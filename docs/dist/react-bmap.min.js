!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],e):"object"==typeof exports?exports.ReactBMap=e(require("react"),require("react-dom")):t.ReactBMap=e(t.React,t.ReactDOM)}("undefined"!=typeof self?self:this,function(t,e){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=10)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(1),u=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"bindEvent",value:function(t,e){var n=this;e&&e.forEach(function(e){t.addEventListener(e,function(){n.props.events&&n.props.events[e]&&n.props.events[e].apply(n,arguments)})})}},{key:"bindToggleMeghods",value:function(t,e){for(var n in e)void 0!==this.props[n]&&(this.props[n]?t[e[n][0]]():t[e[n][1]]())}},{key:"getOptions",value:function(t){var e=this,n={};return t.map(function(t){void 0!==e.props[t]&&(n[t]=e.props[t])}),n}},{key:"render",value:function(){return null}}]),e}(s.Component);e.default=u},function(e,n){e.exports=t},function(t,e,n){(function(t){!function(t,n){n(e)}(0,function(e){"use strict";function n(){this._subscribers={}}function r(t){var e=t.split("|");return e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}function i(t,e){n.bind(this)(),this._options=e||{},this._data=[],t&&this.add(t)}function o(t,e,n){var r=60*n+30,i=Math.PI/180*r;return[t.x+e*Math.cos(i),t.y+e*Math.sin(i)]}function a(t,e,n,r){for(var i=0;i<6;i++){var a=o({x:e,y:n},r,i);t.lineTo(a[0],a[1])}}function s(t,e){var n;if("undefined"==typeof document);else{var n=document.createElement("canvas");t&&(n.width=t),e&&(n.height=e)}return n}function u(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function l(t){var e=t/2,n=t+e,r=new s(2*n,2*n),i=r.getContext("2d");return i.shadowBlur=e,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=1e4,i.beginPath(),i.arc(n-1e4,n-1e4,t,0,2*Math.PI,!0),i.closePath(),i.fill(),r}function h(t,e,n){var r=c(n),i=f(n),o=r-i,a=n.range||null,s=0,u=1024;a&&2===a.length&&(s=(a[0]-i)/o*1024),a&&2===a.length&&(u=(a[1]-i)/o*1024);for(var l,h=n.maxOpacity||.8,p=n.minOpacity||0,a=n.range,d=3,v=t.length;d<v;d+=4)l=4*t[d],t[d]/256>h&&(t[d]=256*h),t[d]/256<p&&(t[d]=256*p),l&&l>=s&&l<=u?(t[d-3]=e[l],t[d-2]=e[l+1],t[d-1]=e[l+2]):t[d]=0}function c(t){return t.max||100}function f(t){return t.min||0}function p(t,e,n){var r=c(n),i=f(n),o=n._size;void 0==o&&void 0==(o=n.size)&&(o=13);var a=new u({gradient:n.gradient,max:r,min:i}),s=l(o),h=s.width/2,p=s.height/2,d=e,v={};d.forEach(function(t,e){var n=void 0===t.count?1:t.count,i=Math.min(1,n/r).toFixed(2);v[i]=v[i]||[],v[i].push(t)});for(var g in v)if(!isNaN(g)){var m=v[g];t.beginPath(),n.withoutAlpha||(t.globalAlpha=g),t.strokeStyle=a.getColor(g*r),m.forEach(function(e,i){if(e.geometry){var o=e.geometry._coordinates||e.geometry.coordinates,a=e.geometry.type;if("Point"===a){var u=void 0===e.count?1:e.count;t.globalAlpha=u/r,t.drawImage(s,o[0]-h,o[1]-p)}else if("LineString"===a){var u=void 0===e.count?1:e.count;t.globalAlpha=u/r,t.beginPath(),zt.draw(t,e,n),t.stroke()}}})}}function d(t,e,n){if(!(t.canvas.width<=0||t.canvas.height<=0)){var r=n.strength||.3;t.strokeStyle="rgba(0,0,0,"+r+")";var o=new s(t.canvas.width,t.canvas.height),a=o.getContext("2d");a.scale(Nt,Nt),n=n||{};var l=e instanceof i?e.get():e;t.save();var c=new u({gradient:n.gradient});if(p(a,l,n),!n.absolute){var f=a.getImageData(0,0,t.canvas.width,t.canvas.height);h(f.data,c.getImageData(),n),t.putImageData(f,0,0),t.restore()}c=null,o=null}}function v(t,e,n){var r=60*n+30,i=Math.PI/180*r;return[t.x+e*Math.cos(i),t.y+e*Math.sin(i)]}function g(t,e,n){var r=t.createShader(n);return t.shaderSource(r,e),t.compileShader(r),r}function m(t,e,n){var r=g(t,e,t.VERTEX_SHADER),i=g(t,n,t.FRAGMENT_SHADER),o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),t.useProgram(o),o}function y(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=t,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data}function b(t,e,n){if(e){var r=m(t,Ht,Wt);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT);var i=t.canvas.width/2,o=t.canvas.height/2,a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var s=t.getAttribLocation(r,"a_Position");t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);var u=t.getUniformLocation(r,"u_FragColor"),l=y(n.strokeStyle||"red");t.uniform4f(u,l[0]/255,l[1]/255,l[2]/255,l[3]/255),t.lineWidth(n.lineWidth||1);for(var h=0,c=e.length;h<c;h++){for(var f=e[h].geometry._coordinates,p=[],d=0;d<f.length;d++){var v=f[d],g=(v[0]-i)/i,b=(o-v[1])/o;p.push(g,b)}var x=new Float32Array(p);t.bufferData(t.ARRAY_BUFFER,x,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,f.length)}}}function x(t,e,n){if(e){var r=m(t,Zt,Xt),i=t.getAttribLocation(r,"a_Position"),o=t.getAttribLocation(r,"a_PointSize"),a=t.getUniformLocation(r,"u_FragColor");t.clear(t.COLOR_BUFFER_BIT);for(var s=t.canvas.width/2,u=t.canvas.height/2,l=[],h=0,c=0;c<e.length;c++){var f=e[c].geometry._coordinates,p=(f[0]-s)/s,d=(u-f[1])/u;p<-1||p>1||d<-1||d>1||(l.push(p,d),h++)}var v=new Float32Array(l),g=h,b=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,b),t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i),t.vertexAttrib1f(o,n._size);var x=y(n.fillStyle||"red");t.uniform4f(a,x[0]/255,x[1]/255,x[2]/255,x[3]/255),t.drawArrays(t.POINTS,0,g)}}function _(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=w(t,0,i,n,!0),a=[];if(!o)return a;var s,u,l,h,c,f,p;if(r&&(o=R(t,e,o,n)),t.length>80*n){s=l=t[0],u=h=t[1];for(var d=n;d<i;d+=n)c=t[d],f=t[d+1],c<s&&(s=c),f<u&&(u=f),c>l&&(l=c),f>h&&(h=f);p=Math.max(l-s,h-u)}return T(o,a,n,s,u,p),a}function w(t,e,n,r,i){var o,a;if(i===K(t,e,n,r)>0)for(o=e;o<n;o+=r)a=X(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=X(o,t[o],t[o+1],a);return a&&Y(a,a.next)&&(G(a),a=a.next),a}function M(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Y(r,r.next)&&0!==j(r.prev,r,r.next))r=r.next;else{if(G(r),(r=e=r.prev)===r.next)return null;n=!0}}while(n||r!==e);return e}function T(t,e,n,r,i,o,a){if(t){!a&&o&&D(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?E(t,r,i,o):A(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),G(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?(t=S(t,e,n),T(t,e,n,r,i,o,2)):2===a&&C(t,e,n,r,i,o):T(M(t),e,n,r,i,o,1);break}}}function A(t){var e=t.prev,n=t,r=t.next;if(j(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(U(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&j(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function E(t,e,n,r){var i=t.prev,o=t,a=t.next;if(j(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,h=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=z(s,u,e,n,r),f=z(l,h,e,n,r),p=t.nextZ;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&U(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&U(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function S(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Y(i,o)&&V(i,r,r.next,o)&&W(i,o)&&W(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),G(r),G(r.next),r=t=o),r=r.next}while(r!==t);return r}function C(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&N(a,s)){var u=Z(a,s);return a=M(a,a.next),u=M(u,u.next),T(a,e,n,r,i,o),void T(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function R(t,e,n,r){var i,o,a,s,u,l=[];for(i=0,o=e.length;i<o;i++)a=e[i]*r,s=i<o-1?e[i+1]*r:t.length,u=w(t,a,s,r,!1),u===u.next&&(u.steiner=!0),l.push(I(u));for(l.sort(O),i=0;i<l.length;i++)k(l[i],n),n=M(n,n.next);return n}function O(t,e){return t.x-e.x}function k(t,e){if(e=F(t,e)){var n=Z(e,t);M(n,n.next)}}function F(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var u,l=n,h=n.x,c=n.y,f=1/0;for(r=n.next;r!==l;)i>=r.x&&r.x>=h&&U(o<c?i:a,o,h,c,o<c?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<f||u===f&&r.x>n.x)&&W(r,t)&&(n=r,f=u),r=r.next;return n}function D(t,e,n,r){var i=t;do{null===i.z&&(i.z=z(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,B(i)}function B(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0===s?(i=r,r=r.nextZ,u--):0!==u&&r?n.z<=r.z?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--):(i=n,n=n.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1);return t}function z(t,e,n,r,i){return t=32767*(t-n)/i,e=32767*(e-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function I(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function U(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function N(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!H(t,e)&&W(t,e)&&W(e,t)&&q(t,e)}function j(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Y(t,e){return t.x===e.x&&t.y===e.y}function V(t,e,n,r){return!!(Y(t,e)&&Y(n,r)||Y(t,r)&&Y(n,e))||j(t,e,n)>0!=j(t,e,r)>0&&j(n,r,t)>0!=j(n,r,e)>0}function H(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&V(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function W(t,e){return j(t.prev,t,t.next)<0?j(t,e,t.next)>=0&&j(t,t.prev,e)>=0:j(t,e,t.prev)<0||j(t,t.next,e)<0}function q(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function Z(t,e){var n=new J(t.i,t.x,t.y),r=new J(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function X(t,e,n,r){var i=new J(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function G(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function J(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function K(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function $(t,e,n){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);var r=m(t,Jt,Kt);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);var i=t.canvas.width/2,o=t.canvas.height/2;t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer());var a=t.getAttribLocation(r,"a_Position");t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var s=t.getUniformLocation(r,"u_FragColor"),u=y(n.fillStyle||"red");t.uniform4f(s,u[0]/255,u[1]/255,u[2]/255,u[3]/255),t.lineWidth(n.lineWidth||1);for(var l=[],h=[],c=0,f=0,p=e.length;f<p;f++){var d=_.flatten(e[f].geometry._coordinates||e[f].geometry.coordinates),v=d.vertices;c=l.length/2;for(var g=0;g<v.length;g+=2)v[g]=(v[g]-i)/i,v[g+1]=(o-v[g+1])/o;(l.length+v.length)/2>65536&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),l.length=0,h.length=0,c=0);for(var g=0;g<v.length;g++)l.push(v[g]);for(var b=_(v,d.holes,d.dimensions),g=0;g<b.length;g++)h.push(b[g]+c)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}function Q(t,e){e=e||{};for(var n=[],r=0;r<t.length-1;r++){var i=tt(t[r],t[r+1],e.count);i&&i.length>0&&(n=n.concat(i))}return n}function tt(t,e,n){if(!t||!e)return null;var r,i,o,a,s,u,l=function(t){return 1-2*t+t*t},h=function(t){return 2*t-2*t*t},c=function(t){return t*t},f=[],n=n||40,p=0,d=0;if(void 0===e)return void(void 0!==f&&(f=[]));var v=parseFloat(t.lat),g=parseFloat(e.lat),m=parseFloat(t.lng),y=parseFloat(e.lng);for(y>m&&parseFloat(y-m)>180&&m<0&&(m=parseFloat(360+m),y=parseFloat(360+y)),0,u=0,g==v?(r=0,i=m-y):y==m?(r=Math.PI/2,i=v-g):(r=Math.atan((g-v)/(y-m)),i=(g-v)/Math.sin(r)),0==u&&(u=r+Math.PI/5),o=i/2,s=o*Math.cos(u)+m,a=o*Math.sin(u)+v,p=0;p<n+1;p++){var b=m*l(d)+s*h(d)+y*c(d),x=v*l(d)+a*h(d)+g*c(d),_=t.lng,w=e.lng;f.push([_<0&&w>0?b-360:b,x]),d+=1/n}return f}function et(t){this.splitList=t||{other:1}}function nt(t){this.splitList=t||[{start:0,value:"red"}]}function rt(t){this.options=t||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=t.map,this._lastDrawTime=null,this.show()}function it(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=360*Math.atan(r/n)/(2*Math.PI);return e[0]<t[0]&&(i+=180),i}function ot(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function at(t,e){for(var n=0;n<t.length;n++)if(st(t[n],e))return!0;return!1}function st(t,e){var n=Math.min(t.ne.x,e.ne.x),r=Math.min(t.sw.y,e.sw.y),i=Math.max(t.sw.x,e.sw.x),o=Math.max(t.ne.y,e.ne.y);return n>i&&r>o}function ut(t,e,n,r,i,o){if(!(i-r<=n)){var a=r+i>>1;lt(t,e,a,r,i,o%2),ut(t,e,n,r,a-1,o+1),ut(t,e,n,a+1,i,o+1)}}function lt(t,e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);lt(t,e,n,Math.max(r,Math.floor(n-s*l/a+h)),Math.min(i,Math.floor(n+(a-s)*l/a+h)),o)}var c=e[2*n+o],f=r,p=i;for(ht(t,e,r,n),e[2*i+o]>c&&ht(t,e,r,i);f<p;){for(ht(t,e,f,p),f++,p--;e[2*f+o]<c;)f++;for(;e[2*p+o]>c;)p--}e[2*r+o]===c?ht(t,e,r,p):(p++,ht(t,e,p,i)),p<=n&&(r=p+1),n<=p&&(i=p-1)}}function ht(t,e,n,r){ct(t,n,r),ct(e,2*n,2*r),ct(e,2*n+1,2*r+1)}function ct(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ft(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],h=[];l.length;){var c=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&h.push(t[d]);else{var v=Math.floor((p+f)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&h.push(t[v]);var g=(c+1)%2;(0===c?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===c?i>=s:o>=u)&&(l.push(v+1),l.push(f),l.push(g))}}return h}function pt(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(var f=c;f<=h;f++)dt(e[2*f],e[2*f+1],n,r)<=u&&s.push(t[f]);else{var p=Math.floor((c+h)/2),d=e[2*p],v=e[2*p+1];dt(d,v,n,r)<=u&&s.push(t[p]);var g=(l+1)%2;(0===l?n-i<=d:r-i<=v)&&(a.push(c),a.push(p-1),a.push(g)),(0===l?n+i>=d:r+i>=v)&&(a.push(p+1),a.push(h),a.push(g))}}return s}function dt(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}function vt(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function gt(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:bt(r),y:xt(i),zoom:1/0,index:e,parentId:-1}}function mt(t){return{type:"Feature",id:t.id,properties:yt(t),geometry:{type:"Point",coordinates:[_t(t.x),wt(t.y)]}}}function yt(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return Mt(Mt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function bt(t){return t/360+.5}function xt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function _t(t){return 360*(t-.5)}function wt(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Mt(t,e){for(var n in e)t[n]=e[n];return t}function Tt(t){return t.x}function At(t){return t.y}function Et(t){requestAnimationFrame(Et),oe.update(t)}function Pt(t){function e(t,e){return function(){e.apply(t)}}this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=Pt.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var n=document.createElement("canvas");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.pointerEvents="none",this.canvas=n,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=e(this,this.repositionCanvas_),this.resizeFunction_=e(this,this.resize_),this.requestUpdateFunction_=e(this,this.update_),t&&this.setOptions(t)}var St=function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)},Ct=function(t){var e=window.devicePixelRatio||1;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)};n.prototype.on=function(t,e){var n=this._subscribers[t];n||(n=[],this._subscribers[t]=n),n.push({callback:e})},n.prototype.off=function(t,e){var n=this._subscribers[t];if(n)for(var r=0;r<n.length;r++)n[r].callback==e&&(n.splice(r,1),r--)},n.prototype._trigger=function(t,e,n){if("*"==t)throw new Error("Cannot trigger event *");var r=[];t in this._subscribers&&(r=r.concat(this._subscribers[t])),"*"in this._subscribers&&(r=r.concat(this._subscribers["*"]));for(var i=0,o=r.length;i<o;i++){var a=r[i];a.callback&&a.callback(t,e,n||null)}};var Lt={municipalities:[{n:"北京",g:"116.395645,39.929986|12"},{n:"上海",g:"121.487899,31.249162|12"},{n:"天津",g:"117.210813,39.14393|12"},{n:"重庆",g:"106.530635,29.544606|12"}],provinces:[{n:"安徽",g:"117.216005,31.859252|8",cities:[{n:"合肥",g:"117.282699,31.866942|12"},{n:"安庆",g:"117.058739,30.537898|13"},{n:"蚌埠",g:"117.35708,32.929499|13"},{n:"亳州",g:"115.787928,33.871211|13"},{n:"巢湖",g:"117.88049,31.608733|13"},{n:"池州",g:"117.494477,30.660019|14"},{n:"滁州",g:"118.32457,32.317351|13"},{n:"阜阳",g:"115.820932,32.901211|13"},{n:"淮北",g:"116.791447,33.960023|13"},{n:"淮南",g:"117.018639,32.642812|13"},{n:"黄山",g:"118.29357,29.734435|13"},{n:"六安",g:"116.505253,31.755558|13"},{n:"马鞍山",g:"118.515882,31.688528|13"},{n:"宿州",g:"116.988692,33.636772|13"},{n:"铜陵",g:"117.819429,30.94093|14"},{n:"芜湖",g:"118.384108,31.36602|12"},{n:"宣城",g:"118.752096,30.951642|13"}]},{n:"福建",g:"117.984943,26.050118|8",cities:[{n:"福州",g:"119.330221,26.047125|12"},{n:"龙岩",g:"117.017997,25.078685|13"},{n:"南平",g:"118.181883,26.643626|13"},{n:"宁德",g:"119.542082,26.656527|14"},{n:"莆田",g:"119.077731,25.44845|13"},{n:"泉州",g:"118.600362,24.901652|12"},{n:"三明",g:"117.642194,26.270835|14"},{n:"厦门",g:"118.103886,24.489231|12"},{n:"漳州",g:"117.676205,24.517065|12"}]},{n:"甘肃",g:"102.457625,38.103267|6",cities:[{n:"兰州",g:"103.823305,36.064226|12"},{n:"白银",g:"104.171241,36.546682|13"},{n:"定西",g:"104.626638,35.586056|13"},{n:"甘南州",g:"102.917442,34.992211|14"},{n:"嘉峪关",g:"98.281635,39.802397|13"},{n:"金昌",g:"102.208126,38.516072|13"},{n:"酒泉",g:"98.508415,39.741474|13"},{n:"临夏州",g:"103.215249,35.598514|13"},{n:"陇南",g:"104.934573,33.39448|14"},{n:"平凉",g:"106.688911,35.55011|13"},{n:"庆阳",g:"107.644227,35.726801|13"},{n:"天水",g:"105.736932,34.584319|13"},{n:"武威",g:"102.640147,37.933172|13"},{n:"张掖",g:"100.459892,38.93932|13"}]},{n:"广东",g:"113.394818,23.408004|8",cities:[{n:"广州",g:"113.30765,23.120049|12"},{n:"潮州",g:"116.630076,23.661812|13"},{n:"东莞",g:"113.763434,23.043024|12"},{n:"佛山",g:"113.134026,23.035095|13"},{n:"河源",g:"114.713721,23.757251|12"},{n:"惠州",g:"114.410658,23.11354|12"},{n:"江门",g:"113.078125,22.575117|13"},{n:"揭阳",g:"116.379501,23.547999|13"},{n:"茂名",g:"110.931245,21.668226|13"},{n:"梅州",g:"116.126403,24.304571|13"},{n:"清远",g:"113.040773,23.698469|13"},{n:"汕头",g:"116.72865,23.383908|13"},{n:"汕尾",g:"115.372924,22.778731|14"},{n:"韶关",g:"113.594461,24.80296|13"},{n:"深圳",g:"114.025974,22.546054|12"},{n:"阳江",g:"111.97701,21.871517|14"},{n:"云浮",g:"112.050946,22.937976|13"},{n:"湛江",g:"110.365067,21.257463|13"},{n:"肇庆",g:"112.479653,23.078663|13"},{n:"中山",g:"113.42206,22.545178|12"},{n:"珠海",g:"113.562447,22.256915|13"}]},{n:"广西",g:"108.924274,23.552255|7",cities:[{n:"南宁",g:"108.297234,22.806493|12"},{n:"百色",g:"106.631821,23.901512|13"},{n:"北海",g:"109.122628,21.472718|13"},{n:"崇左",g:"107.357322,22.415455|14"},{n:"防城港",g:"108.351791,21.617398|15"},{n:"桂林",g:"110.26092,25.262901|12"},{n:"贵港",g:"109.613708,23.103373|13"},{n:"河池",g:"108.069948,24.699521|14"},{n:"贺州",g:"111.552594,24.411054|14"},{n:"来宾",g:"109.231817,23.741166|14"},{n:"柳州",g:"109.422402,24.329053|12"},{n:"钦州",g:"108.638798,21.97335|13"},{n:"梧州",g:"111.305472,23.485395|13"},{n:"玉林",g:"110.151676,22.643974|14"}]},{n:"贵州",g:"106.734996,26.902826|8",cities:[{n:"贵阳",g:"106.709177,26.629907|12"},{n:"安顺",g:"105.92827,26.228595|13"},{n:"毕节地区",g:"105.300492,27.302612|14"},{n:"六盘水",g:"104.852087,26.591866|13"},{n:"铜仁地区",g:"109.196161,27.726271|14"},{n:"遵义",g:"106.93126,27.699961|13"},{n:"黔西南州",g:"104.900558,25.095148|11"},{n:"黔东南州",g:"107.985353,26.583992|11"},{n:"黔南州",g:"107.523205,26.264536|11"}]},{n:"海南",g:"109.733755,19.180501|9",cities:[{n:"海口",g:"110.330802,20.022071|13"},{n:"白沙",g:"109.358586,19.216056|12"},{n:"保亭",g:"109.656113,18.597592|12"},{n:"昌江",g:"109.0113,19.222483|12"},{n:"儋州",g:"109.413973,19.571153|13"},{n:"澄迈",g:"109.996736,19.693135|13"},{n:"东方",g:"108.85101,18.998161|13"},{n:"定安",g:"110.32009,19.490991|13"},{n:"琼海",g:"110.414359,19.21483|13"},{n:"琼中",g:"109.861849,19.039771|12"},{n:"乐东",g:"109.062698,18.658614|12"},{n:"临高",g:"109.724101,19.805922|13"},{n:"陵水",g:"109.948661,18.575985|12"},{n:"三亚",g:"109.522771,18.257776|12"},{n:"屯昌",g:"110.063364,19.347749|13"},{n:"万宁",g:"110.292505,18.839886|13"},{n:"文昌",g:"110.780909,19.750947|13"},{n:"五指山",g:"109.51775,18.831306|13"}]},{n:"河北",g:"115.661434,38.61384|7",cities:[{n:"石家庄",g:"114.522082,38.048958|12"},{n:"保定",g:"115.49481,38.886565|13"},{n:"沧州",g:"116.863806,38.297615|13"},{n:"承德",g:"117.933822,40.992521|14"},{n:"邯郸",g:"114.482694,36.609308|13"},{n:"衡水",g:"115.686229,37.746929|13"},{n:"廊坊",g:"116.703602,39.518611|13"},{n:"秦皇岛",g:"119.604368,39.945462|12"},{n:"唐山",g:"118.183451,39.650531|13"},{n:"邢台",g:"114.520487,37.069531|13"},{n:"张家口",g:"114.893782,40.811188|13"}]},{n:"河南",g:"113.486804,34.157184|7",cities:[{n:"郑州",g:"113.649644,34.75661|12"},{n:"安阳",g:"114.351807,36.110267|12"},{n:"鹤壁",g:"114.29777,35.755426|13"},{n:"焦作",g:"113.211836,35.234608|13"},{n:"开封",g:"114.351642,34.801854|13"},{n:"洛阳",g:"112.447525,34.657368|12"},{n:"漯河",g:"114.046061,33.576279|13"},{n:"南阳",g:"112.542842,33.01142|13"},{n:"平顶山",g:"113.300849,33.745301|13"},{n:"濮阳",g:"115.026627,35.753298|12"},{n:"三门峡",g:"111.181262,34.78332|13"},{n:"商丘",g:"115.641886,34.438589|13"},{n:"新乡",g:"113.91269,35.307258|13"},{n:"信阳",g:"114.085491,32.128582|13"},{n:"许昌",g:"113.835312,34.02674|13"},{n:"周口",g:"114.654102,33.623741|13"},{n:"驻马店",g:"114.049154,32.983158|13"}]},{n:"黑龙江",g:"128.047414,47.356592|6",cities:[{n:"哈尔滨",g:"126.657717,45.773225|12"},{n:"大庆",g:"125.02184,46.596709|12"},{n:"大兴安岭地区",g:"124.196104,51.991789|10"},{n:"鹤岗",g:"130.292472,47.338666|13"},{n:"黑河",g:"127.50083,50.25069|14"},{n:"鸡西",g:"130.941767,45.32154|13"},{n:"佳木斯",g:"130.284735,46.81378|12"},{n:"牡丹江",g:"129.608035,44.588521|13"},{n:"七台河",g:"131.019048,45.775005|14"},{n:"齐齐哈尔",g:"123.987289,47.3477|13"},{n:"双鸭山",g:"131.171402,46.655102|13"},{n:"绥化",g:"126.989095,46.646064|13"},{n:"伊春",g:"128.910766,47.734685|14"}]},{n:"湖北",g:"112.410562,31.209316|8",cities:[{n:"武汉",g:"114.3162,30.581084|12"},{n:"鄂州",g:"114.895594,30.384439|14"},{n:"恩施",g:"109.517433,30.308978|14"},{n:"黄冈",g:"114.906618,30.446109|14"},{n:"黄石",g:"115.050683,30.216127|13"},{n:"荆门",g:"112.21733,31.042611|13"},{n:"荆州",g:"112.241866,30.332591|12"},{n:"潜江",g:"112.768768,30.343116|13"},{n:"神农架林区",g:"110.487231,31.595768|13"},{n:"十堰",g:"110.801229,32.636994|13"},{n:"随州",g:"113.379358,31.717858|13"},{n:"天门",g:"113.12623,30.649047|13"},{n:"仙桃",g:"113.387448,30.293966|13"},{n:"咸宁",g:"114.300061,29.880657|13"},{n:"襄阳",g:"112.176326,32.094934|12"},{n:"孝感",g:"113.935734,30.927955|13"},{n:"宜昌",g:"111.310981,30.732758|13"}]},{n:"湖南",g:"111.720664,27.695864|7",cities:[{n:"长沙",g:"112.979353,28.213478|12"},{n:"常德",g:"111.653718,29.012149|12"},{n:"郴州",g:"113.037704,25.782264|13"},{n:"衡阳",g:"112.583819,26.898164|13"},{n:"怀化",g:"109.986959,27.557483|13"},{n:"娄底",g:"111.996396,27.741073|13"},{n:"邵阳",g:"111.461525,27.236811|13"},{n:"湘潭",g:"112.935556,27.835095|13"},{n:"湘西州",g:"109.745746,28.317951|14"},{n:"益阳",g:"112.366547,28.588088|13"},{n:"永州",g:"111.614648,26.435972|13"},{n:"岳阳",g:"113.146196,29.378007|13"},{n:"张家界",g:"110.48162,29.124889|13"},{n:"株洲",g:"113.131695,27.827433|13"}]},{n:"江苏",g:"119.368489,33.013797|8",cities:[{n:"南京",g:"118.778074,32.057236|12"},{n:"常州",g:"119.981861,31.771397|12"},{n:"淮安",g:"119.030186,33.606513|12"},{n:"连云港",g:"119.173872,34.601549|12"},{n:"南通",g:"120.873801,32.014665|12"},{n:"苏州",g:"120.619907,31.317987|12"},{n:"宿迁",g:"118.296893,33.95205|13"},{n:"泰州",g:"119.919606,32.476053|13"},{n:"无锡",g:"120.305456,31.570037|12"},{n:"徐州",g:"117.188107,34.271553|12"},{n:"盐城",g:"120.148872,33.379862|12"},{n:"扬州",g:"119.427778,32.408505|13"},{n:"镇江",g:"119.455835,32.204409|13"}]},{n:"江西",g:"115.676082,27.757258|7",cities:[{n:"南昌",g:"115.893528,28.689578|12"},{n:"抚州",g:"116.360919,27.954545|13"},{n:"赣州",g:"114.935909,25.845296|13"},{n:"吉安",g:"114.992039,27.113848|13"},{n:"景德镇",g:"117.186523,29.303563|12"},{n:"九江",g:"115.999848,29.71964|13"},{n:"萍乡",g:"113.859917,27.639544|13"},{n:"上饶",g:"117.955464,28.457623|13"},{n:"新余",g:"114.947117,27.822322|13"},{n:"宜春",g:"114.400039,27.81113|13"},{n:"鹰潭",g:"117.03545,28.24131|13"}]},{n:"吉林",g:"126.262876,43.678846|7",cities:[{n:"长春",g:"125.313642,43.898338|12"},{n:"白城",g:"122.840777,45.621086|13"},{n:"白山",g:"126.435798,41.945859|13"},{n:"吉林",g:"126.564544,43.871988|12"},{n:"辽源",g:"125.133686,42.923303|13"},{n:"四平",g:"124.391382,43.175525|12"},{n:"松原",g:"124.832995,45.136049|13"},{n:"通化",g:"125.94265,41.736397|13"},{n:"延边",g:"129.485902,42.896414|13"}]},{n:"辽宁",g:"122.753592,41.6216|8",cities:[{n:"沈阳",g:"123.432791,41.808645|12"},{n:"鞍山",g:"123.007763,41.118744|13"},{n:"本溪",g:"123.778062,41.325838|12"},{n:"朝阳",g:"120.446163,41.571828|13"},{n:"大连",g:"121.593478,38.94871|12"},{n:"丹东",g:"124.338543,40.129023|12"},{n:"抚顺",g:"123.92982,41.877304|12"},{n:"阜新",g:"121.660822,42.01925|14"},{n:"葫芦岛",g:"120.860758,40.74303|13"},{n:"锦州",g:"121.147749,41.130879|13"},{n:"辽阳",g:"123.172451,41.273339|14"},{n:"盘锦",g:"122.073228,41.141248|13"},{n:"铁岭",g:"123.85485,42.299757|13"},{n:"营口",g:"122.233391,40.668651|13"}]},{n:"内蒙古",g:"114.415868,43.468238|5",cities:[{n:"呼和浩特",g:"111.660351,40.828319|12"},{n:"阿拉善盟",g:"105.695683,38.843075|14"},{n:"包头",g:"109.846239,40.647119|12"},{n:"巴彦淖尔",g:"107.423807,40.76918|12"},{n:"赤峰",g:"118.930761,42.297112|12"},{n:"鄂尔多斯",g:"109.993706,39.81649|12"},{n:"呼伦贝尔",g:"119.760822,49.201636|12"},{n:"通辽",g:"122.260363,43.633756|12"},{n:"乌海",g:"106.831999,39.683177|13"},{n:"乌兰察布",g:"113.112846,41.022363|12"},{n:"锡林郭勒盟",g:"116.02734,43.939705|11"},{n:"兴安盟",g:"122.048167,46.083757|11"}]},{n:"宁夏",g:"106.155481,37.321323|8",cities:[{n:"银川",g:"106.206479,38.502621|12"},{n:"固原",g:"106.285268,36.021523|13"},{n:"石嘴山",g:"106.379337,39.020223|13"},{n:"吴忠",g:"106.208254,37.993561|14"},{n:"中卫",g:"105.196754,37.521124|14"}]},{n:"青海",g:"96.202544,35.499761|7",cities:[{n:"西宁",g:"101.767921,36.640739|12"},{n:"果洛州",g:"100.223723,34.480485|11"},{n:"海东地区",g:"102.085207,36.51761|11"},{n:"海北州",g:"100.879802,36.960654|11"},{n:"海南州",g:"100.624066,36.284364|11"},{n:"海西州",g:"97.342625,37.373799|11"},{n:"黄南州",g:"102.0076,35.522852|11"},{n:"玉树州",g:"97.013316,33.00624|14"}]},{n:"山东",g:"118.527663,36.09929|8",cities:[{n:"济南",g:"117.024967,36.682785|12"},{n:"滨州",g:"117.968292,37.405314|12"},{n:"东营",g:"118.583926,37.487121|12"},{n:"德州",g:"116.328161,37.460826|12"},{n:"菏泽",g:"115.46336,35.26244|13"},{n:"济宁",g:"116.600798,35.402122|13"},{n:"莱芜",g:"117.684667,36.233654|13"},{n:"聊城",g:"115.986869,36.455829|12"},{n:"临沂",g:"118.340768,35.072409|12"},{n:"青岛",g:"120.384428,36.105215|12"},{n:"日照",g:"119.50718,35.420225|12"},{n:"泰安",g:"117.089415,36.188078|13"},{n:"威海",g:"122.093958,37.528787|13"},{n:"潍坊",g:"119.142634,36.716115|12"},{n:"烟台",g:"121.309555,37.536562|12"},{n:"枣庄",g:"117.279305,34.807883|13"},{n:"淄博",g:"118.059134,36.804685|12"}]},{n:"山西",g:"112.515496,37.866566|7",cities:[{n:"太原",g:"112.550864,37.890277|12"},{n:"长治",g:"113.120292,36.201664|12"},{n:"大同",g:"113.290509,40.113744|12"},{n:"晋城",g:"112.867333,35.499834|13"},{n:"晋中",g:"112.738514,37.693362|13"},{n:"临汾",g:"111.538788,36.099745|13"},{n:"吕梁",g:"111.143157,37.527316|14"},{n:"朔州",g:"112.479928,39.337672|13"},{n:"忻州",g:"112.727939,38.461031|12"},{n:"阳泉",g:"113.569238,37.869529|13"},{n:"运城",g:"111.006854,35.038859|13"}]},{n:"陕西",g:"109.503789,35.860026|7",cities:[{n:"西安",g:"108.953098,34.2778|12"},{n:"安康",g:"109.038045,32.70437|13"},{n:"宝鸡",g:"107.170645,34.364081|12"},{n:"汉中",g:"107.045478,33.081569|13"},{n:"商洛",g:"109.934208,33.873907|13"},{n:"铜川",g:"108.968067,34.908368|13"},{n:"渭南",g:"109.483933,34.502358|13"},{n:"咸阳",g:"108.707509,34.345373|13"},{n:"延安",g:"109.50051,36.60332|13"},{n:"榆林",g:"109.745926,38.279439|12"}]},{n:"四川",g:"102.89916,30.367481|7",cities:[{n:"成都",g:"104.067923,30.679943|12"},{n:"阿坝州",g:"102.228565,31.905763|15"},{n:"巴中",g:"106.757916,31.869189|14"},{n:"达州",g:"107.494973,31.214199|14"},{n:"德阳",g:"104.402398,31.13114|13"},{n:"甘孜州",g:"101.969232,30.055144|15"},{n:"广安",g:"106.63572,30.463984|13"},{n:"广元",g:"105.819687,32.44104|13"},{n:"乐山",g:"103.760824,29.600958|13"},{n:"凉山州",g:"102.259591,27.892393|14"},{n:"泸州",g:"105.44397,28.89593|14"},{n:"南充",g:"106.105554,30.800965|13"},{n:"眉山",g:"103.84143,30.061115|13"},{n:"绵阳",g:"104.705519,31.504701|12"},{n:"内江",g:"105.073056,29.599462|13"},{n:"攀枝花",g:"101.722423,26.587571|14"},{n:"遂宁",g:"105.564888,30.557491|12"},{n:"雅安",g:"103.009356,29.999716|13"},{n:"宜宾",g:"104.633019,28.769675|13"},{n:"资阳",g:"104.63593,30.132191|13"},{n:"自贡",g:"104.776071,29.359157|13"}]},{n:"西藏",g:"89.137982,31.367315|6",cities:[{n:"拉萨",g:"91.111891,29.662557|13"},{n:"阿里地区",g:"81.107669,30.404557|11"},{n:"昌都地区",g:"97.185582,31.140576|15"},{n:"林芝地区",g:"94.349985,29.666941|11"},{n:"那曲地区",g:"92.067018,31.48068|14"},{n:"日喀则地区",g:"88.891486,29.269023|14"},{n:"山南地区",g:"91.750644,29.229027|11"}]},{n:"新疆",g:"85.614899,42.127001|6",cities:[{n:"乌鲁木齐",g:"87.564988,43.84038|12"},{n:"阿拉尔",g:"81.291737,40.61568|13"},{n:"阿克苏地区",g:"80.269846,41.171731|12"},{n:"阿勒泰地区",g:"88.137915,47.839744|13"},{n:"巴音郭楞",g:"86.121688,41.771362|12"},{n:"博尔塔拉州",g:"82.052436,44.913651|11"},{n:"昌吉州",g:"87.296038,44.007058|13"},{n:"哈密地区",g:"93.528355,42.858596|13"},{n:"和田地区",g:"79.930239,37.116774|13"},{n:"喀什地区",g:"75.992973,39.470627|12"},{n:"克拉玛依",g:"84.88118,45.594331|13"},{n:"克孜勒苏州",g:"76.137564,39.750346|11"},{n:"石河子",g:"86.041865,44.308259|13"},{n:"塔城地区",g:"82.974881,46.758684|12"},{n:"图木舒克",g:"79.198155,39.889223|13"},{n:"吐鲁番地区",g:"89.181595,42.96047|13"},{n:"五家渠",g:"87.565449,44.368899|13"},{n:"伊犁州",g:"81.297854,43.922248|11"}]},{n:"云南",g:"101.592952,24.864213|7",cities:[{n:"昆明",g:"102.714601,25.049153|12"},{n:"保山",g:"99.177996,25.120489|13"},{n:"楚雄州",g:"101.529382,25.066356|13"},{n:"大理州",g:"100.223675,25.5969|14"},{n:"德宏州",g:"98.589434,24.44124|14"},{n:"迪庆州",g:"99.713682,27.831029|14"},{n:"红河州",g:"103.384065,23.367718|11"},{n:"丽江",g:"100.229628,26.875351|13"},{n:"临沧",g:"100.092613,23.887806|14"},{n:"怒江州",g:"98.859932,25.860677|14"},{n:"普洱",g:"100.980058,22.788778|14"},{n:"曲靖",g:"103.782539,25.520758|12"},{n:"昭通",g:"103.725021,27.340633|13"},{n:"文山",g:"104.089112,23.401781|14"},{n:"西双版纳",g:"100.803038,22.009433|13"},{n:"玉溪",g:"102.545068,24.370447|13"}]},{n:"浙江",g:"119.957202,29.159494|8",cities:[{n:"杭州",g:"120.219375,30.259244|12"},{n:"湖州",g:"120.137243,30.877925|12"},{n:"嘉兴",g:"120.760428,30.773992|13"},{n:"金华",g:"119.652576,29.102899|12"},{n:"丽水",g:"119.929576,28.4563|13"},{n:"宁波",g:"121.579006,29.885259|12"},{n:"衢州",g:"118.875842,28.95691|12"},{n:"绍兴",g:"120.592467,30.002365|13"},{n:"台州",g:"121.440613,28.668283|13"},{n:"温州",g:"120.690635,28.002838|12"},{n:"舟山",g:"122.169872,30.03601|13"}]}],other:[{n:"香港",g:"114.186124,22.293586|11"},{n:"澳门",g:"113.557519,22.204118|13"},{n:"台湾",g:"120.961454,23.80406|8"}]},Rt={getProvinceNameByCityName:function(t){for(var e=Lt.provinces,n=0;n<e.length;n++)for(var r=e[n].n,i=e[n].cities,o=0;o<i.length;o++)if(i[o].n==t)return r;return null},getCenterByCityName:function(t){t=t.replace("市","");for(var e=0;e<Lt.municipalities.length;e++)if(Lt.municipalities[e].n==t)return r(Lt.municipalities[e].g);for(var e=0;e<Lt.other.length;e++)if(Lt.other[e].n==t)return r(Lt.other[e].g);for(var n=Lt.provinces,e=0;e<n.length;e++){if(n[e].n==t)return r(n[e].g);for(var i=n[e].cities,o=0;o<i.length;o++)if(i[o].n==t)return r(i[o].g)}return null}},Ot=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},kt=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Ft=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},Dt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Bt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};i.prototype=Object.create(n.prototype),i.prototype.add=function(t,e){if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(t[n]){if(t[n].time&&14==t[n].time.length&&"20"==t[n].time.substr(0,2)){var i=t[n].time;t[n].time=new Date(i.substr(0,4)+"-"+i.substr(4,2)+"-"+i.substr(6,2)+" "+i.substr(8,2)+":"+i.substr(10,2)+":"+i.substr(12,2)).getTime()}this._data.push(t[n])}}else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},i.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},i.prototype.get=function(t){t=t||{};var e=(new Date,this._data);new Date;if(t.filter){for(var n=[],r=0;r<e.length;r++)t.filter(e[r])&&n.push(e[r]);e=n}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn)),e},i.prototype.set=function(t){this._set(t),this._trigger("change")},i.prototype._set=function(t){this.clear(),this.add(t)},i.prototype.clear=function(t){this._data=[]},i.prototype.remove=function(t){},i.prototype.update=function(t,e){for(var n=this._data,r=0;r<n.length;r++)if(e){var i=!0;for(var o in e)n[r][o]!=e[o]&&(i=!1);i&&t&&t(n[r])}else t&&t(n[r]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},i.prototype.transferCoordinate=function(t,e,n,r){function i(t){for(var n=[],r=0;r<t.length;r++){for(var i=t[r],o=[],a=0;a<i.length;a++)o.push(e(i[a]));n.push(o)}return n}r=r||"_coordinates",n=n||"coordinates";for(var o=0;o<t.length;o++){var a=t[o].geometry,s=a[n];switch(a.type){case"Point":a[r]=e(s);break;case"LineString":for(var u=[],l=0;l<s.length;l++)u.push(e(s[l]));a[r]=u;break;case"MultiLineString":case"Polygon":var u=i(s);a[r]=u;break;case"MultiPolygon":for(var u=[],h=0;h<s.length;h++){var c=s[h],c=i(c);u.push(c)}a[r]=u}}return t},i.prototype.initGeometry=function(t){t?this._data.forEach(function(e){e.geometry=t(e)}):this._data.forEach(function(t){if(!t.geometry)if(t.lng&&t.lat)t.geometry={type:"Point",coordinates:[t.lng,t.lat]};else if(t.city){var e=Rt.getCenterByCityName(t.city);e&&(t.geometry={type:"Point",coordinates:[e.lng,e.lat]})}})},i.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),r=1;r<e.length;r++){var i=parseFloat(e[r][t]);i>n&&(n=i)}return n}},i.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=0,r=0;r<e.length;r++)e[r][t]&&(n+=parseFloat(e[r][t]));return n}},i.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),r=1;r<e.length;r++){var i=parseFloat(e[r][t]);i<n&&(n=i)}return n}},i.prototype.getUnique=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n={},r=1;r<e.length;r++)n[e[r][t]]=!0;var e=[];for(var i in n)e.push(i);return e}};var zt={drawDataSet:function(t,e,n){for(var r=e instanceof i?e.get():e,o=0,a=r.length;o<a;o++){var s=r[o];this.draw(t,s,n)}},draw:function(t,e,n){var r=e.geometry.type,i=e.geometry._coordinates||e.geometry.coordinates,o=e.symbol||n.symbol||"circle";switch(r){case"Point":var s=e._size||e.size||n._size||n.size||5;"circle"===o?("Point"===n.bigData&&t.moveTo(i[0],i[1]),t.arc(i[0],i[1],s,0,2*Math.PI)):"rect"===o?t.rect(i[0]-s/2,i[1]-s/2,s,s):"honeycomb"===o&&a(t,i[0],i[1],s);break;case"LineString":this.drawLineString(t,i);break;case"MultiLineString":for(var u=0;u<i.length;u++){var l=i[u];this.drawLineString(t,l)}break;case"Polygon":this.drawPolygon(t,i);break;case"MultiPolygon":for(var u=0;u<i.length;u++){var h=i[u];if(this.drawPolygon(t,h),n.multiPolygonDraw){var c=n.multiPolygonDraw();if(c)return c}}break;default:console.error("type"+r+"is not support now!")}},drawLineString:function(t,e){for(var n=0;n<e.length;n++){var r=e[n][0],i=e[n][1];0==n?t.moveTo(r,i):t.lineTo(r,i)}},drawPolygon:function(t,e){t.beginPath();for(var n=0;n<e.length;n++){var r=e[n];t.moveTo(r[0][0],r[0][1]);for(var i=1;i<r.length;i++)t.lineTo(r[i][0],r[i][1]);t.lineTo(r[0][0],r[0][1]),t.closePath()}}},It={draw:function(t,e,n){var r=e instanceof i?e.get():e;t.save();for(var o in n)t[o]=n[o];if(n.bigData){t.save(),t.beginPath();for(var a=0,s=r.length;a<s;a++){var u=r[a];zt.draw(t,u,n)}var l=n.bigData;"Point"==l||"Polygon"==l||"MultiPolygon"==l?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),u.lineDash&&t.setLineDash(u.lineDash),(u.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=l&&"MultiLineString"!=l||t.stroke(),t.restore()}else for(var a=0,s=r.length;a<s;a++){var u=r[a];t.save(),(u.fillStyle||u._fillStyle)&&(t.fillStyle=u.fillStyle||u._fillStyle),(u.strokeStyle||u._strokeStyle)&&(t.strokeStyle=u.strokeStyle||u._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),u.lineDash&&t.setLineDash(u.lineDash);var l=u.geometry.type;t.beginPath(),n.multiPolygonDraw=function(){t.fill(),(u.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()},zt.draw(t,u,n),"Point"==l||"Polygon"==l||"MultiPolygon"==l?(t.fill(),(u.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=l&&"MultiLineString"!=l||((u.lineWidth||u._lineWidth)&&(t.lineWidth=u.lineWidth||u._lineWidth),t.stroke()),t.restore()}t.restore()}};u.prototype.setMax=function(t){this.max=t||100},u.prototype.setMin=function(t){this.min=t||0},u.prototype.setMaxSize=function(t){this.maxSize=t||35},u.prototype.setMinSize=function(t){this.minSize=t||0},u.prototype.initPalette=function(){var t=this.gradient,e=new s(256,1),n=this.paletteCtx=e.getContext("2d"),r=n.createLinearGradient(0,0,256,1);for(var i in t)r.addColorStop(parseFloat(i),t[i]);n.fillStyle=r,n.fillRect(0,0,256,1)},u.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},u.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var n=this.max,r=this.min;t>n&&(t=n),t<r&&(t=r);var i=4*Math.floor((t-r)/(n-r)*255);return[e[i],e[i+1],e[i+2],e[i+3]]},u.prototype.getSize=function(t){var e=this.max,n=this.min,r=this.maxSize,i=this.minSize;return t>e&&(t=e),t<n&&(t=n),e>n?i+(t-n)/(e-n)*(r-i):r},u.prototype.getLegend=function(t){var e=this.gradient,n=t.width||20,r=t.height||180,i=new s(n,r),o=i.getContext("2d"),a=o.createLinearGradient(0,r,0,0);for(var u in e)a.addColorStop(parseFloat(u),e[u]);return o.fillStyle=a,o.fillRect(0,0,n,r),i};var Ut="undefined"==typeof window?{}:window,Nt=Ut.devicePixelRatio||1,jt={draw:d},Yt={draw:function(t,e,n){t.save();var r=e instanceof i?e.get():e,o={},a=n._size||n.size||50,s=!("enableCluster"in n)||n.enableCluster,l=n.offset||{x:0,y:0},h=new u({min:n.min||0,max:n.max||100,gradient:n.gradient});if(s){for(var c=0;c<r.length;c++){var f=r[c].geometry._coordinates||r[c].geometry.coordinates,p=Math.floor((f[0]-l.x)/a)+","+Math.floor((f[1]-l.y)/a);o[p]||(o[p]=0),o[p]+=~~(r[c].count||1)}for(var d in o)d=d.split(","),t.beginPath(),t.rect(d[0]*a+.5+l.x,d[1]*a+.5+l.y,a,a),t.fillStyle=h.getColor(o[d]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}else{for(var v=0;v<r.length;v++){var f=r[v].geometry._coordinates||r[v].geometry.coordinates,p=f.join(",");o[p]=r[v].count||1}for(var g in o)g=g.split(","),t.beginPath(),t.rect(+g[0]-a/2,+g[1]-a/2,a,a),t.fillStyle=h.getColor(o[g]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var p in o){p=p.split(",");var m=o[p],y=t.measureText(m).width;s?t.fillText(m,p[0]*a+.5+l.x+a/2-y/2,p[1]*a+.5+l.y+a/2+5):t.fillText(m,+p[0]-y/2,+p[1]+5)}}t.restore()}},Vt={draw:function(t,e,n){t.save();var r=e instanceof i?e.get():e;for(var o in n)t[o]=n[o];var a=n.offset||{x:10,y:10},s=n._size||n.size||40;s=s/2/Math.sin(Math.PI/3);for(var l=2*s*Math.sin(Math.PI/3),h=1.5*s,c={},f=0;f<r.length;f++){var p=r[f].geometry._coordinates||r[f].geometry.coordinates,d=(p[1]-a.y)/h,g=Math.round(d),m=(p[0]-a.x)/l-(1&g?.5:0),y=Math.round(m),b=d-g;if(3*Math.abs(b)>1){var x=m-y,_=y+(m<y?-1:1)/2,w=g+(d<g?-1:1),M=m-_,T=d-w;x*x+b*b>M*M+T*T&&(y=_+(1&g?1:-1)/2,g=w)}var A=y+"-"+g,E=c[A];E?E.push(r[f]):(E=c[A]=[r[f]],E.i=y,E.j=g,E.x=(y+(1&g?.5:0))*l,E.y=g*h)}var P=new u({max:n.max||100,maxSize:s,gradient:n.gradient});for(var o in c){var S=c[o];t.beginPath();for(var C=0;C<6;C++){var L=v({x:S.x+a.x,y:S.y+a.y},s,C);t.lineTo(L[0],L[1])}t.closePath();for(var R=0,f=0;f<S.length;f++)R+=S[f].count||1;S.count=R,t.fillStyle=P.getColor(R),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var o in c){var S=c[o],O=S.count;O=O<0?O.toFixed(2):~~O;var k=t.measureText(O).width;t.fillText(O,S.x+a.x-k/2,S.y+a.y+5)}}t.restore()}},Ht=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),Wt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),qt={draw:b},Zt=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),Xt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),Gt={draw:x};_.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(K(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,h=s<u-1?e[s+1]*n:t.length;a-=Math.abs(K(t,l,h,n))}var c=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;c+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},_.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var Jt=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),Kt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),$t={draw:$},Qt={draw:function(t,e,n){var r=e instanceof i?e.get():e;r.length>0&&("LineString"==r[0].geometry.type?qt.draw(t,r,n):"Polygon"==r[0].geometry.type||"MultiPolygon"==r[0].geometry.type?$t.draw(t,r,n):Gt.draw(t,r,n))}},te={getPoints:Q},ee=function(){function t(t,e){return t.x*e.x+t.y*e.y}function e(t){return{x:M[t.target].x-M[t.source].x,y:M[t.target].y-M[t.source].y}}function n(t){return Math.sqrt(Math.pow(M[t.source].x-M[t.target].x,2)+Math.pow(M[t.source].y-M[t.target].y,2))}function r(t){return Math.sqrt(Math.pow(t.source.x-t.target.x,2)+Math.pow(t.source.y-t.target.y,2))}function i(t){return{x:(M[t.source].x+M[t.target].x)/2,y:(M[t.source].y+M[t.target].y)/2}}function o(t){for(var e=0,n=1;n<E[t].length;n++){e+=a(E[t][n],E[t][n-1])}return e}function a(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function s(t,e){var n=Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y)),r=((e.source.y-t.y)*(e.source.y-e.target.y)-(e.source.x-t.x)*(e.target.x-e.source.x))/(n*n);return{x:e.source.x+r*(e.target.x-e.source.x),y:e.source.y+r*(e.target.y-e.source.y)}}function u(){for(var t=0;t<T.length;t++)1==L?E[t]=[]:(E[t]=[],E[t].push(M[T[t].source]),E[t].push(M[T[t].target]))}function l(){for(var t=0;t<T.length;t++)A[t]=[]}function h(t){for(var e=[],n=0;n<t.length;n++)M[t[n].source].x!=M[t[n].target].x&&M[t[n].source].y!=M[t[n].target].y&&e.push(t[n]);return e}function c(t,e,n){var r=E[t][e-1],i=E[t][e+1],o=E[t][e],a=r.x-o.x+i.x-o.x,s=r.y-o.y+i.y-o.y;return a*=n,s*=n,{x:a,y:s}}function f(t,e,n){for(var i={x:0,y:0},o=A[t],a=0;a<o.length;a++){var s={x:E[o[a]][e].x-E[t][e].x,y:E[o[a]][e].y-E[t][e].y};if(Math.abs(s.x)>B||Math.abs(s.y)>B){var u=1/Math.pow(r({source:E[o[a]][e],target:E[t][e]}),1);i.x+=s.x*u,i.y+=s.y*u}}return i}function p(t,e,r){for(var i=S/(n(T[t])*(e+1)),o=[{x:0,y:0}],a=1;a<e+1;a++){var s={x:0,y:0},u=c(t,a,i),l=f(t,a,r);s.x=r*(u.x+l.x),s.y=r*(u.y+l.y),o.push(s)}return o.push({x:0,y:0}),o}function d(t){for(var e=0;e<T.length;e++)if(1==t)E[e].push(M[T[e].source]),E[e].push(i(T[e])),E[e].push(M[T[e].target]);else{var n=o(e),r=n/(t+1),s=r,u=[];u.push(M[T[e].source]);for(var l=1;l<E[e].length;l++){for(var h=a(E[e][l],E[e][l-1]);h>s;){var c=s/h,f=E[e][l-1].x,p=E[e][l-1].y;f+=c*(E[e][l].x-E[e][l-1].x),p+=c*(E[e][l].y-E[e][l-1].y),u.push({x:f,y:p}),h-=s,s=r}s-=h}u.push(M[T[e].target]),E[e]=u}}function v(r,i){return Math.abs(t(e(r),e(i))/(n(r)*n(i)))}function g(t,e){var r=(n(t)+n(e))/2;return 2/(r/Math.min(n(t),n(e))+Math.max(n(t),n(e))/r)}function m(t,e){var r=(n(t)+n(e))/2;return r/(r+a({x:(M[t.source].x+M[t.target].x)/2,y:(M[t.source].y+M[t.target].y)/2},{x:(M[e.source].x+M[e.target].x)/2,y:(M[e.source].y+M[e.target].y)/2}))}function y(t,e){var n=s(M[e.source],{source:M[t.source],target:M[t.target]}),r=s(M[e.target],{source:M[t.source],target:M[t.target]}),i={x:(n.x+r.x)/2,y:(n.y+r.y)/2},o={x:(M[t.source].x+M[t.target].x)/2,y:(M[t.source].y+M[t.target].y)/2};return Math.max(0,1-2*a(o,i)/a(n,r))}function b(t,e){return Math.min(y(t,e),y(e,t))}function x(t,e){return v(t,e)*g(t,e)*m(t,e)*b(t,e)}function _(t,e){return x(t,e)>=D}function w(){for(var t=0;t<T.length-1;t++)for(var e=t+1;e<T.length;e++)t!=e&&_(T[t],T[e])&&(A[t].push(e),A[e].push(t))}var M={},T=[],A=[],E=[],S=.1,C=.1,L=1,R=2,O=6,k=70,F=.6666667,D=.6,B=1e-8,z=function(){var t=C,e=k,n=L;u(),l(),d(n),w();for(var r=0;r<O;r++){for(var i=0;i<e;i++){for(var o=[],a=0;a<T.length;a++)o[a]=p(a,n,t);for(var s=0;s<T.length;s++)for(var h=0;h<n+1;h++)E[s][h].x+=o[s][h].x,E[s][h].y+=o[s][h].y}t/=2,n*=2,e*=F,d(n)}return E};return z.nodes=function(t){return 0==arguments.length?M:(M=t,z)},z.edges=function(t){return 0==arguments.length?T:(T=h(t),z)},z.bundling_stiffness=function(t){return 0==arguments.length?S:(S=t,z)},z.step_size=function(t){return 0==arguments.length?C:(C=t,z)},z.cycles=function(t){return 0==arguments.length?O:(O=t,z)},z.iterations=function(t){return 0==arguments.length?k:(k=t,z)},z.iterations_rate=function(t){return 0==arguments.length?F:(F=t,z)},z.subdivision_points_seed=function(t){return 0==arguments.length?P:(P=t,z)},z.subdivision_rate=function(t){return 0==arguments.length?R:(R=t,z)},z.compatbility_threshold=function(t){return 0==arguments.length?compatbility_threshold:(D=t,z)},z};et.prototype.get=function(t){var e=this.splitList,n=e.other;for(var r in e)if(t==r){n=e[r];break}return n},et.prototype.generateByDataSet=function(t,e){var n=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],r=t.get();this.splitList={};for(var i=0,o=0;o<r.length&&(void 0===this.splitList[r[o].count]&&(this.splitList[r[o].count]=n[i],i++),!(i>=n.length-1));o++);this.splitList.other=n[n.length-1]},et.prototype.getLegend=function(t){var e=this.splitList,n=document.createElement("div");n.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;";var r="";for(var i in e)r+='<div style="line-height: 19px;" value="'+i+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+e[i]+';"></span><span style="margin-left: 3px;">'+i+"<span></div>";return n.innerHTML=r,n},nt.prototype.get=function(t){for(var e=this.splitList,n=!1,r=0;r<e.length;r++)if((void 0===e[r].start||void 0!==e[r].start&&t>=e[r].start)&&(void 0===e[r].end||void 0!==e[r].end&&t<e[r].end)){n=e[r].value;break}return n},nt.prototype.generateByDataSet=function(t){var e=t.getMin("count"),n=t.getMax("count");this.generateByMinMax(e,n)},nt.prototype.generateByMinMax=function(t,e){var n=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],r=Number((e-t)/7);e=Number(e);var i=Number(t);this.splitList=[];for(var o=0;i<e;)this.splitList.push({start:i,end:i+r,value:n[o]}),o++,i+=r},nt.prototype.getLegend=function(t){this.splitList};var ne=function(){function t(e,n,r){if(Ot(this,t),!e||!n)return console.warn("id 和 type 为必填项"),!1;if("baidu"==n){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=n;var i=r&&r.center?r.center:[106.962497,38.208726],o=r&&r.zoom?r.zoom:5,a=this.map=new BMap.Map(e,{enableMapClick:!1});a.centerAndZoom(new BMap.Point(i[0],i[1]),o),a.enableScrollWheelZoom(!0),a.setMapStyle({style:"light"})}return kt(t,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]),t}(),re="undefined"==typeof window?{}:window,ie=re.BMap||re.BMapGL;ie&&(rt.prototype=new ie.Overlay,rt.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize();var n=t.getPanes()[this.paneName];n||(n=t.getPanes().floatShadow),n.appendChild(e);var r=this;return t.addEventListener("resize",function(){r.adjustSize(),r._draw()}),t.addEventListener("update",function(){r._draw()}),this.options.updateImmediate&&setTimeout(function(){r._draw()},100),this.canvas},rt.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=this.devicePixelRatio=re.devicePixelRatio||1;e.width=t.width*n,e.height=t.height*n,"2d"==this.context&&e.getContext(this.context).scale(n,n),e.style.width=t.width+"px",e.style.height=t.height+"px"},rt.prototype.draw=function(){var t=this;this.options.updateImmediate?t._draw():(clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15))},rt.prototype._draw=function(){var t=this._map,e=t.getSize(),n=t.getCenter();if(n){var r=t.pointToOverlayPixel(n);this.canvas.style.left=r.x-e.width/2+"px",this.canvas.style.top=r.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},rt.prototype.getContainer=function(){return this.canvas},rt.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},rt.prototype.hide=function(){this.canvas.style.display="none"},rt.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},rt.prototype.getZIndex=function(){return this.zIndex});var oe=oe||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},update:function(e,n){if(0===t.length)return!1;var r=0;for(e=void 0!==e?e:oe.now();r<t.length;)t[r].update(e)||n?r++:t.splice(r,1);return!0}}}();"undefined"==typeof window&&void 0!==t?oe.now=function(){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?oe.now=window.performance.now.bind(window.performance):void 0!==Date.now?oe.now=Date.now:oe.now=function(){return(new Date).getTime()},oe.Tween=function(t){var e,n=t,r={},i={},o={},a=1e3,s=0,u=!1,l=!1,h=!1,c=0,f=null,p=oe.Easing.Linear.None,d=oe.Interpolation.Linear,v=[],g=null,m=!1,y=null,b=null,x=null;this.to=function(t,e){return i=t,void 0!==e&&(a=e),this},this.start=function(t){oe.add(this),l=!0,m=!1,f=void 0!==t?t:oe.now(),f+=c;for(var e in i){if(i[e]instanceof Array){if(0===i[e].length)continue;i[e]=[n[e]].concat(i[e])}void 0!==n[e]&&(r[e]=n[e],r[e]instanceof Array==!1&&(r[e]*=1),o[e]=r[e]||0)}return this},this.stop=function(){return l?(oe.remove(this),l=!1,null!==x&&x.call(n,n),this.stopChainedTweens(),this):this},this.end=function(){return this.update(f+a),this},this.stopChainedTweens=function(){for(var t=0,e=v.length;t<e;t++)v[t].stop()},this.delay=function(t){return c=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return u=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return v=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){var l,x,_;if(t<f)return!0;!1===m&&(null!==g&&g.call(n,n),m=!0),x=(t-f)/a,x=x>1?1:x,_=p(x);for(l in i)if(void 0!==r[l]){var w=r[l]||0,M=i[l];M instanceof Array?n[l]=d(M,_):("string"==typeof M&&(M="+"===M.charAt(0)||"-"===M.charAt(0)?w+parseFloat(M):parseFloat(M)),"number"==typeof M&&(n[l]=w+(M-w)*_))}if(null!==y&&y.call(n,_),1===x){if(s>0){isFinite(s)&&s--;for(l in o){if("string"==typeof i[l]&&(o[l]=o[l]+parseFloat(i[l])),u){var T=o[l];o[l]=i[l],i[l]=T}r[l]=o[l]}return u&&(h=!h),f=void 0!==e?t+e:t+c,!0}null!==b&&b.call(n,n);for(var A=0,E=v.length;A<E;A++)v[A].start(f+a);return!1}return!0}},oe.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-oe.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*oe.Easing.Bounce.In(2*t):.5*oe.Easing.Bounce.Out(2*t-1)+.5}}},oe.Interpolation={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=oe.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],r):e>1?o(t[n],t[n-1],n-r):o(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,o=oe.Interpolation.Utils.Bernstein,a=0;a<=r;a++)n+=i(1-e,r-a)*i(e,a)*t[a]*o(r,a);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=oe.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),o(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):o(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=oe.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var r=e;r>1;r--)n*=r;return t[e]=n,n}}(),CatmullRom:function(t,e,n,r,i){var o=.5*(n-t),a=.5*(r-e),s=i*i;return(2*e-2*n+o+a)*(i*s)+(-3*e+3*n-2*o-a)*s+o*i+e}}};var ae={},se={draw:function(t,e,n){var r="http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png";n.arrow&&n.arrow.url&&(r=n.arrow.url),ae[r]||(ae[r]=null);var o=ae[r];if(!o){var a=Array.prototype.slice.call(arguments),s=new Image;return s.onload=function(){ae[r]=s,se.draw.apply(null,a)},void(s.src=r)}var u=e instanceof i?e.get():e;t.save();for(var l in n)t[l]=n[l];for(var h=[],c=null,f=0,p=u.length;f<p;f++){var d=u[f];t.save(),(d.fillStyle||d._fillStyle)&&(t.fillStyle=d.fillStyle||d._fillStyle),(d.strokeStyle||d._strokeStyle)&&(t.strokeStyle=d.strokeStyle||d._strokeStyle);var v=d.geometry.type;if(t.beginPath(),"LineString"===v)for(var g=d.geometry._coordinates||d.geometry.coordinates,m=void 0!==n.arrow.interval?n.arrow.interval:1,y=0;y<g.length;y+=m)if(g[y]&&g[y+1]){var b=g[y];if(c&&ot(b,c)<30)continue;t.save();var x=it(g[y],g[y+1]);t.translate(b[0],b[1]),t.rotate(x*Math.PI/180),t.drawImage(o,-o.width/2/2,-o.height/2/2,o.width/2,o.height/2),t.restore(),h.push(b),c=b}t.restore()}t.restore()}},ue={draw:function(t,e,n){var r=e instanceof i?e.get():e;t.save(),t.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),n.multiPolygonDraw=function(){t.save(),t.clip(),St(t),t.restore()};for(var o=0,a=r.length;o<a;o++)t.beginPath(),zt.drawDataSet(t,[r[o]],n),t.save(),t.clip(),St(t),t.restore();t.restore()}},le={draw:function(t,e,n){t.save();for(var r,o,a=e instanceof i?e.get():e,s=0;s<a.length;s++){var l=a[s];l.properties&&l.properties.cluster&&(void 0===r&&(r=l.properties.point_count),void 0===o&&(o=l.properties.point_count),r=Math.max(r,l.properties.point_count),o=Math.min(o,l.properties.point_count))}for(var h=new u({min:o,max:r,minSize:n.minSize||8,maxSize:n.maxSize||30,gradient:n.gradient}),s=0;s<a.length;s++){var l=a[s],c=a[s].geometry._coordinates||a[s].geometry.coordinates;if(t.beginPath(),l.properties&&l.properties.cluster){if(t.arc(c[0],c[1],h.getSize(l.properties.point_count),0,2*Math.PI),t.fillStyle=h.getColor(l.properties.point_count),t.fill(),n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);var f=l.properties.point_count,p=t.measureText(f).width;t.fillText(f,c[0]+.5-p/2,c[1]+.5+3)}}else t.arc(c[0],c[1],n.size||5,0,2*Math.PI),t.fillStyle=n.fillStyle||"red",t.fill()}t.restore()}},he={draw:function(t,e,n){var r=e instanceof i?e.get():e;t.save();for(var o in n)t[o]=n[o];var a=[],s=n._size||n.size;s?t.font="bold "+s+"px Arial":s=12;var u=n.textKey||"text";if(n.textAlign||(t.textAlign="center"),n.textBaseline||(t.textBaseline="middle"),n.avoid)for(var l=0,h=r.length;l<h;l++){var c=r[l].offset||n.offset||{x:0,y:0},f=r[l].geometry._coordinates||r[l].geometry.coordinates,p=f[0]+c.x,d=f[1]+c.y,v=r[l][u],g=t.measureText(v).width,m=p-g/2,y=d-s/2,b={sw:{x:m,y:y+s},ne:{x:m+g,y:y}};at(a,b)||(a.push(b),m+=g/2,y+=s/2,t.fillText(v,m,y))}else for(var l=0,h=r.length;l<h;l++){var c=r[l].offset||n.offset||{x:0,y:0},f=r[l].geometry._coordinates||r[l].geometry.coordinates,p=f[0]+c.x,d=f[1]+c.y,v=r[l][u];t.fillText(v,p,d)}t.restore()}},ce={draw:function(t,e,n){var r=e instanceof i?e.get():e;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var o=n.offset||{x:0,y:0},a=0,s=r.length;a<s;a++)if(r[a].geometry){var u=r[a].deg||n.deg,l=r[a].icon||n.icon,h=r[a].geometry._coordinates||r[a].geometry.coordinates,c=h[0],f=h[1];u&&(t.save(),t.translate(c,f),t.rotate(u*Math.PI/180),t.translate(-c,-f));var p=n._width||n.width||l.width,d=n._height||n.height||l.height;c=c-p/2+o.x,f=f-d/2+o.y,n.sx&&n.sy&&n.swidth&&n.sheight&&n.width&&n.height?t.drawImage(l,n.sx,n.sy,n.swidth,n.sheight,c,f,p,d):n.width&&n.height?t.drawImage(l,c,f,p,d):t.drawImage(l,c,f),u&&t.restore()}}},fe=function(t){return t[0]},pe=function(t){return t[1]},de=function(t,e,n,r,i){void 0===e&&(e=fe),void 0===n&&(n=pe),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);ut(a,s,r,0,a.length-1,0)};de.prototype.range=function(t,e,n,r){return ft(this.ids,this.coords,t,e,n,r,this.nodeSize)},de.prototype.within=function(t,e,n){return pt(this.ids,this.coords,t,e,n,this.nodeSize)};var ve={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},ge=function(t){this.options=Mt(Object.create(ve),t),this.trees=new Array(this.options.maxZoom+1)};ge.prototype.load=function(t){var e=this.options,n=(e.log,e.minZoom),r=e.maxZoom,i=e.nodeSize;t.length;this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(gt(t[a],a));this.trees[r+1]=new de(o,Tt,At,i,Float32Array);for(var s=r;s>=n;s--){Date.now();o=this._cluster(o,s),this.trees[s]=new de(o,Tt,At,i,Float32Array)}return this},ge.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=u.range(bt(n),xt(o),bt(i),xt(r)),h=[],c=0,f=l;c<f.length;c+=1){var p=f[c],d=u.points[p];h.push(d.numPoints?mt(d):this.points[d.index])}return h},ge.prototype.getChildren=function(t){var e=t>>5,n=t%32,r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(o.x,o.y,a),u=[],l=0,h=s;l<h.length;l+=1){var c=h[l],f=i.points[c];f.parentId===t&&u.push(f.numPoints?mt(f):this.points[f.index])}if(0===u.length)throw new Error(r);return u},ge.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},ge.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius,u=s/a,l=(n-u)/i,h=(n+1+u)/i,c={features:[]};return this._addTileFeatures(r.range((e-u)/i,l,(e+1+u)/i,h),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-u/i,l,1,h),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,l,u/i,h),r.points,-1,n,i,c),c.features.length?c:null},ge.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},ge.prototype._appendLeaves=function(t,e,n,r,i){for(var o=this.getChildren(e),a=0,s=o;a<s.length;a+=1){var u=s[a],l=u.properties;if(l&&l.cluster?i+l.point_count<=r?i+=l.point_count:i=this._appendLeaves(t,l.cluster_id,n,r,i):i<r?i++:t.push(u),t.length===n)break}return i},ge.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=e[u],h={type:1,geometry:[[Math.round(this.options.extent*(l.x*i-n)),Math.round(this.options.extent*(l.y*i-r))]],tags:l.numPoints?yt(l):this.points[l.index].properties},c=l.numPoints?l.id:this.points[l.index].id;void 0!==c&&(h.id=c),o.features.push(h)}},ge.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},ge.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=i/(o*Math.pow(2,e)),u=0;u<t.length;u++){var l=t[u];if(!(l.zoom<=e)){l.zoom=e;for(var h=this.trees[e+1],c=h.within(l.x,l.y,s),f=l.numPoints||1,p=l.x*f,d=l.y*f,v=a&&f>1?this._map(l,!0):null,g=(u<<5)+(e+1),m=0,y=c;m<y.length;m+=1){var b=y[m],x=h.points[b];if(!(x.zoom<=e)){x.zoom=e;var _=x.numPoints||1;p+=x.x*_,d+=x.y*_,f+=_,x.parentId=g,a&&(v||(v=this._map(l,!0)),a(v,this._map(x)))}}1===f?n.push(l):(l.parentId=g,n.push(vt(p/f,d/f,g,f,v)))}}return n},ge.prototype._map=function(t,e){if(t.numPoints)return e?Mt({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?Mt({},r):r},"undefined"!=typeof window&&requestAnimationFrame(Et);var me=function(){function t(e,n,r){Ot(this,t),n instanceof i||(n=new i(n)),this.dataSet=n,this.map=e,"cluster"!==r.draw||this.supercluster||(this.supercluster=new ge({maxZoom:r.maxZoom||19,radius:r.clusterRadius||100}),this.supercluster.load(n.get()),this.clusterDataSet=new i)}return kt(t,[{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){var e=this;if(e.intensity=new u({maxSize:e.options.maxSize,minSize:e.options.minSize,gradient:e.options.gradient,max:e.options.max||this.dataSet.getMax("count")}),e.category=new et(e.options.splitList),e.choropleth=new nt(e.options.splitList),void 0===e.options.splitList&&e.category.generateByDataSet(this.dataSet,e.options.color),void 0===e.options.splitList){var n=e.options.min||this.dataSet.getMin("count"),r=e.options.max||this.dataSet.getMax("count");e.choropleth.generateByMinMax(n,r)}}},{key:"getLegend",value:function(t){var e=(this.options.draw,this);return"intensity"==e.options.draw||"heatmap"==e.options.draw?this.intensity.getLegend(t):"category"==e.options.draw?this.category.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this,n=e.options.draw;if("bubble"==n||"intensity"==n||"category"==n||"choropleth"==n||"simple"==n)for(var r=0;r<t.length;r++){var i=t[r];"bubble"==e.options.draw?t[r]._size=e.intensity.getSize(i.count):t[r]._size=void 0;var o="_fillStyle";"LineString"!==t[r].geometry.type&&"stroke"!==e.options.styleType||(o="_strokeStyle"),"intensity"==e.options.draw?t[r][o]=e.intensity.getColor(i.count):"category"==e.options.draw?t[r][o]=e.category.get(i.count):"choropleth"==e.options.draw&&(t[r][o]=e.choropleth.get(i.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation;return t&&!(!1===t.enabled)}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,n,r){var i=this;switch(i.options.draw){case"heatmap":jt.draw(t,e,i.options);break;case"grid":case"cluster":case"honeycomb":i.options.offset={x:r.x,y:r.y},"grid"===i.options.draw?Yt.draw(t,e,i.options):"cluster"===i.options.draw?le.draw(t,e,i.options):Vt.draw(t,e,i.options);break;case"text":he.draw(t,e,i.options);break;case"icon":ce.draw(t,e,i.options);break;case"clip":ue.draw(t,e,i.options);break;default:"webgl"==i.options.context?Qt.draw(i.canvasLayer.canvas.getContext("webgl"),e,i.options):It.draw(t,e,i.options)}i.options.arrow&&!1!==i.options.arrow.show&&se.draw(t,e,i.options)}},{key:"isPointInPath",value:function(t,e){var n,t=this.canvasLayer.canvas.getContext(this.context);n="cluster"===this.options.draw?this.clusterDataSet.get():this.dataSet.get();for(var r=0;r<n.length;r++){t.beginPath();var i=this.options,o=e.x*this.canvasLayer.devicePixelRatio,a=e.y*this.canvasLayer.devicePixelRatio;i.multiPolygonDraw=function(){if(t.isPointInPath(o,a))return n[r]},zt.draw(t,n[r],i);if((n[r].geometry&&n[r].geometry.type).indexOf("LineString")>-1){if(t.isPointInStroke&&t.isPointInStroke(o,a))return n[r]}else if(t.isPointInPath(o,a))return n[r]}}},{key:"clickEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);n?this.options.methods.click(n,e):this.options.methods.click(null,e)}}},{key:"mousemoveEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);n?this.options.methods.mousemove(n,e):this.options.methods.mousemove(null,e)}}},{key:"tapEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);n?this.options.methods.tap(n,e):this.options.methods.tap(null,e)}}},{key:"update",value:function(t,e){var n=this,r=t.options,i=n.options;for(var o in r)i[o]=r[o];n.init(i),!1!==e&&n.draw()}},{key:"setOptions",value:function(t){var e=this;e.dataSet.reset(),e.init(t),e.draw()}},{key:"set",value:function(t){var e=this,n=this.getContext(),r=this.getDefaultContextConfig();for(var i in r)n[i]=r[i];e.init(t.options),e.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t=this,e=t.options.animation;if("time"==t.options.draw||t.isEnabledTime()){e.stepsRange||(e.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:e.stepsRange.start},t.animator=new oe.Tween(this.steps).onUpdate(function(){t._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent();var n=1e3*e.duration||5e3;t.animator.to({step:e.stepsRange.end},n),t.animator.start()}else t.animator&&t.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),t}(),ye="undefined"==typeof window?{}:window,be=ye.BMap||ye.BMapGL,xe=function(t){function e(t,n,r){Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));i.map=t,i.options=r||{},i.dataSet=n;var o=new rt({map:t,zIndex:i.options.zIndex,update:i._canvasUpdate.bind(i)});i.init(i.options),i.canvasLayer=o,i.transferToMercator();var a=i;return n.on("change",function(){a.transferToMercator(),o.draw()}),i.ctx=o.canvas.getContext("2d"),i.start(),i}return Dt(e,t),kt(e,[{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var t,e=this.map,n=e.getMapType();if(t=n.getProjection?n.getProjection():{lngLatToPoint:function(t){var n=e.lnglatToMercator(t.lng,t.lat);return{x:n[0],y:n[1]}}},"bd09mc"!==this.options.coordType){var r=this.dataSet.get();r=this.dataSet.transferCoordinate(r,function(e){var n=t.lngLatToPoint({lng:e[0],lat:e[1]});return[n.x,n.y]},"coordinates","coordinates_mercator"),this.dataSet._set(r)}}},{key:"_canvasUpdate",value:function(){var t=this.ctx;if(t){var e,n,r=this.map;r.getMapType().getProjection?(e=r.getMapType().getProjection(),n=e.lngLatToPoint(r.getCenter())):(n={x:r.getCenter().lng,y:r.getCenter().lat},n.x>-180&&n.x<180&&(n=r.lnglatToMercator(n.x,n.y),n={x:n[0],y:n[1]}),e={lngLatToPoint:function(t){var e=r.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}});var i;i=e.getZoomUnits?e.getZoomUnits(r.getZoom()):Math.pow(2,18-r.getZoom());var o=new be.Pixel(n.x-r.getSize().width/2*i,n.y+r.getSize().height/2*i);St(t);var a={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){if(t){return[(t[0]-o.x)/i,(o.y-t[1])/i]}}};this.data=this.dataSet.get(a),this.processData(this.data),this.drawAnimation()}}},{key:"drawAnimation",value:function(){var t=this.ctx,e=this.data;if(e){t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),t.save(),this.options.shadowColor&&(t.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(t.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(t.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(t.globalCompositeOperation=this.options.globalCompositeOperation);for(var n=this.options,r=0;r<e.length;r++)if("Point"===e[r].geometry.type){t.beginPath();var i=e[r].size||this.options.size,o=e[r].minSize||this.options.minSize||0;void 0===e[r]._size&&(e[r]._size=o),t.arc(e[r].geometry._coordinates[0],e[r].geometry._coordinates[1],e[r]._size,0,2*Math.PI,!0),t.closePath(),e[r]._size++,e[r]._size>i&&(e[r]._size=o),t.lineWidth=1,t.strokeStyle=e[r].strokeStyle||e[r]._strokeStyle||n.strokeStyle||"yellow",t.stroke();var a=e[r].fillStyle||e[r]._fillStyle||n.fillStyle;a&&(t.fillStyle=a,t.fill())}else if("LineString"===e[r].geometry.type){t.beginPath();var s=e[r].size||this.options.size||5,o=e[r].minSize||this.options.minSize||0;void 0===e[r]._index&&(e[r]._index=0);var u=e[r]._index;t.arc(e[r].geometry._coordinates[u][0],e[r].geometry._coordinates[u][1],s,0,2*Math.PI,!0),t.closePath(),e[r]._index++,e[r]._index>=e[r].geometry._coordinates.length&&(e[r]._index=0);var l=e[r].strokeStyle||n.strokeStyle,a=e[r].fillStyle||n.fillStyle||"yellow";t.fillStyle=a,t.fill(),l&&n.lineWidth&&(t.lineWidth=n.lineWidth||1,t.strokeStyle=l,t.stroke())}t.restore()}}},{key:"animate",value:function(){this.drawAnimation();var t=this.options.animateTime||100;this.timeout=setTimeout(this.animate.bind(this),t)}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}},{key:"unbindEvent",value:function(){}},{key:"hide",value:function(){this.canvasLayer.hide(),this.stop()}},{key:"show",value:function(){this.start()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.stop(),this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(me),_e="undefined"==typeof window?{}:window,we=_e.BMap||_e.BMapGL,Me=function(t){function e(t,n,r){Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r)),o=i;r=r||{},i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.tapEvent=i.tapEvent.bind(i),o.init(r),o.argCheck(r),o.transferToMercator();var a=i.canvasLayer=new rt({map:t,context:i.context,updateImmediate:r.updateImmediate,paneName:r.paneName,mixBlendMode:r.mixBlendMode,enableMassClear:r.enableMassClear,zIndex:r.zIndex,update:function(){o._canvasUpdate()}});return n.on("change",function(){o.transferToMercator(),a.draw()}),i}return Dt(e,t),kt(e,[{key:"clickEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,n,t)}},{key:"mousemoveEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"tapEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tapEvent",this).call(this,n,t)}},{key:"bindEvent",value:function(t){this.unbindEvent();var e=this.map,n=0,r=this;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addEventListener("mousemove",this.mousemoveEvent),"ontouchend"in window.document&&this.options.methods.tap&&(e.addEventListener("touchstart",function(t){n=new Date}),e.addEventListener("touchend",function(t){new Date-n<300&&r.tapEvent(t)})))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(t){t||(t=this.dataSet);var e,n=this.map,r=n.getMapType();if(e=r.getProjection?r.getProjection():{lngLatToPoint:function(t){var e=n.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}},"bd09mc"!==this.options.coordType){var i=t.get();i=t.transferCoordinate(i,function(t){if(t[0]<-180||t[0]>180||t[1]<-90||t[1]>90)return t;var n=e.lngLatToPoint({lng:t[0],lat:t[1]});return[n.x,n.y]},"coordinates","coordinates_mercator"),t._set(i)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e,n,r=this,i=r.options.animation,o=this.canvasLayer._map;o.getMapType().getProjection?(e=o.getMapType().getProjection(),n=e.lngLatToPoint(o.getCenter())):(n={x:o.getCenter().lng,y:o.getCenter().lat},n.x>-180&&n.x<180&&(n=o.lnglatToMercator(n.x,n.y),n={x:n[0],y:n[1]}),e={lngLatToPoint:function(t){var e=o.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}});var a;a=e.getZoomUnits?e.getZoomUnits(o.getZoom()):Math.pow(2,18-o.getZoom());var s=new we.Pixel(n.x-o.getSize().width/2*a,n.y+o.getSize().height/2*a),u=this.getContext();if(r.isEnabledTime()){if(void 0===t)return void St(u);"2d"==this.context&&(u.save(),u.globalCompositeOperation="destination-out",u.fillStyle="rgba(0, 0, 0, .1)",u.fillRect(0,0,u.canvas.width,u.canvas.height),u.restore())}else St(u);if("2d"==this.context)for(var l in r.options)u[l]=r.options[l];else u.clear(u.COLOR_BUFFER_BIT);if(!(r.options.minZoom&&o.getZoom()<r.options.minZoom||r.options.maxZoom&&o.getZoom()>r.options.maxZoom)){var h=1;"2d"!=this.context&&(h=this.canvasLayer.devicePixelRatio);var c={fromColumn:"bd09mc"==r.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){return[(t[0]-s.x)/a*h,(s.y-t[1])/a*h]}};void 0!==t&&(c.filter=function(e){var n=i.trails||10;return!!(t&&e.time>t-n&&e.time<t)});var f;if("cluster"===r.options.draw){var p=this.map.getBounds(),d=p.getNorthEast(),v=p.getSouthWest(),g=this.supercluster.getClusters([v.lng,v.lat,d.lng,d.lat],this.getZoom());this.clusterDataSet.set(g),this.transferToMercator(this.clusterDataSet),f=this.clusterDataSet.get(c)}else f=r.dataSet.get(c);this.processData(f);var m=o.pointToPixel(new we.Point(0,0));"m"==r.options.unit?(r.options.size&&(r.options._size=r.options.size/a),r.options.width&&(r.options._width=r.options.width/a),r.options.height&&(r.options._height=r.options.height/a)):(r.options._size=r.options.size,r.options._height=r.options.height,r.options._width=r.options.width),this.drawContext(u,f,r.options,m),r.options.updateCallback&&r.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator(),this.bindEvent()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer),this.bindEvent()}},{key:"hide",value:function(){this.unbindEvent(),this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer&&this.canvasLayer.draw()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(me),Te="undefined"==typeof window?{}:window;Te.google&&Te.google.maps&&(Pt.prototype=new google.maps.OverlayView,Pt.DEFAULT_PANE_NAME_="overlayLayer",Pt.CSS_TRANSFORM_=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],n=0;n<e.length;n++){var r=e[n];if(void 0!==t.style[r])return r}return e[0]}(),Pt.prototype.requestAnimFrame_=Te.requestAnimationFrame||Te.webkitRequestAnimationFrame||Te.mozRequestAnimationFrame||Te.oRequestAnimationFrame||Te.msRequestAnimationFrame||function(t){return Te.setTimeout(t,1e3/60)},Pt.prototype.cancelAnimFrame_=Te.cancelAnimationFrame||Te.webkitCancelAnimationFrame||Te.mozCancelAnimationFrame||Te.oCancelAnimationFrame||Te.msCancelAnimationFrame||function(t){},Pt.prototype.setOptions=function(t){void 0!==t.animate&&this.setAnimate(t.animate),void 0!==t.paneName&&this.setPaneName(t.paneName),void 0!==t.updateHandler&&this.setUpdateHandler(t.updateHandler),void 0!==t.resizeHandler&&this.setResizeHandler(t.resizeHandler),void 0!==t.resolutionScale&&this.setResolutionScale(t.resolutionScale),void 0!==t.map&&this.setMap(t.map)},Pt.prototype.setAnimate=function(t){this.isAnimated_=!!t,this.isAnimated_&&this.scheduleUpdate()},Pt.prototype.isAnimated=function(){return this.isAnimated_},Pt.prototype.setPaneName=function(t){this.paneName_=t,this.setPane_()},Pt.prototype.getPaneName=function(){return this.paneName_},Pt.prototype.setPane_=function(){if(this.isAdded_){var t=this.getPanes();if(!t[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');t[this.paneName_].appendChild(this.canvas)}},Pt.prototype.setResizeHandler=function(t){this.resizeHandler_=t},Pt.prototype.setResolutionScale=function(t){"number"==typeof t&&(this.resolutionScale_=t,this.resize_())},Pt.prototype.setUpdateHandler=function(t){this.updateHandler_=t},Pt.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},Pt.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(Te,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},Pt.prototype.resize_=function(){if(this.isAdded_){var t=this.getMap(),e=t.getDiv().offsetWidth,n=t.getDiv().offsetHeight,r=e*this.resolutionScale_,i=n*this.resolutionScale_,o=this.canvas.width,a=this.canvas.height;o===r&&a===i||(this.canvas.width=r,this.canvas.height=i,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===e&&this.canvasCssHeight_===n||(this.canvasCssWidth_=e,this.canvasCssHeight_=n,this.canvas.style.width=e+"px",this.canvas.style.height=n+"px")}},Pt.prototype.draw=function(){this.repositionCanvas_()},Pt.prototype.repositionCanvas_=function(){var t=this.getMap(),e=t.getBounds().getNorthEast().lat(),n=t.getCenter(),r=Math.pow(2,t.getZoom()),i=n.lng()-180*this.canvasCssWidth_/(256*r);this.topLeft_=new google.maps.LatLng(e,i);var o=this.getProjection(),a=o.fromLatLngToDivPixel(n),s=-Math.round(this.canvasCssWidth_/2-a.x),u=-Math.round(this.canvasCssHeight_/2-a.y);this.canvas.style[Pt.CSS_TRANSFORM_]="translate("+s+"px,"+u+"px)",this.scheduleUpdate()},Pt.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},Pt.prototype.getTopLeft=function(){return this.topLeft_},Pt.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(Te,this.requestUpdateFunction_))});var Ae=function(t){function e(t,n,r){Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r)),o=i;r=r||{},o.init(r),o.argCheck(r);var a={map:t,animate:!1,updateHandler:function(){o._canvasUpdate()},resolutionScale:resolutionScale};i.canvasLayer=new Pt(a);return i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return Dt(e,t),kt(e,[{key:"clickEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,n,t)}},{key:"mousemoveEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"bindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeListener("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,n=e.options.animation,r=this.getContext();if(e.isEnabledTime()){if(void 0===t)return void St(r);"2d"==this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else St(r);if("2d"==this.context)for(var o in e.options)r[o]=e.options[o];else r.clear(r.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&s.getZoom()<e.options.minZoom||e.options.maxZoom&&s.getZoom()>e.options.maxZoom)){var a=1;"2d"!=this.context&&(a=this.canvasLayer.devicePixelRatio);var s=this.map,u=s.getProjection(),a=Math.pow(2,s.zoom)*resolutionScale,l=u.fromLatLngToPoint(this.canvasLayer.getTopLeft()),h={transferCoordinate:function(t){var e=new google.maps.LatLng(t[1],t[0]),n=u.fromLatLngToPoint(e),r={x:(n.x-l.x)*a,y:(n.y-l.y)*a};return[r.x,r.y]}};void 0!==t&&(h.filter=function(e){var r=n.trails||10;return!!(t&&e.time>t-r&&e.time<t)});var c=e.dataSet.get(h);this.processData(c);var f=new google.maps.LatLng(0,0),p=u.fromLatLngToPoint(f),d={x:(p.x-l.x)*a,y:(p.y-l.y)*a};"m"==e.options.unit&&e.options.size?e.options._size=e.options.size/zoomUnit:e.options._size=e.options.size,this.drawContext(r,new i(c),e.options,d),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),e}(me),Ee=void 0;if("undefined"!=typeof maptalks){Ee=function(t){function e(t,n,r){Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return i.options_=r,i.dataSet=n,i._initBaseLayer(r),i}return Dt(e,t),kt(e,[{key:"_initBaseLayer",value:function(t){var e=this,n=this.baseLayer=new me(null,this.dataSet,t);e.init(t),n.argCheck(t)}},{key:"clickEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.clickEvent(e,t.domEvent)}}},{key:"mousemoveEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.mousemoveEvent(e,t.domEvent)}}},{key:"getEvents",value:function(){return{click:this.clickEvent,mousemove:this.mousemoveEvent}}},{key:"init",value:function(t){var e=this.baseLayer;e.options=t,e.initDataRange(t),e.context=e.options.context||"2d",e.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}}]),e}(maptalks.Layer);var Pe=function(t){function e(){return Ot(this,e),Bt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Dt(e,t),kt(e,[{key:"needToRedraw",value:function(){return!!this.layer.baseLayer.isEnabledTime()||Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"needToRedraw",this).call(this)}},{key:"draw",value:function(){var t=this.layer.baseLayer;this.canvas&&t.isEnabledTime()&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this._update(this.gl||this.context,this._mapvFrameTime),delete this._mapvFrameTime,this.completeRender()}},{key:"drawOnInteracting",value:function(){this.draw(),this._shouldClear=!1}},{key:"onSkipDrawOnInteracting",value:function(){this._shouldClear=!0}},{key:"_canvasUpdate",value:function(t){this.setToRedraw(),this._mapvFrameTime=t}},{key:"_update",value:function(t,e){if(this.canvas){var n=this.layer.baseLayer,r=n.options.animation,i=this.getMap();if(n.isEnabledTime()){if(void 0===e)return void St(t);"2d"==n.context&&(t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore())}else St(t);if("2d"==n.context)for(var o in n.options)t[o]=n.options[o];else t.clear(t.COLOR_BUFFER_BIT);var a=new maptalks.Coordinate(0,0),s={fromColumn:"bd09mc"===n.options.coordType?"coordinates_mercator":"coordinates",transferCoordinate:function(t){return a.x=t[0],a.y=t[1],i.coordToContainerPoint(a)._multi(1).toArray()}};void 0!==e&&(s.filter=function(t){var n=r.trails||10;return!!(e&&t.time>e-n&&t.time<e)});var u=n.dataSet.get(s);n.processData(u),"m"==n.options.unit?(n.options.size&&(n.options._size=n.options.size/zoomUnit),n.options.width&&(n.options._width=n.options.width/zoomUnit),n.options.height&&(n.options._height=n.options.height/zoomUnit)):(n.options._size=n.options.size,n.options._height=n.options.height,n.options._width=n.options.width);var l=new maptalks.Point(0,0),h=i._pointToContainerPoint(l)._multi(1);n.drawContext(t,u,n.options,h),n.options.updateCallback&&n.options.updateCallback(e)}}},{key:"createCanvas",value:function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio?t.getDevicePixelRatio():maptalks.Browser.retina?2:1,r=n*e.width,i=n*e.height;this.canvas=maptalks.Canvas.createCanvas(r,i,t.CanvasClass);if("2d"===this.layer.baseLayer.context)this.context=this.canvas.getContext("2d"),this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation),"heatmap"!==this.layer.baseLayer.options.draw&&1!==n&&this.context.scale(n,n);else{var o={alpha:!0,preserveDrawingBuffer:!0,antialias:!1};this.gl=this.canvas.getContext("webgl",o)}this.onCanvasCreate(),this._bindToMapv(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})}}},{key:"_bindToMapv",value:function(){var t=this.layer.baseLayer,e=this.getMap();this.devicePixelRatio=e.getDevicePixelRatio?e.getDevicePixelRatio():maptalks.Browser.retina?2:1,t.canvasLayer=this,t._canvasUpdate=this._canvasUpdate.bind(this),t.getContext=function(){var t=self.getRenderer();return t.gl||t.context}}}]),e}(maptalks.renderer.CanvasRenderer);Ee.registerRenderer("canvas",Pe)}var Se,Ce=Ee,Le=function(t,e,n){if("undefined"!=typeof document){var r=document.createElement("canvas");return r.width=t,r.height=e,r}return new n(t,e)},Re=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments[1],r=arguments[2];Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.options=r,i.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},i.layer_=null,i.initDataRange(r),i.initAnimator(),i.onEvents(),t.on("complete",function(){this.init(t,r),this.argCheck(r)},i),i}return Dt(e,t),kt(e,[{key:"init",value:function(t,e){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){if(t){var n=this.map,r=t.getContext(this.context),o=this.options.animation;if(this.isEnabledTime()){if(void 0===e)return St(r),this;"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else St(r);if("2d"===this.context)for(var a in this.options)r[a]=this.options[a];else r.clear(r.COLOR_BUFFER_BIT);var s={transferCoordinate:function(t){var e=n.lngLatToContainer(new AMap.LngLat(t[0],t[1]));return[e.x,e.y]}};void 0!==e&&(s.filter=function(t){var n=o.trails||10;return!!(e&&t.time>e-n&&t.time<e)});var u=this.dataSet.get(s);return this.processData(u),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(r,new i(u),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.canvasFunction(),e=this.map.getBounds();this.layer_=new AMap.CanvasLayer({canvas:t,bounds:this.options.bounds||e,zooms:this.options.zooms||[0,22]}),this.layer_.setMap(this.map),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this)}}},{key:"canvasFunction",value:function(){var t=[this.map.getSize().width,this.map.getSize().height],e=t[0],n=t[1];if(this.canvasLayer.canvas){this.canvasLayer.canvas.width=e,this.canvasLayer.canvas.height=n;var r=this.map.getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||r)}else this.canvasLayer.canvas=Le(e,n);return this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"removeLayer",value:function(){this.map&&(this.unEvents(),this.map.removeLayer(this.layer_),delete this.map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,n,t)}},{key:"mousemoveEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"addAnimatorEvent",value:function(){this.map.on("movestart",this.animatorMovestartEvent,this),this.map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent,this),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent,this))}}]),e}(me),Oe=function(t,e){if("undefined"!=typeof document){var n=document.createElement("canvas");return n.width=t,n.height=e,n}},ke=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments[1],r=arguments[2];Ot(this,e);var i=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.options=r,i.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},i.layer_=null,i.previousCursor_=void 0,i.init(t,r),i.argCheck(r),i}return Dt(e,t),kt(e,[{key:"init",value:function(t,e){if(!(t&&t instanceof ol.Map))throw new Error("not map object");this.$Map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.initDataRange(e),this.initAnimator(),this.onEvents()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){var n=this.$Map,r=t.getContext(this.context),o=this.options.animation,a=this.options.hasOwnProperty("projection")?this.options.projection:"EPSG:4326",s=this.$Map.getView().getProjection().getCode();if(this.isEnabledTime()){if(void 0===e)return St(r),this;"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else St(r);if("2d"===this.context)for(var u in this.options)r[u]=this.options[u];else r.clear(r.COLOR_BUFFER_BIT);var l={};l.transferCoordinate=a===s?function(t){return n.getPixelFromCoordinate(t)}:function(t){return n.getPixelFromCoordinate(ol.proj.transform(t,a,s))},void 0!==e&&(l.filter=function(t){var n=o.trails||10;return!!(e&&t.time>e-n&&t.time<e)});var h=this.dataSet.get(l);return this.processData(h),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(r,new i(h),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.getMapExtent();this.layer_=new ol.layer.Image({layerName:this.options.layerName,minResolution:this.options.minResolution,maxResolution:this.options.maxResolution,zIndex:this.options.zIndex,extent:t,source:new ol.source.ImageCanvas({canvasFunction:this.canvasFunction.bind(this),projection:this.$Map.getView().getProjection().getCode(),ratio:this.options.hasOwnProperty("ratio")?this.options.ratio:1})}),this.$Map.addLayer(this.layer_),this.$Map.un("precompose",this.reRender,this),this.$Map.on("precompose",this.reRender,this)}}},{key:"reRender",value:function(){if(this.layer_){var t=this.getMapExtent();this.layer_.setExtent(t)}}},{key:"canvasFunction",value:function(t,e,n,r,i){return this.canvasLayer.canvas?(this.canvasLayer.canvas.width=r[0],this.canvasLayer.canvas.height=r[1]):this.canvasLayer.canvas=Oe(r[0],r[1]),this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"getMapExtent",value:function(){var t=this.$Map.getSize();return this.$Map.getView().calculateExtent(t)}},{key:"addTo",value:function(t){this.init(t,this.options)}},{key:"removeLayer",value:function(){this.$Map&&(this.unEvents(),this.$Map.un("precompose",this.reRender,this),this.$Map.removeLayer(this.layer_),delete this.$Map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,{x:n[0],y:n[1]},t)}},{key:"mousemoveEvent",value:function(t){var n=t.pixel;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,{x:n[0],y:n[1]},t)}},{key:"addAnimatorEvent",value:function(){this.$Map.on("movestart",this.animatorMovestartEvent,this),this.$Map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.$Map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("pointermove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.$Map;this.options.methods&&(this.options.methods.click&&t.un("click",this.clickEvent,this),this.options.methods.pointermove&&t.un("pointermove",this.mousemoveEvent,this))}},{key:"setDefaultCursor",value:function(t,e){if(this.$Map){var n=this.$Map.getTargetElement();e?n.style.cursor!==t&&(this.previousCursor_=n.style.cursor,n.style.cursor=t):void 0!==this.previousCursor_&&(n.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}}},{key:"show",value:function(){this.$Map.addLayer(this.layer_)}},{key:"hide",value:function(){this.$Map.removeLayer(this.layer_)}}]),e}(me),Fe=function(t){function e(t,n,r,i){Ot(this,e);var o=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i));if(!me)return Bt(o);var a=o;return i=i||{},a.init(i),a.argCheck(i),o.canvasLayer=n,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o._moveStartEvent=o.moveStartEvent.bind(o),o._moveEndEvent=o.moveEndEvent.bind(o),o._zoomStartEvent=o.zoomStartEvent.bind(o),o.bindEvent(),o}return Dt(e,t),kt(e,[{key:"clickEvent",value:function(t){var n=this.map.containerPointToLayerPoint([0,0]),r=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio,i=t.layerPoint;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,L.point((i.x-n.x)/r,(i.y-n.y)/r),t)}},{key:"mousemoveEvent",value:function(t){var n=t.layerPoint;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"bindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent)),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent)),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}},{key:"getContext",value:function(){return this.canvasLayer.getCanvas().getContext(this.context)}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"update",value:function(t){var n=t||{},r=n.data;r&&r.get&&(r=r.get()),void 0!=r&&this.dataSet.set(r),Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:n.options})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,n=e.options.animation,r=this.getContext(),i=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(r);"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else this.clear(r);if("2d"===this.context)for(var o in e.options)r[o]=e.options[o];else r.clear(r.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&i.getZoom()<e.options.minZoom||e.options.maxZoom&&i.getZoom()>e.options.maxZoom)){var a=i.getBounds(),s=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth(),l=i.getSize(),h=s/l.x,c=u/l.y,f=this.canvasLayer.getTopLeft(),p=i.latLngToContainerPoint(f),d={transferCoordinate:function(t){var n;n="2d"===e.context?i.latLngToContainerPoint(L.latLng(t[1],t[0])):{x:(t[0]-f.lng)/h,y:(f.lat-t[1])/c};var r={x:n.x-p.x,y:n.y-p.y};return[r.x,r.y]}};void 0!==t&&(d.filter=function(e){var r=n.trails||10;return t&&e.time>t-r&&e.time<t});var v=e.dataSet.get(d);this.processData(v),e.options._size=e.options.size;var g=i.latLngToContainerPoint(L.latLng(0,0)),m={x:g.x-p.x,y:g.y-p.y};this.drawContext(r,v,e.options,m),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){}},{key:"moveStartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}},{key:"moveEndEvent",value:function(){this.canvasLayer.draw(),this._show()}},{key:"zoomStartEvent",value:function(){this._hide()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_hide",value:function(){this.canvasLayer.canvas.style.display="none"}},{key:"_show",value:function(){this.canvasLayer.canvas.style.display="block"}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),e}(me);if("undefined"!=typeof L){var De=L.Layer.extend({options:{attributionPrefix:null,attribution:""},initialize:function(t,e,n){n=n||{},this.dataSet=t||{},this.mapVOptions=e||{},this.render=this.render.bind(this),L.Util.setOptions(this,n),this.options.attributionPrefix&&(this.options.attribution=this.options.attributionPrefix+this.options.attribution),this.canvas=this._createCanvas(),L.stamp(this)},onAdd:function(t){this._map=t;var e=this.getPane(),n=this.container=L.DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e);n.appendChild(this.canvas);var r=t.getSize();n.style.width=r.x+"px",n.style.height=r.y+"px",this.renderer=new Fe(t,this,this.dataSet,this.mapVOptions),this.draw(),this.fire("loaded")},onRemove:function(){L.DomUtil.remove(this.container),this.renderer.destroy()},addData:function(t,e){this.renderer.addData(t,e)},update:function(t){this.renderer.update(t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},draw:function(){return this._reset()},setZIndex:function(t){this.canvas.style.zIndex=t},render:function(){this.renderer._canvasUpdate()},getCanvas:function(){return this.canvas},getContainer:function(){return this.container},getTopLeft:function(){var t,e=this._map;if(e){t=e.getBounds().getNorthWest()}return t},_createCanvas:function(){var t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600;var e="undefined"==typeof window?{}:window,n=this.devicePixelRatio=e.devicePixelRatio;return this.mapVOptions.context&&"2d"!==this.mapVOptions.context||t.getContext("2d").scale(n,n),t},_resize:function(){var t=this.canvas;if(t){var e=this._map,n=e.getSize();t.width=n.x,t.height=n.y,t.style.width=n.x+"px",t.style.height=n.y+"px";var r=e.getBounds(),i=e.latLngToLayerPoint(r.getNorthWest());L.DomUtil.setPosition(t,i)}},_reset:function(){this._resize(),this._render()},redraw:function(){this._resize(),this._render()},_render:function(){this.render()}});Se=function(t,e,n){return new De(t,e,n)}}var Be,ze=Se,Ie=function(t){function e(t,n,r,i){Ot(this,e);var o=Bt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return me?(o.map=t,o.scene=t.scene,o.dataSet=n,r=r||{},o.init(r),o.argCheck(r),o.initDevicePixelRatio(),o.canvasLayer=i,o.stopAniamation=!1,o.animation=r.animation,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o.bindEvent(),o):Bt(o)}return Dt(e,t),kt(e,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(t){var n=t.point;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,n,t)}},{key:"mousemoveEvent",value:function(t){var n=t.point;Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(t){this.map;var e=this.scene;if(this.canvasLayer&&!this.stopAniamation){var n=this.options.animation,r=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void this.clear(r);"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else this.clear(r);if("2d"===this.context)for(var o in this.options)r[o]=this.options[o];else r.clear(r.COLOR_BUFFER_BIT);var a={transferCoordinate:function(t){var n=Cesium.Cartesian3.fromDegrees(t[0],t[1]),r=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,n);return void 0==r?[-1,-1]:[r.x,r.y]}};void 0!==t&&(a.filter=function(e){var r=n.trails||10;return!!(t&&e.time>t-r&&e.time<t)});var s=this.dataSet.get(a);this.processData(s),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var u=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,Cesium.Cartesian3.fromDegrees(0,0));this.drawContext(r,new i(s),this.options,u),this.options.updateCallback&&this.options.updateCallback(t)}}},{key:"updateData",value:function(t,n){var r=t;r&&r.get&&(r=r.get()),void 0!=r&&this.dataSet.set(r),Ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:n})}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}}]),e}(me);if("undefined"!=typeof Cesium){var Ue=0,Ne=(Cesium,function(){function t(e,n,r,i){if(Ot(this,t),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new Ie(e,n,r,this),this.mapVOptions=r,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),i)this.container=i;else{var o=e.container.querySelector(".cesium-viewer-cesiumWidgetContainer");this.container=o||e.container}this.addInnerContainer(),this.bindEvent(),this._reset()}return kt(t,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var e=new Cesium.ScreenSpaceEventHandler(this.scene.canvas);e.setInputAction(function(e){t.innerMoveEnd()},Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(e){t.innerMoveEnd()},Cesium.ScreenSpaceEventType.MIDDLE_UP),this.handler=e}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.mapvBaseLayer&&(this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer.animatorMoveendEvent(),this._reset())}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(t,e)}},{key:"updateData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(t,e)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(t){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(t)}},{key:"removeAllData",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block",this}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none",this}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");t.id=this.mapVOptions.layerid||"mapv"+Ue++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||0,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height;var e=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(e,e),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){void 0!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(t){void 0!=t&&this.updateData(t.data,t.options)}},{key:"resizeCanvas",value:function(){if(void 0!=this.canvas&&null!=this.canvas){var t=this.canvas;t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),t}());Be=function(t,e,n,r){return new Ne(t,e,n,r)}}var je=Be,Ye={getDataSet:function(t){var e=[],n=t.features;if(n)for(var r=0;r<n.length;r++){var o=n[r],a=o.geometry,s=o.properties,u={};for(var l in s)u[l]=s[l];u.geometry=a,e.push(u)}return new i(e)}},Ve={CSVToArray:function(t,e){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),r=[[]],i=null;i=n.exec(t);){var o=i[1];o.length&&o!==e&&r.push([]);var a;a=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],r[r.length-1].push(a)}return r},getDataSet:function(t,e){for(var n=this.CSVToArray(t,e||","),r=[],o=n[0],a=1;a<n.length-1;a++){for(var s=n[a],u={},l=0;l<s.length;l++){var h=s[l];"geometry"==o[l]&&(h=JSON.parse(h)),u[o[l]]=h}r.push(u)}return new i(r)}};e.version="2.0.57",e.canvasClear=St,e.canvasResolutionScale=Ct,e.canvasDrawSimple=It,e.canvasDrawHeatmap=jt,e.canvasDrawGrid=Yt,e.canvasDrawHoneycomb=Vt,e.webglDrawSimple=Qt,e.webglDrawPoint=Gt,e.webglDrawLine=qt,e.webglDrawPolygon=$t,e.utilCityCenter=Rt,e.utilCurve=te,e.utilForceEdgeBundling=ee,e.utilDataRangeIntensity=u,e.utilDataRangeCategory=et,e.utilDataRangeChoropleth=nt,e.Map=ne,e.baiduMapCanvasLayer=rt,e.baiduMapAnimationLayer=xe,e.baiduMapLayer=Me,e.googleMapCanvasLayer=Pt,e.googleMapLayer=Ae,e.MaptalksLayer=Ce,e.AMapLayer=Re,e.OpenlayersLayer=ke,e.leafletMapLayer=ze,e.cesiumMapLayer=je,e.DataSet=i,e.geojson=Ye,e.csv=Ve,Object.defineProperty(e,"__esModule",{value:!0})})}).call(e,n(34))},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeControl(this.control),this.control=null}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.destroy(),this.control=this.getControl(),t.addControl(this.control))}},{key:"getControl",value:function(){return null}}]),e}(u.default);e.default=l},function(t,n){t.exports=e},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeOverlay(this.overlay),this.overlay=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.overlay=this.getOverlay(),this.bindEvent(this.overlay,this.events),t.addOverlay(this.overlay);var e=this.overlay.getPath();e&&e.length>0&&!0===this.props.autoViewport&&t.setViewport(e,this.props.viewportOptions)}}},{key:"getOverlay",value:function(){return null}},{key:"options",get:function(){return["strokeColor","fillColor","strokeWeight","strokeOpacity","fillOpacity","strokeStyle","enableMassClear","enableEditing","enableClicking"]}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});for(var s=(function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()),u=n(1),l=r(u),h=n(4),c=n(0),f=r(c),p=n(7),d=r(p),v=n(23),g=r(v),m=window.Huiyan_Makers_IMG||"//huiyan.baidu.com/cms/react-bmap/markers_new2x_fbb9e99.png",y={simple_red:new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-189),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),simple_blue:new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-225),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),loc_red:new BMap.Icon(m,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-189),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),loc_blue:new BMap.Icon(m,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-225),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),start:new BMap.Icon(m,new BMap.Size(25,40),{imageOffset:new BMap.Size(-200,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),end:new BMap.Icon(m,new BMap.Size(25,40),{imageOffset:new BMap.Size(-225,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),location:new BMap.Icon(m,new BMap.Size(14,20),{imageOffset:new BMap.Size(-124,-233),anchor:new BMap.Size(7,20),imageSize:new BMap.Size(300,300)})},b=1;b<=10;b++)y["red"+b]=new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(b-1),0),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});for(var b=1;b<=10;b++)y["blue"+b]=new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(b-1),-66),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});var x=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.marker&&(this.props.map.removeOverlay(this.marker),this.marker=null)}},{key:"initialize",value:function(){var t=this.props.map;if("order_tip"!=this.props.type&&t){this.destroy();var e,n=this.props.icon;if(e=n&&n instanceof BMap.Icon?n:n&&y[n]?y[n]:y.simple_red,"bd09mc"===this.props.coordType)var r=t.getMapType().getProjection(),i=r.pointToLngLat(new BMap.Pixel(this.props.position.lng,this.props.position.lat));else var i=new BMap.Point(this.props.position.lng,this.props.position.lat);if("children"in this.props){this.contentDom=document.createElement("div");var o=this.props.children;(0,h.render)(l.default.createElement("div",null,o),this.contentDom),this.marker=new g.default(i,this.contentDom,{zIndex:this.props.zIndex,pane:this.props.pane,offset:this.props.offset}),t.addOverlay(this.marker)}else{var a=this.getOptions(this.options);a.icon=e,this.marker=new BMap.Marker(i,a),this.props.isTop&&this.marker.setTop(!0),this.bindEvent(this.marker,this.events),t.addOverlay(this.marker),this.bindToggleMeghods(this.marker,this.toggleMethods)}this.props.autoViewport&&t.setViewport([i],this.props.ViewportOptions)}}},{key:"render",value:function(){return"order_tip"==this.props.type?l.default.createElement(d.default,this.props):null}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","infowindowclose","infowindowopen","dragstart","dragging","dragend","rightclick"]}},{key:"toggleMethods",get:function(){return{enableMassClear:["enableMassClear","disableMassClear"],enableDragging:["enableDragging","disableDragging"]}}},{key:"options",get:function(){return["offset","icon","enableMassClear","enableDragging","enableClicking","raiseOnDrag","draggingCursor","rotation","shadow","title"]}}],[{key:"defaultProps",get:function(){return{}}}]),e}(f.default);e.default=x},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(1),h=r(l),c=n(6),f=r(c),p=n(13),d=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.createMarker=n.createMarker.bind(n),n.state={},n}return a(e,t),u(e,[{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)!=JSON.stringify(this.props.data)||this.map}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"createMarker",value:function(){var t=this,e=this.props,n=e.position,r=e.num,i=e.rate,o=e.name,a=e.rightModule,u=e.order,l=e.visible,c=void 0===l||l,d=p.bmap.createPoint(n),v=!0;i&&(i.indexOf("-")>-1&&(v=!1,i=i.replace(/-/,"")),i.indexOf("+")>-1&&(v=!0,i=i.replace("+","")),0==i.length&&(i="_"));var g={display:"flex",justifyContent:"space-between",background:"#FFFFFF",alignItems:"stretch",boxShadow:"0 2px 2px 0 rgba(0, 0, 0, 0.22)",borderRadius:"3px 0 0 3px",minWidth:"155px",minHeight:"50px",marginTop:"-25px"},m={minWidth:"30px",background:"#999999",color:"white",padding:"auto 0",display:"flex",justifyContent:"center",alignItems:"center"};this.props.active&&(m.background="#F5533D"),this.props.leftStyle&&(m=p.obj.merge(m,this.props.leftStyle)),this.props.style&&(g=p.obj.merge(g,this.props.style));var y={flex:"1",padding:"6px",justifyContent:"center",alignItems:"center",fontSize:"12px",color:"#8D93A3",letterSpacing:"0.6px"};this.props.rightStyle&&(y=p.obj.merge(y,this.props.rightStyle));var b=Object.keys(t.props).filter(function(t){return 0==t.indexOf("on")}),x=[];if(b.map(function(e){x[e]=t.props[e]}),c)return h.default.createElement(f.default,{key:JSON.stringify(d)+Math.random(),map:this.props.map,position:d,zIndex:t.props.zIndex},h.default.createElement("div",s({key:JSON.stringify(d)+Math.random(),style:g},x),h.default.createElement("div",{style:m},u),h.default.createElement("div",{style:y},!a&&h.default.createElement("div",null,"  ",r+"("+i,v?h.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/up.png"}):h.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/down.png"}),")"),a||h.default.createElement("div",null,"  ",o," "))))}},{key:"render",value:function(){return this.createMarker()}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(h.default.Component);e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=void 0,r=void 0;try{if("string"==typeof t){var i=t.split(",");n=JSON.parse(i[0].match(/[0-9]+\.?[0-9]{0,}/)[0]),r=JSON.parse(i[1].match(/[0-9]+\.?[0-9]{0,}/)[0])}else t instanceof Array?(n=JSON.parse(t[0]),r=JSON.parse(t[1])):t instanceof Object&&(n=t.lng,r=t.lat);if(e)return{lng:n,lat:r};return new BMap.Point(n,r)}catch(t){console.log("create BmapPoint error",'Please input data like this:  1. "114.54,40.33",  2.[114.54,40.33],  3.{lng:114.54,lat:40.33}')}};e.default=r},function(t,e,n){(function(t){!function(t,n){n(e)}(0,function(e){function n(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function i(t,e){return function(n){return e(t(n))}}function o(t){var e=function(e){return void 0===e||null===e?e:(1<arguments.length&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function a(t){var e=function(e){if(void 0===e||null===e)return e;1<arguments.length&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"===(void 0===n?"undefined":Fr(n)))for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}function s(t,e){if(!(this instanceof s))return new s(t,e);if(e&&e in Ui&&(e=null),e&&!(e in zi))throw Error("Unknown model: "+e);if(void 0===t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof s)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){if(null===(e=ki.get(t)))throw Error("Unable to parse color from string: "+t);this.model=e.model;var n=zi[this.model].channels;this.color=e.value.slice(0,n),this.valpha="number"==typeof e.value[n]?e.value[n]:1}else if(t.length)this.model=e||"rgb",n=zi[this.model].channels,e=Ii.call(t,0,n),this.color=c(e,n),this.valpha="number"==typeof t[n]?t[n]:1;else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{if(this.valpha=1,e=He(t),"alpha"in t&&(e.splice(e.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0),!((e=e.sort().join(""))in Ni))throw Error("Unable to parse color from object: "+Li(t));this.model=Ni[e],n=zi[this.model].labels;var r=[];for(e=0;e<n.length;e++)r.push(t[n[e]]);this.color=c(r)}if(ji[this.model])for(n=zi[this.model].channels,e=0;e<n;e++)(t=ji[this.model][e])&&(this.color[e]=t(this.color[e]));this.valpha=Math.max(0,Math.min(1,this.valpha)),Ei&&Ei(this)}function u(t){return function(e){return Number(e.toFixed(t))}}function l(t,e,n){return t=Array.isArray(t)?t:[t],t.forEach(function(t){(ji[t]||(ji[t]=[]))[e]=n}),t=t[0],function(r){if(arguments.length){n&&(r=n(r));var i=this[t]();return i.color[e]=r,i}return i=this[t]().color[e],n&&(i=n(i)),i}}function h(t){return function(e){return Math.max(0,Math.min(t,e))}}function c(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}function f(t){return t*Math.PI/180}function p(t){return t/Math.PI*180}function d(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function v(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function g(t,e){return 1e-8>Math.abs(t-e)}function m(){}function y(t,e){for(var n in e)t[n]=e[n]}function b(t,e){this.lng=t,this.lat=e}function x(t,e){this.x=t,this.y=e}function _(t,e){var n=document.createElement("canvas");return t&&(n.width=t),e&&(n.height=e),n}function w(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=void 0===t.maxSize?35:t.maxSize,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function M(t){this.options=t||{},this._initialize()}function T(t,e,n,r,i){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*n+3*(1-t)*t*t*r+t*t*t*i}function A(t){this.WORLD_SIZE_MC_HALF=20037726.372307256,this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF,this.options=t||{},this._initialize()}function E(t,e){return t&&e?Math.round(Math.sqrt(Math.pow(t.lng-e.lng,2)+Math.pow(t.lat-e.lat,2))):0}function P(t){for(var e,n=["webgl2","experimental-webgl2","webgl","experimental-webgl"],r=0;r<n.length;r++)try{if(e=t.getContext(n[r],{premultipliedAlpha:!1}))break}catch(t){}return e}function S(t,e,n){n=Ke({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},n);var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);for(var i in n)t.texParameteri(t.TEXTURE_2D,t[i],t[n[i]]);return t.bindTexture(t.TEXTURE_2D,null),r}function C(t,e,n,r){if("object"===(void 0===e?"undefined":Fr(e)))e=S(t,e,r),n(e,null);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var e=v(i.width),o=v(i.height),a=document.createElement("canvas");a.width=e,a.height=o,a.getContext("2d").drawImage(i,0,0,e,o),i=a,e=S(t,i,r),n(e,i)},i.src=e}}function L(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=R(t,0,i,n,!0),a=[];if(!o||o.next===o.prev)return a;var s;if(r){var u=n;r=[];var l,h=0;for(l=e.length;h<l;h++){var c=e[h]*u;c=R(t,c,h<l-1?e[h+1]*u:t.length,u,!1),c===c.next&&(c.steiner=!0),r.push(I(c))}for(r.sort(D),h=0;h<r.length;h++)e=r[h],u=o,(u=B(e,u))&&(e=H(u,e),O(e,e.next)),o=O(o,o.next)}if(t.length>80*n){var f=s=t[0],p=r=t[1];for(u=n;u<i;u+=n)h=t[u],e=t[u+1],h<f&&(f=h),e<p&&(p=e),h>s&&(s=h),e>r&&(r=e);s=Math.max(s-f,r-p),s=0!==s?1/s:0}return k(o,a,n,f,p,s),a}function R(t,e,n,r,i){if(i===0<X(t,e,n,r))for(i=e;i<n;i+=r)var o=W(i,t[i],t[i+1],o);else for(i=n-r;i>=e;i-=r)o=W(i,t[i],t[i+1],o);return o&&j(o,o.next)&&(q(o),o=o.next),o}function O(t,e){if(!t)return t;e||(e=t);do{var n=!1;if(t.steiner||!j(t,t.next)&&0!==N(t.prev,t,t.next))t=t.next;else{if(q(t),(t=e=t.prev)===t.next)break;n=!0}}while(n||t!==e);return e}function k(t,e,n,r,i,o,a){if(t){if(!a&&o){var s=t,u=s;do{null===u.z&&(u.z=z(u.x,u.y,r,i,o)),u.prevZ=u.prev,u=u.nextZ=u.next}while(u!==s);u.prevZ.nextZ=null,u.prevZ=null,s=u;var l,h,c,f,p=1;do{u=s;var d=s=null;for(h=0;u;){h++;var v=u;for(l=c=0;l<p&&(c++,v=v.nextZ);l++);for(f=p;0<c||0<f&&v;)0!==c&&(0===f||!v||u.z<=v.z)?(l=u,u=u.nextZ,c--):(l=v,v=v.nextZ,f--),d?d.nextZ=l:s=l,l.prevZ=d,d=l;u=v}d.nextZ=null,p*=2}while(1<h)}for(s=t;t.prev!==t.next;){if(u=t.prev,v=t.next,o)d=F(t,r,i,o);else t:if(d=t,h=d.prev,c=d,p=d.next,0<=N(h,c,p))d=!1;else{for(l=d.next.next;l!==d.prev;){if(U(h.x,h.y,c.x,c.y,p.x,p.y,l.x,l.y)&&0<=N(l.prev,l,l.next)){d=!1;break t}l=l.next}d=!0}if(d)e.push(u.i/n),e.push(t.i/n),e.push(v.i/n),q(t),s=t=v.next;else if((t=v)===s){if(a){if(1===a){a=e,s=n,u=t;do{v=u.prev,d=u.next.next,!j(v,d)&&Y(v,u,u.next,d)&&V(v,d)&&V(d,v)&&(a.push(v.i/s),a.push(u.i/s),a.push(d.i/s),q(u),q(u.next),u=t=d),u=u.next}while(u!==t);t=u,k(t,e,n,r,i,o,2)}else if(2===a)t:{a=t;do{for(s=a.next.next;s!==a.prev;){if(u=a.i!==s.i){if(u=a,v=s,d=u.next.i!==v.i&&u.prev.i!==v.i){e:{d=u;do{if(d.i!==u.i&&d.next.i!==u.i&&d.i!==v.i&&d.next.i!==v.i&&Y(d,d.next,u,v)){d=!0;break e}d=d.next}while(d!==u);d=!1}d=!d}if(d=d&&V(u,v)&&V(v,u)){d=u,h=!1,c=(u.x+v.x)/2,v=(u.y+v.y)/2;do{d.y>v!=d.next.y>v&&d.next.y!==d.y&&c<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(h=!h),d=d.next}while(d!==u);d=h}u=d}if(u){t=H(a,s),a=O(a,a.next),t=O(t,t.next),k(a,e,n,r,i,o),k(t,e,n,r,i,o);break t}s=s.next}a=a.next}while(a!==t)}}else k(O(t),e,n,r,i,o,1);break}}}}function F(t,e,n,r){var i=t.prev,o=t.next;if(0<=N(i,t,o))return!1;var a=i.x>t.x?i.x>o.x?i.x:o.x:t.x>o.x?t.x:o.x,s=i.y>t.y?i.y>o.y?i.y:o.y:t.y>o.y?t.y:o.y,u=z(i.x<t.x?i.x<o.x?i.x:o.x:t.x<o.x?t.x:o.x,i.y<t.y?i.y<o.y?i.y:o.y:t.y<o.y?t.y:o.y,e,n,r);for(e=z(a,s,e,n,r),n=t.prevZ,r=t.nextZ;n&&n.z>=u&&r&&r.z<=e;){if(n!==t.prev&&n!==t.next&&U(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=N(n.prev,n,n.next))return!1;if(n=n.prevZ,r!==t.prev&&r!==t.next&&U(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=N(r.prev,r,r.next))return!1;r=r.nextZ}for(;n&&n.z>=u;){if(n!==t.prev&&n!==t.next&&U(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=N(n.prev,n,n.next))return!1;n=n.prevZ}for(;r&&r.z<=e;){if(r!==t.prev&&r!==t.next&&U(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=N(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function D(t,e){return t.x-e.x}function B(t,e){var n=e,r=t.x,i=t.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(i===n.y)return n;if(i===n.next.y)return n.next}var s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s.prev;e=s,a=s.x;var u=s.y,l=1/0;for(n=s.next;n!==e;){if(r>=n.x&&n.x>=a&&r!==n.x&&U(i<u?r:o,i,a,u,i<u?o:r,i,n.x,n.y)){var h=Math.abs(i-n.y)/(r-n.x);(h<l||h===l&&n.x>s.x)&&V(n,t)&&(s=n,l=h)}n=n.next}return s}function z(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),1431655765&(t|t<<1)|(1431655765&(e|e<<1))<<1}function I(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function U(t,e,n,r,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(r-s)-(n-a)*(e-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function N(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function j(t,e){return t.x===e.x&&t.y===e.y}function Y(t,e,n,r){return!!(j(t,e)&&j(n,r)||j(t,r)&&j(n,e))||0<N(t,e,n)!=0<N(t,e,r)&&0<N(n,r,t)!=0<N(n,r,e)}function V(t,e){return 0>N(t.prev,t,t.next)?0<=N(t,e,t.next)&&0<=N(t,t.prev,e):0>N(t,e,t.prev)||0>N(t,t.next,e)}function H(t,e){var n=new Z(t.i,t.x,t.y),r=new Z(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function W(t,e,n,r){return t=new Z(t,e,n),r?(t.next=r.next,t.prev=r,r.next.prev=t,r.next=t):(t.prev=t,t.next=t),t}function q(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Z(t,e,n){this.i=t,this.x=e,this.y=n,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function X(t,e,n,r){for(var i=0,o=n-r;e<n;e+=r)i+=(t[o]-t[e])*(t[e+1]+t[o+1]),o=e;return i}function G(t){try{return Po.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch(n){var e=new Eo;return e.append(t),Po.createObjectURL(e.getBlob(type))}}function J(t,e){this.shapeLayer=t,this.gl=e,this.initData()}function K(){Ho=!0;for(var t=0;64>t;++t)jo[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t],Yo["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;Yo[45]=62,Yo[95]=63}function $(t,e,n){for(var r=[],i=e;i<n;i+=3)e=(t[i]<<16)+(t[i+1]<<8)+t[i+2],r.push(jo[e>>18&63]+jo[e>>12&63]+jo[e>>6&63]+jo[63&e]);return r.join("")}function Q(t){Ho||K();for(var e=t.length,n=e%3,r="",i=[],o=0,a=e-n;o<a;o+=16383)i.push($(t,o,o+16383>a?a:o+16383));return 1===n?(t=t[e-1],r+=jo[t>>2],r+=jo[t<<4&63],r+="=="):2===n&&(t=(t[e-2]<<8)+t[e-1],r+=jo[t>>10],r+=jo[t>>4&63],r+=jo[t<<2&63],r+="="),i.push(r),i.join("")}function tt(t,e,n,r,i){var o=8*i-r-1,a=(1<<o)-1,s=a>>1,u=-7;i=n?i-1:0;var l=n?-1:1,h=t[e+i];for(i+=l,n=h&(1<<-u)-1,h>>=-u,u+=o;0<u;n=256*n+t[e+i],i+=l,u-=8);for(o=n&(1<<-u)-1,n>>=-u,u+=r;0<u;o=256*o+t[e+i],i+=l,u-=8);if(0===n)n=1-s;else{if(n===a)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),n-=s}return(h?-1:1)*o*Math.pow(2,n-r)}function et(t,e,n,r,i,o){var a,s=8*o-i-1,u=(1<<s)-1,l=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0;o=r?0:o-1;var c=r?1:-1,f=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(e=isNaN(e)?1:0,r=u):(r=Math.floor(Math.log(e)/Math.LN2),1>e*(a=Math.pow(2,-r))&&(r--,a*=2),e=1<=r+l?e+h/a:e+h*Math.pow(2,1-l),2<=e*a&&(r++,a/=2),r+l>=u?(e=0,r=u):1<=r+l?(e=(e*a-1)*Math.pow(2,i),r+=l):(e=e*Math.pow(2,l-1)*Math.pow(2,i),r=0));8<=i;t[n+o]=255&e,o+=c,e/=256,i-=8);for(r=r<<i|e,s+=i;0<s;t[n+o]=255&r,o+=c,r/=256,s-=8);t[n+o-c]|=128*f}function nt(t,e){if((rt.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<e)throw new RangeError("Invalid typed array length");return rt.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=rt.prototype):(null===t&&(t=new rt(e)),t.length=e),t}function rt(t,e,n){if(!(rt.TYPED_ARRAY_SUPPORT||this instanceof rt))return new rt(t,e,n);if("number"==typeof t){if("string"==typeof e)throw Error("If encoding is specified then the first argument must be a string");return at(this,t)}return it(this,t,e,n)}function it(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){if(e.byteLength,0>n||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),rt.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=rt.prototype):t=st(t,e),t}if("string"==typeof e){if(r=t,t=n,"string"==typeof t&&""!==t||(t="utf8"),!rt.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return n=0|ct(e,t),r=nt(r,n),e=r.write(e,t),e!==n&&(r=r.slice(0,e)),r}return ut(t,e)}function ot(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(0>t)throw new RangeError('"size" argument must not be negative')}function at(t,e){if(ot(e),t=nt(t,0>e?0:0|lt(e)),!rt.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function st(t,e){var n=0>e.length?0:0|lt(e.length);t=nt(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function ut(t,e){if(ht(e)){var n=0|lt(e.length);return t=nt(t,n),0===t.length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return(n="number"!=typeof e.length)||(n=e.length,n=n!==n),n?nt(t,0):st(t,e);if("Buffer"===e.type&&qo(e.data))return st(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function lt(t){if(t>=(rt.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(rt.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return 0|t}function ht(t){return!(null==t||!t._isBuffer)}function ct(t,e){if(ht(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Tt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Et(t).length;default:if(r)return Tt(t).length;e=(""+e).toLowerCase(),r=!0}}function ft(t,e,n){var r=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":for(t=e,e=n,n=this.length,(!t||0>t)&&(t=0),(!e||0>e||e>n)&&(e=n),r="",n=t;n<e;++n)t=r,r=this[n],r=16>r?"0"+r.toString(16):r.toString(16),r=t+r;return r;case"utf8":case"utf-8":return gt(this,e,n);case"ascii":for(t="",n=Math.min(this.length,n);e<n;++e)t+=String.fromCharCode(127&this[e]);return t;case"latin1":case"binary":for(t="",n=Math.min(this.length,n);e<n;++e)t+=String.fromCharCode(this[e]);return t;case"base64":return e=Q(0===e&&n===this.length?this:this.slice(e,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(e=this.slice(e,n),n="",t=0;t<e.length;t+=2)n+=String.fromCharCode(e[t]+256*e[t+1]);return n;default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function pt(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function dt(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),0>n&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(0>n){if(!i)return-1;n=0}if("string"==typeof e&&(e=rt.from(e,r)),ht(e))return 0===e.length?-1:vt(t,e,n,r,i);if("number"==typeof e)return e&=255,rt.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):vt(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function vt(t,e,n,r,i){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var a=1,s=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(2>t.length||2>e.length)return-1;a=2,s/=2,u/=2,n/=2}if(i)for(r=-1;n<s;n++)if(o(t,n)===o(e,-1===r?0:n-r)){if(-1===r&&(r=n),n-r+1===u)return r*a}else-1!==r&&(n-=n-r),r=-1;else for(n+u>s&&(n=s-u);0<=n;n--){for(s=!0,r=0;r<u;r++)if(o(t,n+r)!==o(e,r)){s=!1;break}if(s)return n}return-1}function gt(t,e,n){n=Math.min(t.length,n);for(var r=[];e<n;){var i=t[e],o=null,a=239<i?4:223<i?3:191<i?2:1;if(e+a<=n)switch(a){case 1:128>i&&(o=i);break;case 2:var s=t[e+1];128==(192&s)&&127<(i=(31&i)<<6|63&s)&&(o=i);break;case 3:s=t[e+1];var u=t[e+2];128==(192&s)&&128==(192&u)&&2047<(i=(15&i)<<12|(63&s)<<6|63&u)&&(55296>i||57343<i)&&(o=i);break;case 4:s=t[e+1],u=t[e+2];var l=t[e+3];128==(192&s)&&128==(192&u)&&128==(192&l)&&65535<(i=(15&i)<<18|(63&s)<<12|(63&u)<<6|63&l)&&1114112>i&&(o=i)}null===o?(o=65533,a=1):65535<o&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),e+=a}if((t=r.length)<=Zo)r=String.fromCharCode.apply(String,r);else{for(n="",e=0;e<t;)n+=String.fromCharCode.apply(String,r.slice(e,e+=Zo));r=n}return r}function mt(t,e,n){if(0!=t%1||0>t)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function yt(t,e,n,r,i,o){if(!ht(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function bt(t,e,n,r){0>e&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function xt(t,e,n,r){0>e&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function _t(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function wt(t,e,n,r,i){return i||_t(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),et(t,e,n,r,23,4),n+4}function Mt(t,e,n,r,i){return i||_t(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),et(t,e,n,r,52,8),n+8}function Tt(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],a=0;a<r;++a){if(55295<(n=t.charCodeAt(a))&&57344>n){if(!i){if(56319<n){-1<(e-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(e-=3)&&o.push(239,191,189);continue}i=n;continue}if(56320>n){-1<(e-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,128>n){if(0>--e)break;o.push(n)}else if(2048>n){if(0>(e-=2))break;o.push(n>>6|192,63&n|128)}else if(65536>n){if(0>(e-=3))break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(1114112>n))throw Error("Invalid code point");if(0>(e-=4))break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function At(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function Et(t){if(t=(t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Jo,""),2>t.length)t="";else for(;0!=t.length%4;)t+="=";Ho||K();var e=t.length;if(0<e%4)throw Error("Invalid string. Length must be a multiple of 4");var n="="===t[e-2]?2:"="===t[e-1]?1:0,r=new Vo(3*e/4-n),i=0<n?e-4:e,o=0;for(e=0;e<i;e+=4){var a=Yo[t.charCodeAt(e)]<<18|Yo[t.charCodeAt(e+1)]<<12|Yo[t.charCodeAt(e+2)]<<6|Yo[t.charCodeAt(e+3)];r[o++]=a>>16&255,r[o++]=a>>8&255,r[o++]=255&a}return 2===n?(a=Yo[t.charCodeAt(e)]<<2|Yo[t.charCodeAt(e+1)]>>4,r[o++]=255&a):1===n&&(a=Yo[t.charCodeAt(e)]<<10|Yo[t.charCodeAt(e+1)]<<4|Yo[t.charCodeAt(e+2)]>>2,r[o++]=a>>8&255,r[o++]=255&a),r}function Pt(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function St(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Ct(t,e){var n=[];return t.forEach(function(t){n.push(e?-t:t,t)}),n}function Lt(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=[],r=0;r<t-1;r++){var i=2*(r+e);n.push(i,i+1,i+2),n.push(i+2,i+1,i+3)}return n}function Rt(t){return function(e,n,r){return e=n+t,n=r.length-1,r[0<n?0>e?0:e>n?n:e:e<n?n:0<e?0:e]}}function Ot(t){if(!t[0]||!t[0].length)return t;for(var e=t[0].length,n=[],r=0,i=0;i<t.length;i++)for(var o=0;o<e;o++)n[r++]=t[i][o];return n}function kt(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=[],n=0,r=0;r<t.length;r++){var i=t[r];if(0<r){var o=t[r-1];n+=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2))}e.push(n)}return{arr:e,total:n}}function Ft(t,e){var n=[];return t.forEach(function(t){n.push(e?-t:t,t)}),n}function Dt(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=[],r=0;r<t-1;r++){var i=2*(r+e);n.push(i,i+1,i+2),n.push(i+2,i+1,i+3)}return n}function Bt(t){return function(e,n,r){return e=n+t,n=r.length-1,r[0<n?0>e?0:e>n?n:e:e<n?n:0<e?0:e]}}function zt(t){if(!t[0]||!t[0].length)return t;for(var e=t[0].length,n=[],r=0,i=0;i<t.length;i++)for(var o=0;o<e;o++)n[r++]=t[i][o];return n}function It(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=[],n=0,r=0;r<t.length;r++){var i=t[r];if(0<r){var o=t[r-1];n+=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2))}e.push(n)}return{arr:e,total:n}}function Ut(t){var e=0,n=0,r=!0,i=!1,o=void 0;try{for(var a,s=li(t);!(r=(a=s.next()).done);r=!0){var u=a.value;e+=u.w*u.h,n=Math.max(n,u.w)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}t.sort(function(t,e){return e.h-t.h}),n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],i=r=0,o=!0,s=!1,a=void 0;try{for(var l,h=li(t);!(o=(l=h.next()).done);o=!0)for(var c=l.value,f=n.length-1;0<=f;f--){var p=n[f];if(!(c.w>p.w||c.h>p.h)){if(c.x=p.x,c.y=p.y,i=Math.max(i,c.y+c.h),r=Math.max(r,c.x+c.w),c.w===p.w&&c.h===p.h){var d=n.pop();f<n.length&&(n[f]=d)}else c.h===p.h?(p.x+=c.w,p.w-=c.w):(c.w!==p.w&&n.push({x:p.x+c.w,y:p.y,w:p.w-c.w,h:c.h}),p.y+=c.h,p.h-=c.h);break}}}catch(t){s=!0,a=t}finally{try{!o&&h.return&&h.return()}finally{if(s)throw a}}return{w:r,h:i,fill:e/(r*i)||0}}function Nt(t,e,n){return n=Math.PI/180*(60*n+30),[t.x+e*Math.cos(n),t.y+e*Math.sin(n)]}function jt(t,e,n){for(var r={},i=[],o=t.length,a=e/2/Math.sin(Math.PI/3),s=1.5*a,u=1,l=0;l<o;++l){var h=t[l].geometry.coordinates;n&&(h=n(h));var c=+h[0],f=+h[1];if(!isNaN(c)&&!isNaN(f)){h=Math.round(f/=s);var p=Math.round(c=c/e-(1&h)/2),d=f-h;if(1<3*Math.abs(d)){var v=c-p,g=p+(c<p?-1:1)/2,m=h+(f<h?-1:1);c-=g,f-=m,v*v+d*d>c*c+f*f&&(p=g+(1&h?1:-1)/2,h=m)}d=p+"-"+h,(v=r[d])?(v.count+=t[l].count||1,u=Math.max(u,v.count)):(r[d]={center:{x:(p+(1&h)/2)*e,y:h*s},count:t[l].count||1},i.push(r[d]))}}return i.max=u,i.r=a,i}function Yt(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=Ae(e),this.reject=Ae(n)}function Vt(t,e,n,r){switch(r){case 5122:return new Int16Array(t,e,n);case 5123:return new Uint16Array(t,e,n);case 5124:return new Int32Array(t,e,n);case 5125:return new Uint32Array(t,e,n);case 5126:return new Float32Array(t,e,n);default:return null}}function Ht(t){return Vt(t.bufferView.data,t.byteOffset,t.count*Eu[t.type],t.componentType)}function Wt(t){var e="",n=t.lastIndexOf("/");return-1!==n&&(e=t.substring(0,n+1)),e}function qt(t,e){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",t,!0),n.onreadystatechange=function(){4==n.readyState&&"200"==n.status&&e(n.responseText,this)},n.send(null)}function Zt(t,e){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("GET",t,!0),n.onreadystatechange=function(){if(4==n.readyState&&"200"==n.status){var t=n.response;t&&e&&e(t)}},n.send(null)}function Xt(t,e,n){var r=new Image;r.crossOrigin="Anonymous",r.src=t,r.onload=function(){n(r,e)}}function Gt(t){function e(t,e){n.uniform1i(t,e.index),n.activeTexture(n.TEXTURE0+e.index),t=w.glTF.textures[e.index],n.bindTexture(n.TEXTURE_2D,t.texture),n.bindSampler(e.index,t.sampler?t.sampler.sampler:a)}var n=t.gl,r=0,i=[];t=n.canvas;var o=function(t,e,n){for(this.glTFScene=t,this.glTF=e,this.id=n,this.rootTransform=xo.create(),this.nodeMatrix=Array(e.nodes.length),t=0,e=this.nodeMatrix.length;t<e;t++)this.nodeMatrix[t]=xo.create()},a=n.createSampler();n.samplerParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST_MIPMAP_LINEAR),n.samplerParameteri(a,n.TEXTURE_MAG_FILTER,n.LINEAR),n.samplerParameteri(a,n.TEXTURE_WRAP_S,n.REPEAT),n.samplerParameteri(a,n.TEXTURE_WRAP_T,n.REPEAT),n.bindVertexArray(null),n.bindVertexArray(null);var s={HAS_SKIN:1,SKIN_VEC8:2,HAS_BASECOLORMAP:4,HAS_NORMALMAP:8,HAS_METALROUGHNESSMAP:16,HAS_OCCLUSIONMAP:32,HAS_EMISSIVEMAP:64},u={},l=function(){this.flags=0,this.programObject=null};l.prototype.hasSkin=function(){return this.flags&s.HAS_SKIN},l.prototype.hasBaseColorMap=function(){return this.flags&s.HAS_BASECOLORMAP},l.prototype.hasNormalMap=function(){return this.flags&s.HAS_NORMALMAP},l.prototype.hasMetalRoughnessMap=function(){return this.flags&s.HAS_METALROUGHNESSMAP},l.prototype.hasOcclusionMap=function(){return this.flags&s.HAS_OCCLUSIONMAP},l.prototype.hasEmissiveMap=function(){return this.flags&s.HAS_EMISSIVEMAP},l.prototype.defineMacro=function(t){void 0!==s[t]&&(this.flags|=s[t])},l.prototype.compile=function(){var t=u[this.flags];if(t)this.programObject=t;else{var e=t="";this.flags&s.HAS_SKIN&&(t+="#define HAS_SKIN\n"),this.flags&s.SKIN_VEC8&&(t+="#define SKIN_VEC8\n"),this.flags&s.HAS_BASECOLORMAP&&(e+="#define HAS_BASECOLORMAP\n"),this.flags&s.HAS_NORMALMAP&&(e+="#define HAS_NORMALMAP\n"),this.flags&s.HAS_METALROUGHNESSMAP&&(e+="#define HAS_METALROUGHNESSMAP\n"),this.flags&s.HAS_OCCLUSIONMAP&&(e+="#define HAS_OCCLUSIONMAP\n"),this.flags&s.HAS_EMISSIVEMAP&&(e+="#define HAS_EMISSIVEMAP\n"),t=Su.createProgram(n,"#version 300 es\n"+t+"#define POSITION_LOCATION 0\n#define NORMAL_LOCATION 1\n#define TEXCOORD_0_LOCATION 2\n#define JOINTS_0_LOCATION 3\n#define JOINTS_1_LOCATION 5\n#define WEIGHTS_0_LOCATION 4\n#define WEIGHTS_1_LOCATION 6\n#define TANGENT_LOCATION 7\nprecision highp float;precision highp int;uniform mat4 u_MVP;uniform mat4 u_MV;uniform mat4 u_MVNormal;\n#ifdef HAS_SKIN\nuniform JointMatrix{mat4 matrix[65];}u_jointMatrix;\n#endif\nlayout(location=POSITION_LOCATION)in vec3 position;layout(location=NORMAL_LOCATION)in vec3 normal;layout(location=TEXCOORD_0_LOCATION)in vec2 uv;\n#ifdef HAS_SKIN\nlayout(location=JOINTS_0_LOCATION)in vec4 joint0;layout(location=WEIGHTS_0_LOCATION)in vec4 weight0;\n#ifdef SKIN_VEC8\nlayout(location=JOINTS_1_LOCATION)in vec4 joint1;layout(location=WEIGHTS_1_LOCATION)in vec4 weight1;\n#endif\n#endif\nout vec3 v_position;out vec3 v_normal;out vec2 v_uv;void main(){\n#ifdef HAS_SKIN\nmat4 skinMatrix=weight0.x*u_jointMatrix.matrix[int(joint0.x)]+weight0.y*u_jointMatrix.matrix[int(joint0.y)]+weight0.z*u_jointMatrix.matrix[int(joint0.z)]+weight0.w*u_jointMatrix.matrix[int(joint0.w)];\n#ifdef SKIN_VEC8\nskinMatrix+=weight1.x*u_jointMatrix.matrix[int(joint1.x)]+weight1.y*u_jointMatrix.matrix[int(joint1.y)]+weight1.z*u_jointMatrix.matrix[int(joint1.z)]+weight1.w*u_jointMatrix.matrix[int(joint1.w)];\n#endif\n#endif\nv_uv=uv;\n#ifdef HAS_SKIN\nv_normal=normalize((u_MVNormal*transpose(inverse(skinMatrix))*vec4(normal,0)).xyz);vec4 pos=u_MV*skinMatrix*vec4(position,1.0);gl_Position=u_MVP*skinMatrix*vec4(position,1.0);\n#else\nv_normal=normalize((u_MVNormal*vec4(normal,0)).xyz);vec4 pos=u_MV*vec4(position,1.0);gl_Position=u_MVP*vec4(position,1.0);\n#endif\nv_position=vec3(pos.xyz)/pos.w;}","#version 300 es\n"+e+"#define FRAG_COLOR_LOCATION 0\nprecision highp float;precision highp int;uniform sampler2D u_brdfLUT;uniform vec4 u_baseColorFactor;\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_baseColorTexture;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_normalTexture;uniform float u_normalTextureScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_emissiveTexture;uniform vec3 u_emissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\nuniform float u_metallicFactor;uniform float u_roughnessFactor;\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_occlusionTexture;uniform float u_occlusionStrength;\n#endif\nin vec3 v_position;in vec3 v_normal;in vec2 v_uv;layout(location=FRAG_COLOR_LOCATION)out vec4 frag_color;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec3 getNormal(){vec3 pos_dx=dFdx(v_position);vec3 pos_dy=dFdy(v_position);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=v_normal;t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);\n#ifdef HAS_NORMALMAP\nvec3 n=texture(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalTextureScale,u_normalTextureScale,1.0)));\n#else\nvec3 n=tbn[2].xyz;\n#endif\nreturn n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=10.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture(u_brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 diffuseLight=vec3(0.6,0.6,0.6);vec3 specularLight=vec3(0.6,0.6,0.6);vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(){float perceptualRoughness=u_roughnessFactor;float metallic=u_metallicFactor;\n#ifdef HAS_METALROUGHNESSMAP\nvec4 mrSample=texture(u_metallicRoughnessTexture,v_uv);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;\n#endif\nperceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;\n#ifdef HAS_BASECOLORMAP\nvec4 baseColor=texture(u_baseColorTexture,v_uv)*u_baseColorFactor;\n#else\nvec4 baseColor=u_baseColorFactor;\n#endif\nvec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(-v_position);vec3 l=normalize(vec3(1.0,1.0,1.0));vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=max(vec3(0.0),F*G*D/(4.0*NdotL*NdotV));vec3 color=NdotL*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);\n#ifdef HAS_OCCLUSIONMAP\nfloat ao=texture(u_occlusionTexture,v_uv).r;color=mix(color,color*ao,u_occlusionStrength);\n#endif\n#ifdef HAS_EMISSIVEMAP\nvec3 emissive=texture(u_emissiveTexture,v_uv).rgb*u_emissiveFactor;color+=emissive;\n#endif\nfrag_color=vec4(color,baseColor.a);}"),this.programObject={program:t,uniformLocations:{},uniformBlockIndices:{}},this.flags&s.HAS_SKIN&&(this.programObject.uniformBlockIndices.JointMatrix=n.getUniformBlockIndex(t,"JointMatrix")),e=this.programObject.uniformLocations,e.MVP=n.getUniformLocation(t,"u_MVP"),e.MVNormal=n.getUniformLocation(t,"u_MVNormal"),e.MV=n.getUniformLocation(t,"u_MV"),e.baseColorFactor=n.getUniformLocation(t,"u_baseColorFactor"),e.metallicFactor=n.getUniformLocation(t,"u_metallicFactor"),e.roughnessFactor=n.getUniformLocation(t,"u_roughnessFactor"),this.flags&s.HAS_BASECOLORMAP&&(e.baseColorTexture=n.getUniformLocation(t,"u_baseColorTexture")),this.flags&s.HAS_NORMALMAP&&(e.normalTexture=n.getUniformLocation(t,"u_normalTexture"),e.normalTextureScale=n.getUniformLocation(t,"u_normalTextureScale")),this.flags&s.HAS_METALROUGHNESSMAP&&(e.metallicRoughnessTexture=n.getUniformLocation(t,"u_metallicRoughnessTexture")),this.flags&s.HAS_OCCLUSIONMAP&&(e.occlusionTexture=n.getUniformLocation(t,"u_occlusionTexture"),e.occlusionStrength=n.getUniformLocation(t,"u_occlusionStrength")),this.flags&s.HAS_EMISSIVEMAP&&(e.emissiveTexture=n.getUniformLocation(t,"u_emissiveTexture"),e.emissiveFactor=n.getUniformLocation(t,"u_emissiveFactor")),n.useProgram(null),u[this.flags]=this.programObject}};var h=1,c=go.create(),f=xo.create();bo.create();var p=[];n.enable(n.CULL_FACE),n.cullFace(n.BACK),n.frontFace(n.CCW);var d=!0;n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL);var v=v||{},g=null;go.create();var m=xo.create();xo.perspective(m,.785,t.width/t.height,.01,100),xo.create();var y=xo.create(),b=xo.create(),x=xo.create();xo.create();var _,w,M,T=[1,1,1,1],A=v.drawPrimitive=function(t,r){if(M){b=y=M.matrix,xo.invert(x,y),xo.transpose(x,x),r=T;var i=t.shader,o=t.material;if(null!==o){var a=o.pbrMetallicRoughness;r=a.baseColorFactor,t.material.doubleSided===d&&((d=!t.material.doubleSided)?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE))}g!=t.shader.programObject&&(g=t.shader.programObject,n.useProgram(g.program)),o&&(i.hasBaseColorMap()&&e(g.uniformLocations.baseColorTexture,a.baseColorTexture),i.hasNormalMap()&&(e(g.uniformLocations.normalTexture,o.normalTexture),n.uniform1f(g.uniformLocations.normalTextureScale,o.normalTexture.scale)),i.hasMetalRoughnessMap()&&e(g.uniformLocations.metallicRoughnessTexture,a.metallicRoughnessTexture),n.uniform1f(g.uniformLocations.metallicFactor,a.metallicFactor),n.uniform1f(g.uniformLocations.roughnessFactor,a.roughnessFactor),i.hasOcclusionMap()&&(e(g.uniformLocations.occlusionTexture,o.occlusionTexture),n.uniform1f(g.uniformLocations.occlusionStrength,o.occlusionTexture.strength)),i.hasEmissiveMap()&&(e(g.uniformLocations.emissiveTexture,o.emissiveTexture),n.uniform3fv(g.uniformLocations.emissiveFactor,o.emissiveFactor))),i.hasSkin()&&n.uniformBlockBinding(g.program,g.uniformBlockIndices.JointMatrix,_),n.activeTexture(n.TEXTURE0+29),n.bindTexture(n.TEXTURE_2D,null),n.uniform4fv(g.uniformLocations.baseColorFactor,r),n.uniformMatrix4fv(g.uniformLocations.MV,!1,y),n.uniformMatrix4fv(g.uniformLocations.MVP,!1,b),n.uniformMatrix4fv(g.uniformLocations.MVNormal,!1,x),n.bindVertexArray(t.vertexArray),null!==t.indices?n.drawElements(t.mode,t.indicesLength,t.indicesComponentType,t.indicesOffset):n.drawArrays(t.mode,t.drawArraysOffset,t.drawArraysCount),n.bindVertexArray(null)}},E=xo.create(),P=xo.create(),S=v.drawNode=function(t,e,r,i){if(e=r[e],void 0!==i?xo.mul(e,i,t.matrix):xo.copy(e,t.matrix),null!==t.skin){var o=t.skin;_=o.uniformBlockID;var a=t.skin.joints;for(xo.invert(P,e),i=0,u=a.length;i<u;i++){var s=a[i];xo.mul(E,r[s.nodeID],o.inverseBindMatrix[i]),xo.mul(E,P,E),o.jointMatrixUnidormBufferData.set(E,16*i)}n.bindBuffer(n.UNIFORM_BUFFER,o.jointMatrixUniformBuffer),n.bufferSubData(n.UNIFORM_BUFFER,0,o.jointMatrixUnidormBufferData,0,o.jointMatrixUnidormBufferData.length)}var u;if(null!==t.mesh)for(o=t.mesh,i=0,u=o.primitives.length;i<u;i++)A(o.primitives[i],e);for(null!==t.skin&&n.bindBuffer(n.UNIFORM_BUFFER,null),i=0,u=t.children.length;i<u;i++)S(t.children[i],t.children[i].nodeID,r,e)},C=v.drawScene=function(t){var e=t.glTF;if(e.animations){var n,i=e.animations[r],o=0;for(n=i.samplers.length;o<n;o++)i.samplers[o].getValue(R);for(o=0,n=i.channels.length;o<n;o++){var a=i.channels[o],s=a.sampler,u=e.nodes[a.target.nodeID];switch(a.target.path){case"rotation":vo.copy(u.rotation,s.curValue);break;case"translation":go.copy(u.translation,s.curValue);break;case"scale":go.copy(u.scale,s.curValue)}u.updateMatrixFromTRS()}}for(i=0,e=t.glTFScene.nodes.length;i<e;i++)S(t.glTFScene.nodes[i],t.glTFScene.nodes[i].nodeID,t.nodeMatrix,t.rootTransform)},L=performance.now(),R=0;return{setupScene:function(t,e){function a(t,e){if(void 0!==t){var r=t.bufferView;return null===r.target?(n.bindBuffer(n.ARRAY_BUFFER,r.buffer),n.bufferData(n.ARRAY_BUFFER,r.data,n.STATIC_DRAW)):n.bindBuffer(r.target,r.buffer),t.prepareVertexAttrib(e,n),!0}return!1}var s;if(t.animations){var u=0;for(s=t.animations.length;u<s;u++)i.add(t.animations[u].name||u)}r=0,u=t.scenes[t.defaultScene],go.fromValues(1.2*u.boundingBox.transform[0],0,0),go.create(),e?e=p[e.id]=new o(u,t,e.id):(e=new o(u,t,p.length),p.push(e)),1===p.length&&(xo.identity(f),h=1/Math.max(u.boundingBox.transform[0],Math.max(u.boundingBox.transform[5],u.boundingBox.transform[10])),xo.getTranslation(c,u.boundingBox.transform),go.scale(c,c,-1),c[0]+=-.5*u.boundingBox.transform[0],c[1]+=-.5*u.boundingBox.transform[5],c[2]+=-.5*u.boundingBox.transform[10],h*=.5,f[0]=h,f[5]=h,f[10]=h,xo.translate(f,f,c),go.set(c,0,0,-1.5),h=1);var d;for(u=0,s=t.bufferViews.length;u<s;u++){var v=t.bufferViews[u];v.createBuffer(n),v.bindData(n)}if(t.textures)for(u=0,s=t.textures.length;u<s;u++){var g=t.textures[u];g.createTexture(n)}if(t.samplers)for(u=0,s=t.samplers.length;u<s;u++)g=t.samplers[u],g.createSampler(n);if(t.skins)for(u=0,s=t.skins.length;u<s;u++)g=t.skins[u],g.jointMatrixUniformBuffer=n.createBuffer(),n.bindBufferBase(n.UNIFORM_BUFFER,g.uniformBlockID,g.jointMatrixUniformBuffer),n.bindBuffer(n.UNIFORM_BUFFER,g.jointMatrixUniformBuffer),n.bufferData(n.UNIFORM_BUFFER,g.jointMatrixUnidormBufferData,n.DYNAMIC_DRAW),n.bufferSubData(n.UNIFORM_BUFFER,0,g.jointMatrixUnidormBufferData),n.bindBuffer(n.UNIFORM_BUFFER,null);var m=0;for(d=t.meshes.length;m<d;m++)for(g=t.meshes[m],u=0,s=g.primitives.length;u<s;++u){var y=g.primitives[u];y.shader=new l,y.vertexArray=v=n.createVertexArray(),n.bindVertexArray(v),a(y.attributes.POSITION,0),a(y.attributes.NORMAL,1),a(y.attributes.TEXCOORD_0,2),a(y.attributes.JOINTS_0,3)&&a(y.attributes.WEIGHTS_0,4)&&y.shader.defineMacro("HAS_SKIN"),a(y.attributes.JOINTS_1,5)&&a(y.attributes.WEIGHTS_1,6)&&y.shader.defineMacro("SKIN_VEC8"),null!==y.indices&&(v=t.accessors[y.indices],v=v.bufferView,null===v.target?(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,v.data,n.STATIC_DRAW)):n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v.buffer)),n.bindVertexArray(null),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),(v=y.material)&&(v.pbrMetallicRoughness.baseColorTexture&&y.shader.defineMacro("HAS_BASECOLORMAP"),v.pbrMetallicRoughness.metallicRoughnessTexture&&y.shader.defineMacro("HAS_METALROUGHNESSMAP"),v.normalTexture&&y.shader.defineMacro("HAS_NORMALMAP"),v.occlusionTexture&&y.shader.defineMacro("HAS_OCCLUSIONMAP"),v.emissiveTexture&&y.shader.defineMacro("HAS_EMISSIVEMAP")),y.shader.compile()}return e},render:v.render=function(t){M=t,t=(new Date).getTime();var e,n=0;for(e=p.length;n<e;n++)w=p[n],C(p[n]);g=null,R=.001*(t-L)}}}function Jt(t){this.options=t=t||{},t.colors=t.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var e=t.colors;this.drawTogether=!0,this.parseColors(e),this.tileSize=256,this.ratio=window.devicePixelRatio,this.cache={},t.getTileUrl&&(this.getTileUrl=t.getTileUrl),this._loadCount={}}function Kt(t){var e=t/2,n=t+e,r=new _(2*n,2*n),i=r.getContext("2d");return i.shadowBlur=e,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=1e4,i.beginPath(),i.arc(n-1e4,n-1e4,t,0,2*Math.PI,!0),i.closePath(),i.fill(),r}var $t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self,function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}),Qt={}.hasOwnProperty,te=function(t,e){return Qt.call(t,e)},ee={}.toString,ne=function(t){return ee.call(t).slice(8,-1)},re=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==ne(t)?t.split(""):Object(t)},ie=function(t){return re($t(t))},oe=Math.ceil,ae=Math.floor,se=function(t){return isNaN(t=+t)?0:(0<t?ae:oe)(t)},ue=Math.min,le=function(t){return 0<t?ue(se(t),9007199254740991):0},he=Math.max,ce=Math.min,fe=r(function(t){t=t.exports={version:"2.6.5"},"number"==typeof __e&&(__e=t)}),pe=r(function(t){t=t.exports="undefined"!=typeof window&&Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),"number"==typeof __g&&(__g=t)}),de=r(function(t){var e=pe["__core-js_shared__"]||(pe["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:fe.version,mode:"pure",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),ve=0,ge=Math.random(),me=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++ve+ge).toString(36))},ye=de("keys"),be=function(t){return ye[t]||(ye[t]=me(t))},xe=function(t){return function(t,e,n){t=ie(t);var r=le(t.length);for(n=se(n),n=0>n?he(n+r,0):ce(n,r);r>n;n++)if(n in t&&t[n]===e)return n||0;return-1}}(),_e=be("IE_PROTO"),we=function(t,e){t=ie(t);var n,r=0,i=[];for(n in t)n!=_e&&te(t,n)&&i.push(n);for(;e.length>r;)te(t,n=e[r++])&&(~xe(i,n)||i.push(n));return i},Me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Te=Object.keys||function(t){return we(t,Me)},Ae=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},Ee=function(t,e,n){if(Ae(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},Pe=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Se=function(t){if(!Pe(t))throw TypeError(t+" is not an object!");return t},Ce=function(t){try{return!!t()}catch(t){return!0}},Le=!Ce(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Re=pe.document,Oe=Pe(Re)&&Pe(Re.createElement),ke=!Le&&!Ce(function(){return 7!=Object.defineProperty(Oe?Re.createElement("div"):{},"a",{get:function(){return 7}}).a}),Fe=function(t,e){if(!Pe(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!Pe(r=n.call(t))||"function"==typeof(n=t.valueOf)&&!Pe(r=n.call(t))||!e&&"function"==typeof(n=t.toString)&&!Pe(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},De=Object.defineProperty,Be={f:Le?Object.defineProperty:function(t,e,n){if(Se(t),e=Fe(e,!0),Se(n),ke)try{return De(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},ze=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Ie=Le?function(t,e,n){return Be.f(t,e,ze(1,n))}:function(t,e,n){return t[e]=n,t},Ue=function(t,e,n){var r=t&Ue.F,i=t&Ue.G,o=t&Ue.S,a=t&Ue.P,s=t&Ue.B,u=t&Ue.W,l=i?fe:fe[e]||(fe[e]={}),h=l.prototype;o=i?pe:o?pe[e]:(pe[e]||{}).prototype;var c;i&&(n=e);for(c in n)if(!(e=!r&&o&&void 0!==o[c])||!te(l,c)){var f=e?o[c]:n[c];l[c]=i&&"function"!=typeof o[c]?n[c]:s&&e?Ee(f,pe):u&&o[c]==f?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(f):a&&"function"==typeof f?Ee(Function.call,f):f,a&&((l.virtual||(l.virtual={}))[c]=f,t&Ue.R&&h&&!h[c]&&Ie(h,c,f))}};Ue.F=1,Ue.G=2,Ue.S=4,Ue.P=8,Ue.B=16,Ue.W=32,Ue.U=64,Ue.R=128;var Ne=Ue,je=function(t,e){var n=(fe.Object||{})[t]||Object[t],r={};r[t]=e(n),Ne(Ne.S+Ne.F*Ce(function(){n(1)}),"Object",r)};je("keys",function(){return function(t){return Te(Object($t(t)))}});var Ye=fe.Object.keys,Ve=r(function(t){t.exports={default:Ye,__esModule:!0}}),He=n(Ve),We=Object.getOwnPropertySymbols,qe={}.propertyIsEnumerable,Ze=Object.assign,Xe=!Ze||Ce(function(){var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=Ze({},t)[n]||"abcdefghijklmnopqrst"!=Object.keys(Ze({},e)).join("")})?function(t,e){for(var n=Object($t(t)),r=arguments.length,i=1,o=We,a=qe;r>i;)for(var s,u=re(arguments[i++]),l=o?Te(u).concat(o(u)):Te(u),h=l.length,c=0;h>c;)a.call(u,s=l[c++])&&(n[s]=u[s]);return n}:Ze;Ne(Ne.S+Ne.F,"Object",{assign:Xe});var Ge=fe.Object.assign,Je=r(function(t){t.exports={default:Ge,__esModule:!0}}),Ke=n(Je),$e=be("IE_PROTO"),Qe=Object.prototype,tn=Object.getPrototypeOf||function(t){return t=Object($t(t)),te(t,$e)?t[$e]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Qe:null};je("getPrototypeOf",function(){return function(t){return tn(Object($t(t)))}});var en=fe.Object.getPrototypeOf,nn=r(function(t){t.exports={default:en,__esModule:!0}}),rn=n(nn),on=r(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}),an=n(on);Ne(Ne.S+Ne.F*!Le,"Object",{defineProperty:Be.f});var sn=fe.Object,un=function(t,e,n){return sn.defineProperty(t,e,n)},ln=r(function(t){t.exports={default:un,__esModule:!0}}),hn=n(ln),cn=r(function(t,e){e.__esModule=!0;var n=ln&&ln.__esModule?ln:{default:ln};e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(t,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()}),fn=n(cn),pn={},dn=Le?Object.defineProperties:function(t,e){Se(t);for(var n,r=Te(e),i=r.length,o=0;i>o;)Be.f(t,n=r[o++],e[n]);return t},vn=pe.document,gn=vn&&vn.documentElement,mn=be("IE_PROTO"),yn=function(){},bn=function(){var t=Oe?Re.createElement("iframe"):{},e=Me.length;for(t.style.display="none",gn.appendChild(t),t.src="javascript:",t=t.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),bn=t.F;e--;)delete bn.prototype[Me[e]];return bn()},xn=Object.create||function(t,e){if(null!==t){yn.prototype=Se(t);var n=new yn;yn.prototype=null,n[mn]=t}else n=bn();return void 0===e?n:dn(n,e)},_n=r(function(t){var e=de("wks"),n=pe.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:me)("Symbol."+t))}).store=e}),wn=Be.f,Mn=_n("toStringTag"),Tn=function(t,e,n){t&&!te(t=n?t:t.prototype,Mn)&&wn(t,Mn,{configurable:!0,value:e})},An={};Ie(An,_n("iterator"),function(){return this});var En=function(t,e,n){t.prototype=xn(An,{next:ze(1,n)}),Tn(t,e+" Iterator")},Pn=_n("iterator"),Sn=!([].keys&&"next"in[].keys()),Cn=function(){return this},Ln=function(t,e,n,r,i,o,a){En(n,e,r),r=function(t){return!Sn&&t in c?c[t]:function(){return new n(this,t)}};var s,u=e+" Iterator",l="values"==i,h=!1,c=t.prototype,f=c[Pn]||c["@@iterator"]||i&&c[i],p=f||r(i),d=i?l?r("entries"):p:void 0,v="Array"==e?c.entries||f:f;if(v&&(t=tn(v.call(new t)))!==Object.prototype&&t.next&&Tn(t,u,!0),l&&f&&"values"!==f.name&&(h=!0,p=function(){return f.call(this)}),a&&(Sn||h||!c[Pn])&&Ie(c,Pn,p),pn[e]=p,pn[u]=Cn,i){var g={values:l?p:r("values"),keys:o?p:r("keys"),entries:d};if(a)for(s in g)s in c||Ie(c,s,g[s]);else Ne(Ne.P+Ne.F*(Sn||h),e,g)}return g},Rn=function(t){return function(t,e){t=String($t(t)),e=se(e);var n,r=t.length;if(0>e||e>=r)return"";var i=t.charCodeAt(e);return 55296>i||56319<i||e+1===r||56320>(n=t.charCodeAt(e+1))||57343<n?t.charAt(e):t.slice(e,e+2)}}();Ln(String,"String",function(t){this._t=String(t),this._i=0},function(){var t=this._t,e=this._i;return e>=t.length?{value:void 0,done:!0}:(t=Rn(t,e),this._i+=t.length,{value:t,done:!1})});var On=function(t,e){return{value:e,done:!!t}};Ln(Array,"Array",function(t,e){this._t=ie(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,On(1)):"keys"==e?On(0,n):"values"==e?On(0,t[n]):On(0,[n,t[n]])},"values"),pn.Arguments=pn.Array;for(var kn=_n("toStringTag"),Fn="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),Dn=0;Dn<Fn.length;Dn++){var Bn=Fn[Dn],zn=pe[Bn],In=zn&&zn.prototype;In&&!In[kn]&&Ie(In,kn,Bn),pn[Bn]=pn.Array}var Un={f:_n},Nn=Un.f("iterator"),jn=r(function(t){t.exports={default:Nn,__esModule:!0}});n(jn);var Yn=r(function(t){var e=me("meta"),n=Be.f,r=0,i=Object.isExtensible||function(){return!0},o=!Ce(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!Pe(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!te(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!te(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!te(t,e)&&a(t),t}}}),Vn=Be.f,Hn=function(t){var e=fe.Symbol||(fe.Symbol={});"_"==t.charAt(0)||t in e||Vn(e,t,{value:Un.f(t)})},Wn=Array.isArray||function(t){return"Array"==ne(t)},qn=Me.concat("length","prototype"),Zn=Object.getOwnPropertyNames||function(t){return we(t,qn)},Xn=Zn,Gn={}.toString,Jn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Kn=function(t){if(Jn&&"[object Window]"==Gn.call(t))try{var e=Xn(t)}catch(t){e=Jn.slice()}else e=Xn(ie(t));return e},$n=Object.getOwnPropertyDescriptor,Qn={f:Le?$n:function(t,e){if(t=ie(t),e=Fe(e,!0),ke)try{return $n(t,e)}catch(t){}if(te(t,e))return ze(!qe.call(t,e),t[e])}},tr=Yn.KEY,er=Qn.f,nr=Be.f,rr=Kn,ir=pe.Symbol,or=pe.JSON,ar=or&&or.stringify,sr=_n("_hidden"),ur=_n("toPrimitive"),lr={}.propertyIsEnumerable,hr=de("symbol-registry"),cr=de("symbols"),fr=de("op-symbols"),pr=Object.prototype,dr="function"==typeof ir,vr=pe.QObject,gr=!vr||!vr.prototype||!vr.prototype.findChild,mr=Le&&Ce(function(){return 7!=xn(nr({},"a",{get:function(){return nr(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=er(pr,e);r&&delete pr[e],nr(t,e,n),r&&t!==pr&&nr(pr,e,r)}:nr,yr=function(t){var e=cr[t]=xn(ir.prototype);return e._k=t,e},br=dr&&"symbol"==typeof ir.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof ir},xr=function(t,e,n){return t===pr&&xr(fr,e,n),Se(t),e=Fe(e,!0),Se(n),te(cr,e)?(n.enumerable?(te(t,sr)&&t[sr][e]&&(t[sr][e]=!1),n=xn(n,{enumerable:ze(0,!1)})):(te(t,sr)||nr(t,sr,ze(1,{})),t[sr][e]=!0),mr(t,e,n)):nr(t,e,n)},_r=function(t,e){Se(t);var n=e=ie(e),r=Te(n),i=We;if(i){i=i(n);for(var o,a=qe,s=0;i.length>s;)a.call(n,o=i[s++])&&r.push(o)}n=0,o=r.length;for(var u;o>n;)xr(t,u=r[n++],e[u]);return t},wr=function(t){var e=lr.call(this,t=Fe(t,!0));return!(this===pr&&te(cr,t)&&!te(fr,t))&&(!(e||!te(this,t)||!te(cr,t)||te(this,sr)&&this[sr][t])||e)},Mr=function(t,e){if(t=ie(t),e=Fe(e,!0),t!==pr||!te(cr,e)||te(fr,e)){var n=er(t,e);return!n||!te(cr,e)||te(t,sr)&&t[sr][e]||(n.enumerable=!0),n}},Tr=function(t){t=rr(ie(t));for(var e,n=[],r=0;t.length>r;)te(cr,e=t[r++])||e==sr||e==tr||n.push(e);return n},Ar=function(t){var e=t===pr;t=rr(e?fr:ie(t));for(var n,r=[],i=0;t.length>i;)te(cr,n=t[i++])&&(e?te(pr,n):1)&&r.push(cr[n]);return r};dr||(ir=function(){if(this instanceof ir)throw TypeError("Symbol is not a constructor!");var t=me(0<arguments.length?arguments[0]:void 0),e=function(n){this===pr&&e.call(fr,n),te(this,sr)&&te(this[sr],t)&&(this[sr][t]=!1),mr(this,t,ze(1,n))};return Le&&gr&&mr(pr,t,{configurable:!0,set:e}),yr(t)},Ie(ir.prototype,"toString",function(){return this._k}),Qn.f=Mr,Be.f=xr,Zn=Kn=Tr,qe=wr,We=Ar,Un.f=function(t){return yr(_n(t))}),Ne(Ne.G+Ne.W+Ne.F*!dr,{Symbol:ir});for(var Er="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),Pr=0;Er.length>Pr;)_n(Er[Pr++]);for(var Sr=Te(_n.store),Cr=0;Sr.length>Cr;)Hn(Sr[Cr++]);Ne(Ne.S+Ne.F*!dr,"Symbol",{for:function(t){return te(hr,t+="")?hr[t]:hr[t]=ir(t)},keyFor:function(t){if(!br(t))throw TypeError(t+" is not a symbol!");for(var e in hr)if(hr[e]===t)return e},useSetter:function(){gr=!0},useSimple:function(){gr=!1}}),Ne(Ne.S+Ne.F*!dr,"Object",{create:function(t,e){return void 0===e?xn(t):_r(xn(t),e)},defineProperty:xr,defineProperties:_r,getOwnPropertyDescriptor:Mr,getOwnPropertyNames:Tr,getOwnPropertySymbols:Ar}),or&&Ne(Ne.S+Ne.F*(!dr||Ce(function(){var t=ir();return"[null]"!=ar([t])||"{}"!=ar({a:t})||"{}"!=ar(Object(t))})),"JSON",{stringify:function(t){for(var e,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(e=r=n[1],(Pe(r)||void 0!==t)&&!br(t))return Wn(r)||(r=function(t,n){if("function"==typeof e&&(n=e.call(this,t,n)),!br(n))return n}),n[1]=r,ar.apply(or,n)}}),ir.prototype[ur]||Ie(ir.prototype,ur,ir.prototype.valueOf),Tn(ir,"Symbol"),Tn(Math,"Math",!0),Tn(pe.JSON,"JSON",!0),Hn("asyncIterator"),Hn("observable");var Lr=fe.Symbol,Rr=r(function(t){t.exports={default:Lr,__esModule:!0}}),Or=n(Rr),kr=r(function(t,e){e.__esModule=!0,t=jn&&jn.__esModule?jn:{default:jn};var n=Rr&&Rr.__esModule?Rr:{default:Rr},r="function"==typeof n.default&&"symbol"==typeof t.default?function(t){return typeof t}:function(t){return t&&"function"==typeof n.default&&t.constructor===n.default&&t!==n.default.prototype?"symbol":typeof t};e.default="function"==typeof n.default&&"symbol"===r(t.default)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof n.default&&t.constructor===n.default&&t!==n.default.prototype?"symbol":void 0===t?"undefined":r(t)}}),Fr=n(kr),Dr=r(function(t,e){e.__esModule=!0;var n=kr&&kr.__esModule?kr:{default:kr};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,n.default)(e))&&"function"!=typeof e?t:e}}),Br=n(Dr),zr=Qn.f;je("getOwnPropertyDescriptor",function(){return function(t,e){return zr(ie(t),e)}});var Ir=fe.Object,Ur=function(t,e){return Ir.getOwnPropertyDescriptor(t,e)},Nr=r(function(t){t.exports={default:Ur,__esModule:!0}}),jr=n(Nr),Yr=r(function(t,e){e.__esModule=!0;var n=nn&&nn.__esModule?nn:{default:nn},r=Nr&&Nr.__esModule?Nr:{default:Nr};e.default=function t(e,i,o){null===e&&(e=Function.prototype);var a=(0,r.default)(e,i);return void 0!==a?"value"in a?a.value:(i=a.get,void 0===i?void 0:i.call(o)):null!==(e=(0,n.default)(e))?t(e,i,o):void 0}}),Vr=n(Yr),Hr=Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=Ee(Function.call,Qn.f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){if(Se(t),!Pe(r)&&null!==r)throw TypeError(r+": can't set as prototype!");return e?t.__proto__=r:n(t,r),t}}({},!1):void 0);Ne(Ne.S,"Object",{setPrototypeOf:Hr});var Wr=fe.Object.setPrototypeOf,qr=r(function(t){t.exports={default:Wr,__esModule:!0}});n(qr),Ne(Ne.S,"Object",{create:xn});var Zr=fe.Object,Xr=function(t,e){return Zr.create(t,e)},Gr=r(function(t){t.exports={default:Xr,__esModule:!0}}),Jr=n(Gr),Kr=r(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(qr),i=n(Gr),o=n(kr);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,o.default)(e)));t.prototype=(0,i.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(r.default?(0,r.default)(t,e):t.__proto__=e)}}),$r=n(Kr),Qr=_n("toStringTag"),ti="Arguments"==ne(function(){return arguments}()),ei=function(t){var e;if(void 0===t)var n="Undefined";else{if(null===t)var r="Null";else{t:{var i=t=Object(t);try{r=i[Qr];break t}catch(t){}r=void 0}r="string"==typeof(n=r)?n:ti?ne(t):"Object"==(e=ne(t))&&"function"==typeof t.callee?"Arguments":e}n=r}return n},ni=_n("iterator"),ri=fe.isIterable=function(t){return t=Object(t),void 0!==t[ni]||"@@iterator"in t||pn.hasOwnProperty(ei(t))},ii=r(function(t){t.exports={default:ri,__esModule:!0}});n(ii);var oi=_n("iterator"),ai=fe.getIteratorMethod=function(t){if(void 0!=t)return t[oi]||t["@@iterator"]||pn[ei(t)]},si=fe.getIterator=function(t){var e=ai(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return Se(e.call(t))},ui=r(function(t){t.exports={default:si,__esModule:!0}}),li=n(ui),hi=r(function(t,e){e.__esModule=!0;var n=ii&&ii.__esModule?ii:{default:ii},r=ui&&ui.__esModule?ui:{default:ui};e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t))){var i=[],o=!0,a=!1,s=void 0;try{for(var u,l=(0,r.default)(t);!(o=(u=l.next()).done)&&(i.push(u.value),!e||i.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return i}throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),ci=n(hi),fi=function(t,e,n,r){try{return r?e(Se(n)[0],n[1]):e(n)}catch(n){throw e=t.return,void 0!==e&&Se(e.call(t)),n}},pi=_n("iterator"),di=Array.prototype,vi=_n("iterator"),gi=!1;try{[7][vi]().return=function(){gi=!0}}catch(t){}var mi=function(t,e){if(!e&&!gi)return!1;var n=!1;try{e=[7];var r=e[vi]();r.next=function(){return{done:n=!0}},e[vi]=function(){return r},t(e)}catch(t){}return n};Ne(Ne.S+Ne.F*!mi(function(t){}),"Array",{from:function(t){var e,n=Object($t(t)),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,a=void 0!==o,s=0,u=ai(n);if(a&&(o=Ee(o,2<i?arguments[2]:void 0,2)),void 0!=u&&(r!=Array||void 0===u||pn.Array!==u&&di[pi]!==u))for(n=u.call(n),r=new r;!(e=n.next()).done;s++)i=r,u=s,e=a?fi(n,o,[e.value,s],!0):e.value,u in i?Be.f(i,u,ze(0,e)):i[u]=e;else for(i=le(n.length),r=new r(i);i>s;s++){u=r,e=s;var l=a?o(n[s],s):n[s];e in u?Be.f(u,e,ze(0,l)):u[e]=l}return r.length=s,r}});var yi=fe.Array.from,bi=r(function(t){t.exports={default:yi,__esModule:!0}}),xi=n(bi),_i=r(function(t,e){e.__esModule=!0;var n=bi&&bi.__esModule?bi:{default:bi};e.default=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return(0,n.default)(t)}}),wi=n(_i),Mi=Yn.onFreeze;je("freeze",function(t){return function(e){return t&&Pe(e)?t(Mi(e)):e}});var Ti=fe.Object.freeze,Ai=r(function(t){t.exports={default:Ti,__esModule:!0}}),Ei=n(Ai),Pi=fe.JSON||(fe.JSON={stringify:JSON.stringify}),Si=function(t){return Pi.stringify.apply(Pi,arguments)},Ci=r(function(t){t.exports={default:Si,__esModule:!0}}),Li=n(Ci),Ri={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Oi=r(function(t){var e=Array.prototype.concat,n=Array.prototype.slice,r=t.exports=function(t){for(var r=[],i=0,o=t.length;i<o;i++){var a=t[i],s=!(!(s=a)||"string"==typeof s)&&(s instanceof Array||Array.isArray(s)||0<=s.length&&(s.splice instanceof Function||jr(s,s.length-1)&&"String"!==s.constructor.name));s?r=e.call(r,n.call(a)):r.push(a)}return r};r.wrap=function(t){return function(){return t(r(arguments))}}}),ki=r(function(t){function e(t,e,n){return Math.min(Math.max(e,t),n)}function n(t){return t=t.toString(16).toUpperCase(),2>t.length?"0"+t:t}var r,i={};for(r in Ri)Ri.hasOwnProperty(r)&&(i[Ri[r]]=r);var o=t.exports={to:{},get:{}};o.get=function(t){switch(t.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(t);var e="hsl";break;case"hwb":t=o.get.hwb(t),e="hwb";break;default:t=o.get.rgb(t),e="rgb"}return t?{model:e,value:t}:null},o.get.rgb=function(t){if(!t)return null;var n,r=/^#([a-f0-9]{3,4})$/i,i=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/(\D+)/,s=[0,0,0,1];if(n=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=n[2],n=n[1],t=0;3>t;t++)i=2*t,s[t]=parseInt(n.slice(i,i+2),16);r&&(s[3]=Math.round(parseInt(r,16)/255*100)/100)}else if(n=t.match(r)){for(n=n[1],r=n[3],t=0;3>t;t++)s[t]=parseInt(n[t]+n[t],16);r&&(s[3]=Math.round(parseInt(r+r,16)/255*100)/100)}else if(n=t.match(i)){for(t=0;3>t;t++)s[t]=parseInt(n[t+1],0);n[4]&&(s[3]=parseFloat(n[4]))}else{if(!(n=t.match(o)))return(n=t.match(a))?"transparent"===n[1]?[0,0,0,0]:(s=Ri[n[1]])?(s[3]=1,s):null:null;for(t=0;3>t;t++)s[t]=Math.round(2.55*parseFloat(n[t+1]));n[4]&&(s[3]=parseFloat(n[4]))}for(t=0;3>t;t++)s[t]=e(s[t],0,255);return s[3]=e(s[3],0,1),s},o.get.hsl=function(t){if(!t)return null;var n=t.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(n){var r=parseFloat(n[4]);t=(parseFloat(n[1])+360)%360;var i=e(parseFloat(n[2]),0,100);return n=e(parseFloat(n[3]),0,100),r=e(isNaN(r)?1:r,0,1),[t,i,n,r]}return null},o.get.hwb=function(t){if(!t)return null;var n=t.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(n){var r=parseFloat(n[4]);t=(parseFloat(n[1])%360+360)%360;var i=e(parseFloat(n[2]),0,100);return n=e(parseFloat(n[3]),0,100),r=e(isNaN(r)?1:r,0,1),[t,i,n,r]}return null},o.to.hex=function(){var t=Oi(arguments);return"#"+n(t[0])+n(t[1])+n(t[2])+(1>t[3]?n(Math.round(255*t[3])):"")},o.to.rgb=function(){var t=Oi(arguments);return 4>t.length||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},o.to.rgb.percent=function(){var t=Oi(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return 4>t.length||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},o.to.hsl=function(){var t=Oi(arguments);return 4>t.length||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},o.to.hwb=function(){var t=Oi(arguments),e="";return 4<=t.length&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},o.to.keyword=function(t){return i[t.slice(0,3)]}}),Fi=r(function(t){var e={};for(i in Ri)Ri.hasOwnProperty(i)&&(e[Ri[i]]=i);var n,r=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(n in r)if(r.hasOwnProperty(n)){if(!("channels"in r[n]))throw Error("missing channels property: "+n);if(!("labels"in r[n]))throw Error("missing channel labels property: "+n);if(r[n].labels.length!==r[n].channels)throw Error("channel and label counts mismatch: "+n);t=r[n].channels;var i=r[n].labels;delete r[n].channels,delete r[n].labels,Object.defineProperty(r[n],"channels",{value:t}),Object.defineProperty(r[n],"labels",{value:i})}r.rgb.hsl=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;t=Math.min(e,n,r);var i,o=Math.max(e,n,r),a=o-t;return o===t?i=0:e===o?i=(n-r)/a:n===o?i=2+(r-e)/a:r===o&&(i=4+(e-n)/a),i=Math.min(60*i,360),0>i&&(i+=360),e=(t+o)/2,[i,100*(o===t?0:.5>=e?a/(o+t):a/(2-o-t)),100*e]},r.rgb.hsv=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255,o=Math.max(n,r,i),a=o-Math.min(n,r,i);if(0===a)var s=e=0;else{e=a/o,t=(o-n)/6/a+.5;var u=(o-r)/6/a+.5;a=(o-i)/6/a+.5,n===o?s=a-u:r===o?s=1/3+t-a:i===o&&(s=2/3+u-t),0>s?s+=1:1<s&&--s}return[360*s,100*e,100*o]},r.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];t=r.rgb.hsl(t)[0];var o=1/255*Math.min(e,Math.min(n,i));return i=1-1/255*Math.max(e,Math.max(n,i)),[t,100*o,100*i]},r.rgb.cmyk=function(t){var e=t[0]/255,n=t[1]/255;t=t[2]/255;var r=Math.min(1-e,1-n,1-t);return[100*((1-e-r)/(1-r)||0),100*((1-n-r)/(1-r)||0),100*((1-t-r)/(1-r)||0),100*r]},r.rgb.keyword=function(t){var n=e[t];if(n)return n;n=1/0;var r;for(r in Ri)if(Ri.hasOwnProperty(r)){var i=Ri[r];if((i=Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)+Math.pow(t[2]-i[2],2))<n){n=i;var o=r}}return o},r.keyword.rgb=function(t){return Ri[t]},r.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255;return t=t[2]/255,e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92,n=.04045<n?Math.pow((n+.055)/1.055,2.4):n/12.92,t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92,[100*(.4124*e+.3576*n+.1805*t),100*(.2126*e+.7152*n+.0722*t),100*(.0193*e+.1192*n+.9505*t)]},r.rgb.lab=function(t){var e=r.rgb.xyz(t);t=e[0];var n=e[1];return e=e[2],t/=95.047,n/=100,e/=108.883,t=.008856<t?Math.pow(t,1/3):7.787*t+16/116,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,e=.008856<e?Math.pow(e,1/3):7.787*e+16/116,[116*n-16,500*(t-n),200*(n-e)]},r.hsl.rgb=function(t){var e=t[0]/360,n=t[1]/100;if(t=t[2]/100,0===n){var r=255*t;return[r,r,r]}n=.5>t?t*(1+n):t+n-t*n,t=2*t-n;for(var i=[0,0,0],o=0;3>o;o++)r=e+1/3*-(o-1),0>r&&r++,1<r&&r--,r=1>6*r?t+6*(n-t)*r:1>2*r?n:2>3*r?t+(n-t)*(2/3-r)*6:t,i[o]=255*r;return i},r.hsl.hsv=function(t){var e=t[0],n=t[1]/100;t=t[2]/100;var r=n,i=Math.max(t,.01);return t*=2,n*=1>=t?t:2-t,r*=1>=i?i:2-i,[e,100*(0===t?2*r/(i+r):2*n/(t+n)),(t+n)/2*100]},r.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100;t=t[2]/100;var r=Math.floor(e)%6,i=e-Math.floor(e);e=255*t*(1-n);var o=255*t*(1-n*i);switch(n=255*t*(1-n*(1-i)),t*=255,r){case 0:return[t,n,e];case 1:return[o,t,e];case 2:return[e,t,n];case 3:return[e,o,t];case 4:return[n,e,t];case 5:return[t,e,o]}},r.hsv.hsl=function(t){var e=t[0],n=t[1]/100;t=t[2]/100;var r=Math.max(t,.01),i=(2-n)*r;return r=n*r/(1>=i?i:2-i)||0,[e,100*r,(2-n)*t/2*100]},r.hwb.rgb=function(t){var e=t[0]/360,n=t[1]/100;t=t[2]/100;var r=n+t;switch(1<r&&(n/=r,t/=r),r=Math.floor(6*e),t=1-t,e=6*e-r,0!=(1&r)&&(e=1-e),e=n+e*(t-n),r){default:case 6:case 0:r=t;var i=e;break;case 1:r=e,i=t;break;case 2:r=n,i=t,n=e;break;case 3:r=n,i=e,n=t;break;case 4:r=e,i=n,n=t;break;case 5:r=t,i=n,n=e}return[255*r,255*i,255*n]},r.cmyk.rgb=function(t){var e=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-e)+e)),255*(1-Math.min(1,t[1]/100*(1-e)+e)),255*(1-Math.min(1,t[2]/100*(1-e)+e))]},r.xyz.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100;t=3.2406*e+-1.5372*n+-.4986*r;var i=-.9689*e+1.8758*n+.0415*r;return e=.0557*e+-.204*n+1.057*r,t=.0031308<t?1.055*Math.pow(t,1/2.4)-.055:12.92*t,i=.0031308<i?1.055*Math.pow(i,1/2.4)-.055:12.92*i,e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e,t=Math.min(Math.max(0,t),1),i=Math.min(Math.max(0,i),1),e=Math.min(Math.max(0,e),1),[255*t,255*i,255*e]},r.xyz.lab=function(t){var e=t[0],n=t[1];return t=t[2],e/=95.047,n/=100,t/=108.883,e=.008856<e?Math.pow(e,1/3):7.787*e+16/116,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,t=.008856<t?Math.pow(t,1/3):7.787*t+16/116,[116*n-16,500*(e-n),200*(n-t)]},r.lab.xyz=function(t){var e=t[1],n=t[2];t=(t[0]+16)/116,e=e/500+t,n=t-n/200;var r=Math.pow(t,3),i=Math.pow(e,3),o=Math.pow(n,3);return[95.047*(.008856<i?i:(e-16/116)/7.787),100*(.008856<r?r:(t-16/116)/7.787),108.883*(.008856<o?o:(n-16/116)/7.787)]},r.lab.lch=function(t){var e=t[0],n=t[1];t=t[2];var r=360*Math.atan2(t,n)/2/Math.PI;return 0>r&&(r+=360),[e,Math.sqrt(n*n+t*t),r]},r.lch.lab=function(t){var e=t[0],n=t[1];return t=t[2]/360*2*Math.PI,[e,n*Math.cos(t),n*Math.sin(t)]},r.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],o=1 in arguments?arguments[1]:r.rgb.hsv(t)[2];return 0===(o=Math.round(o/50))?30:(e=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255)),2===o&&(e+=60),e)},r.hsv.ansi16=function(t){return r.rgb.ansi16(r.hsv.rgb(t),t[2])},r.rgb.ansi256=function(t){var e=t[0],n=t[1];return t=t[2],e===n&&n===t?8>e?16:248<e?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(t/255*5)},r.ansi16.rgb=function(t){var e=t%10;return 0===e||7===e?(50<t&&(e+=3.5),e=e/10.5*255,[e,e,e]):(t=.5*(1+~~(50<t)),[(1&e)*t*255,(e>>1&1)*t*255,(e>>2&1)*t*255])},r.ansi256.rgb=function(t){if(232<=t){var e=10*(t-232)+8;return[e,e,e]}return t-=16,e=Math.floor(t/36)/5*255,[e,Math.floor((t%=36)/6)/5*255,t%6/5*255]},r.rgb.hex=function(t){return t=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase(),"000000".substring(t.length)+t},r.hex.rgb=function(t){if(!(t=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i)))return[0,0,0];var e=t[0];return 3===t[0].length&&(e=e.split("").map(function(t){return t+t}).join("")),t=parseInt(e,16),[t>>16&255,t>>8&255,255&t]},r.rgb.hcg=function(t){var e=t[0]/255,n=t[1]/255;t=t[2]/255;var r=Math.max(Math.max(e,n),t),i=Math.min(Math.min(e,n),t),o=r-i;return[(0>=o?0:r===e?(n-t)/o%6:r===n?2+(t-e)/o:(e-n)/o+8)/6%1*360,100*o,100*(1>o?i/(1-o):0)]},r.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=0;return e=.5>n?2*e*n:2*e*(1-n),1>e&&(r=(n-.5*e)/(1-e)),[t[0],100*e,100*r]},r.hsv.hcg=function(t){var e=t[2]/100,n=t[1]/100*e,r=0;return 1>n&&(r=(e-n)/(1-n)),[t[0],100*n,100*r]},r.hcg.rgb=function(t){var e=t[1]/100,n=t[2]/100;if(0===e)return[255*n,255*n,255*n];var r=[0,0,0];t=t[0]/360%1*6;var i=t%1,o=1-i;switch(Math.floor(t)){case 0:r[0]=1,r[1]=i,r[2]=0;break;case 1:r[0]=o,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=i;break;case 3:r[0]=0,r[1]=o,r[2]=1;break;case 4:r[0]=i,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=o}return n*=1-e,[255*(e*r[0]+n),255*(e*r[1]+n),255*(e*r[2]+n)]},r.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return 0<n&&(r=e/n),[t[0],100*r,100*n]},r.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return 0<n&&.5>n?r=e/(2*n):.5<=n&&1>n&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},r.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},r.hwb.hcg=function(t){var e=1-t[2]/100,n=e-t[1]/100,r=0;return 1>n&&(r=(e-n)/(1-n)),[t[0],100*n,100*r]},r.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},r.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},r.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},r.gray.hsl=r.gray.hsv=function(t){return[0,0,t[0]]},r.gray.hwb=function(t){return[0,100,t[0]]},r.gray.cmyk=function(t){return[0,0,0,t[0]]},r.gray.lab=function(t){return[t[0],0,0]},r.gray.hex=function(t){return t=255&Math.round(t[0]/100*255),t=((t<<16)+(t<<8)+t).toString(16).toUpperCase(),"000000".substring(t.length)+t},r.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}}),Di=function(t){for(var e={},n=He(Fi),r=n.length,o=0;o<r;o++)e[n[o]]={distance:-1,parent:null};for(n=[t],e[t].distance=0;n.length;){t=n.pop(),r=He(Fi[t]),o=r.length;for(var a=0;a<o;a++){var s=r[a],u=e[s];-1===u.distance&&(u.distance=e[t].distance+1,u.parent=t,n.unshift(s))}}for(n={},t=He(e),r=t.length,o=0;o<r;o++){var l=t[o];if(null!==e[l].parent){a=l,s=e,u=[s[l].parent,l];var h=Fi[s[l].parent][l];for(l=s[l].parent;s[l].parent;)u.unshift(s[l].parent),h=i(Fi[s[l].parent][l],h),l=s[l].parent;h.conversion=u,n[a]=h}}return n},Bi={};He(Fi).forEach(function(t){Bi[t]={},Object.defineProperty(Bi[t],"channels",{value:Fi[t].channels}),Object.defineProperty(Bi[t],"labels",{value:Fi[t].labels});var e=Di(t);He(e).forEach(function(n){var r=e[n];Bi[t][n]=a(r),Bi[t][n].raw=o(r)})});var zi=Bi,Ii=[].slice,Ui=["keyword","gray","hex"],Ni={};He(zi).forEach(function(t){Ni[Ii.call(zi[t].labels).sort().join("")]=t});var ji={};s.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in ki.to?this:this.rgb();return e=e.round("number"==typeof t?t:1),t=1===e.valpha?e.color:e.color.concat(this.valpha),ki.to[e.model](t)},percentString:function(t){return t=this.rgb().round("number"==typeof t?t:1),t=1===t.valpha?t.color:t.color.concat(this.valpha),ki.to.rgb.percent(t)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=zi[this.model].channels,n=zi[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new s(this.color.map(u(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new s(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:l("rgb",0,h(255)),green:l("rgb",1,h(255)),blue:l("rgb",2,h(255)),hue:l(["hsl","hsv","hsl","hwb","hcg"],0,function(t){return(t%360+360)%360}),saturationl:l("hsl",1,h(100)),lightness:l("hsl",2,h(100)),saturationv:l("hsv",1,h(100)),value:l("hsv",2,h(100)),chroma:l("hcg",1,h(100)),gray:l("hcg",2,h(100)),white:l("hwb",1,h(100)),wblack:l("hwb",2,h(100)),cyan:l("cmyk",0,h(100)),magenta:l("cmyk",1,h(100)),yellow:l("cmyk",2,h(100)),black:l("cmyk",3,h(100)),x:l("xyz",0,h(100)),y:l("xyz",1,h(100)),z:l("xyz",2,h(100)),l:l("lab",0,h(100)),a:l("lab",1),b:l("lab",2),keyword:function(t){return arguments.length?new s(t):zi[this.model].keyword(this.color)},hex:function(t){return arguments.length?new s(t):ki.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity();return t=t.luminosity(),e>t?(e+.05)/(t+.05):(t+.05)/(e+.05)},level:function(t){return t=this.contrast(t),7.1<=t?"AAA":4.5<=t?"AA":""},isDark:function(){var t=this.rgb().color;return 128>(299*t[0]+587*t[1]+114*t[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;3>e;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color;return t=.3*t[0]+.59*t[1]+.11*t[2],s.rgb(t,t,t)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n+t)%360,e.color[0]=0>n?360+n:n,e},mix:function(t,e){if(!t||!t.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+(void 0===t?"undefined":Fr(t)));t=t.rgb();var n=this.rgb();e=void 0===e?.5:e;var r=2*e-1,i=t.alpha()-n.alpha();return r=((-1==r*i?r:(r+i)/(1+r*i))+1)/2,i=1-r,s.rgb(r*t.red()+i*n.red(),r*t.green()+i*n.green(),r*t.blue()+i*n.blue(),t.alpha()*e+n.alpha()*(1-e))}},He(zi).forEach(function(t){if(-1===Ui.indexOf(t)){var e=zi[t].channels;s.prototype[t]=function(){if(this.model===t)return new s(this);if(arguments.length)return new s(arguments,t);var n="number"==typeof arguments[e]?e:this.valpha,r=zi[this.model][t].raw(this.color);return r=Array.isArray(r)?r:[r],new s(r.concat(n),t)},s[t]=function(n){return"number"==typeof n&&(n=c(Ii.call(arguments),e)),new s(n,t)}}}),y(b.prototype,{equals:function(t){return this.lat===t.lat&&this.lng===t.lng},clone:function(){return new b(this.lat,this.lng)},getLngSpan:function(t){return t=Math.abs(t-this.lng),180<t&&(t=360-t),t},sub:function(t){return new b(this.lat-t.lat,this.lng-t.lng)},toString:function(){return"Point"}}),y(m,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(t,e){if(!t||!e)return 0;if(!(t=this.convertMC2LL(t)))return 0;var n=this.toRadians(t.lng);if(t=this.toRadians(t.lat),!(e=this.convertMC2LL(e)))return 0;var r=this.toRadians(e.lng);return e=this.toRadians(e.lat),this.getDistance(n,r,t,e)},getDistanceByLL:function(t,e){if(!t||!e)return 0;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74),e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74);var n=this.toRadians(t.lng),r=this.toRadians(t.lat);return t=this.toRadians(e.lng),e=this.toRadians(e.lat),this.getDistance(n,t,r,e)},convertMC2LL:function(t){if(null===t||void 0===t)return new b(0,0);if(180>t.lng&&-180<t.lng&&90>t.lat&&-90<t.lat)return t;for(var e=new b(Math.abs(t.lng),Math.abs(t.lat)),n=0;n<this.MCBAND.length;n++)if(e.lat>=this.MCBAND[n]){var r=this.MC2LL[n];break}return t=this.convertor(t,r),t=new b(t.lng.toFixed(6),t.lat.toFixed(6))},convertLL2MC:function(t){if(null===t||void 0===t)return new b(0,0);if(180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return t;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74);for(var e=new b(t.lng,t.lat),n=0;n<this.LLBAND.length;n++)if(e.lat>=this.LLBAND[n]){var r=this.LL2MC[n];break}if(!r)for(n=0;n<this.LLBAND.length;n++)if(e.lat<=-this.LLBAND[n]){r=this.LL2MC[n];break}return t=this.convertor(t,r),t=new b(Number(t.lng.toFixed(2)),Number(t.lat.toFixed(2)))},convertor:function(t,e){if(t&&e){var n=e[0]+e[1]*Math.abs(t.lng),r=Math.abs(t.lat)/e[9];return e=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r,n*=0>t.lng?-1:1,e*=0>t.lat?-1:1,new b(n,e)}},getDistance:function(t,e,n,r){return this.EARTHRADIUS*Math.acos(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(e-t))},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,n){return null!=e&&(t=Math.max(t,e)),null!=n&&(t=Math.min(t,n)),t},getLoop:function(t,e,n){for(;t>n;)t-=n-e;for(;t<e;)t+=n-e;return t}}),y(m.prototype,{lngLatToMercator:function(t){return m.convertLL2MC(t)},lngLatToPoint:function(t){return t=m.convertLL2MC(t),new x(t.lng,t.lat)},mercatorToLngLat:function(t){return m.convertMC2LL(t)},pointToLngLat:function(t){return t=new b(t.x,t.y),m.convertMC2LL(t)},pointToPixel:function(t,e,n,r,i){if(t)return t=this.lngLatToMercator(t,i),e=this.getZoomUnits(e),new x(Math.round((t.lng-n.lng)/e+r.width/2),Math.round((n.lat-t.lat)/e+r.height/2))},pixelToPoint:function(t,e,n,r,i){if(t)return e=this.getZoomUnits(e),t=new b(n.lng+e*(t.x-r.width/2),n.lat-e*(t.y-r.height/2)),this.mercatorToLngLat(t,i)},getZoomUnits:function(t){return Math.pow(2,18-t)}}),w.prototype.setMax=function(t){this.max=t||100},w.prototype.setMin=function(t){this.min=t||0},w.prototype.setMaxSize=function(t){this.maxSize=t||35},w.prototype.setMinSize=function(t){this.minSize=t||0},w.prototype.initPalette=function(){var t=this.gradient,e=this.paletteCtx=new _(256,1).getContext("2d"),n=e.createLinearGradient(0,0,256,1);He(t).forEach(function(e){n.addColorStop(parseFloat(e),t[e])}),e.fillStyle=n,e.fillRect(0,0,256,1),e.imageData=e.getImageData(0,0,256,1).data},w.prototype.getColor=function(t){return t=this.getImageData(t),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},w.prototype.getImageData=function(t){var e=this.paletteCtx.imageData;if(void 0===t)return e;var n=this.max,r=this.min;return t>n&&(t=n),t<r&&(t=r),t=4*Math.floor((t-r)/(n-r)*255),[e[t],e[t+1],e[t+2],e[t+3]]},w.prototype.getSize=function(t){var e=this.max,n=this.min,r=this.maxSize,i=this.minSize;return t>e&&(t=e),t<n&&(t=n),i+(t-n)/(e-n)*(r-i)},M.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},M.prototype.setOptions=function(t){this.options=t||{},this._initialize()},M.prototype.getPoints=function(t){void 0===t&&(t=20);for(var e=[],n=0;n<=t;n++)e.push(this._getPoint(n/t));return e},M.prototype._normalizaCoord=function(t){return t?(t=m.convertLL2MC({lng:Number(t[0]),lat:Number(t[1])}),[t.lng,t.lat]):[]},M.prototype._getControlPoint=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(wi(this._getQuarter(t,e)),[this._getDistance(t,e)/n])},M.prototype._getQuarter=function(t,e){return[(3*t[0]+e[0])/4,(3*t[1]+e[1])/4]},M.prototype._getDistance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},M.prototype._getPoint=function(t){var e=[],n=this.v0,r=this.v1,i=this.v2,o=this.v3;return e.push(T(t,n[0],r[0],i[0],o[0]),T(t,n[1],r[1],i[1],o[1]),T(t,n[2],r[2],i[2],o[2])),e},A.prototype._initialize=function(){this.points=this.options.points||this.options.point||[],this.greatCirclePoints=[];for(var t=[],e=0;e<this.points.length;e++){var n=this._normalizaCoord(this.points[e]);n&&t.push(n)}this.points=t},A.prototype.setOptions=function(t){this.options=t||{},this._initialize()},A.prototype.getPoints=function(){if(0===this.greatCirclePoints.length)for(var t=0;t<this.points.length-1;t++)this._calcGreatCirclePoints(this.points[t],this.points[t+1]);return this.greatCirclePoints},A.prototype._normalizaCoord=function(t){if(!t)return null;t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])});var e=m.convertLL2MC(t);return t=m.convertMC2LL(t),e.latLng=t,e},A.prototype._calcGreatCirclePoints=function(t,e){var n=t.latLng,r=e.latLng;if(!g(n.lng,r.lng)||!g(n.lat,r.lat)){var i=m.getDistance(f(n.lng),f(n.lat),f(r.lng),f(r.lat));if(!(25e4>i)){i=Math.round(i/15e4);var o=this._calcAngularDistance(n,r);this.greatCirclePoints.push([t.lng,t.lat]);for(var a=0;a<i;a++){var s=this._calcMiddlePoint(n,r,a/i,o);s=m.convertLL2MC(s);var u=E(s,t);30037726<u&&(s.lng=s.lng<t.lng?s.lng+this.WORLD_SIZE_MC:s.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([s.lng,s.lat]),t=s}u=E(e,t),30037726<u&&(e.lng=e.lng<t.lng?e.lng+this.WORLD_SIZE_MC:e.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([e.lng,e.lat])}}},A.prototype._calcAngularDistance=function(t,e){var n=f(t.lat),r=f(e.lat);return t=f(t.lng),e=f(e.lng),Math.acos(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(Math.abs(e-t)))},A.prototype._calcMiddlePoint=function(t,e,n,r){var i=e.lat,o=t.lng;e=e.lng,t=f(t.lat),i=f(i),o=f(o);var a=f(e);return e=Math.sin((1-n)*r)/Math.sin(r),r=Math.sin(n*r)/Math.sin(r),n=e*Math.cos(t)*Math.cos(o)+r*Math.cos(i)*Math.cos(a),o=e*Math.cos(t)*Math.sin(o)+r*Math.cos(i)*Math.sin(a),t=Math.atan2(e*Math.sin(t)+r*Math.sin(i),Math.sqrt(Math.pow(n,2)+Math.pow(o,2))),new b(p(Math.atan2(o,n)),p(t))};var Yi=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};an(this,t),this.options=e,this._initialize()}return fn(t,[{key:"_initialize",value:function(){this.points=this.options.points}},{key:"_normalizaCoord",value:function(t){return t?(t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])}),m.convertLL2MC(t)):null}},{key:"setOptions",value:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this._initialize()}},{key:"getPoints",value:function(t){for(var e=[],n=this.points,r=0;r<n.length-1;r++){var i=this.getCurveByTwoPoints(this._normalizaCoord(n[r]),this._normalizaCoord(n[r+1]),t);i&&0<i.length&&(e=e.concat(i))}return e}},{key:"getCurveByTwoPoints",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;if(!t||!e)return null;var r=[],i=0;if(void 0!==(void 0===e?"undefined":Fr(e))){var o=parseFloat(t.lat),a=parseFloat(e.lat),s=parseFloat(t.lng),u=parseFloat(e.lng);u>s&&180<parseFloat(u-s)&&0>s&&(s=parseFloat(360+s),u=parseFloat(360+u));var l=0;if(a===o)var h=0,c=s-u;else u===s?(h=Math.PI/2,c=o-a):(h=Math.atan((a-o)/(u-s)),c=(a-o)/Math.sin(h));for(0===l&&(l=h+Math.PI/5),c/=2,h=c*Math.cos(l)+s,l=c*Math.sin(l)+o,c=0;c<n+1;c++){var f=s*(1-2*i+i*i)+h*(2*i-2*i*i)+u*i*i,p=e.lng;r.push([0>t.lng&&0<p?f-360:f,o*(1-2*i+i*i)+l*(2*i-2*i*i)+a*i*i]),i+=1/n}return r}void 0===r||Fr(r)}}]),t}(),Vi=function(){function t(e){an(this,t),this.options=this.getCommonDefaultOptions(),this.options=Ke(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=Ke(this.options,e),this.options.data&&(this.data=this.options.data,delete this.options.data)}return fn(t,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(t,e){e=e||{},this.data=t,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData()),!1!==e.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(t){t=t||{};var e=Ke({},this.getOptions());Ke(this.options,t),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),e),this.onChanged&&this.onChanged(this.getOptions(),this.getData()),t.data?(this.setData(t.data),delete t.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(t,e){}},{key:"onDataChanged",value:function(t){}},{key:"onChanged",value:function(t,e){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(t,e){}},{key:"setWebglLayer",value:function(t){this.webglLayer=t}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),t}(),Hi=function(){function t(e,n,r){an(this,t),this.options=n,this.gl=e,r&&(this.map=r.map),r=this.getVertexShader(n.vertexShader);var i=this.getFragmentShader(n.fragmentShader);n=e.createShader(e.VERTEX_SHADER),e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?(r=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?(i=e.createProgram(),e.attachShader(i,n),e.attachShader(i,r),e.deleteShader(n),e.deleteShader(r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?n=i:(n="Shader program failed to link.  The error log is:"+e.getProgramInfoLog(i),console.error(n),n=-1)):(n="Fragment shader failed to compile.  The error log is:"+e.getShaderInfoLog(r),console.error(n),n=-1)):(n="Vertex shader failed to compile.  The error log is:"+e.getShaderInfoLog(n),console.error(n),n=-1),n=this.program=n,r={},i=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES);for(var o=0;o<i;o++){var a=e.getActiveAttrib(n,o);r[a.name]=e.getAttribLocation(n,a.name)}o={},a={};for(var s=e.getProgramParameter(n,e.ACTIVE_UNIFORMS),u=0;u<s;u++){var l=e.getActiveUniform(n,u);o[l.name]=e.getUniformLocation(n,l.name),a[l.name]=l.type}this.parameter=e={attributes:r,numAttributes:i,uniformsType:a,uniforms:o},this.attributes=e.attributes,this.uniforms=e.uniforms,this.parameter=e}return fn(t,[{key:"getVertexShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\nuniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\nv_depthFromNearPlusOne=(gl_Position.w-0.1)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}",t=this.getDefines()+e+t,(t=t.replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#if defined(LOG_DEPTH)\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;uniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\n#if defined(LOG_DEPTH)\nuniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n#if defined(LOG_DEPTH)\nwriteLogDepth(v_depthFromNearPlusOne);\n#endif\n}",t=this.getDefines()+e+t,(t=t.replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var t="",e=this.options.defines;if(e)for(var n=0;n<e.length;n++)t+="#define "+e[n]+"\n";return t}},{key:"use",value:function(t,e){this.gl=t,t.useProgram(this.program),this.map&&"cesium"===this.map.type&&this.setUniforms({oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context._us._oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context._us._farDepthFromNearPlusOne}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[t.canvas.width,t.canvas.height]})}},{key:"setUniform",value:function(t,e){var n=this.gl,r=this.uniforms[t];if(r)switch(this.parameter.uniformsType[t]){case n.FLOAT:n.uniform1f(r,e);break;case n.FLOAT_VEC2:n.uniform2f(r,e[0],e[1]);break;case n.FLOAT_VEC3:n.uniform3f(r,e[0],e[1],e[2]);break;case n.FLOAT_VEC4:n.uniform4f(r,e[0],e[1],e[2],e[3]);break;case n.SAMPLER_2D:case n.SAMPLER_CUBE:n.activeTexture(n["TEXTURE"+this.textureIndex]),n.uniform1i(r,this.textureIndex),n.bindTexture(n.TEXTURE_2D,e),this.textureIndex++;break;case n.INT:case n.BOOL:n.uniform1i(r,e);break;case n.INT_VEC2:case n.BOOL_VEC2:n.uniform2i(r,e[0],e[1]);break;case n.INT_VEC3:case n.BOOL_VEC3:n.uniform3i(r,e[0],e[1],e[2]);break;case n.INT_VEC4:case n.BOOL_VEC4:n.uniform4i(r,e[0],e[1],e[2],e[3]);break;case n.FLOAT_MAT2:n.uniformMatrix2fv(r,!1,e);break;case n.FLOAT_MAT3:n.uniformMatrix3fv(r,!1,e);break;case n.FLOAT_MAT4:n.uniformMatrix4fv(r,!1,e);break;default:console.error("Unrecognized uniform type: "+t)}else console.warn("Unrecognized uniform type: "+t)}},{key:"setUniforms",value:function(t){this.textureIndex=0;for(var e in t)this.setUniform(e,t[e])}}]),t}(),Wi=function(){function t(e){an(this,t),this.options=e,this.gl=e.gl,this.savedState=[],this.currentState=this.getCurrentState()}return fn(t,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){return{blend:!1,depthTest:!1,cullFace:!1,depthMask:!0,stencilTest:!1}}},{key:"getCurrentState",value:function(){var t=this.gl;return{blend:t.getParameter(t.BLEND),stencilTest:t.getParameter(t.STENCIL_TEST),depthTest:t.getParameter(t.DEPTH_TEST),cullFace:t.getParameter(t.CULL_FACE),depthMask:t.getParameter(t.DEPTH_WRITEMASK)}}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var t=this.savedState.pop();this.setState(t)}},{key:"setState",value:function(t){var e=this.gl,n=this.getCurrentState();t=Ke(this.getDefaultState(),t),t.blend!==n.blend&&(t.blend?e.enable(e.BLEND):e.disable(e.BLEND)),t.depthTest!==n.depthTest&&(t.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)),t.cullFace!==n.cullFace&&(t.cullFace?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)),t.depthMask!==n.depthMask&&(t.depthMask?e.depthMask(!0):e.depthMask(!1)),this.currentState=t}}]),t}(),qi=function(){function t(e){an(this,t),this.options=e,this.gl=e.gl,this.buffer=this.gl.createBuffer(),e.data&&this.updateData(e.data)}return fn(t,[{key:"updateData",value:function(t){var e=this.options,n=this.gl;this.bind(),n.bufferData(n[e.target],t,n[e.usage])}},{key:"bind",value:function(t){t=t||this.gl,t.bindBuffer(t[this.options.target],this.buffer)}},{key:"unBind",value:function(t){t=t||this.gl,t.bindBuffer(t[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),t}(),Zi={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},Xi=function(){function t(e){for(an(this,t),this.options=e,this.attributes=e.attributes,this.gl=e.gl,this.program=e.program,e=this.stride=0;e<this.attributes.length;e++)this.stride+=Zi[this.attributes[e].type]*this.attributes[e].size}return fn(t,[{key:"setVertexAttribPointers",value:function(){for(var t=this.gl,e=this.program,n=0;n<this.attributes.length;n++){var r=this.attributes[n],i=e.attributes[r.name];void 0!==i&&(r.buffer.bind(t),t.vertexAttribPointer(i,r.size,t[r.type],r.normalize||!1,void 0!==r.stride?r.stride:this.stride,r.offset),t.enableVertexAttribArray(i))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),t}(),Gi=function t(e,n,r){an(this,t),n=n||e.canvas.width,r=r||e.canvas.height;var i=e.createFramebuffer(),o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i.texture=o;var a=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n,r),i.depthBuffer=a,e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),n=e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE===n&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),this.framebuffer=i)},Ji=function(){function t(e){an(this,t),this.options={},Ke(this.options,e),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return fn(t,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(t){}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var n=this.programSample;e.useProgram(n.program);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);var i=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,3,e.FLOAT,!1,0,0),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.aTextureCoord),e.vertexAttribPointer(n.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(n.uniforms.uSampler,0),e.drawArrays(e.TRIANGLES,0,i.length/3)}}]),t}(),Ki=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new Xi({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=this.getProgram(e);n.use(e),this.vertexArray.bind(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(n.uniforms.uSampler,1),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(Ji),$i=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Gi(t),this.bloomBuffer=new Gi(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Gi(t)),this.bloomBuffer||(this.bloomBuffer=new Gi(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,n=t.texture;t=t.fbo;var r=this.getOptions();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.getProgram(e),o=i.programBright,a=i.programBloom;i=i.programResult;var s=this.getExtraFbo(e),u=s.collectBrightBuffer;s=s.bloomBuffer;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),l=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.aTextureCoord),e.vertexAttribPointer(i.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(o.uniforms.uSampler,1),e.uniform1f(o.uniforms.threshold,r.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!0),e.uniform1f(a.uniforms.blurSize,r.blurSize||2),e.uniform1f(a.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!1),e.uniform1f(a.uniforms.blurSize,r.blurSize||2),e.uniform1f(a.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(i.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(i.uniforms.originalTexture,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(i.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(Ji),Qi=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Gi(t),this.bloomBuffer=new Gi(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Gi(t)),this.bloomBuffer||(this.bloomBuffer=new Gi(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,n=t.texture;t=t.fbo;var r=this.getOptions(),i="clarity"in r?r.clarity:1;i=Math.max(0,i),i=Math.min(1,i),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var o=this.getProgram(e),a=o.programBright,s=o.programBloom;o=o.programResult;var u=this.getExtraFbo(e),l=u.collectBrightBuffer;u=u.bloomBuffer;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aPos),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aTextureCoord),e.vertexAttribPointer(s.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(a.uniforms.uSampler,1),e.uniform1f(a.uniforms.threshold,r.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!0),e.uniform1f(s.uniforms.blurSize,r.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!1),e.uniform1f(s.uniforms.blurSize,r.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(o.uniforms.originalTexture,1),e.uniform1f(o.uniforms.toneScale,i),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(o.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(Ji),to=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Hi(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var n=this.getProgram(e);e.useProgram(n.program);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,3,e.FLOAT,!1,0,0),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.aTextureCoord),e.vertexAttribPointer(n.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(n.uniforms.uSampler,1),e.uniform2fv(n.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(Ji),eo=function(){function t(e){an(this,t),this.gl=e,this.effects=[],this.initFbo()}return fn(t,[{key:"addEffect",value:function(t){this.effects.push(t)}},{key:"removeEffect",value:function(t){}},{key:"setEffects",value:function(t){this.effects=t}},{key:"onResize",value:function(){this.initFbo();var t=this.gl,e=this.effects;if(e&&1<e.length)for(var n=1;n<e.length;n++){var r=e[n];r.onResize&&r.onResize(t)}}},{key:"initFbo",value:function(){var t=this.gl;this.fbo=[new Gi(t),new Gi(t)]}},{key:"render",value:function(){var t=this.gl,e=this.effects;if(e&&0<e.length)for(var n={},r=0;r<e.length;r++){var i=this.fbo[r%2].framebuffer;r===e.length-1&&(i=null),t.bindFramebuffer(t.FRAMEBUFFER,i);var o=[0,0,0,0];t.clearColor(o[0],o[1],o[2],o[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e[r].render({isPickRender:!1,gl:t,texture:n.texture,fbo:i}),n=i}}}]),t}(),no=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.pickedColor=[-1,-1,-1],t}return $r(e,t),fn(e,[{key:"getCommonDefaultOptions",value:function(){return{repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){var e=this.getOptions();this.gl=t,e.enablePicked&&(this.pickBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"normizedColor",value:function(t){var e=t;return t instanceof Array||(e=s(t).unitArray()),void 0===e[3]&&(e[3]=1),e}},{key:"normizedPoint",value:function(t){if(!t||!t[0]||!t[1])return[0,0,0];var e=this.getPointOffset(),n=Number(t[0]),r=Number(t[1]);-180<=n&&180>=n&&-90<=r&&90>=r&&(r=this.webglLayer.map.lnglatToMercator(n,r),n=r[0],r=r[1]);var i=Number(t[2])||0;return this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium?(n=this.convertLngLat([n,r]),i=window.Cesium.Cartesian3.fromDegrees(n[0],n[1],i),n=i.x,r=i.y,i=i.z):this.webglLayer&&"bmapgl"===this.webglLayer.options.mapType&&"B_EARTH_MAP"===this.webglLayer.map.map.mapType&&(n=this.convertLngLat([n,r]),i=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:n[0],lat:n[1]}),n=i.x,r=i.y,i=i.z),3<t.length?[n-e[0],r-e[1],i].concat(wi(t.slice(3))):[n-e[0],r-e[1],i]}},{key:"convertLngLat",value:function(t){return[t[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var t=[0,0],e=this.getOptions();return this.webglLayer&&this.webglLayer.options.pointOffset?t=this.webglLayer.options.pointOffset:e.pointOffset&&(t=e.pointOffset),t}},{key:"indexToRgb",value:function(t){t++;var e=Math.floor(t/65536);t-=65536*e;var n=Math.floor(t/256);return[t-256*n,n,e]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var e=this.getOptions(),n={};if(e.enablePicked){var r=0<=e.selectedIndex?e.selectedIndex:-1;r=e.autoSelect?this.pickedColor:this.indexToRgb(r),n=Ke(n,{uSelectedColor:this.normizedColor(e.selectedColor),uEnablePicked:e.enablePicked,uPickedColor:r.map(function(t){return t/255}),uIsPickRender:!!t})}return n}},{key:"pick",value:function(t,e){var n=this.gl;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:n,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var r=new Uint8Array(4);return n.readPixels(t*window.devicePixelRatio,n.canvas.height-e*window.devicePixelRatio,1,1,n.RGBA,n.UNSIGNED_BYTE,r),t=this.rgbToIndex(r),this.pickedColor=[r[0],r[1],r[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:this.data[t]}}},{key:"setGLState",value:function(t){this.webglLayer.stateManager.setState(t)}},{key:"addMultipleCoords",value:function(t,e,n){if(!this.options.repeat||!this.webglLayer||"bmapgl"!==this.webglLayer.options.mapType||"B_EARTH_MAP"===this.webglLayer.map.map.mapType)return[t];var r=this.webglLayer.map.map;e=e||r.getZoom();var i=n?r.worldSize(e):40075452.74461451;if(e=function(t){return[[t[0]-i,t[1],t[2]||0],[t[0]+i,t[1],t[2]||0]]},t instanceof Array&&!(t[0]instanceof Array))return e=e(t),e=ci(e,2),[t,e[0],e[1]];n=[],r=[];for(var o=0;o<t.length;o++){var a=e(t[o]);a=ci(a,2);var s=a[1];n.push(a[0]),r.push(s)}return[t,n,r]}}]),e}(Vi),ro=r(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=r=t},e.toRadian=function(t){return t*i},e.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var n=1e-6;e.EPSILON=n;var r="undefined"!=typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=r,e.RANDOM=Math.random;var i=Math.PI/180});n(ro);var io=r(function(t,e){function n(t,e,n){var r=e[0],i=e[1],o=e[2];e=e[3];var a=n[0],s=n[1],u=n[2];return n=n[3],t[0]=r*a+o*s,t[1]=i*a+e*s,t[2]=r*u+o*n,t[3]=i*u+e*n,t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,n,r){var o=new i.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o},e.set=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},e.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2];e=e[3];var o=n*e-i*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null},e.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=n,e.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(n);return n=Math.cos(n),t[0]=r*n+o*a,t[1]=i*n+e*a,t[2]=r*-a+o*n,t[3]=i*-a+e*n,t},e.scale=function(t,e,n){var r=e[1],i=e[2],o=e[3],a=n[0];return n=n[1],t[0]=e[0]*a,t[1]=r*a,t[2]=i*n,t[3]=o*n,t},e.fromRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=n,t[2]=-n,t[3]=e,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},e.subtract=r,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var n=t[0],r=t[1],o=t[2];t=t[3];var a=e[0],s=e[1],u=e[2];return e=e[3],Math.abs(n-a)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.mul=n,e.sub=r});n(io);var oo=r(function(t,e){function n(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=n[0],l=n[1],h=n[2],c=n[3],f=n[4];return n=n[5],t[0]=r*u+o*l,t[1]=i*u+a*l,t[2]=r*h+o*c,t[3]=i*h+a*c,t[4]=r*f+o*n+s,t[5]=i*f+a*n+e,t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(6);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,n,r,o,a){var s=new i.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=o,s[5]=a,s},e.set=function(t,e,n,r,i,o,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4];e=e[5];var s=n*o-r*i;return s?(s=1/s,t[0]=o*s,t[1]=-r*s,t[2]=-i*s,t[3]=n*s,t[4]=(i*e-o*a)*s,t[5]=(r*a-n*e)*s,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=n,e.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=Math.sin(n);return n=Math.cos(n),t[0]=r*n+o*u,t[1]=i*n+a*u,t[2]=r*-u+o*n,t[3]=i*-u+a*n,t[4]=s,t[5]=e,t},e.scale=function(t,e,n){var r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=n[0];return n=n[1],t[0]=e[0]*u,t[1]=r*u,t[2]=i*n,t[3]=o*n,t[4]=a,t[5]=s,t},e.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=n[0];return n=n[1],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*u+o*n+s,t[5]=i*u+a*n+e,t},e.fromRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=n,t[2]=-n,t[3]=e,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},e.subtract=r,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4];t=t[5];var u=e[0],l=e[1],h=e[2],c=e[3],f=e[4];return e=e[5],Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-l)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-h)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-f)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.mul=n,e.sub=r});n(oo);var ao=r(function(t,e){function n(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=n[0],f=n[1],p=n[2],d=n[3],v=n[4],g=n[5],m=n[6],y=n[7];return n=n[8],t[0]=c*r+f*a+p*l,t[1]=c*i+f*s+p*h,t[2]=c*o+f*u+p*e,t[3]=d*r+v*a+g*l,t[4]=d*i+v*s+g*h,t[5]=d*o+v*u+g*e,t[6]=m*r+y*a+n*l,t[7]=m*i+y*s+n*h,t[8]=m*o+y*u+n*e,t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(9);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,n,r,o,a,s,u,l){var h=new i.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=o,h[5]=a,h[6]=s,h[7]=u,h[8]=l,h},e.set=function(t,e,n,r,i,o,a,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];e=e[8];var h=e*a-s*l,c=-e*o+s*u,f=l*o-a*u,p=n*h+r*c+i*f;return p?(p=1/p,t[0]=h*p,t[1]=(-e*r+i*l)*p,t[2]=(s*r-i*a)*p,t[3]=c*p,t[4]=(e*n-i*u)*p,t[5]=(-s*n+i*o)*p,t[6]=f*p,t[7]=(-l*n+r*u)*p,t[8]=(a*n-r*o)*p,t):null},e.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];return e=e[8],t[0]=a*e-s*l,t[1]=i*l-r*e,t[2]=r*s-i*a,t[3]=s*u-o*e,t[4]=n*e-i*u,t[5]=i*o-n*s,t[6]=o*l-a*u,t[7]=r*u-n*l,t[8]=n*a-r*o,t},e.determinant=function(t){var e=t[3],n=t[4],r=t[5],i=t[6],o=t[7],a=t[8];return t[0]*(a*n-r*o)+t[1]*(-a*e+r*i)+t[2]*(o*e-n*i)},e.multiply=n,e.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=n[0];return n=n[1],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c*r+n*a+l,t[7]=c*i+n*s+h,t[8]=c*o+n*u+e,t},e.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=Math.sin(n);return n=Math.cos(n),t[0]=n*r+c*a,t[1]=n*i+c*s,t[2]=n*o+c*u,t[3]=n*a-c*r,t[4]=n*s-c*i,t[5]=n*u-c*o,t[6]=l,t[7]=h,t[8]=e,t},e.scale=function(t,e,n){var r=n[0];return n=n[1],t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=n,t[2]=0,t[3]=-n,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2];e=e[3];var o=n+n,a=r+r,s=i+i;n*=o;var u=r*o;r*=a;var l=i*o,h=i*a;return i*=s,o*=e,a*=e,e*=s,t[0]=1-r-i,t[3]=u-e,t[6]=l+a,t[1]=u+e,t[4]=1-n-i,t[7]=h-o,t[2]=l-a,t[5]=h+o,t[8]=1-n-r,t},e.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14];e=e[15];var m=n*s-r*a,y=n*u-i*a,b=n*l-o*a,x=r*u-i*s,_=r*l-o*s,w=i*l-o*u,M=h*v-c*d,T=h*g-f*d;h=h*e-p*d;var A=c*g-f*v;return c=c*e-p*v,f=f*e-p*g,(p=m*f-y*c+b*A+x*h-_*T+w*M)?(p=1/p,t[0]=(s*f-u*c+l*A)*p,t[1]=(u*h-a*f-l*T)*p,t[2]=(a*c-s*h+l*M)*p,t[3]=(i*c-r*f-o*A)*p,t[4]=(n*f-i*h+o*T)*p,t[5]=(r*h-n*c-o*M)*p,t[6]=(v*w-g*_+e*x)*p,t[7]=(g*b-d*w-e*y)*p,t[8]=(d*_-v*b+e*m)*p,t):null},e.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},e.subtract=r,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7];t=t[8];var c=e[0],f=e[1],p=e[2],d=e[3],v=e[4],g=e[5],m=e[6],y=e[7];return e=e[8],Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-v)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-g)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-m)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-y)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.mul=n,e.sub=r});n(ao);var so=r(function(t,e){function n(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],p=e[10],d=e[11],v=e[12],g=e[13],m=e[14];e=e[15];var y=n[0],b=n[1],x=n[2],_=n[3];return t[0]=y*r+b*s+x*c+_*v,t[1]=y*i+b*u+x*f+_*g,t[2]=y*o+b*l+x*p+_*m,t[3]=y*a+b*h+x*d+_*e,y=n[4],b=n[5],x=n[6],_=n[7],t[4]=y*r+b*s+x*c+_*v,t[5]=y*i+b*u+x*f+_*g,t[6]=y*o+b*l+x*p+_*m,t[7]=y*a+b*h+x*d+_*e,y=n[8],b=n[9],x=n[10],_=n[11],t[8]=y*r+b*s+x*c+_*v,t[9]=y*i+b*u+x*f+_*g,t[10]=y*o+b*l+x*p+_*m,t[11]=y*a+b*h+x*d+_*e,y=n[12],b=n[13],x=n[14],_=n[15],t[12]=y*r+b*s+x*c+_*v,t[13]=y*i+b*u+x*f+_*g,t[14]=y*o+b*l+x*p+_*m,t[15]=y*a+b*h+x*d+_*e,t}function i(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o;e=r*s;var h=r*u;r*=l;var c=i*u;return i*=l,o*=l,s*=a,u*=a,a*=l,t[0]=1-(c+o),t[1]=h+a,t[2]=r-u,t[3]=0,t[4]=h-a,t[5]=1-(e+o),t[6]=i+s,t[7]=0,t[8]=r+u,t[9]=i-s,t[10]=1-(e+c),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function o(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,n,r,i,o,s,u,l,h,c,f,p,d,v,g){var m=new a.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=s,m[7]=u,m[8]=l,m[9]=h,m[10]=c,m[11]=f,m[12]=p,m[13]=d,m[14]=v,m[15]=g,m},e.set=function(t,e,n,r,i,o,a,s,u,l,h,c,f,p,d,v,g){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=f,t[12]=p,t[13]=d,t[14]=v,t[15]=g,t},e.identity=n,e.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14];e=e[15];var m=n*s-r*a,y=n*u-i*a,b=n*l-o*a,x=r*u-i*s,_=r*l-o*s,w=i*l-o*u,M=h*v-c*d,T=h*g-f*d,A=h*e-p*d,E=c*g-f*v,P=c*e-p*v,S=f*e-p*g,C=m*S-y*P+b*E+x*A-_*T+w*M;return C?(C=1/C,t[0]=(s*S-u*P+l*E)*C,t[1]=(i*P-r*S-o*E)*C,t[2]=(v*w-g*_+e*x)*C,t[3]=(f*_-c*w-p*x)*C,t[4]=(u*A-a*S-l*T)*C,t[5]=(n*S-i*A+o*T)*C,t[6]=(g*b-d*w-e*y)*C,t[7]=(h*w-f*b+p*y)*C,t[8]=(a*P-s*A+l*M)*C,t[9]=(r*A-n*P-o*M)*C,t[10]=(d*_-v*b+e*m)*C,t[11]=(c*b-h*_-p*m)*C,t[12]=(s*T-a*E-u*M)*C,t[13]=(n*E-r*T+i*M)*C,t[14]=(v*y-d*x-g*m)*C,t[15]=(h*x-c*y+f*m)*C,t):null},e.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14];return e=e[15],t[0]=s*(f*e-p*g)-c*(u*e-l*g)+v*(u*p-l*f),t[1]=-(r*(f*e-p*g)-c*(i*e-o*g)+v*(i*p-o*f)),t[2]=r*(u*e-l*g)-s*(i*e-o*g)+v*(i*l-o*u),t[3]=-(r*(u*p-l*f)-s*(i*p-o*f)+c*(i*l-o*u)),t[4]=-(a*(f*e-p*g)-h*(u*e-l*g)+d*(u*p-l*f)),t[5]=n*(f*e-p*g)-h*(i*e-o*g)+d*(i*p-o*f),t[6]=-(n*(u*e-l*g)-a*(i*e-o*g)+d*(i*l-o*u)),t[7]=n*(u*p-l*f)-a*(i*p-o*f)+h*(i*l-o*u),t[8]=a*(c*e-p*v)-h*(s*e-l*v)+d*(s*p-l*c),t[9]=-(n*(c*e-p*v)-h*(r*e-o*v)+d*(r*p-o*c)),t[10]=n*(s*e-l*v)-a*(r*e-o*v)+d*(r*l-o*s),t[11]=-(n*(s*p-l*c)-a*(r*p-o*c)+h*(r*l-o*s)),t[12]=-(a*(c*g-f*v)-h*(s*g-u*v)+d*(s*f-u*c)),t[13]=n*(c*g-f*v)-h*(r*g-i*v)+d*(r*f-i*c),t[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),t[15]=n*(s*f-u*c)-a*(r*f-i*c)+h*(r*u-i*s),t},e.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],h=t[9],c=t[10],f=t[11],p=t[12],d=t[13],v=t[14];return t=t[15],(e*a-n*o)*(c*t-f*v)-(e*s-r*o)*(h*t-f*d)+(e*u-i*o)*(h*v-c*d)+(n*s-r*a)*(l*t-f*p)-(n*u-i*a)*(l*v-c*p)+(r*u-i*s)*(l*d-h*p)},e.multiply=r,e.translate=function(t,e,n){var r=n[0],i=n[1];if(n=n[2],e===t)t[12]=e[0]*r+e[4]*i+e[8]*n+e[12],t[13]=e[1]*r+e[5]*i+e[9]*n+e[13],t[14]=e[2]*r+e[6]*i+e[10]*n+e[14],t[15]=e[3]*r+e[7]*i+e[11]*n+e[15];else{var o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7],p=e[8],d=e[9],v=e[10],g=e[11];t[0]=o,t[1]=a,t[2]=s,t[3]=u,t[4]=l,t[5]=h,t[6]=c,t[7]=f,t[8]=p,t[9]=d,t[10]=v,t[11]=g,t[12]=o*r+l*i+p*n+e[12],t[13]=a*r+h*i+d*n+e[13],t[14]=s*r+c*i+v*n+e[14],t[15]=u*r+f*i+g*n+e[15]}return t},e.scale=function(t,e,n){var r=n[0],i=n[1];return n=n[2],t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,n,r){var i=r[0],o=r[1];r=r[2];var s=Math.sqrt(i*i+o*o+r*r);if(s<a.EPSILON)return null;s=1/s,i*=s,o*=s,r*=s;var u=Math.sin(n),l=Math.cos(n),h=1-l;n=e[0],s=e[1];var c=e[2],f=e[3],p=e[4],d=e[5],v=e[6],g=e[7],m=e[8],y=e[9],b=e[10],x=e[11],_=i*i*h+l,w=o*i*h+r*u,M=r*i*h-o*u,T=i*o*h-r*u,A=o*o*h+l,E=r*o*h+i*u,P=i*r*h+o*u;return i=o*r*h-i*u,o=r*r*h+l,t[0]=n*_+p*w+m*M,t[1]=s*_+d*w+y*M,t[2]=c*_+v*w+b*M,t[3]=f*_+g*w+x*M,t[4]=n*T+p*A+m*E,t[5]=s*T+d*A+y*E,t[6]=c*T+v*A+b*E,t[7]=f*T+g*A+x*E,t[8]=n*P+p*i+m*o,t[9]=s*P+d*i+y*o,t[10]=c*P+v*i+b*o,t[11]=f*P+g*i+x*o,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},e.rotateX=function(t,e,n){var r=Math.sin(n);n=Math.cos(n);var i=e[4],o=e[5],a=e[6],s=e[7],u=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*n+u*r,t[5]=o*n+l*r,t[6]=a*n+h*r,t[7]=s*n+c*r,t[8]=u*n-i*r,t[9]=l*n-o*r,t[10]=h*n-a*r,t[11]=c*n-s*r,t},e.rotateY=function(t,e,n){var r=Math.sin(n);n=Math.cos(n);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n-u*r,t[1]=o*n-l*r,t[2]=a*n-h*r,t[3]=s*n-c*r,t[8]=i*r+u*n,t[9]=o*r+l*n,t[10]=a*r+h*n,t[11]=s*r+c*n,t},e.rotateZ=function(t,e,n){var r=Math.sin(n);n=Math.cos(n);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],l=e[5],h=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*n+u*r,t[1]=o*n+l*r,t[2]=a*n+h*r,t[3]=s*n+c*r,t[4]=u*n-i*r,t[5]=l*n-o*r,t[6]=h*n-a*r,t[7]=c*n-s*r,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,n){var r=n[0],i=n[1];n=n[2];var o=Math.sqrt(r*r+i*i+n*n);if(o<a.EPSILON)return null;o=1/o,r*=o,i*=o,n*=o,o=Math.sin(e),e=Math.cos(e);var s=1-e;return t[0]=r*r*s+e,t[1]=i*r*s+n*o,t[2]=n*r*s-i*o,t[3]=0,t[4]=r*i*s-n*o,t[5]=i*i*s+e,t[6]=n*i*s+r*o,t[7]=0,t[8]=r*n*s+i*o,t[9]=i*n*s-r*o,t[10]=n*n*s+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromXRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var n=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=i,e.fromQuat2=function(t,e){var n=new a.ARRAY_TYPE(3),r=-e[0],o=-e[1],s=-e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7],p=r*r+o*o+s*s+u*u;return 0<p?(n[0]=2*(l*u+f*r+h*s-c*o)/p,n[1]=2*(h*u+f*o+c*r-l*s)/p,n[2]=2*(c*u+f*s+l*o-h*r)/p):(n[0]=2*(l*u+f*r+h*s-c*o),n[1]=2*(h*u+f*o+c*r-l*s),n[2]=2*(c*u+f*s+l*o-h*r)),i(t,e,n),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9];return e=e[10],t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(o*o+a*a+s*s),t[2]=Math.sqrt(u*u+l*l+e*e),t},e.getRotation=function(t,e){var n=e[0]+e[5]+e[10];return 0<n?(n=2*Math.sqrt(n+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},e.fromRotationTranslationScale=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,h=a+a;e=i*u;var c=i*l;i*=h;var f=o*l;o*=h,a*=h,u*=s,l*=s,s*=h,h=r[0];var p=r[1];return r=r[2],t[0]=(1-(f+a))*h,t[1]=(c+s)*h,t[2]=(i-l)*h,t[3]=0,t[4]=(c-s)*p,t[5]=(1-(e+a))*p,t[6]=(o+u)*p,t[7]=0,t[8]=(i+l)*r,t[9]=(o-u)*r,t[10]=(1-(e+f))*r,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,h=a+a,c=s+s;e=o*l;var f=o*h,p=o*c;o=a*h,a*=c;var d=s*c;s=u*l,h*=u;var v=u*c,g=r[0],m=r[1];c=r[2],r=i[0],u=i[1],i=i[2],l=(1-(o+d))*g;var y=(f+v)*g;return g*=p-h,f=(f-v)*m,d=(1-(e+d))*m,m*=a+s,p=(p+h)*c,a=(a-s)*c,e=(1-(e+o))*c,t[0]=l,t[1]=y,t[2]=g,t[3]=0,t[4]=f,t[5]=d,t[6]=m,t[7]=0,t[8]=p,t[9]=a,t[10]=e,t[11]=0,t[12]=n[0]+r-(l*r+f*u+p*i),t[13]=n[1]+u-(y*r+d*u+a*i),t[14]=n[2]+i-(g*r+m*u+e*i),t[15]=1,t},e.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2];e=e[3];var o=n+n,a=r+r,s=i+i;n*=o;var u=r*o;r*=a;var l=i*o,h=i*a;return i*=s,o*=e,a*=e,e*=s,t[0]=1-r-i,t[1]=u+e,t[2]=l-a,t[3]=0,t[4]=u-e,t[5]=1-n-i,t[6]=h+o,t[7]=0,t[8]=l+a,t[9]=h-o,t[10]=1-n-r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},e.perspective=function(t,e,n,r,i){return e=1/Math.tan(e/2),t[0]=e/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&1/0!==i?(n=1/(r-i),t[10]=(i+r)*n,t[14]=2*i*r*n):(t[10]=-1,t[14]=-2*r),t},e.perspectiveFromFieldOfView=function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180);e=Math.tan(e.rightDegrees*Math.PI/180);var s=2/(a+e),u=2/(i+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-e)*s*.5,t[9]=(i-o)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},e.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},e.lookAt=function(t,e,r,i){var o=e[0],s=e[1];e=e[2];var u=i[0],l=i[1],h=i[2],c=r[0];i=r[1];var f=r[2];if(Math.abs(o-c)<a.EPSILON&&Math.abs(s-i)<a.EPSILON&&Math.abs(e-f)<a.EPSILON)return n(t);r=o-c,i=s-i,c=e-f;var p=1/Math.sqrt(r*r+i*i+c*c);r*=p,i*=p,c*=p,f=l*c-h*i,h=h*r-u*c,u=u*i-l*r,(p=Math.sqrt(f*f+h*h+u*u))?(p=1/p,f*=p,h*=p,u*=p):u=h=f=0,l=i*u-c*h;var d=c*f-r*u,v=r*h-i*f;return(p=Math.sqrt(l*l+d*d+v*v))?(p=1/p,l*=p,d*=p,v*=p):v=d=l=0,t[0]=f,t[1]=l,t[2]=r,t[3]=0,t[4]=h,t[5]=d,t[6]=i,t[7]=0,t[8]=u,t[9]=v,t[10]=c,t[11]=0,t[12]=-(f*o+h*s+u*e),t[13]=-(l*o+d*s+v*e),t[14]=-(r*o+i*s+c*e),t[15]=1,t},e.targetTo=function(t,e,n,r){var i=e[0],o=e[1];e=e[2];var a=r[0],s=r[1],u=r[2];r=i-n[0];var l=o-n[1];n=e-n[2];var h=r*r+l*l+n*n;0<h&&(h=1/Math.sqrt(h),r*=h,l*=h,n*=h);var c=s*n-u*l;return u=u*r-a*n,a=a*l-s*r,h=c*c+u*u+a*a,0<h&&(h=1/Math.sqrt(h),c*=h,u*=h,a*=h),t[0]=c,t[1]=u,t[2]=a,t[3]=0,t[4]=l*a-n*u,t[5]=n*c-r*a,t[6]=r*u-l*c,t[7]=0,t[8]=r,t[9]=l,t[10]=n,t[11]=0,t[12]=i,t[13]=o,t[14]=e,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},e.subtract=o,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],c=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14];t=t[15];var y=e[0],b=e[1],x=e[2],_=e[3],w=e[4],M=e[5],T=e[6],A=e[7],E=e[8],P=e[9],S=e[10],C=e[11],L=e[12],R=e[13],O=e[14];return e=e[15],Math.abs(n-y)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-b)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-x)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-_)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-w)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-M)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(l-T)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-A)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(c-E)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(f-P)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(p-S)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(d-C)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(v-L)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(g-R)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-O)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.mul=r,e.sub=o});n(so);var uo=r(function(t,e){function n(){var t=new p.ARRAY_TYPE(3);return p.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function r(t){var e=t[0],n=t[1];return t=t[2],Math.sqrt(e*e+n*n+t*t)}function i(t,e,n){var r=new p.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r}function o(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function a(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function s(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function u(t,e){var n=e[0]-t[0],r=e[1]-t[1];return t=e[2]-t[2],Math.sqrt(n*n+r*r+t*t)}function l(t,e){var n=e[0]-t[0],r=e[1]-t[1];return t=e[2]-t[2],n*n+r*r+t*t}function h(t){var e=t[0],n=t[1];return t=t[2],e*e+n*n+t*t}function c(t,e){var n=e[0],r=e[1],i=e[2];return n=n*n+r*r+i*i,0<n&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function f(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.clone=function(t){var e=new p.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=r,e.fromValues=i,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},e.subtract=o,e.multiply=a,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},e.distance=u,e.squaredDistance=l,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=c,e.dot=f,e.cross=function(t,e,n){var r=e[0],i=e[1];e=e[2];var o=n[0],a=n[1];return n=n[2],t[0]=i*n-e*a,t[1]=e*o-r*n,t[2]=r*a-i*o,t},e.lerp=function(t,e,n,r){var i=e[0],o=e[1];return e=e[2],t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=e+r*(n[2]-e),t},e.hermite=function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1);return o=a*(3-2*o),t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*o,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*o,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*o,t},e.bezier=function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a;return s*=3*o,a*=3*u,o*=u,t[0]=e[0]*l+n[0]*s+r[0]*a+i[0]*o,t[1]=e[1]*l+n[1]*s+r[1]*a+i[1]*o,t[2]=e[2]*l+n[2]*s+r[2]*a+i[2]*o,t},e.random=function(t,e){e=e||1;var n=2*p.RANDOM()*Math.PI,r=2*p.RANDOM()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},e.transformMat4=function(t,e,n){var r=e[0],i=e[1];e=e[2];var o=n[3]*r+n[7]*i+n[11]*e+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*e+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*e+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*e+n[14])/o,t},e.transformMat3=function(t,e,n){var r=e[0],i=e[1];return e=e[2],t[0]=r*n[0]+i*n[3]+e*n[6],t[1]=r*n[1]+i*n[4]+e*n[7],t[2]=r*n[2]+i*n[5]+e*n[8],t},e.transformQuat=function(t,e,n){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1];e=e[2];var u=i*e-o*s,l=o*a-r*e,h=r*s-i*a;return n=2*n[3],t[0]=a+u*n+2*(i*h-o*l),t[1]=s+l*n+2*(o*u-r*h),t[2]=e+h*n+2*(r*l-i*u),t},e.rotateX=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.rotateY=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.rotateZ=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.angle=function(t,e){return t=i(t[0],t[1],t[2]),e=i(e[0],e[1],e[2]),c(t,t),c(e,e),e=f(t,e),1<e?0:-1>e?Math.PI:Math.acos(e)},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var n=t[0],r=t[1];t=t[2];var i=e[0],o=e[1];return e=e[2],Math.abs(n-i)<=p.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=p.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(t-e)<=p.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.sub=o,e.mul=a,e.div=s,e.dist=u,e.sqrDist=l,e.len=r,e.sqrLen=h,t=function(){var t=n();return function(e,n,r,i,o,a){for(n||(n=3),r||(r=0),i=i?Math.min(i*n+r,e.length):e.length;r<i;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],o(t,t,a),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2];return e}}(),e.forEach=t});n(uo);var lo=r(function(t,e){function n(){var t=new h.ARRAY_TYPE(4);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function i(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function o(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function a(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return t=e[3]-t[3],Math.sqrt(n*n+r*r+i*i+t*t)}function s(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return t=e[3]-t[3],n*n+r*r+i*i+t*t}function u(t){var e=t[0],n=t[1],r=t[2];return t=t[3],Math.sqrt(e*e+n*n+r*r+t*t)}function l(t){var e=t[0],n=t[1],r=t[2];return t=t[3],e*e+n*n+r*r+t*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.clone=function(t){var e=new h.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,n,r){var i=new h.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},e.subtract=r,e.multiply=i,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var n=e[0],r=e[1],i=e[2];e=e[3];var o=n*n+r*r+i*i+e*e;return 0<o&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=e*o,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.cross=function(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1];n=n[2]*r[3]-n[3]*r[2],r=e[0];var l=e[1],h=e[2];return e=e[3],t[0]=l*n-h*u+e*s,t[1]=-r*n+h*a-e*o,t[2]=r*u-l*a+e*i,t[3]=-r*s+l*o-h*i,t},e.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return e=e[3],t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=e+r*(n[3]-e),t},e.random=function(t,e){e=e||1;do{var n=2*h.RANDOM()-1,r=2*h.RANDOM()-1,i=n*n+r*r}while(1<=i);do{var o=2*h.RANDOM()-1,a=2*h.RANDOM()-1,s=o*o+a*a}while(1<=s);return i=Math.sqrt((1-i)/s),t[0]=e*n,t[1]=e*r,t[2]=e*o*i,t[3]=e*a*i,t},e.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2];return e=e[3],t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*e,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*e,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*e,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*e,t},e.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];n=n[3];var l=n*r+s*o-u*i,h=n*i+u*r-a*o,c=n*o+a*i-s*r;return r=-a*r-s*i-u*o,t[0]=l*n+r*-a+h*-u-c*-s,t[1]=h*n+r*-s+c*-a-l*-u,t[2]=c*n+r*-u+l*-s-h*-a,t[3]=e[3],t},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var n=t[0],r=t[1],i=t[2];t=t[3];var o=e[0],a=e[1],s=e[2];return e=e[3],Math.abs(n-o)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.sub=r,e.mul=i,e.div=o,e.dist=a,e.sqrDist=s,e.len=u,e.sqrLen=l,t=function(){var t=n();return function(e,n,r,i,o,a){for(n||(n=4),r||(r=0),i=i?Math.min(i*n+r,e.length):e.length;r<i;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],t[3]=e[r+3],o(t,t,a),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3];return e}}(),e.forEach=t});n(lo);var ho=r(function(t,e){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}function r(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function i(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function o(t,e,n){var r=e[0],i=e[1],o=e[2];e=e[3];var a=n[0],s=n[1],u=n[2];return n=n[3],t[0]=r*n+e*a+i*u-o*s,t[1]=i*n+e*s+o*a-r*u,t[2]=o*n+e*u+r*s-i*a,t[3]=e*n-r*a-i*s-o*u,t}function a(t,e,n,r){var i=e[0],o=e[1],a=e[2];e=e[3];var s=n[0],l=n[1],h=n[2];n=n[3];var c=i*s+o*l+a*h+e*n;if(0>c&&(c=-c,s=-s,l=-l,h=-h,n=-n),1-c>u.EPSILON){var f=Math.acos(c),p=Math.sin(f);c=Math.sin((1-r)*f)/p,r=Math.sin(r*f)/p}else c=1-r;return t[0]=c*i+r*s,t[1]=c*o+r*l,t[2]=c*a+r*h,t[3]=c*e+r*n,t}function s(t,e){var n=e[0]+e[4]+e[8];if(0<n)n=Math.sqrt(n+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var i=(r+1)%3,o=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*i+i]-e[3*o+o]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*i+o]-e[3*o+i])*n,t[i]=(e[3*i+r]+e[3*r+i])*n,t[o]=(e[3*o+r]+e[3*r+o])*n}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=i,e.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>u.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n},e.multiply=o,e.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(n);return n=Math.cos(n),t[0]=r*n+e*a,t[1]=i*n+o*a,t[2]=o*n-i*a,t[3]=e*n-r*a,t},e.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(n);return n=Math.cos(n),t[0]=r*n-o*a,t[1]=i*n+e*a,t[2]=o*n+r*a,t[3]=e*n-i*a,t},e.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(n);return n=Math.cos(n),t[0]=r*n+i*a,t[1]=i*n-r*a,t[2]=o*n+e*a,t[3]=e*n-o*a,t},e.calculateW=function(t,e){var n=e[0],r=e[1];return e=e[2],t[0]=n,t[1]=r,t[2]=e,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-e*e)),t},e.slerp=a,e.random=function(t){var e=u.RANDOM(),n=u.RANDOM(),r=u.RANDOM(),i=Math.sqrt(1-e);return e=Math.sqrt(e),t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=e*Math.sin(2*Math.PI*r),t[3]=e*Math.cos(2*Math.PI*r),t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2];e=e[3];var o=n*n+r*r+i*i+e*e;return o=o?1/o:0,t[0]=-n*o,t[1]=-r*o,t[2]=-i*o,t[3]=e*o,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=s,e.fromEuler=function(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i,i=Math.sin(e),e=Math.cos(e);var o=Math.sin(n);n=Math.cos(n);var a=Math.sin(r);return r=Math.cos(r),t[0]=i*n*r-e*o*a,t[1]=e*o*r+i*n*a,t[2]=e*n*a-i*o*r,t[3]=e*n*r+i*o*a,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0;var u=n(ro),l=n(ao),h=n(uo);t=n(lo),e.clone=t.clone,e.fromValues=t.fromValues,e.copy=t.copy,e.set=t.set,e.add=t.add,e.mul=o,e.scale=t.scale,e.dot=t.dot,e.lerp=t.lerp;var c=t.length;e.length=c,e.len=c,c=t.squaredLength,e.squaredLength=c,e.sqrLen=c;var f=t.normalize;e.normalize=f,e.exactEquals=t.exactEquals,e.equals=t.equals,t=function(){var t=h.create(),e=h.fromValues(1,0,0),n=h.fromValues(0,1,0);return function(r,o,a){var s=h.dot(o,a);return-.999999>s?(h.cross(t,e,o),1e-6>h.len(t)&&h.cross(t,n,o),h.normalize(t,t),i(r,t,Math.PI),r):.999999<s?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(h.cross(t,o,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,f(r,r))}}(),e.rotationTo=t,t=function(){var t=r(),e=r();return function(n,r,i,o,s,u){return a(t,r,s,u),a(e,i,o,u),a(n,t,e,2*u*(1-u)),n}}(),e.sqlerp=t,t=function(){var t=l.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],f(e,s(e,t))}}(),e.setAxes=t});n(ho);var co=r(function(t,e){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}function r(t,e,n){var r=.5*n[0],i=.5*n[1];n=.5*n[2];var o=e[0],a=e[1],s=e[2];return e=e[3],t[0]=o,t[1]=a,t[2]=s,t[3]=e,t[4]=r*e+i*s-n*a,t[5]=i*e+n*o-r*s,t[6]=n*e+r*a-i*o,t[7]=-r*o-i*a-n*s,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function o(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[4],u=n[5],l=n[6],h=n[7],c=e[4],f=e[5],p=e[6];e=e[7];var d=n[0],v=n[1],g=n[2];return n=n[3],t[0]=r*n+a*d+i*g-o*v,t[1]=i*n+a*v+o*d-r*g,t[2]=o*n+a*g+r*v-i*d,t[3]=a*n-r*d-i*v-o*g,t[4]=r*h+a*s+i*l-o*u+c*n+e*d+f*g-p*v,t[5]=i*h+a*u+o*s-r*l+f*n+e*v+p*d-c*g,t[6]=o*h+a*l+r*u-i*s+p*n+e*g+c*v-f*d,t[7]=a*h-r*s-i*u-o*l+e*n-c*d-f*v-p*g,t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,n,r,i,o,s,u){var l=new a.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=s,l[7]=u,l},e.fromRotationTranslationValues=function(t,e,n,r,i,o,s){var u=new a.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,i*=.5,o*=.5,s*=.5,u[4]=i*r+o*n-s*e,u[5]=o*r+s*t-i*n,u[6]=s*r+i*e-o*t,u[7]=-i*t-o*e-s*n,u},e.fromRotationTranslation=r,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var n=s.create();u.getRotation(n,e);var i=new a.ARRAY_TYPE(3);return u.getTranslation(i,e),r(t,n,i),t},e.copy=i,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,n,r,i,o,a,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var n=e[4],r=e[5],i=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2];return e=e[3],t[0]=2*(n*e+o*a+r*u-i*s),t[1]=2*(r*e+o*s+i*a-n*u),t[2]=2*(i*e+o*u+n*s-r*a),t},e.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=.5*n[0],u=.5*n[1];n=.5*n[2];var l=e[4],h=e[5],c=e[6];return e=e[7],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*n-o*u+l,t[5]=a*u+o*s-r*n+h,t[6]=a*n+r*u-i*s+c,t[7]=-r*s-i*u-o*n+e,t},e.rotateX=function(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*r+l*o-h*i,p=l*a+c*i+h*r-u*o,d=h*a+c*o+u*i-l*r;return u=c*a-u*r-l*i-h*o,s.rotateX(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*r+p*o-d*i,t[5]=p*a+u*i+d*r-f*o,t[6]=d*a+u*o+f*i-p*r,t[7]=u*a-f*r-p*i-d*o,t},e.rotateY=function(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*r+l*o-h*i,p=l*a+c*i+h*r-u*o,d=h*a+c*o+u*i-l*r;return u=c*a-u*r-l*i-h*o,s.rotateY(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*r+p*o-d*i,t[5]=p*a+u*i+d*r-f*o,t[6]=d*a+u*o+f*i-p*r,t[7]=u*a-f*r-p*i-d*o,t},e.rotateZ=function(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*r+l*o-h*i,p=l*a+c*i+h*r-u*o,d=h*a+c*o+u*i-l*r;return u=c*a-u*r-l*i-h*o,s.rotateZ(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*r+p*o-d*i,t[5]=p*a+u*i+d*r-f*o,t[6]=d*a+u*o+f*i-p*r,t[7]=u*a-f*r-p*i-d*o,t},e.rotateByQuatAppend=function(t,e,n){var r=n[0],i=n[1],o=n[2];n=n[3];var a=e[0],s=e[1],u=e[2],l=e[3];return t[0]=a*n+l*r+s*o-u*i,t[1]=s*n+l*i+u*r-a*o,t[2]=u*n+l*o+a*i-s*r,t[3]=l*n-a*r-s*i-u*o,a=e[4],s=e[5],u=e[6],l=e[7],t[4]=a*n+l*r+s*o-u*i,t[5]=s*n+l*i+u*r-a*o,t[6]=u*n+l*o+a*i-s*r,t[7]=l*n-a*r-s*i-u*o,t},e.rotateByQuatPrepend=function(t,e,n){var r=e[0],i=e[1],o=e[2];e=e[3];var a=n[0],s=n[1],u=n[2],l=n[3];return t[0]=r*l+e*a+i*u-o*s,t[1]=i*l+e*s+o*a-r*u,t[2]=o*l+e*u+r*s-i*a,t[3]=e*l-r*a-i*s-o*u,a=n[4],s=n[5],u=n[6],l=n[7],t[4]=r*l+e*a+i*u-o*s,t[5]=i*l+e*s+o*a-r*u,t[6]=o*l+e*u+r*s-i*a,t[7]=e*l-r*a-i*s-o*u,t},e.rotateAroundAxis=function(t,e,n,r){if(Math.abs(r)<a.EPSILON)return i(t,e);var o=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);r*=.5;var s=Math.sin(r),u=s*n[0]/o,l=s*n[1]/o;n=s*n[2]/o,r=Math.cos(r),o=e[0],s=e[1];var h=e[2],c=e[3];return t[0]=o*r+c*u+s*n-h*l,t[1]=s*r+c*l+h*u-o*n,t[2]=h*r+c*n+o*l-s*u,t[3]=c*r-o*u-s*l-h*n,o=e[4],s=e[5],h=e[6],e=e[7],t[4]=o*r+e*u+s*n-h*l,t[5]=s*r+e*l+h*u-o*n,t[6]=h*r+e*n+o*l-s*u,t[7]=e*r-o*u-s*l-h*n,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},e.multiply=o,e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},e.lerp=function(t,e,n,r){var i=1-r;return 0>l(e,n)&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t},e.invert=function(t,e){var n=h(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var n=h(e);if(0<n){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,o=e[2]/n,a=e[3]/n,s=e[4],u=e[5],l=e[6];e=e[7];var c=r*s+i*u+o*l+a*e;t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-r*c)/n,t[5]=(u-i*c)/n,t[6]=(l-o*c)/n,t[7]=(e-a*c)/n}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],u=t[5],l=t[6];t=t[7];var h=e[0],c=e[1],f=e[2],p=e[3],d=e[4],v=e[5],g=e[6];return e=e[7],Math.abs(n-h)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-c)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-d)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-v)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-g)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0;var a=n(ro),s=n(ho),u=n(so);e.getReal=s.copy,e.setReal=s.copy,e.mul=o;var l=s.dot;e.dot=l,t=s.length,e.length=t,e.len=t;var h=s.squaredLength;e.squaredLength=h,e.sqrLen=h});n(co);var fo=r(function(t,e){function n(){var t=new h.ARRAY_TYPE(2);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function i(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function o(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function a(t,e){var n=e[0]-t[0];return t=e[1]-t[1],Math.sqrt(n*n+t*t)}function s(t,e){var n=e[0]-t[0];return t=e[1]-t[1],n*n+t*t}function u(t){var e=t[0];return t=t[1],Math.sqrt(e*e+t*t)}function l(t){var e=t[0];return t=t[1],e*e+t*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.clone=function(t){var e=new h.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var n=new h.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,n){return t[0]=e,t[1]=n,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},e.subtract=r,e.multiply=i,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var n=e[0],r=e[1];return n=n*n+r*r,0<n&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,n){return e=e[0]*n[1]-e[1]*n[0],t[0]=t[1]=0,t[2]=e,t},e.lerp=function(t,e,n,r){var i=e[0];return e=e[1],t[0]=i+r*(n[0]-i),t[1]=e+r*(n[1]-e),t},e.random=function(t,e){e=e||1;var n=2*h.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},e.transformMat2=function(t,e,n){var r=e[0];return e=e[1],t[0]=n[0]*r+n[2]*e,t[1]=n[1]*r+n[3]*e,t},e.transformMat2d=function(t,e,n){var r=e[0];return e=e[1],t[0]=n[0]*r+n[2]*e+n[4],t[1]=n[1]*r+n[3]*e+n[5],t},e.transformMat3=function(t,e,n){var r=e[0];return e=e[1],t[0]=n[0]*r+n[3]*e+n[6],t[1]=n[1]*r+n[4]*e+n[7],t},e.transformMat4=function(t,e,n){var r=e[0];return e=e[1],t[0]=n[0]*r+n[4]*e+n[12],t[1]=n[1]*r+n[5]*e+n[13],t},e.rotate=function(t,e,n,r){var i=e[0]-n[0];e=e[1]-n[1];var o=Math.sin(r);return r=Math.cos(r),t[0]=i*r-e*o+n[0],t[1]=i*o+e*r+n[1],t},e.angle=function(t,e){var n=t[0];t=t[1];var r=e[0];e=e[1];var i=n*n+t*t;0<i&&(i=1/Math.sqrt(i));var o=r*r+e*e;return 0<o&&(o=1/Math.sqrt(o)),n=(n*r+t*e)*i*o,1<n?0:-1>n?Math.PI:Math.acos(n)},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var n=t[0];t=t[1];var r=e[0];return e=e[1],Math.abs(n-r)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}(ro);e.len=u,e.sub=r,e.mul=i,e.div=o,e.dist=a,e.sqrDist=s,e.sqrLen=l,t=function(){var t=n();return function(e,n,r,i,o,a){for(n||(n=2),r||(r=0),i=i?Math.min(i*n+r,e.length):e.length;r<i;r+=n)t[0]=e[r],t[1]=e[r+1],o(t,t,a),e[r]=t[0],e[r+1]=t[1];return e}}(),e.forEach=t});n(fo);var po=r(function(t,e){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=hn&&jr?jr(t,n):{};r.get||r.set?hn(e,n,r):e[n]=t[n]}return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0,t=n(ro),e.glMatrix=t,t=n(io),e.mat2=t,t=n(oo),e.mat2d=t,t=n(ao),e.mat3=t,t=n(so),e.mat4=t,t=n(ho),e.quat=t,t=n(co),e.quat2=t,t=n(fo),e.vec2=t,t=n(uo),e.vec3=t,t=n(lo),e.vec4=t});n(po);var vo=po.vec4,go=po.vec3,mo=po.vec2,yo=po.quat2,bo=po.quat,xo=po.mat4,_o=po.mat3,wo=po.mat2d,Mo=po.mat2,To=po.glMatrix;L.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(X(t,0,i?e[0]*n:t.length,n));if(i){i=0;for(var a=e.length;i<a;i++)o-=Math.abs(X(t,e[i]*n,i<a-1?e[i+1]*n:t.length,n))}for(i=e=0;i<r.length;i+=3){a=r[i]*n;var s=r[i+1]*n,u=r[i+2]*n;e+=Math.abs((t[a]-t[u])*(t[s+1]-t[a+1])-(t[a]-t[s])*(t[u+1]-t[a+1]))}return 0===o&&0===e?0:Math.abs((e-o)/o)},L.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);0<i&&(r+=t[i-1].length,n.holes.push(r))}return n},L.default=L;var Ao=void 0===Or?"__target":Or(),Eo=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Po=window.URL||window.webkitURL,So=window.Worker;if(So){var Co=G("self.onmessage = function () {}"),Lo=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var Ro=new So(Co);Ro.postMessage(Lo,[Lo.buffer])}catch(t){So=null}finally{Po.revokeObjectURL(Co),Ro&&Ro.terminate()}}var Oo=new function(t,e){return function(t){var n=this;if(!e)return new So("./worker.js");if(So&&!t)return t=(""+e).replace(/^function.+?{/,"").slice(0,-1),t=G(t),this[Ao]=new So(t),Po.revokeObjectURL(t),this[Ao];var r={postMessage:function(t){n.onmessage&&setTimeout(function(){return n.onmessage({data:t,target:r})})}};e.call(r),this.postMessage=function(t){setTimeout(function(){return r.onmessage({data:t,target:n})})},this.isThisThread=!0}}("./worker.js",function(t,e){}),ko={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},Fo=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t._isShow=!0,n=t.getOptions(),("windowAnimation"===n.style||"ripple"===n.style||0<n.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,isTextureFull:!1,topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.dataMgr=new J(this,this.gl),this.texture=null,this.isUseTexture=!1;var n=[];e.enablePicked&&n.push("PICK"),e.texture&&n.push("USE_TEXTURE"),this.program=new Hi(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;\n#if defined(USE_TEXTURE)\nattribute vec2 a_texture_coord;\n#endif\nuniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;\n#if defined(USE_TEXTURE)\nif(u_use_texture){v_texture_coord=a_texture_coord;}\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;\n#if defined(PICK)\nif(mapvIsPicked()){icolor=uSelectedColor;}\n#endif\nif(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}",fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:n},this),this.vertexBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.heightBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.textureBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),n=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}],e.texture&&n.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0}),n=n.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:n}),this.initializeTime=new Date,this.normalMatrix=xo.create()}},{key:"onChanged",value:function(t,e){var n=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){n.loadTexture(function(){n.dataMgr.parseData(e),n.dataTime=new Date,n.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,n=t.projectionMatrix,r=t.viewMatrix;if(this._isShow){var i=this.getData();if(i&&!(0>=i.length)){i=this.getOptions();var o=this.program;if(o.use(e),!i.texture||this.texture){e.disable(e.CULL_FACE),i.blend&&(e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE),e.blendEquation(e.FUNC_ADD)),0===i.height&&(e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA));var a=0;i.style&&ko[i.style]&&(a=ko[i.style]),"gradual"===i.style?(e.depthMask(!1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)):e.depthMask(!0);var s=this.normizedColor(i.topColor);if("ripple"===i.style&&i.rippleLayer&&i.rippleLayer.data&&i.rippleLayer.data[0]){var u=this.normizedPoint(i.rippleLayer.data[0].geometry.coordinates);o.setUniforms({u_ripple_center:[u[0],u[1],0],u_radius:i.rippleLayer.options.size*i.rippleLayer.currentScale})}u=go.fromValues(0,-1,2),i.lightDir&&(u=go.fromValues(i.lightDir[0],i.lightDir[1],i.lightDir[2]));var l=this.normalMatrix;xo.invert(l,r),xo.transpose(l,l),o.setUniforms(Ke(this.getCommonUniforms(t),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:n,u_mv_matrix:r,style:a,top_color:s,u_use_lighting:i.useLight,u_use_texture:this.isUseTexture,alpha:void 0===i.opacity?.8:parseFloat(i.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:i.riseTime,u_side_light_dir:u})),t=this.dataMgr.getData(),0<t.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,t.index.length,e.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var e=this,n=this.getOptions();n.texture?(this.isUseTexture=!0,C(this.gl,n.texture,function(n,r){e.image=r,e.texture=n,t&&t(),e.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(no);J.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}},J.prototype.getData=function(){return this.outBuilding3d},J.prototype.initWorker=function(){this.worker=new Oo,this.worker.onmessage=function(t){}},J.prototype.parseData=function(t){var e=this;this.initData();for(var n=this.shapeLayer.getOptions(),r=0;r<t.length;r++){var i=t[r],o=i.height||0;"properties"in i&&"height"in i.properties&&(o=i.properties.height),o*=1;var a=i.color||n.color;"properties"in i&&"color"in i.properties&&(a=i.properties.color),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(i)),a=this.shapeLayer.normizedColor(a);var s=void 0;n.enablePicked&&(s=this.shapeLayer.indexToRgb(r));var u=void 0,l=void 0;if(n.riseTime&&(l=i.preColor,"properties"in i&&"preColor"in i.properties&&(l=i.properties.preColor),u=i.preHeight,"properties"in i&&"preHeight"in i.properties&&(u=i.properties.preHeight),void 0===u&&(u=0)),i.geometry.coordinates)if("MultiPolygon"===i.geometry.type)for(var h=i.geometry.coordinates,c=0;c<h.length;c++)!function(t){var n=[],r=[];i.geometry.coordinates[t][0].forEach(function(t){t=e.shapeLayer.normizedPoint(t),n.push(t[0],t[1]),r.push(t[2])}),e.parseBuilding3d(n,r,u,o,l,a,s,e.outBuilding3d)}(c);else!function(){var t=[],n=[];i.geometry.coordinates[0].forEach(function(r){r=e.shapeLayer.normizedPoint(r),t.push(r[0],r[1]),n.push(r[2])}),e.parseBuilding3d(t,n,u,o,l,a,s,e.outBuilding3d)}()}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex)),this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color)),this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height)),this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),n.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))},J.prototype.getBounds=function(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0;o<t.length;o+=2)e=Math.min(t[o],e),n=Math.min(t[o+1],n),r=Math.max(t[o],r),i=Math.max(t[o+1],i);return{minX:e,minY:n,maxX:r,maxY:i,width:r-e,height:i-n}},J.prototype.parseBuilding3d=function(t,e,n,r,i,o,a,s){void 0===n&&(n=r);var u=this.shapeLayer.options,l=s.vertex,h=s.texture,c=s.color,f=s.height,p=s.pickColorVertex;s=s.index,void 0===i&&(i=o);var d=0,v=0;if(this.shapeLayer.image&&(d=this.shapeLayer.image.width*u.textureScale,v=this.shapeLayer.image.height*u.textureScale),"gradual"!=u.style){var g=L(t),m=g[0],y=g[1],b=g[2];m=[t[2*m],t[2*m+1],1],y=[t[2*y],t[2*y+1],1];var x=[t[2*b],t[2*b+1],1];if(b=[],go.cross(b,[x[0]-y[0],x[1]-y[1],x[2]-y[2]],[m[0]-y[0],m[1]-y[1],m[2]-y[2]]),y=l.length/7,u.texture)var _=this.getBounds(t);m=u.isTextureFull,x=0;for(var w=t.length;x<w;x+=2)l.push(t[x],t[x+1],e[x/2],1,b[0],b[1],b[2]),c.push(o[0],o[1],o[2],o[3],i[0],i[1],i[2],i[3]),f.push(r,n),u.texture&&(m?(h.push((t[x]-_.minX)/_.width),h.push((t[x+1]-_.minY)/_.height)):(h.push((t[x]-_.minX)/d),h.push((t[x+1]-_.minY)/v))),a&&p.push(a[0]/255,a[1]/255,a[2]/255);for(_=0,b=g.length;_<b;_++)s.push(g[_]+y)}if(!(r===n&&0>=r))for(g=0,_=t.length;g<_;g+=2){b=l.length/7;var M=t[g],T=t[g+1];y=[M,T,e[g/2],0],x=[M,T,e[g/2],1],w=g+2;var A=g+3;g===_-2&&(w=0,A=1),w=t[w],A=t[A],M=Math.sqrt(Math.pow(w-M,2),Math.pow(A-T,2)),T=[w,A,e[g/2],0],w=[w,A,e[g/2],1],A=[],go.cross(A,[T[0]-y[0],T[1]-y[1],T[2]-y[2]],[x[0]-y[0],x[1]-y[1],x[2]-y[2]]),l.push(y[0],y[1],y[2],y[3]),l.push(A[0],A[1],A[2]),l.push(x[0],x[1],x[2],x[3]),l.push(A[0],A[1],A[2]),l.push(T[0],T[1],T[2],T[3]),l.push(A[0],A[1],A[2]),l.push(w[0],w[1],w[2],w[3]),l.push(A[0],A[1],A[2]),c.push(o[0],o[1],o[2],o[3]),c.push(i[0],i[1],i[2],i[3]),c.push(o[0],o[1],o[2],o[3]),c.push(i[0],i[1],i[2],i[3]),c.push(o[0],o[1],o[2],o[3]),c.push(i[0],i[1],i[2],i[3]),c.push(o[0],o[1],o[2],o[3]),c.push(i[0],i[1],i[2],i[3]),f.push(r),f.push(n),f.push(r),f.push(n),f.push(r),f.push(n),f.push(r),f.push(n),u.texture&&(m?(h.push(0,0),h.push(0,1),h.push(1,0),h.push(1,1)):(h.push(0,0),h.push(0,r/v),h.push(M/d,0),h.push(M/d,r/v))),a&&(p.push(a[0]/255,a[1]/255,a[2]/255),p.push(a[0]/255,a[1]/255,a[2]/255),p.push(a[0]/255,a[1]/255,a[2]/255),p.push(a[0]/255,a[1]/255,a[2]/255)),s.push(b,b+2,b+3,b,b+3,b+1)}};var Do=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.preHeightMapper={},t.preColorMapper={},t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return Ke(Vr(e.prototype.__proto__||rn(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,e){var n=e.gridSize,r=[],i={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates);s=~~((s[0]+o[0])/n)+"_"+~~((s[1]+o[1])/n),void 0===i[s]&&(i[s]=0);var u=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(u=~~t[a].properties.count),i[s]+=u}return He(i).forEach(function(t){var e=t.split("_");r.push([e[0]*n+n/2,e[1]*n+n/2,i[t]])}),r}},{key:"onChanged",value:function(t,n){n=this.processData(n),Vr(e.prototype.__proto__||rn(e.prototype),"onChanged",this).call(this,t,n)}},{key:"getGridDataRange",value:function(){var t=this.gridData,e=void 0,n=void 0;t[0]&&(e=t[0][2],n=t[0][2]);for(var r=t.length,i=0;i<r;i++){var o=t[i];e=Math.max(o[2],e),n=Math.min(o[2],n)}return{max:e/2,min:n}}},{key:"processData",value:function(t){var e=this.getOptions(),n=e.style,r=e.gridSize,i=[];if(this.gridData=i,"normal"===n){n=this.getPointOffset();for(var o=0;o<t.length;o++){var a=this.normizedPoint(t[o].geometry.coordinates),u=a[0]+n[0];a=a[1]+n[1];var l=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(l=~~t[o].properties.count);var h=t[o].color;"properties"in t[o]&&"color"in t[o].properties&&(h=~~t[o].properties.color),i.push([u,a,l,h])}}else i=this.generateGrid(t,e);for(t=[],this._preHeightMapper={},this._preColorMapper={},n=0;n<i.length;n++)o=i[n],o[0]=o[0],o[1]=o[1],u=o[2],e.height&&(u="function"==typeof e.height?e.height({count:o[2]}):e.height),a=r/2-5,l=o[3],e.color&&(l="function"==typeof e.color?e.color({count:o[2],color:o[3]}):s(l).unitArray()),h="p"+o[0]+o[1],t.push({geometry:{type:"Polygon",coordinates:[[[o[0]-a,o[1]-a],[o[0]-a,o[1]+a],[o[0]+a,o[1]+a],[o[0]+a,o[1]-a]]]},color:l,preHeight:this.preHeightMapper[h],preColor:this.preColorMapper[h],height:u}),this._preHeightMapper[h]=u,this._preColorMapper[h]=l;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,t}}]),e}(Fo),Bo=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"initialize",value:function(t){var e=this;this.children&&this.children.forEach(function(n){n.map=e.map,n.setWebglLayer(e.getWebglLayer()),n.commonInitialize&&n.commonInitialize(t),n.initialize&&n.initialize(t),n.onOptionsChanged(n.getOptions()),n.onDataChanged(n.getData()),n.onChanged(n.getOptions(),n.getData())})}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Vr(e.prototype.__proto__||rn(e.prototype),"isRequestAnimation",this).call(this);for(var t=!1,n=0;n<this.children.length;n++)if(this.children[n].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach(function(e){e.render(t)})}}]),e}(Vi),zo=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.gridLayer=new Do(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return $r(e,t),fn(e,[{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),e=t.max,n=t.min;void 0===e&&(n=this.gridLayer.getGridDataRange(),e=n.max,n=n.min);var r=new w({max:e,min:n,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(t){var e=r.getSize(t.count);return"properties"in t&&"count"in t.properties&&(e=r.getSize(t.properties.count)),e},t.color=function(t){var e=r.getImageData(t.count);return"properties"in t&&"count"in t.properties&&(e=r.getImageData(t.properties.count)),[e[0]/255,e[1]/255,e[2]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),e}(Bo),Io=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t}return $r(e,t),fn(e,[{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:e.useDash?["DASH"]:""},this),this.buffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Xi({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var n=this;if(this.gl){var r=[],i=function(t,e){if(t)for(var i=0;i<t.length-1;i++){var o=n.normizedPoint(t[i]);r.push(o[0]),r.push(o[1]),r.push(o[2]),r.push(e[0],e[1],e[2],e[3]),o=n.normizedPoint(t[i+1]),r.push(o[0]),r.push(o[1]),r.push(o[2]),r.push(e[0],e[1],e[2],e[3])}};t=t.color;for(var o=0;o<e.length;o++){var a=e[o].color||t;"properties"in e[o]&&"color"in e[o].properties&&(a=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(e[o])),a=this.normizedColor(a);var s=e[o].geometry,u=s.coordinates;if("MultiPolygon"===s.type){if(u)for(s=0;s<u.length;s++)i(u[s][0],a)}else if("Polygon"===s.type)u&&i(u[0],a);else if("MultiLineString"===s.type){if(u)for(s=0;s<u.length;s++)i(u[s],a)}else i(u,a)}this.bufferData=r,this.buffer.updateData(new Float32Array(r))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var n=this.program;n.use(e),this.vertexArray.bind(),n.setUniforms({u_matrix:t}),t=this.getOptions().blend,e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.LINES,0,this.bufferData.length/7),e.disable(e.BLEND)}}}]),e}(no),Uo=Un.f("species");n(r(function(t){t.exports={default:Uo,__esModule:!0}}));var No=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},jo=[],Yo=[],Vo="undefined"!=typeof Uint8Array?Uint8Array:Array,Ho=!1,Wo={}.toString,qo=Array.isArray||function(t){return"[object Array]"==Wo.call(t)};rt.TYPED_ARRAY_SUPPORT=void 0===No.TYPED_ARRAY_SUPPORT||No.TYPED_ARRAY_SUPPORT,rt.poolSize=8192,rt._augment=function(t){return t.__proto__=rt.prototype,t},rt.from=function(t,e,n){return it(null,t,e,n)},rt.TYPED_ARRAY_SUPPORT&&(rt.prototype.__proto__=Uint8Array.prototype,rt.__proto__=Uint8Array),rt.alloc=function(t,e,n){return ot(t),t=0>=t?nt(null,t):void 0!==e?"string"==typeof n?nt(null,t).fill(e,n):nt(null,t).fill(e):nt(null,t)},rt.allocUnsafe=function(t){return at(null,t)},rt.allocUnsafeSlow=function(t){return at(null,t)},rt.isBuffer=function(t){return null!=t&&(!!t._isBuffer||St(t)||"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&St(t.slice(0,0)))},rt.compare=function(t,e){if(!ht(t)||!ht(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},rt.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},rt.concat=function(t,e){if(!qo(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return rt.alloc(0);var n;if(void 0===e)for(n=e=0;n<t.length;++n)e+=t[n].length;e=rt.allocUnsafe(e);var r=0;for(n=0;n<t.length;++n){var i=t[n];if(!ht(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(e,r),r+=i.length}return e},rt.byteLength=ct,rt.prototype._isBuffer=!0,rt.prototype.swap16=function(){var t=this.length;if(0!=t%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)pt(this,e,e+1);return this},rt.prototype.swap32=function(){var t=this.length;if(0!=t%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)pt(this,e,e+3),pt(this,e+1,e+2);return this},rt.prototype.swap64=function(){var t=this.length;if(0!=t%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)pt(this,e,e+7),pt(this,e+1,e+6),pt(this,e+2,e+5),pt(this,e+3,e+4);return this},rt.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?gt(this,0,t):ft.apply(this,arguments)},rt.prototype.equals=function(t){if(!ht(t))throw new TypeError("Argument must be a Buffer");return this===t||0===rt.compare(this,t)},rt.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},rt.prototype.compare=function(t,e,n,r,i){if(!ht(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),0>e||n>t.length||0>r||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;var o=i-r,a=n-e,s=Math.min(o,a);for(r=this.slice(r,i),t=t.slice(e,n),e=0;e<s;++e)if(r[e]!==t[e]){o=r[e],a=t[e];break}return o<a?-1:a<o?1:0},rt.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},rt.prototype.indexOf=function(t,e,n){return dt(this,t,e,n,!0)},rt.prototype.lastIndexOf=function(t,e,n){return dt(this,t,e,n,!1)},rt.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),0<t.length&&(0>n||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");for(r||(r="utf8"),i=!1;;)switch(r){case"hex":t:{if(e=Number(e)||0,r=this.length-e,n?(n=Number(n))>r&&(n=r):n=r,0!=(r=t.length)%2)throw new TypeError("Invalid hex string");for(n>r/2&&(n=r/2),r=0;r<n;++r){if(i=parseInt(t.substr(2*r,2),16),isNaN(i)){t=r;break t}this[e+r]=i}t=r}return t;case"utf8":case"utf-8":return Pt(Tt(t,this.length-e),this,e,n);case"ascii":return Pt(At(t),this,e,n);case"latin1":case"binary":return Pt(At(t),this,e,n);case"base64":return Pt(Et(t),this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=t,i=this.length-e;for(var o=[],a=0;a<r.length&&!(0>(i-=2));++a){var s=r.charCodeAt(a);t=s>>8,s%=256,o.push(s),o.push(t)}return Pt(o,this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},rt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Zo=4096;rt.prototype.slice=function(t,e){var n=this.length;if(t=~~t,e=void 0===e?n:~~e,0>t?0>(t+=n)&&(t=0):t>n&&(t=n),0>e?0>(e+=n)&&(e=0):e>n&&(e=n),e<t&&(e=t),rt.TYPED_ARRAY_SUPPORT)e=this.subarray(t,e),e.__proto__=rt.prototype;else{n=e-t,e=new rt(n,void 0);for(var r=0;r<n;++r)e[r]=this[r+t]}return e},rt.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||mt(t,e,this.length),n=this[t];for(var r=1,i=0;++i<e&&(r*=256);)n+=this[t+i]*r;return n},rt.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||mt(t,e,this.length),n=this[t+--e];for(var r=1;0<e&&(r*=256);)n+=this[t+--e]*r;return n},rt.prototype.readUInt8=function(t,e){return e||mt(t,1,this.length),this[t]},rt.prototype.readUInt16LE=function(t,e){return e||mt(t,2,this.length),this[t]|this[t+1]<<8},rt.prototype.readUInt16BE=function(t,e){return e||mt(t,2,this.length),this[t]<<8|this[t+1]},rt.prototype.readUInt32LE=function(t,e){return e||mt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},rt.prototype.readUInt32BE=function(t,e){return e||mt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},rt.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||mt(t,e,this.length),n=this[t];for(var r=1,i=0;++i<e&&(r*=256);)n+=this[t+i]*r;return n>=128*r&&(n-=Math.pow(2,8*e)),n},rt.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||mt(t,e,this.length),n=e;for(var r=1,i=this[t+--n];0<n&&(r*=256);)i+=this[t+--n]*r;return i>=128*r&&(i-=Math.pow(2,8*e)),i},rt.prototype.readInt8=function(t,e){return e||mt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},rt.prototype.readInt16LE=function(t,e){return e||mt(t,2,this.length),t=this[t]|this[t+1]<<8,32768&t?4294901760|t:t},rt.prototype.readInt16BE=function(t,e){return e||mt(t,2,this.length),t=this[t+1]|this[t]<<8,32768&t?4294901760|t:t},rt.prototype.readInt32LE=function(t,e){return e||mt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},rt.prototype.readInt32BE=function(t,e){return e||mt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},rt.prototype.readFloatLE=function(t,e){return e||mt(t,4,this.length),tt(this,t,!0,23,4)},rt.prototype.readFloatBE=function(t,e){return e||mt(t,4,this.length),tt(this,t,!1,23,4)},rt.prototype.readDoubleLE=function(t,e){return e||mt(t,8,this.length),tt(this,t,!0,52,8)},rt.prototype.readDoubleBE=function(t,e){return e||mt(t,8,this.length),tt(this,t,!1,52,8)},rt.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||yt(this,t,e,n,Math.pow(2,8*n)-1,0),r=1;var i=0;for(this[e]=255&t;++i<n&&(r*=256);)this[e+i]=t/r&255;return e+n},rt.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||yt(this,t,e,n,Math.pow(2,8*n)-1,0),r=n-1;var i=1;for(this[e+r]=255&t;0<=--r&&(i*=256);)this[e+r]=t/i&255;return e+n},rt.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,1,255,0),rt.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},rt.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,2,65535,0),rt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):bt(this,t,e,!0),e+2},rt.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,2,65535,0),rt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):bt(this,t,e,!1),e+2},rt.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,4,4294967295,0),rt.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):xt(this,t,e,!0),e+4},rt.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,4,4294967295,0),rt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):xt(this,t,e,!1),e+4},rt.prototype.writeIntLE=function(t,e,n,r){t=+t,e|=0,r||(r=Math.pow(2,8*n-1),yt(this,t,e,n,r-1,-r)),r=0;var i=1,o=0;for(this[e]=255&t;++r<n&&(i*=256);)0>t&&0===o&&0!==this[e+r-1]&&(o=1),this[e+r]=(t/i>>0)-o&255;return e+n},rt.prototype.writeIntBE=function(t,e,n,r){t=+t,e|=0,r||(r=Math.pow(2,8*n-1),yt(this,t,e,n,r-1,-r)),r=n-1;var i=1,o=0;for(this[e+r]=255&t;0<=--r&&(i*=256);)0>t&&0===o&&0!==this[e+r+1]&&(o=1),this[e+r]=(t/i>>0)-o&255;return e+n},rt.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,1,127,-128),rt.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=255&t,e+1},rt.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,2,32767,-32768),rt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):bt(this,t,e,!0),e+2},rt.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,2,32767,-32768),rt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):bt(this,t,e,!1),e+2},rt.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,4,2147483647,-2147483648),rt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):xt(this,t,e,!0),e+4},rt.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||yt(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),rt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):xt(this,t,e,!1),e+4},rt.prototype.writeFloatLE=function(t,e,n){return wt(this,t,e,!0,n)},rt.prototype.writeFloatBE=function(t,e,n){return wt(this,t,e,!1,n)},rt.prototype.writeDoubleLE=function(t,e,n){return Mt(this,t,e,!0,n)},rt.prototype.writeDoubleBE=function(t,e,n){return Mt(this,t,e,!1,n)},rt.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),0<r&&r<n&&(r=n),r===n||0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("sourceStart out of bounds");if(0>r)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i=r-n;if(this===t&&n<e&&e<r)for(r=i-1;0<=r;--r)t[r+e]=this[r+n];else if(1e3>i||!rt.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+i),e);return i},rt.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);256>i&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!rt.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(0>e||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(r=e;r<n;++r)this[r]=t;else for(t=ht(t)?t:Tt(new rt(t,r).toString()),i=t.length,r=0;r<n-e;++r)this[r+e]=t[r%i];return this};var Xo,Go,Jo=/[^+\/0-9A-Za-z-_]/g,Ko={normal:null,road:function(){var t=document.createElement("canvas");t.width=t.height=32;var e=t.getContext("2d");return e.save(),e.moveTo(0,0),e.lineTo(20,0),e.lineTo(32,16),e.lineTo(20,32),e.lineTo(0,32),e.lineTo(10,16),e.fillStyle="#fff",e.fill(),e.restore(),t}()},$o=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.initData(),t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:4,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",style:"normal",dashArray:[0,0],dashOffset:0}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),n=[];e.enablePicked&&n.push("PICK"),Ko[e.style]&&(this.isUseTexture=!0,n.push("USE_TEXTURE")),this.program=new Hi(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform int miter;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=zoomUnits*uDashArray/aTotalDistance;vTotalDistance=aTotalDistance;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float width=thickness*zoomUnits;vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;gl_Position=uMatrix*vec4(position.xy+normal*direction,position.z,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;\n#if defined(USE_TEXTURE)\nuniform float uTextureMargin;uniform sampler2D textureImage;\n#endif\nvoid main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}\n#if defined(USE_TEXTURE)\nfloat segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}",defines:n},this),this.prevBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),n=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}],n=n.concat(this.getCommonAttributes()),Ko[e.style]&&(n.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Ko[e.style]}),this.loadTexture()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:n})}},{key:"onChanged",value:function(t,e){var n=this;if(this.gl){this.initData();for(var r=t.color,i=[],o=0;o<e.length;o++){var a=[],s=e[o].geometry.coordinates;s&&0<s.length&&(a="Polygon"===e[o].geometry.type?s[0].map(function(t){return n.normizedPoint(t)}):s.map(function(t){return n.normizedPoint(t)})),s=e[o].color||r,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(s)&&(s=s(e[o])),s=this.normizedColor(s);for(var u=this.addMultipleCoords(a),l=0;l<u.length;l++)this.processData(this.dataMgr,u[l],s);if(t.enablePicked)for(s=this.indexToRgb(o),u=0;u<a.length;u++)i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),t.repeat&&(i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(i))}}},{key:"processData",value:function(t,e,n){var r,i,o,a,s,u,l,h,c=e.length,f=t.position.length/6,p=kt(e),d=p.arr,v=p.total;p=Ct(d.map(function(t){return[t,v]})),d=d.map(function(t){return[t,0,t,1]});var g=Ct(e.map(function(t){return-1}),!0),m=Ct(e),y=Ct(e.map(Rt(-1))),b=Ct(e.map(Rt(1)));e=Ct(e.map(function(t){return n})),c=Lt(c,f),(r=t.uv).push.apply(r,wi(Ot(d))),(i=t.counter).push.apply(i,wi(Ot(p))),(o=t.position).push.apply(o,wi(Ot(m))),(a=t.prev).push.apply(a,wi(Ot(y))),(s=t.next).push.apply(s,wi(Ot(b))),(u=t.direction).push.apply(u,wi(g)),(l=t.color).push.apply(l,wi(Ot(e))),(h=t.index).push.apply(h,wi(c))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=this.dataMgr;if(r&&!(0>=r.index.length)&&this.map){var i=this.getOptions(),o=this.program;o.use(e),t=Ke(this.getCommonUniforms(t),{uMatrix:n,uFlat:i.isFlat,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,miter:1,thickness:i.width,uDashArray:i.dashArray,uDashOffset:i.dashOffset,uAntialias:i.antialias}),this.isUseTexture&&(t=Ke(t,{uTextureMargin:140,textureImage:this.texture})),o.setUniforms(t),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),i.blend&&"lighter"===i.blend?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,r.index.length,e.UNSIGNED_INT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.disable(e.BLEND)}}},{key:"loadTexture",value:function(t){var e=this,n=this.getOptions();n.texture?C(this.gl,n.texture,function(n,r){e.image=r,e.texture=n,t&&t(),e.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),e}(no),Qo={normal:null,road:function(){var t=document.createElement("canvas");t.width=t.height=32;var e=t.getContext("2d");return e.save(),e.moveTo(0,0),e.lineTo(20,0),e.lineTo(32,16),e.lineTo(20,32),e.lineTo(0,32),e.lineTo(10,16),e.fillStyle="#fff",e.fill(),e.restore(),t}()},ta=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.initData(),t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:10,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",style:"normal",dashArray:[0,0],dashOffset:0}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),n=[];e.enablePicked&&n.push("PICK"),Qo[e.style]&&(this.isUseTexture=!0,n.push("USE_TEXTURE")),this.program=new Hi(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform int miter;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=zoomUnits*uDashArray/aTotalDistance;vTotalDistance=aTotalDistance;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float width=thickness*zoomUnits;vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;gl_Position=uMatrix*vec4(position.xy+normal*direction,position.z,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;\n#if defined(USE_TEXTURE)\nuniform float uTextureMargin;uniform sampler2D textureImage;\n#endif\nvoid main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}\n#if defined(USE_TEXTURE)\nfloat segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}",defines:n},this),this.prevBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),n=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}],n=n.concat(this.getCommonAttributes()),Qo[e.style]&&(n.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Qo[e.style]}),this.loadTexture()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:n})}},{key:"onChanged",value:function(t,e){var n=this;if(this.gl){this.initData();for(var r=t.color,i=[],o=0;o<e.length;o++){var a=[],s=e[o].geometry.coordinates;s&&0<s.length&&(a="Polygon"===e[o].geometry.type?s[0].map(function(t){return n.normizedPoint(t)}):s.map(function(t){return n.normizedPoint(t)})),s=e[o].color||r,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(s)&&(s=s(e[o])),s=this.normizedColor(s);for(var u=this.addMultipleCoords(a),l=0;l<u.length;l++)this.processData(this.dataMgr,u[l],s);if(t.enablePicked)for(s=this.indexToRgb(o),u=0;u<a.length;u++)i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),t.repeat&&(i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255),i.push(s[0]/255,s[1]/255,s[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(i))}}},{key:"processData",value:function(t,e,n){var r,i,o,a,s,u,l,h,c=e.length,f=t.position.length/6,p=It(e),d=p.arr,v=p.total;p=Ft(d.map(function(t){return[t,v]})),d=d.map(function(t){return[t,0,t,1]});var g=Ft(e.map(function(t){return-1}),!0),m=Ft(e),y=Ft(e.map(Bt(-1))),b=Ft(e.map(Bt(1)));e=Ft(e.map(function(t){return n})),c=Dt(c,f),(r=t.uv).push.apply(r,wi(zt(d))),(i=t.counter).push.apply(i,wi(zt(p))),(o=t.position).push.apply(o,wi(zt(m))),(a=t.prev).push.apply(a,wi(zt(y))),(s=t.next).push.apply(s,wi(zt(b))),(u=t.direction).push.apply(u,wi(g)),(l=t.color).push.apply(l,wi(zt(e))),(h=t.index).push.apply(h,wi(c))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=this.dataMgr;if(r&&!(0>=r.index.length)&&this.map){var i=this.getOptions(),o=this.program;o.use(e),t=Ke(this.getCommonUniforms(t),{uMatrix:n,uFlat:i.isFlat,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,miter:1,thickness:i.width,uDashArray:i.dashArray,uDashOffset:i.dashOffset,uAntialias:i.antialias}),this.isUseTexture&&(t=Ke(t,{uTextureMargin:140,textureImage:this.texture})),o.setUniforms(t),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),i.blend&&"lighter"===i.blend?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,r.index.length,e.UNSIGNED_INT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.disable(e.BLEND)}}},{key:"loadTexture",value:function(t){var e=this,n=this.getOptions();n.texture?C(this.gl,n.texture,function(n,r){e.image=r,e.texture=n,t&&t(),e.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),e}(no),ea=function(){function t(e,n){an(this,t),this.layer=e,this.gl=n,this.initData()}return fn(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var n=t.color,r=t.height,i=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||n,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),i||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(i?i[0]:s),s=this.layer.normizedColor(i?i[1]:s),l=e[o].height||r,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(n=[],r=this.outWall3d.vertex[e].length,i=0;i<r;i++)n.push.apply(n,wi(this.outWall3d.vertex[e][i]));r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=r,t.bindBuffer(t.ARRAY_BUFFER,null),r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=r,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,n,r,i){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;(!a||65536<=a.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t);for(var u=t=0;u<s;u++){var l=[],h=[],c=e[u];l.push(c[0],c[1]),l.push(c[2]?Number(c[2])+i:i),l.push(c[3]?Number(c[3]):u),l.push(t),l.push(n[0],n[1],n[2],n[3]),h.push(c[0],c[1]),h.push(c[2]?Number(c[2]):0),h.push(c[3]?Number(c[3]):u),h.push(t),h.push(r[0],r[1],r[2],r[3]),c=o.length,o.push(l,h),a.push(c,c+1),u<s-1&&(t+=this.getDistance(e[u],e[u+1]))}}},{key:"getDistance",value:function(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}}]),t}(),na=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new ea(this,this.gl),this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var r=this.getOptions(),i=this.program;for(e.useProgram(i.program),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aDistance),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,n),e.uniform1f(i.uniforms.currentTime,this.time),e.uniform1f(i.uniforms.trailLength,r.trailLength),n=0;n<t.vertex.length;n++)if(!(0>=t.vertex[n].length)){var o=t.vertex[n],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[n]),e.vertexAttribPointer(i.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aDistance,1,e.FLOAT,!1,o,4*a),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,5*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[n]),e.drawElements(e.TRIANGLE_STRIP,t.index[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),this.time+=r.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}}]),e}(no),ra=r(function(t,e){e.__esModule=!0;var n=ln&&ln.__esModule?ln:{default:ln};e.default=function(t,e,r){return e in t?(0,n.default)(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}}),ia=n(ra),oa=(Xo={},ia(Xo,1,1),ia(Xo,2,1),ia(Xo,3,1),Xo),aa=(Go={},ia(Go,1,1),ia(Go,2,1),ia(Go,3,1),Go),sa=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferMap={},t.bufferData=[],t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.updateUniformsFromOptions(e),this.program=new Hi(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;uniform float uSize;uniform mat4 u_matrix;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;varying float vAddOpacity;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float percent=mod(uElapsedSteps,aLength)/aLength;if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}gl_PointSize=uSize;}",fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;varying float vAddOpacity;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,e,n,r){var i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),n=new Float32Array(n),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),this.bufferMap[e]={buffer:i,data:n,elementSize:r}}},{key:"onChanged",value:function(t,e){var n=this.gl;if(n){Array.isArray(e)||(e=[]),this.updateUniformsFromOptions(t);var r=[],i=[],o=[],a=[],s=[];t=t.minLineLength;for(var u=0;u<e.length;u++){var l=e[u].geometry.coordinates,h=l.length;if(!(h<t)){for(var c=0;c<h;++c){var f=this.normizedPoint(l[c]);r.push(f[0]),r.push(f[1]),r.push(f[2]||0),3!==this.animationType&&(i.push(c),a.push(h))}if(1!==this.animationType){for(f=r.length-3*h+3,c=r.length,l=f;l<c;++l)s.push(r[l]);if(r.splice(c-3,3),2===this.animationType)i.pop(),a.pop();else if(3===this.animationType){f-=3,c=r.length-3,l=0,h=[];for(var p=f;p<=c;p+=3)f=Math.sqrt(Math.pow(s[p]-r[p],2)+Math.pow(s[p+1]-r[p+1],2)+Math.pow(s[p+2]-r[p+2],2)),l+=f,h.push(f);i.push(0),p=c=0;for(var d=h.length-1;p<d;++p)c+=h[p],f=c/l,i.push(f),o.push(f),a.push(l);o.push(1),a.push(l)}}}}this.bindAttributeBufferData(n,"aPos",r,3),this.bindAttributeBufferData(n,"aIndex",i,1),this.bindAttributeBufferData(n,"aLength",a,1),1!==this.animationType&&(this.bindAttributeBufferData(n,"aNextPos",s,3),3===this.animationType&&this.bindAttributeBufferData(n,"aNextIndex",o,1)),this.vertCount=r.length/3}}},{key:"updateUniformsFromOptions",value:function(t){this.color=this.normizedColor(t.color),this.startTime=(new Date).getTime(),oa[t.animationType]||(t.animationType=2),aa[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,e,n){if(void 0!==e.attributes[n]){var r=this.bufferMap[n];r&&(t.bindBuffer(t.ARRAY_BUFFER,r.buffer),t.enableVertexAttribArray(e.attributes[n]),t.vertexAttribPointer(e.attributes[n],r.elementSize,t.FLOAT,!1,r.data.BYTES_PER_ELEMENT*r.elementSize,0))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var n=this.program;e.useProgram(n.program),this.renderAttributeArr(e,n,"aPos"),this.renderAttributeArr(e,n,"aIndex"),this.renderAttributeArr(e,n,"aLength"),1!==this.animationType&&(this.renderAttributeArr(e,n,"aNextPos"),3===this.animationType&&this.renderAttributeArr(e,n,"aNextIndex"));var r=(new Date).getTime()-this.startTime;r=1===this.animationType?Math.round(r/1e3*this.options.speed*20):3===this.animationType?r/1e3*this.options.speed*1e3:r/1e3*this.options.speed,e.uniformMatrix4fv(n.uniforms.u_matrix,!1,t),e.uniform4f(n.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]),e.uniform1f(n.uniforms.uSize,this.options.size),e.uniform1f(n.uniforms.uElapsedSteps,r),e.uniform1i(n.uniforms.uAnimationType,this.animationType),e.uniform1i(n.uniforms.ushapeType,this.options.shapeType),e.uniform1i(n.uniforms.uPointFade,this.options.pointFade?1:0),e.uniform1f(n.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),t=this.options.blend,n=this.options.depthTest,e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),n||e.disable(e.DEPTH_TEST),e.drawArrays(e.POINTS,0,this.vertCount),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.useProgram(null)}}}]),e}(no);sa.ANIMATION_TYPE_LEAP=1,sa.ANIMATION_TYPE_SMOOTH=2,sa.ANIMATION_TYPE_UNIFORM_SPEED=3,sa.SHAPE_TYPE_SQUARE=1,sa.SHAPE_TYPE_CIRCLE=2,sa.SHAPE_TYPE_CIRCLE_GRADIENT=3;var ua=function(){function t(e,n){an(this,t),this.layer=e,this.gl=n,this.initData()}return fn(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(t,e){this.initData();for(var n=t.color,r=t.height,i=t.gradient,o=t.enablePreciseMap,a=this.gl,s=0;s<e.length;s++){for(var u=e[s].geometry.coordinates,l=u.length,h=[],c=[],f=0,p=0;p<l;p++){var d=this.layer.normizedPoint(u[p]);if(0<p&&o){var v=this.layer.normizedPoint(u[p-1]);f+=Math.sqrt(Math.pow(d[0]-v[0],2)+Math.pow(d[1]-v[1],2))}h.push(d),c.push(f)}l=e[s].color||n,"properties"in e[s]&&"color"in e[s].properties&&(l=e[s].properties.color),i||"[object Function]"!==Object.prototype.toString.call(l)||(l=l(e[s])),u=this.layer.normizedColor(i?i[0]:l),l=this.layer.normizedColor(i?i[1]:l),f=e[s].height||r,"properties"in e[s]&&"height"in e[s].properties&&(f=e[s].properties.height),"[object Function]"===Object.prototype.toString.call(f)&&(f=f(e[s])),this.processData(this.outWall3d,t,h,c,u,l,f)}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],n=this.outWall3d.vertex[t].length,r=0;r<n;r++)e.push.apply(e,wi(this.outWall3d.vertex[t][r]));n=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=n,a.bindBuffer(a.ARRAY_BUFFER,null),n=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),a.STATIC_DRAW),this.outWall3d.indexBuffer[t]=n,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,n,r,i,o,a){var s=r[r.length-1],u=t.vertex[t.vertex.length-1],l=t.index[t.index.length-1],h=n.length;for((!l||65536<=l.length+2*h+2)&&(u=[],l=[],t.vertex.push(u),t.index.push(l)),(t=u.length)&&l.push(t-1,t),t=0;t<h;t++){var c=[],f=[],p=n[t];c.push(p[0],p[1],a),c.push(i[0],i[1],i[2],i[3]),f.push(p[0],p[1],0),f.push(o[0],o[1],o[2],o[3]),e.texture&&(p=r[t],e.enablePreciseMap?(c.push(p/s,1),f.push(p/s,0)):(c.push(t/(h-1),1),f.push(t/(h-1),0))),p=u.length,u.push(c,f),l.push(p,p+1)}}}]),t}(),la=function(t){function e(t,n){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t,n))}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new ua(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,e){var n=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){n.loadTexture(function(){n.dataMgr.onLayerChange(t,e),n.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var r=this.getOptions(),i=this.program;if(e.useProgram(i.program),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),r.texture){if(!this.texture)return;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(i.uniforms.uSampler,0),e.depthMask(!0),e.depthFunc(e.LESS)}else e.depthMask(!1);for(r.texture?e.enableVertexAttribArray(i.attributes.aTextureCoords):e.disableVertexAttribArray(i.attributes.aTextureCoords),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,n),e.uniform1i(i.uniforms.uUseTexture,this.isUseTexture),n=0;n<t.vertex.length;n++)if(!(0>=t.vertex[n].length)){var o=t.vertex[n],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[n]),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,3*a),r.texture&&e.vertexAttribPointer(i.attributes.aTextureCoords,2,e.FLOAT,!1,o,7*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[n]),e.drawElements(e.TRIANGLE_STRIP,t.index[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),e.useProgram(null)}}},{key:"loadTexture",value:function(t){var e=this,n=this.getOptions();n.texture?(this.isUseTexture=!0,C(this.gl,n.texture,function(n,r){e.image=r,e.texture=n,t&&t(),e.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(no),ha=function(){function t(e,n){an(this,t),this.layer=e,this.gl=n,this.initData()}return fn(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var n=t.color,r=t.height,i=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||n,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),i||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(i?i[0]:s),s=this.layer.normizedColor(i?i[1]:s),l=e[o].height||r,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(n=[],r=this.outWall3d.vertex[e].length,i=0;i<r;i++)n.push.apply(n,wi(this.outWall3d.vertex[e][i]));r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=r,t.bindBuffer(t.ARRAY_BUFFER,null),r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=r,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,n,r,i){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;for((!a||65536<=a.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t),t=0;t<s;t++){var u=[],l=[],h=e[t];u.push(h[0],h[1]),u.push(h[2]?Number(h[2])+i:i),u.push(h[3]?Number(h[3]):t),u.push(n[0],n[1],n[2],n[3]),l.push(h[0],h[1]),l.push(h[2]?Number(h[2]):0),l.push(h[3]?Number(h[3]):t),l.push(r[0],r[1],r[2],r[3]),h=o.length,o.push(u,l),a.push(h,h+1)}}}]),t}(),ca=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new ha(this,this.gl),this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var r=this.getOptions(),i=this.program;for(e.useProgram(i.program),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,n),e.uniform1f(i.uniforms.currentTime,this.time),e.uniform1f(i.uniforms.trailLength,r.trailLength),n=0;n<t.vertex.length;n++)if(!(0>=t.vertex[n].length)){var o=t.vertex[n],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[n]),e.vertexAttribPointer(i.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,4*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[n]),e.drawElements(e.TRIANGLE_STRIP,t.index[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),this.time+=r.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}}]),e}(no),fa=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.simpleLineLayer=new Io(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),e=t.max,n=t.min;void 0===e&&(n=this.getDataRange(),e=n.max,n=n.min);var r=new w({max:e,min:n,gradient:t.gradient});return t.color=function(t){var e=~~t.count||1;return"properties"in t&&"count"in t.properties&&(e=~~t.properties.count),t=r.getImageData(e),[t[0]/255,t[1]/255,t[2]/255,t[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),e=0,n=0;t[0]&&(e=~~t[0].count||1,n=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(e=~~t[0].properties.count,n=~~t[0].properties.count);for(var r=t.length,i=0;i<r;i++){var o=~~t[i].count||1;"properties"in t[i]&&"count"in t[i].properties&&(o=~~t[i].properties.count),e=Math.max(o,e),n=Math.min(o,n)}return{max:e/2,min:n}}}]),e}(Bo),pa=r(function(t,e){!function(e,n){t.exports=function(){function t(n,r,i,o,a){for(;o>i;){if(600<o-i){var s=o-i+1,u=r-i+1,l=Math.log(s),h=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*h*(s-h)/s)*(0>u-s/2?-1:1),t(n,r,Math.max(i,Math.floor(r-u*h/s+l)),Math.min(o,Math.floor(r+(s-u)*h/s+l)),a)}for(s=n[r],u=i,h=o,e(n,i,r),0<a(n[o],s)&&e(n,i,o);u<h;){for(e(n,u,h),u++,h--;0>a(n[u],s);)u++;for(;0<a(n[h],s);)h--}0===a(n[i],s)?e(n,i,h):(h++,e(n,h,o)),h<=r&&(i=h+1),r<=h&&(o=h-1)}}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e){return t<e?-1:t>e?1:0}function r(t,e){i(t,0,t.children.length,e,t)}function i(t,e,n,r,i){for(i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;e<n;e++){var a=t.children[e];o(i,t.leaf?r(a):a)}return i}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(e,r,i,o,a){for(var s=[r,i];s.length;)if(i=s.pop(),r=s.pop(),!(i-r<=o)){var u=r+Math.ceil((i-r)/o/2)*o;t(e,u,r||0,i||e.length-1,a||n),s.push(r,u,u,i)}}var d=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return d.prototype.all=function(){return this._all(this.data,[])},d.prototype.search=function(t){var e=this.data,n=[];if(!c(t,e))return n;for(var r=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?r(a):a;c(t,s)&&(e.leaf?n.push(a):h(t,s)?this._all(a,n):i.push(a))}e=i.pop()}return n},d.prototype.collides=function(t){var e=this.data;if(!c(t,e))return!1;for(var n=[];e;){for(var r=0;r<e.children.length;r++){var i=e.children[r],o=e.leaf?this.toBBox(i):i;if(c(t,o)){if(e.leaf||h(t,o))return!0;n.push(i)}}e=n.pop()}return!1},d.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}return t=this._build(t.slice(),0,t.length-1,0),this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(e=this.data,this.data=t,t=e),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this},d.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},d.prototype.clear=function(){return this.data=f([]),this},d.prototype.remove=function(t,e){if(!t)return this;for(var n,r,i,o=this.data,a=this.toBBox(t),s=[],u=[];o||s.length;){if(o||(o=s.pop(),r=s[s.length-1],n=u.pop(),i=!0),o.leaf){t:{var l=t,c=o.children,f=e;if(f){for(var p=0;p<c.length;p++)if(f(l,c[p])){l=p;break t}l=-1}else l=c.indexOf(l)}if(-1!==l){o.children.splice(l,1),s.push(o),this._condense(s);break}}i||o.leaf||!h(o,a)?r?(n++,o=r.children[n],i=!1):o=null:(s.push(o),u.push(n),n=0,r=o,o=o.children[0])}return this},d.prototype.toBBox=function(t){return t},d.prototype.compareMinX=function(t,e){return t.minX-e.minX},d.prototype.compareMinY=function(t,e){return t.minY-e.minY},d.prototype.toJSON=function(){return this.data},d.prototype.fromJSON=function(t){return this.data=t,this},d.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},d.prototype._build=function(t,e,n,i){var o=n-e+1,a=this._maxEntries;if(o<=a){var s=f(t.slice(e,n+1));return r(s,this.toBBox),s}for(i||(i=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,i-1))),s=f([]),s.leaf=!1,s.height=i,o=Math.ceil(o/a),a=o*Math.ceil(Math.sqrt(a)),p(t,e,n,a,this.compareMinX);e<=n;e+=a){var u=Math.min(e+a-1,n);p(t,e,u,o,this.compareMinY);for(var l=e;l<=u;l+=o)s.children.push(this._build(t,l,Math.min(l+o-1,u),i-1))}return r(s,this.toBBox),s},d.prototype._chooseSubtree=function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],h=u(l),c=(Math.max(l.maxX,t.maxX)-Math.min(l.minX,t.minX))*(Math.max(l.maxY,t.maxY)-Math.min(l.minY,t.minY))-h;c<o?(o=c,i=h<i?h:i,a=l):c===o&&h<i&&(i=h,a=l)}e=a||e.children[0]}return e},d.prototype._insert=function(t,e,n){n=n?t:this.toBBox(t);var r=[],i=this._chooseSubtree(n,this.data,e,r);for(i.children.push(t),o(i,n);0<=e&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},d.prototype._split=function(t,e){var n=t[e],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i),i=this._chooseSplitIndex(n,o,i),i=f(n.children.splice(i,n.children.length-i)),i.height=n.height,i.leaf=n.leaf,r(n,this.toBBox),r(i,this.toBBox),e?t[e-1].children.push(i):this._splitRoot(n,i)},d.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},d.prototype._chooseSplitIndex=function(t,e,n){for(var r,o=1/0,a=1/0,s=e;s<=n-e;s++){var l=i(t,0,s,this.toBBox),h=i(t,s,n,this.toBBox),c=Math.max(0,Math.min(l.maxX,h.maxX)-Math.max(l.minX,h.minX))*Math.max(0,Math.min(l.maxY,h.maxY)-Math.max(l.minY,h.minY));l=u(l)+u(h),c<o?(o=c,r=s,a=l<a?l:a):c===o&&l<a&&(a=l,r=s)}return r||n-e},d.prototype._chooseSplitAxis=function(t,e,n){var r=t.leaf?this.compareMinX:a,i=t.leaf?this.compareMinY:s,o=this._allDistMargin(t,e,n,r);e=this._allDistMargin(t,e,n,i),o<e&&t.children.sort(r)},d.prototype._allDistMargin=function(t,e,n,r){t.children.sort(r),r=this.toBBox;for(var a=i(t,0,e,r),s=i(t,n-e,n,r),u=l(a)+l(s),h=e;h<n-e;h++){var c=t.children[h];o(a,t.leaf?r(c):c),u+=l(a)}for(n=n-e-1;n>=e;n--)a=t.children[n],o(s,t.leaf?r(a):a),u+=l(s);return u},d.prototype._adjustParentBBoxes=function(t,e,n){for(;0<=n;n--)o(e[n],t)},d.prototype._condense=function(t){for(var e,n=t.length-1;0<=n;n--)0===t[n].children.length?0<n?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():r(t[n],this.toBBox)},d}()}()}),da=window.devicePixelRatio,va=Math.max(2,da),ga=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),n=t.canvas=document.createElement("canvas"),n=t.ctx=n.getContext("2d"),n.textAlign="start",n.textBaseline="top",t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,isFlat:!1,collides:!0,offset:[0,0],padding:[2,2],margin:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Hi(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform float zoomUnits;uniform float devicePixelRatio;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x-=size[0];y+=size[1];}else if(corner==2.0){x+=size[0];y+=size[1];}else if(corner==3.0){x+=size[0];y-=size[1];}else{x-=size[0];y-=size[1];}return vec3(x,y,coord.z);}void main(){vec2 pixelOffset=offset*zoomUnits;vTextCoord=aTextCoord;if(uFlat){vec2 halfSize=size/2.0*zoomUnits;vec3 current=transformCoord(position,halfSize,corner);gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y+pixelOffset[1],current.z,1.0);}else{vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y+pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(e)}},{key:"processCache",value:function(t){this.cachedData=[];for(var e=0;e<t.length;e++){var n=this.normizedPoint(t[e].geometry.coordinates),r=t[e].text;"properties"in t[e]&&"text"in t[e].properties&&(r=t[e].properties.text),n&&void 0!==r&&this.cachedData.push({point:n,text:r})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,n=t.matrix,r=this.getOptions(),i=this.program;i.use(e),this.updateText(t),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.disable(e.DEPTH_TEST);var o=this.map.getZoomUnits();i.setUniforms(Ke(this.getCommonUniforms(t),{matrix:n,devicePixelRatio:da,textureImage:this.texture,uFlat:r.isFlat,offset:r.offset,zoomUnits:o})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)),e.useProgram(null)}}},{key:"updateText",value:function(t){var e=t.gl,n=t.matrix,r=this.getOptions(),i=r.color,o=r.fontSize,a=r.fontFamily;t=r.padding;var s=r.margin,u=r.collides;r=r.enablePicked;var l=e.canvas.width,h=e.canvas.height,c=this.canvas;e=this.ctx,e.save(),e.scale(va,va),e.textBaseline="top",e.font=o+"px "+a;for(var f=new pa,p=[],v=0;v<this.cachedData.length;v++){var g=this.cachedData[v],m=g.point;g=g.text;var y=ci(m,3);y=vo.clone([y[0],y[1],y[2],1]),vo.transformMat4(y,y,n),vo.scale(y,y,1/y[3]);var b=(y[0]+1)/2*l,x=(1-y[1])/2*h,_=e.measureText(g);y=_.width+t[0],_=_.actualBoundingBoxAscent&&_.actualBoundingBoxDescent?_.actualBoundingBoxDescent-_.actualBoundingBoxAscent:o+t[1],_+=t[1];var w=y+s[0],M=_+s[1];if(b-=w/2*da,x-=M/2*da,w=b+w*da,M=x+M*da,!(0>w||0>M||b>l||x>h)){if(u){if(M={minX:b,maxX:w,minY:x,maxY:M},f.collides(M))continue;f.insert(M)}p.push({w:y,h:_,point:m,text:g,dataIndex:v})}}for(e.restore(),s=Ut(p),n=d(s.w),s=d(s.h),c.width=n*va,c.height=s*va,e.save(),e.scale(va,va),e.textBaseline="top",e.fillStyle=i,e.font=o+"px "+a,i=[],o=[],a=[],c=[],u=0,l=p.length;u<l;++u){for(h=p[u],e.fillText(h.text,h.x+t[0],h.y+t[1]),m=ci(h.point,3),f=m[0],v=m[1],m=m[2],g=0;4>g;g++)i.push(f,v,m),i.push(g),i.push(h.w,h.h);f=h.x/n,v=(h.x+h.w)/n,m=(h.y+h.h)/s,g=h.y/s,o.push(f,m,f,g,v,g,v,m),f=4*u,a.push(f,f+2,f+1,f,f+3,f+2),r&&(h=this.indexToRgb(h.dataIndex),c.push(h[0]/255,h[1]/255,h[2]/255),c.push(h[0]/255,h[1]/255,h[2]/255),c.push(h[0]/255,h[1]/255,h[2]/255),c.push(h[0]/255,h[1]/255,h[2]/255))}e.restore(),this.loadTexture(),this.index=a,this.vertexBuffer.updateData(new Float32Array(i)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(a)),r&&this.pickBuffer.updateData(new Float32Array(c))}},{key:"loadTexture",value:function(){var t=this;this.canvas?C(this.gl,this.canvas,function(e){t.texture=e}):this.texture=null}}]),e}(no),ma=r(function(t,e){!function(e,n){t.exports=function(){function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){for(;a>o;){if(600<a-o){var u=a-o+1,l=i-o+1,h=Math.log(u),c=.5*Math.exp(2*h/3);h=.5*Math.sqrt(h*c*(u-c)/u)*(0>l-u/2?-1:1),e(t,r,i,Math.max(o,Math.floor(i-l*c/u+h)),Math.min(a,Math.floor(i+(u-l)*c/u+h)),s)}for(u=r[2*i+s],l=o,c=a,n(t,r,o,i),r[2*a+s]>u&&n(t,r,o,a);l<c;){for(n(t,r,l,c),l++,c--;r[2*l+s]<u;)l++;for(;r[2*c+s]>u;)c--}r[2*o+s]===u?n(t,r,o,c):(c++,n(t,r,c,a)),c<=i&&(o=c+1),i<=c&&(a=c-1)}}function n(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e){return t=t.geometry.coordinates,{x:t[0]/360+.5,y:s(t[1]),zoom:1/0,index:e,parentId:-1}}function o(t){return{type:"Feature",id:t.id,properties:a(t),geometry:{type:"Point",coordinates:[360*(t.x-.5),360*Math.atan(Math.exp((180-360*t.y)*Math.PI/180))/Math.PI-90]}}}function a(t){var e=t.numPoints,n=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return u(u({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function s(t){return t=Math.sin(t*Math.PI/180),t=.5-.25*Math.log((1+t)/(1-t))/Math.PI,0>t?0:1<t?1:t}function u(t,e){for(var n in e)t[n]=e[n];return t}function l(t){return t.x}function h(t){return t.y}var c=function(t){return t[0]},f=function(t){return t[1]},p=function(e,n,r,i,o){void 0===n&&(n=c),void 0===r&&(r=f),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;var a=this.ids=new(65536>e.length?Uint16Array:Uint32Array)(e.length);o=this.coords=new o(2*e.length);for(var s=0;s<e.length;s++)a[s]=s,o[2*s]=n(e[s]),o[2*s+1]=r(e[s]);t(a,o,i,0,a.length-1,0)};p.prototype.range=function(t,e,n,r){for(var i,o,a=this.ids,s=this.coords,u=this.nodeSize,l=[0,a.length-1,0],h=[];l.length;){var c=l.pop(),f=l.pop(),p=l.pop();if(f-p<=u)for(c=p;c<=f;c++)i=s[2*c],o=s[2*c+1],i>=t&&i<=n&&o>=e&&o<=r&&h.push(a[c]);else{var d=Math.floor((p+f)/2);i=s[2*d],o=s[2*d+1],i>=t&&i<=n&&o>=e&&o<=r&&h.push(a[d]);var v=(c+1)%2;(0===c?t<=i:e<=o)&&(l.push(p),l.push(d-1),l.push(v)),(0===c?n>=i:r>=o)&&(l.push(d+1),l.push(f),l.push(v))}}return h},p.prototype.within=function(t,e,n){for(var r=this.ids,i=this.coords,o=this.nodeSize,a=[0,r.length-1,0],s=[],u=n*n;a.length;){var l=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(l=c;l<=h;l++){c=i[2*l]-t;var f=i[2*l+1]-e;c*c+f*f<=u&&s.push(r[l])}else{f=Math.floor((c+h)/2);var p=i[2*f],d=i[2*f+1],v=p-t,g=d-e;v*v+g*g<=u&&s.push(r[f]),v=(l+1)%2,(0===l?t-n<=p:e-n<=d)&&(a.push(c),a.push(f-1),a.push(v)),(0===l?t+n>=p:e+n>=d)&&(a.push(f+1),a.push(h),a.push(v))}}return s};var d={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},v=function(t){this.options=u(Jr(d),t),this.trees=Array(this.options.maxZoom+1)};return v.prototype.load=function(t){var e=this.options,n=e.minZoom,r=e.maxZoom;e=e.nodeSize,this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(i(t[a],a));for(this.trees[r+1]=new p(o,l,h,e,Float32Array),t=r;t>=n;t--)o=this._cluster(o,t),this.trees[t]=new p(o,l,h,e,Float32Array);return this},v.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])n=-180,i=180;else if(n>i)return n=this.getClusters([n,r,180,a],e),r=this.getClusters([-180,r,i,a],e),n.concat(r);e=this.trees[this._limitZoom(e)],t=[];var u=0;for(r=e.range(n/360+.5,s(a),i/360+.5,s(r));u<r.length;u+=1)i=e.points[r[u]],t.push(i.numPoints?o(i):this.points[i.index]);return t},v.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r=this.trees[n];if(!r)throw Error("No cluster with the specified id.");var i=r.points[e];if(!i)throw Error("No cluster with the specified id.");e=[];var a=0;for(n=r.within(i.x,i.y,this.options.radius/(this.options.extent*Math.pow(2,n-1)));a<n.length;a+=1)i=r.points[n[a]],i.parentId===t&&e.push(i.numPoints?o(i):this.points[i.index]);if(0===e.length)throw Error("No cluster with the specified id.");return e},v.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e||10,n||0,0),r},v.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)];t=Math.pow(2,t);var i=this.options;i=i.radius/i.extent;var o=(n-i)/t,a=(n+1+i)/t,s={features:[]};return this._addTileFeatures(r.range((e-i)/t,o,(e+1+i)/t,a),r.points,e,n,t,s),0===e&&this._addTileFeatures(r.range(1-i/t,o,1,a),r.points,t,n,t,s),e===t-1&&this._addTileFeatures(r.range(0,o,i/t,a),r.points,-1,n,t,s),s.features.length?s:null},v.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom&&(t=this.getChildren(t),e++,1===t.length);)t=t[0].properties.cluster_id;return e},v.prototype._appendLeaves=function(t,e,n,r,i){var o=0;for(e=this.getChildren(e);o<e.length;o+=1){var a=e[o],s=a.properties;if(s&&s.cluster?i=i+s.point_count<=r?i+s.point_count:this._appendLeaves(t,s.cluster_id,n,r,i):i<r?i++:t.push(a),t.length===n)break}return i},v.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var s=0;s<t.length;s+=1){var u=e[t[s]],l=u.numPoints,h={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?a(u):this.points[u.index].properties},c=void 0;l?c=u.id:this.options.generateId?c=u.index:this.points[u.index].id&&(c=this.points[u.index].id),void 0!==c&&(h.id=c),o.features.push(h)}},v.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},v.prototype._cluster=function(t,e){var n=[],r=this.options,i=r.reduce;r=r.radius/(r.extent*Math.pow(2,e));for(var o=0;o<t.length;o++){var a=t[o];if(!(a.zoom<=e)){a.zoom=e;for(var s=this.trees[e+1],u=s.within(a.x,a.y,r),l=a.numPoints||1,h=a.x*l,c=a.y*l,f=i&&1<l?this._map(a,!0):null,p=(o<<5)+(e+1)+this.points.length,d=0;d<u.length;d+=1){var v=s.points[u[d]];if(!(v.zoom<=e)){v.zoom=e;var g=v.numPoints||1;h+=v.x*g,c+=v.y*g,l+=g,v.parentId=p,i&&(f||(f=this._map(a,!0)),i(f,this._map(v)))}}1===l?n.push(a):(a.parentId=p,n.push({x:h/l,y:c/l,zoom:1/0,id:p,parentId:-1,numPoints:l,properties:f}))}}return n},v.prototype._getOriginId=function(t){return t-this.points.length>>5},v.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},v.prototype._map=function(t,e){if(t.numPoints)return e?u({},t.properties):t.properties;t=this.points[t.index].properties;var n=this.options.map(t);return e&&n===t?u({},n):n},v}()}()}),ya=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.shapeLayer=new Fo(t.options),t.textLayer=new ga(t.options.textOptions),t.children=[t.shapeLayer,t.textLayer],t.max=[],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&Ke(e,t.textOptions);var n=t.minZoom,r=t.maxZoom,i=t.size;n=r&&r!==this.options.maxZoom||n&&n!==this.options.minZoom||i&&i!==this.options.size,Ke(this.options,t,{textOptions:e}),n?this.onChanged(this.options,this.data):this.refreshLayer(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){if(e&&e.length){this.zoom=Math.floor(this.map.map.getZoom());var n=t.maxZoom,r=t.minZoom,i=t.enableCluster;t=t.size,this.zoom>n?this.zoom=n:this.zoom<r&&(this.zoom=r),i&&(this.supercluster=new ma({maxZoom:n,minZoom:r,radius:t/2}),this.supercluster.load(e)),this.refreshLayer()}}},{key:"refreshLayer",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data,n=this.map.map,r=this.zoom;if(t.enableCluster&&this.supercluster&&(e=this.getClusterData(t)),e&&e.length){var i=t.gradient,o=t.showText,a=t.textOptions,s=t.height,u=t.size;u*=Math.pow(2,18-r),e=jt(e,u,function(t){var e=ci(t,2),r=e[0];return e=e[1],-180<=r&&180>=r&&-90<=e&&90>=e&&(e=n.lnglatToMercator(r,e),r=e[0],e=e[1]),t[0]=r,t[1]=e,t}),this.max[r]=Math.max(this.max[r]||0,e.max);var l=new w({max:this.max[r],min:0,maxSize:s*Math.pow(2,18-r),minSize:0,gradient:i});if(i=[],o){var h=a&&a.format;h="function"==typeof h?h:null,i=e.map(function(t){return{geometry:{coordinates:[t.center.x,t.center.y,l.getSize(t.count)+a.fontSize/2*Math.pow(2,18-r)]},text:h?h(t.count):t.count}})}this.textLayer.setData(i),o=e.map(function(t){for(var n=t.center,r=e.r,i=[],o=0;6>o;o++)i.push(Nt({x:n.x,y:n.y},r,o));return{geometry:{type:"Polygon",coordinates:[i]},properties:{height:l.getSize(t.count),color:l.getColor(t.count)}}}),this.shapeLayer.setData(o),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var t=this.map.map,e=t.getBounds(),n=e.ne;e=e.sw,this.ne=n,this.sw=e;var r=n,i=r.lng;r=r.lat;var o=[];return-180<=i&&180>=i&&-90<=r&&90>=r?o=[e.lng,e.lat,n.lng,n.lat]:(n=t.mercatorToLnglat(this.ne.lng,this.ne.lat),e=t.mercatorToLnglat(this.sw.lng,this.sw.lat),o=e.concat(n)),this.supercluster.getClusters(o,this.zoom).map(function(t){var e=0;return t.properties&&t.properties.point_count&&(e=t.properties.point_count),{geometry:t.geometry,count:e}})}},{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map.map,e=Math.floor(t.getZoom()),n=this.options,r=n.maxZoom;return n=n.minZoom,e>r?e=r:e<n&&(e=n),this.zoom!==e?(this.zoom=e,!0):!!this.options.enableCluster&&(e=t.getBounds(),t=e.ne,e=e.sw,!!(t&&e&&this.ne&&this.sw)&&(this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat||void 0))}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshLayer():Vr(e.prototype.__proto__||rn(e.prototype),"render",this).call(this,t)}}]),e}(Bo),ba=function(){function t(e,n){an(this,t),this.map=e,this.options=n||{}}return fn(t,[{key:"onResize",value:function(t){}},{key:"onUpdate",value:function(t){throw"未实现onUpdate方法"}},{key:"getContainer",value:function(){throw"未实现getContainer方法"}},{key:"getSize",value:function(){throw"未实现getSize方法"}},{key:"getTilt",value:function(){throw"未实现getTilt方法"}},{key:"getHeading",value:function(){throw"未实现getHeading方法"}},{key:"getZoomUnits",value:function(){throw"未实现getZoomUnits方法"}},{key:"getCenter",value:function(){throw"未实现getCenter方法"}},{key:"getMapType",value:function(){throw"未实现getMapType方法"}},{key:"lnglatToMercator",value:function(t,e){return"gcj02"===this.options.coordinateSystem?(e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]):(t=m.convertLL2MC({lng:t,lat:e}),[t.lng,t.lat])}}]),t}(),xa=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t)}},{key:"onMousemove",value:function(t){this.map.addEventListener("mousemove",function(e){t(Ke(e,{x:e.x,y:e.y}))})}},{key:"onClick",value:function(t){this.map.addEventListener("click",function(e){t(Ke(e,{x:e.x,y:e.y}))})}},{key:"onDblClick",value:function(t){this.map.addEventListener("dblclick",function(e){t(Ke(e,{x:e.x,y:e.y}))})}},{key:"onRightClick",value:function(t){this.map.addEventListener("rightclick",function(e){t(Ke(e,{x:e.x,y:e.y}))})}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t=this.map.lnglatToMercator(t.lng,t.lat),t={lng:t[0],lat:t[1]}),t}},{key:"getMapType",value:function(){return this.map.getMapType()}},{key:"lnglatToMercator",value:function(t,e){return this.map.lnglatToMercator(t,e)}}]),e}(ba),_a=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t}return $r(e,t),fn(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t)}},{key:"onMousemove",value:function(t){this.map.addEventListener("mousemove",function(e){t(Ke(e,{x:e.pixel.x,y:e.pixel.y}))})}},{key:"onClick",value:function(t){this.map.addEventListener("click",function(e){t(Ke(e,{x:e.pixel.x,y:e.pixel.y}))})}},{key:"onDblClick",value:function(t){this.map.addEventListener("dblclick",function(e){t(Ke(e,{x:e.pixel.x,y:e.pixel.y}))})}},{key:"onRightClick",value:function(t){this.map.addEventListener("rightclick",function(e){t(Ke(e,{x:e.pixel.x,y:e.pixel.y}))})}},{key:"changeCanvas",value:function(){var t=this.map,e=t.getSize(),n=t.getCenter();t=t.pointToOverlayPixel(n),this.div.style.left=t.x-e.width/2+"px",this.div.style.top=t.y-e.height/2+"px"}},{key:"onUpdate",value:function(t){var e=this;this.map.addEventListener("moveend",function(){e.changeCanvas(),t()}),this.map.addEventListener("moving",function(){e.changeCanvas(),t()}),this.map.addEventListener("zoomend",function(){e.changeCanvas(),t()})}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}}]),e}(ba),wa=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]),{lng:t[0],lat:t[1]}}},{key:"getMercator",value:function(t){var e=[];return e[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,e[1]=3189068.5*Math.log((1+Math.sin(t))/(1-Math.sin(t))),e}}]),e}(ba),Ma=function(t){function e(t){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t))}return $r(e,t),fn(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(ba),Ta=function(t){function e(t,n){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t,n))}return $r(e,t),fn(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(ba),Aa=function(){function t(e,n){an(this,t),n=n||{},"bmap"===n.mapType?this.map=new _a(e,n):"blank"===n.mapType?this.map=new Ma(e,n):"cesium"===n.mapType?this.map=new wa(e,n):"three"===n.mapType?this.map=new Ta(e,n):(n.mapType="bmapgl",this.map=new xa(e,n)),this.map.type=n.mapType,this.options=n||{},this.renderArr=[],(e=n.canvas)||(e=document.createElement("canvas")),this.canvas=e,this.gl=n.gl?n.gl:P(e),this.gl.getExtension("OES_element_index_uint"),this.changeSize(),this.projectionMatrix=xo.create(Float64Array),this.orthoMatrix=xo.create(Float64Array),this.matrix=xo.create(Float64Array),this.viewMatrix=xo.create(Float64Array),this.pointToPixelMatrix=xo.create(Float64Array),this.pixelToViewMatrix=xo.create(Float64Array),this.fovy=35,this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.stateManager=new Wi({gl:this.gl}),this.pickFBO=new Gi(this.gl),this.transferOptions={},this.bind()}return fn(t,[{key:"bind",value:function(){var t=this,e=this.map;e.onResize(function(){t.changeSize(),t.render()}),e.onUpdate(this._update),e.onClick&&e.onClick(function(e){t.onClick&&t.onClick(e)}),e.onDblClick&&e.onDblClick(function(e){t.onDblClick&&t.onDblClick(e)}),e.onRightClick&&e.onRightClick(function(e){t.onRightClick&&t.onRightClick(e)}),e.onMousemove&&e.onMousemove(function(e){t.onMousemove&&t.onMousemove(e)}),this.options.canvas||e.getContainer().appendChild(this.canvas)}},{key:"setOptions",value:function(t){this.options=t}},{key:"onInitialize",value:function(t){t&&(this.transferOptions=t.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(t){var e=this.gl;t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var t=this.gl;this.preFramebuffer=t.getParameter(t.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(t){this.renderArr.push(t)}},{key:"changeSize",value:function(){var t=this.canvas;if(t){var e=t.style,n=this.map.getSize(),r=window.devicePixelRatio;t.width=n.width*r,t.height=n.height*r,e.cssText="position: absolute;left:0;top:0;width:"+n.width+"px;height:"+n.height+"px;z-index:2;",n=this.options,"cesium"!==n.mapType||n.canvas||(e.pointerEvents="none"),this.gl.viewport(0,0,t.width,t.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var t=this.options,e=this.projectionMatrix,n=this.viewMatrix;if("three"===t.mapType)n=this.map.map.camera,e=n.projectionMatrix.elements,n=n.matrixWorldInverse.elements;else if("cesium"===t.mapType){n=this.map.map;var r=n.camera.frustum.projectionMatrix;e=new Float32Array([r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]]),r=n.camera.viewMatrix,n=new Float32Array([r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]])}else"B_EARTH_MAP"===this.map.map.mapType?(e=this.map.map.getEarth().scene._camera.getProjectionMatrix(),n=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());for(r=xo.multiply(this.matrix,e,n),Ke(this.transferOptions,{gl:this.gl,matrix:r,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:e,orthoMatrix:this.orthoMatrix,viewMatrix:n,stateManager:this.stateManager}),"three"!==t.mapType&&"cesium"!==t.mapType&&!1!==t.autoUpdate&&this.clear(),t=0;t<this.renderArr.length;t++)this.renderArr[t]&&this.renderArr[t].bind(this)(this.transferOptions)}}},{key:"clear",value:function(t){var e=this.gl,n=this.options.clearColor||[0,0,0,0];e.clearColor(n[0],n[1],n[2],n[3]),t&&(t instanceof Array||(t=s(t).unitArray()),e.clearColor(t[0],t[1],t[2],t[3])),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var t=this.gl.canvas.width/this.gl.canvas.height,e=this.options.cameraNear||1,n=this.options.cameraFar||4e3;xo.perspective(this.projectionMatrix,f(this.fovy),t,e,n),t=this.map.getSize(),xo.ortho(this.orthoMatrix,-t.width/2,t.width/2,-t.height/2,t.height/2,e,n)}},{key:"updateModelViewMatrix",value:function(){var t=this.map,e=this.viewMatrix,n=this.pointToPixelMatrix,r=this.pixelToViewMatrix;xo.identity(e),xo.identity(n),xo.identity(r);var i=t.getSize();i=Math.round(-i.height/(2*Math.tan(f(this.fovy)/2))),xo.translate(r,r,[0,0,i]),xo.rotate(r,r,f(t.getTilt()),[-1,0,0]),xo.rotate(r,r,f(t.getHeading()),[0,0,-1]),i=t.getCenter();var o=this.options.pointOffset||[0,0];t=t.getZoomUnits(),xo.translate(n,n,[(o[0]-i.lng)/t,(o[1]-i.lat)/t,0]),t=1/t,xo.scale(n,n,[t,t,t]),xo.multiply(e,r,n)}},{key:"destroy",value:function(){this.stopAnimation(),this.map.getContainer().removeChild(this.canvas),this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),t}(),Ea={circle:1,square:2},Pa=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.bufferData=[],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Hi(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;varying vec4 vColor;uniform vec4 uSelectedColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;uniform int uShape;void main(void){vec4 color=vColor;if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}else{gl_FragColor=color;}}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){if(this.gl){for(var n=[],r=t.color,i=t.size,o=0;o<e.length;o++){var a=this.normizedPoint(e[o].geometry.coordinates),s=e[o].color||r;"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(s)&&(s=s(e[o])),s=this.normizedColor(s);var u=e[o].size||i;"properties"in e[o]&&"size"in e[o].properties&&(u=e[o].properties.size),u="[object Function]"===Object.prototype.toString.call(u)?u(e[o]):Number(u),a=this.addMultipleCoords(a);for(var l=0;l<a.length;l++){var h=a[l];n.push(h[0],h[1],Number(h[2]||0)),n.push(s[0],s[1],s[2],s[3]),n.push(u*window.devicePixelRatio)}}this.bufferData=n,this.buffer.updateData(new Float32Array(n)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),n=[];if(e.enablePicked)for(var r=0;r<t.length;r++){var i=this.indexToRgb(r);n.push(i[0]/255,i[1]/255,i[2]/255),e.repeat&&(n.push(i[0]/255,i[1]/255,i[2]/255),n.push(i[0]/255,i[1]/255,i[2]/255))}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(n))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=t.isPickRender;if(!(0>=this.bufferData.length)){this.getOptions();var i=this.program;i.use(e),this.vertexArray.bind();var o=1;this.options.shape&&Ea[this.options.shape]&&(o=Ea[this.options.shape]),t=this.getCommonUniforms(t),t=Ke(t,{uShape:o,uMatrix:n}),i.setUniforms(t),n=this.options.blend,r?e.disable(e.BLEND):(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),n&&"lighter"===n?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),e}(no),Sa=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(t,e){var n=this.gl;if(n&&(this.currentScale=this.opacity=1,(this.data=e)&&e.length)){var r=t.color,i=t.segs;t=t.size;for(var o=360/i,a=0;a<e.length;a++){var s=[],u=[],l=this.normizedPoint(e[a].geometry.coordinates),h=e[a].color||r;"properties"in e[a]&&"color"in e[a].properties&&(h=e[a].properties.color),h=this.normizedColor(h);var c="[object Function]"===Object.prototype.toString.call(t)?t(e[a]):Number(t),f=l[0],p=l[1];s.push(0,0,-.5),s.push(h[0],h[1],h[2],0);for(var d=1,v=0;d<=i;d++,v+=o)s.push(l[0]-f+Math.cos(Math.PI/180*v)*c,l[1]-p+Math.sin(Math.PI/180*v)*c,-.5),s.push(h[0],h[1],h[2],this.opacity),d===i?u.push(0,0+d,1):u.push(0,0+d,0+d+1);h=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,h),n.bufferData(n.ARRAY_BUFFER,new Float32Array(s),n.STATIC_DRAW),this.vertexBuffer[a]=h,this.bufferDataArr[a]=s,n.bindBuffer(n.ARRAY_BUFFER,null),s=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),n.STATIC_DRAW),this.indexBuffer[a]=s,this.indexDataArr[a]=u,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.position[a]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,n=t.projectionMatrix,r=t.viewMatrix;for(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,n),e.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,r),n=this.opacity,void 0!==this.options.opacity&&(n=this.options.opacity),e.uniform1f(t.uniforms.u_opacity,n),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA),e.blendEquation(e.FUNC_ADD),e.enableVertexAttribArray(t.attributes.aPos),e.enableVertexAttribArray(t.attributes.aColor),n=0;n<this.bufferDataArr.length;n++)if(!(0>=this.bufferDataArr[n].length)){r=new Float32Array(this.bufferDataArr[n]).BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer[n]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,7*r,3*r),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,7*r,0),r=this.position[n];var i=xo.create(),o=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(o=this.map.getZoomUnits(),o=[this.currentScale*o,this.currentScale*o,this.currentScale]),xo.identity(i),xo.translate(i,i,[r[0],r[1],0]),xo.scale(i,i,o),e.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,i),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer[n]),e.drawElements(e.TRIANGLES,this.indexDataArr[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),n=this.getOptions(),t=n.scale,n=n.step,this.opacity-=n/10,this.currentScale+=t*n,0>this.opacity&&(this.currentScale=this.opacity=1),e.useProgram(null)}}]),e}(no),Ca=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.bufferData=[],t.date=new Date,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Hi(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){if(this.gl){for(var n=[],r=t.color,i=t.size,o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=e[o].color||r;"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(s)&&(s=s(e[o])),s=this.normizedColor(s),a=this.normizedPoint(a);var u=e[o].size||i;"properties"in e[o]&&"size"in e[o].properties&&(u=e[o].properties.size),u="[object Function]"===Object.prototype.toString.call(u)?u(e[o]):Number(u),n.push(a[0],a[1],Number(a[2]||0)),n.push(s[0],s[1],s[2],s[3]),n.push(u*window.devicePixelRatio)}this.bufferData=n,this.buffer.updateData(new Float32Array(n)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),n=[];if(e.enablePicked)for(var r=0;r<t.length;r++){var i=this.indexToRgb(r);n.push(i[0]/255,i[1]/255,i[2]/255)}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(n))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=t.isPickRender;if(!(0>=this.bufferData.length)){var i=this.getOptions(),o=this.program;o.use(e),this.vertexArray.bind(),t=this.getCommonUniforms(t);var a=1;"m"===i.unit&&this.map&&(a=this.map.getZoomUnits()),t=Ke(t,{zoomUnits:a,uTime:(new Date-this.date)/1e3,duration:i.duration,uMatrix:n}),o.setUniforms(t),n=this.options.blend,r?e.disable(e.BLEND):(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),n&&"lighter"===n?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),e}(no),La=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t.startTime=Number(t.options.startTime)||0,t.endTime=Number(t.options.endTime),t.time=t.startTime,t.segs=Number(t.options.segs)||10,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new Hi(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var n=this.gl;if(n){this.buffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.buffer);for(var r=[],i=t.height,o=0;o<e.length;o++)for(var a=e[o].geometry.coordinates,s="[object Function]"===Object.prototype.toString.call(i)?i(e[o]):Number(i),u=0,l=0;l<this.segs;l++){var h=this.normizedPoint(a);r.push(h[0],h[1],u),void 0===a[2]?r.push(l):r.push(Number(a[2])),u+=s/this.segs,r.push(h[0],h[1],u),void 0===a[2]?r.push(l+1):r.push(Number(a[2]))}void 0===t.endTime&&(this.endTime=this.segs),this.bufferData=r,n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,n),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,0,0),n=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,n[0],n[1],n[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),e.enable(e.BLEND),e.polygonOffset(2,1),e.blendFunc(e.SRC_ALPHA,e.ONE),e.blendEquation(e.FUNC_ADD),e.drawArrays(e.LINES,0,this.bufferData.length/4),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),this.time+=Number(this.options.step),this.time>1.5*this.endTime&&(this.time=this.startTime),e.useProgram(null)}}]),e}(no),Ra=function(t){function e(t){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.pointLayer=new Pa(t.options),t.textLayer=new ga(t.options.textOptions),t.children=[t.pointLayer,t.textLayer],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&Ke(e,t.textOptions);var n=t.minZoom,r=t.maxZoom,i=t.clusterRadius;n=r&&r!==this.options.maxZoom||n&&n!==this.options.minZoom||i&&i!==this.options.clusterRadius,Ke(this.options,t,{textOptions:e}),n?this.onChanged(this.options,this.data):this.refreshCluster(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){if(e&&e.length){var n=this.map.map;e.forEach(function(t){var e=ci(t.geometry.coordinates,2),r=e[0];e=e[1],-180<=r&&180>=r&&-90<=e&&90>=e||(r=n.mercatorToLnglat(r,e),t.geometry.coordinates[0]=r[0],t.geometry.coordinates[1]=r[1])}),this.supercluster=new ma({maxZoom:t.maxZoom,minZoom:t.minZoom,radius:t.clusterRadius,extent:256}),this.supercluster.load(e),this.supercluster.trees.forEach(function(t){var e=0,n=1/0;t.points.forEach(function(t){e=Math.max(t.numPoints||0,e),n=Math.min(t.numPoints||1/0,n)}),t.max=e,t.min=n}),this.refreshCluster()}}},{key:"refreshCluster",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;if(this.supercluster){var e=this.getClusterData(t);e&&e.length&&(this.pointLayer.setData(e),this.textLayer.setData(t.showText?e:[]),t.enablePicked&&t.autoSelect&&this.pick(-1,-1))}}},{key:"getClusterData",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=this.map.map,n=e.getBounds(),r=n.ne;n=n.sw,this.ne=r,this.sw=n;var i=r,o=i.lng;return i=i.lat,-180<=o&&180>=o&&-90<=i&&90>=i?r=[n.lng,n.lat,r.lng,r.lat]:(r=e.mercatorToLnglat(this.ne.lng,this.ne.lat),n=e.mercatorToLnglat(this.sw.lng,this.sw.lat),r=n.concat(r)),e=Math.floor(e.getZoom()),r=this.supercluster.getClusters(r,e),this.zoom!==e&&0<r.length&&(this.zoom=e,o=this.supercluster.trees,n=o[e]&&o[e].max||this.max,e=o[e]&&o[e].min||this.min,n!==e&&(this.max=n,this.min=e)),this.processData(r,t)}},{key:"processData",value:function(t,e){var n=e.defaultColor,r=e.defaultSize,i=e.gradient,o=e.minSize,a=e.textOptions,s=new w({max:this.max,min:~~this.min||1,minSize:o||8,maxSize:e.maxSize||30,gradient:i});n=n||i[0]||"black",r=r||.5*o||5;var u=a&&a.format;return u="function"==typeof u?u:null,t.map(function(t){var e=r,i=n,o=0;return t.properties&&t.properties.point_count&&(o=t.properties.point_count,e=s.getSize(o)||e,i=s.getColor(o),o=u?u(o):o),{geometry:t.geometry,properties:{text:o,size:e,color:i}}})}},{key:"pick",value:function(t,e){return this.pointLayer.pick(t,e)}},{key:"shouldUpdate",value:function(){if(!this.data||!this.supercluster)return!1;var t=this.map.map;if(this.zoom!==Math.floor(t.getZoom()))return!0;var e=t.getBounds();return t=e.ne,e=e.sw,this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat||void 0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshCluster():Vr(e.prototype.__proto__||rn(e.prototype),"render",this).call(this,t)}}]),e}(Bo),Oa=function(t){function e(t,n){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t,n))}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return Ke(Vr(e.prototype.__proto__||rn(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,n){this.gl&&(n=this.processData(n,t),Vr(e.prototype.__proto__||rn(e.prototype),"onChanged",this).call(this,t,n))}},{key:"generateGrid",value:function(t,e){var n=e.gridSize,r=[],i={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates);s=~~((s[0]+o[0])/n)+"_"+~~((s[1]+o[1])/n),void 0===i[s]&&(i[s]=0);var u=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(u=~~t[a].properties.count),i[s]+=u}return He(i).forEach(function(t){var e=t.split("_");r.push([e[0]*n+n/2,e[1]*n+n/2,i[t]])}),r}},{key:"processData",value:function(t,e){var n=[];if("normal"===e.style)for(var r=this.getPointOffset(),i=0;i<t.length;i++){var o=this.normizedPoint(t[i].geometry.coordinates),a=o[0]+r[0];o=o[1]+r[1];var s=~~t[i].count||1;"properties"in t[i]&&"count"in t[i].properties&&(s=~~t[i].properties.count),n.push([a,o,s])}else n=this.generateGrid(t,e);if(r=t=0,void 0!==e.max&&void 0!==e.min)t=e.max,r=e.min;else{for(n[0]&&(t=n[0][2],r=n[0][2]),i=n.length,a=0;a<i;a++)o=n[a],t=Math.max(o[2],t),r=Math.min(o[2],r);t/=2}for(e=new w({max:~~t,min:r,gradient:e.gradient}),t=[],r=0;r<n.length;r++)i=n[r],i[0]=i[0],i[1]=i[1],a=e.getImageData(i[2]),t.push({geometry:{type:"Point",coordinates:[i[0],i[1]]},color:[a[0]/255,a[1]/255,a[2]/255,a[3]/255]});return t}}]),e}(Pa),ka=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,e){var n=this;if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var r=[],i=0;20>i;i++)!function(t){var i=5*t;for(t=0;t<e.length;t++)e[t].geometry.coordinates.forEach(function(t){for(var e=0;e<t.length-1;e++){var o=n.normizedPoint(t[e]);r.push(o[0]),r.push(o[1]),r.push(Number(i)),o=n.normizedPoint(t[e+1]),r.push(o[0]),r.push(o[1]),r.push(Number(i))}})}(i);t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.bufferData=r,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Hi(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var n=this.program;e.useProgram(n.program);var r=this.normizedColor(this.options.color);e.uniform4f(n.uniforms.uFragColor,r[0],r[1],r[2],r[3]),e.uniformMatrix4fv(n.uniforms.uMatrix,!1,t),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,3,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE),e.drawArrays(e.LINES,0,this.bufferData.length/3),e.bindBuffer(e.ARRAY_BUFFER,null)}}]),e}(no),Fa={circle:1,square:2},Da=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"initialize",value:function(t){this.gl=t,this.program=new Hi(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var n=this.gl;if(n){this.buffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.buffer);for(var r=[],i=t.color||[.1,.1,.9,1],o=t.size||5,a=0;a<e.length;a++){var s=e[a].geometry.coordinates,u=e[a].color||i;"[object Function]"===Object.prototype.toString.call(u)&&(u=u(e[a])),"properties"in e[a]&&"color"in e[a].properties&&(u=e[a].properties.color),u=this.normizedColor(u);var l=this.normizedPoint(s),h=o;h="[object Function]"===Object.prototype.toString.call(h)?h(e[a]):Number(h);var c=e[a].time||a;"properties"in e[a]&&"time"in e[a].properties&&(c=e[a].properties.time),r.push(l[0],l[1],Number(s[2]||0),c),r.push(u[0],u[1],u[2],u[3]),r.push(h*window.devicePixelRatio)}void 0===t.endTime&&(this.endTime=e.length),this.bufferData=r,this.f32BufferData=new Float32Array(r),n.bufferData(n.ARRAY_BUFFER,this.f32BufferData,n.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;0>=this.bufferData.length||(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,n),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),n=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,9*n,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,9*n,4*n),e.enableVertexAttribArray(t.attributes.aSize),e.vertexAttribPointer(t.attributes.aSize,1,e.FLOAT,!1,9*n,8*n),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),n=1,this.options.shape&&Fa[this.options.shape]&&(n=Fa[this.options.shape]),e.uniform1i(t.uniforms.uShape,n),t=this.options.blend,e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.POINTS,0,this.bufferData.length/9),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),e}(no),Ba=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Hi(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,e){var n=this.gl;if(n){this.buffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.buffer);for(var r=[],i=0,o=this.options.color,a=0;a<e.length;a++){var s=e[a].geometry.coordinates;e[a].color&&(o=e[a].color),"properties"in e[a]&&"color"in e[a].properties&&(o=e[a].properties.color),"[object Function]"===Object.prototype.toString.call(o)&&(o=o(e[a])),o=this.normizedColor(o),s.length>i&&(i=s.length);for(var u=0;u<s.length-1;u++){var l=this.normizedPoint(s[u]);r.push(l[0]),r.push(l[1]),r.push(l[2]),void 0===s[u][3]?r.push(u):r.push(Number(s[u][3])),r.push(o[0]),r.push(o[1]),r.push(o[2]),r.push(o[3]),l=this.normizedPoint(s[u+1]),r.push(l[0]),r.push(l[1]),r.push(l[2]),void 0===s[u+1][3]?r.push(u+1):r.push(Number(s[u+1][3])),r.push(o[0]),r.push(o[1]),r.push(o[2]),r.push(o[3])}}void 0===t.endTime&&(this.endTime=i),this.bufferData=r,this.f32BufferData=new Float32Array(r),n.bufferData(n.ARRAY_BUFFER,this.f32BufferData,n.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,n=t.matrix;t=this.program,t.use(e),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,n),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),n=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,8*n,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,8*n,4*n),n=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,n[0],n[1],n[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),e.enable(e.BLEND),e.polygonOffset(2,1),"lighter"===this.options.blend?e.blendFunc(e.ONE,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE),e.blendEquation(e.FUNC_ADD),e.drawArrays(e.LINES,0,this.bufferData.length/8),e.bindBuffer(e.ARRAY_BUFFER,null),this.time+=this.options.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}]),e}(no),za=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.initData(),t.date=new Date,t.autoUpdate=!0,t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",interval:.1,duration:2,trailLength:.5,zoom:4}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float thickness;uniform int miter;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nvec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}",fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.prevBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){var n=this;if(this.gl){this.initData();for(var r=1,i=[],o=0;o<e.length;o++){var a=[],s=e[o].geometry.coordinates;s&&0<s.length&&(a="Polygon"===e[o].geometry.type?s[0].map(function(t){return n.normizedPoint(t)}):s.map(function(t){return n.normizedPoint(t)})),a=kt(a),s=a.total,i[o]=a.arr,r=Math.max(s,r)}for(o=[],a=t.color,s=0;s<e.length;s++){var u=[],l=e[s].geometry.coordinates;l&&0<l.length&&(u="Polygon"===e[s].geometry.type?l[0].map(function(t){return n.normizedPoint(t)}):l.map(function(t){return n.normizedPoint(t)})),l=e[s].color||a,"properties"in e[s]&&"color"in e[s].properties&&(l=e[s].properties.color),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[s])),l=this.normizedColor(l);for(var h=this.addMultipleCoords(u),c=0;c<h.length;c++)this.processData(this.dataMgr,h[c],i[s],r,l);if(t.enablePicked)for(l=this.indexToRgb(s),h=0;h<u.length;h++)o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),t.repeat&&(o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(o))}}},{key:"processData",value:function(t,e,n,r,i){var o,a,s,u,l,h,c,f=e.length,p=t.position.length/6;n=Ct(n.map(function(t){return t/r}));var d=Ct(e.map(function(t){return-1}),!0),v=Ct(e),g=Ct(e.map(Rt(-1))),m=Ct(e.map(Rt(1)));e=Ct(e.map(function(t){return i})),f=Lt(f,p),(o=t.counter).push.apply(o,wi(n)),(a=t.position).push.apply(a,wi(Ot(v))),(s=t.prev).push.apply(s,wi(Ot(g))),(u=t.next).push.apply(u,wi(Ot(m))),(l=t.direction).push.apply(l,wi(d)),(h=t.color).push.apply(h,wi(Ot(e))),(c=t.index).push.apply(c,wi(f))}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=this.dataMgr;if(r&&!(0>=r.index.length)){var i=this.getOptions(),o=this.program;o.use(e);var a=!this.map||!!(this.map.getZoom()>=i.zoom&&this.autoUpdate);o.setUniforms(Ke(this.getCommonUniforms(t),{u_matrix:n,miter:1,thickness:i.width,uAntialias:i.antialias,uTime:(new Date-this.date)/1e3,uAnimate:a,duration:i.duration,interval:i.interval,trailLength:i.trailLength})),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),i.blend&&"lighter"===i.blend?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,r.index.length,e.UNSIGNED_INT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.disable(e.BLEND)}}}]),e}(no),Ia=function(t){function e(t,n){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t,n))}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Hi(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:e.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Xi({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var n=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){n.loadTexture(function(){n.parseData(e),n.dataTime=new Date,n.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,n=t.projectionMatrix;t=t.viewMatrix;var r=this.getOptions(),i=this.program,o=i.uniforms;i.use(e),this.texture&&(e.activeTexture(e.TEXTURE0),e.uniform1i(o.uTile,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE1),e.uniform1i(o.uTerrain,1),e.bindTexture(e.TEXTURE_2D,this.terrainSampler),e.disable(e.CULL_FACE),i.setUniforms({u_proj_matrix:n,uUseFilter:!!r.filterColor,uFilterColor:this.normizedColor(r.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var e=this,n=this.getOptions();n.tile?n.terrain?C(this.gl,n.terrain,function(r,i){e.terrainSampler=r,C(e.gl,n.tile,function(n,r){e.texture=n,t&&t(),e.webglLayer.render()})},{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):C(this.gl,n.tile,function(n,r){e.texture=n,t&&t(),e.webglLayer.render()}):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this,n=[],r=[];if(t&&t[0]){var i=t[0].geometry.coordinates[0];i=i.map(function(t){return e.normizedPoint(t)}),t=i[0][0];var o=i[0][1],a=i[0][2],s=(i[2][0]-t)/16;i=(i[2][1]-o)/16;for(var u=0;16>=u;u++)for(var l=0;16>=l;l++)if(n.push(t+s*l,o+i*u,a),n.push(l/16,u/16),16>l&&16>u){var h=17*u+l,c=17*(u+1)+l;r.push(h,c+1,h+1),r.push(h,c,c+1)}}this.index=r,this.vertexBuffer.updateData(new Float32Array(n)),this.indexBuffer.updateData(new Uint32Array(r))}}]),e}(no),Ua=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Na=r(function(t){var e={},n={};t=t.exports=function(t,r,i,o,a){a=a?function(){return t}:ai(t),i=Ee(i,o,r?2:1),o=0;var s,u;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(void 0===a||pn.Array!==a&&di[pi]!==a){for(o=a.call(t);!(u=o.next()).done;)if((a=fi(o,i,u.value,r))===e||a===n)return a}else for(s=le(t.length);s>o;o++)if((a=r?i(Se(u=t[o])[0],u[1]):i(t[o]))===e||a===n)return a},t.BREAK=e,t.RETURN=n}),ja=_n("species"),Ya=function(t,e){t=Se(t).constructor;var n;return void 0===t||void 0==(n=Se(t)[ja])?e:Ae(n)},Va=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)},Ha=pe.process,Wa=pe.setImmediate,qa=pe.clearImmediate,Za=pe.MessageChannel,Xa=pe.Dispatch,Ga=0,Ja={},Ka=function(){var t=+this;if(Ja.hasOwnProperty(t)){var e=Ja[t];delete Ja[t],e()}},$a=function(t){Ka.call(t.data)};if(!Wa||!qa)if(Wa=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Ja[++Ga]=function(){Va("function"==typeof t?t:Function(t),e)},Qa(Ga),Ga},qa=function(t){delete Ja[t]},"process"==ne(Ha))var Qa=function(t){Ha.nextTick(Ee(Ka,t,1))};else if(Xa&&Xa.now)Qa=function(t){Xa.now(Ee(Ka,t,1))};else if(Za){var ts=new Za,es=ts.port2;ts.port1.onmessage=$a,Qa=Ee(es.postMessage,es,1)}else pe.addEventListener&&"function"==typeof postMessage&&!pe.importScripts?(Qa=function(t){pe.postMessage(t+"","*")},pe.addEventListener("message",$a,!1)):Qa="onreadystatechange"in(Oe?Re.createElement("script"):{})?function(t){gn.appendChild(Oe?Re.createElement("script"):{}).onreadystatechange=function(){gn.removeChild(this),Ka.call(t)}}:function(t){setTimeout(Ee(Ka,t,1),0)};var ns,rs=Wa,is=pe.MutationObserver||pe.WebKitMutationObserver,os=pe.process,as=pe.Promise,ss="process"==ne(os),us={f:function(t){return new Yt(t)}},ls=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},hs=pe.navigator,cs=hs&&hs.userAgent||"",fs=function(t,e){return Se(t),Pe(e)&&e.constructor===t?e:(t=us.f(t),(0,t.resolve)(e),t.promise)},ps=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:Ie(t,r,e[r]);return t},ds=_n("species"),vs=function(t){t="function"==typeof fe[t]?fe[t]:pe[t],Le&&t&&!t[ds]&&Be.f(t,ds,{configurable:!0,get:function(){return this}})},gs=function(){var t,e,n=function(){var n;for(ss&&(n=os.domain)&&n.exit();t;){var i=t.fn;t=t.next;try{i()}catch(n){throw t?r():e=void 0,n}}e=void 0,n&&n.enter()};if(ss)var r=function(){os.nextTick(n)};else if(!is||pe.navigator&&pe.navigator.standalone)if(as&&as.resolve){var i=as.resolve(void 0);r=function(){i.then(n)}}else r=function(){rs.call(pe,n)};else{var o=!0,a=document.createTextNode("");new is(n).observe(a,{characterData:!0}),r=function(){a.data=o=!o}}return function(n){n={fn:n,next:void 0},e&&(e.next=n),t||(t=n,r()),e=n}}(),ms=pe.TypeError,ys=pe.process,bs=ys&&ys.versions,xs=bs&&bs.v8||"",_s=pe.Promise,ws="process"==ei(ys),Ms=function(){},Ts=ns=us.f,As=!!function(){try{var t=_s.resolve(1),e=(t.constructor={})[_n("species")]=function(t){t(Ms,Ms)};return(ws||"function"==typeof PromiseRejectionEvent)&&t.then(Ms)instanceof e&&0!==xs.indexOf("6.6")&&-1===cs.indexOf("Chrome/66")}catch(t){}}(),Es=function(t){var e;return!(!Pe(t)||"function"!=typeof(e=t.then))&&e},Ps=function(t,e){if(!t._n){t._n=!0;var n=t._c;gs(function(){for(var r=t._v,i=1==t._s,o=0;n.length>o;){var a=void 0,s=void 0,u=void 0,l=n[o++],h=i?l.ok:l.fail,c=l.resolve,f=l.reject,p=l.domain;try{h?(i||(2==t._h&&Cs(t),t._h=1),!0===h?u=r:(p&&p.enter(),u=h(r),p&&(p.exit(),a=!0)),u===l.promise?f(ms("Promise-chain cycle")):(s=Es(u))?s.call(u,c,f):c(u)):f(r)}catch(t){p&&!a&&p.exit(),f(t)}}t._c=[],t._n=!1,e&&!t._h&&Ss(t)})}},Ss=function(t){rs.call(pe,function(){var e,n,r=t._v,i=1!==t._h&&0===(t._a||t._c).length;if(i){var o=ls(function(){ws?ys.emit("unhandledRejection",r,t):(e=pe.onunhandledrejection)?e({promise:t,reason:r}):(n=pe.console)&&n.error&&n.error("Unhandled promise rejection",r)});t._h=ws||1!==t._h&&0===(t._a||t._c).length?2:1}if(t._a=void 0,i&&o.e)throw o.v})},Cs=function(t){rs.call(pe,function(){var e;ws?ys.emit("rejectionHandled",t):(e=pe.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ls=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ps(e,!0))},Rs=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw ms("Promise can't be resolved itself");(e=Es(t))?gs(function(){var r={_w:n,_d:!1};try{e.call(t,Ee(Rs,r,1),Ee(Ls,r,1))}catch(t){Ls.call(r,t)}}):(n._v=t,n._s=1,Ps(n,!1))}catch(t){Ls.call({_w:n,_d:!1},t)}}};if(!As){_s=function(t){Ua(this,_s,"Promise","_h"),Ae(t),Os.call(this);try{t(Ee(Rs,this,1),Ee(Ls,this,1))}catch(t){Ls.call(this,t)}};var Os=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1};Os.prototype=ps(_s.prototype,{then:function(t,e){var n=Ts(Ya(this,_s));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=ws?ys.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ps(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}});var ks=function(){var t=new Os;this.promise=t,this.resolve=Ee(Rs,t,1),this.reject=Ee(Ls,t,1)};us.f=Ts=function(t){return t===_s||t===Fs?new ks(t):ns(t)}}Ne(Ne.G+Ne.W+Ne.F*!As,{Promise:_s}),Tn(_s,"Promise"),vs("Promise");var Fs=fe.Promise;Ne(Ne.S+Ne.F*!As,"Promise",{reject:function(t){var e=Ts(this);return(0,e.reject)(t),e.promise}}),Ne(Ne.S+1*Ne.F,"Promise",{resolve:function(t){return fs(this===Fs?_s:this,t)}}),Ne(Ne.S+Ne.F*!(As&&mi(function(t){_s.all(t).catch(Ms)})),"Promise",{all:function(t){var e=this,n=Ts(e),r=n.resolve,i=n.reject,o=ls(function(){var n=[],o=0,a=1;Na(t,!1,function(t){var s=o++,u=!1;n.push(void 0),a++,e.resolve(t).then(function(t){u||(u=!0,n[s]=t,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(t){var e=this,n=Ts(e),r=n.reject,i=ls(function(){Na(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}}),Ne(Ne.P+Ne.R,"Promise",{finally:function(t){var e=Ya(this,fe.Promise||pe.Promise),n="function"==typeof t;return this.then(n?function(n){return fs(e,t()).then(function(){return n})}:t,n?function(n){return fs(e,t()).then(function(){throw n})}:t)}}),Ne(Ne.S,"Promise",{try:function(t){var e=us.f(this);return t=ls(t),(t.e?e.reject:e.resolve)(t.v),e.promise}});var Ds=fe.Promise,Bs=r(function(t){t.exports={default:Ds,__esModule:!0}}),zs=n(Bs),Is=function(t,e){if(!Pe(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},Us=Be.f,Ns=Yn.fastKey,js=Le?"_s":"size",Ys=function(t,e){var n=Ns(e);if("F"!==n)return t._i[n];for(t=t._f;t;t=t.n)if(t.k==e)return t},Vs={getConstructor:function(t,e,n,r){var i=t(function(t,o){Ua(t,i,e,"_i"),t._t=e,t._i=xn(null),t._f=void 0,t._l=void 0,t[js]=0,void 0!=o&&Na(o,n,t[r],t)});return ps(i.prototype,{clear:function(){for(var t=Is(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[js]=0},delete:function(t){var n=Is(this,e);if(t=Ys(n,t)){var r=t.n,i=t.p;delete n._i[t.i],t.r=!0,i&&(i.n=r),r&&(r.p=i),n._f==t&&(n._f=r),n._l==t&&(n._l=i),n[js]--}return!!t},forEach:function(t){Is(this,e);for(var n,r=Ee(t,1<arguments.length?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!Ys(Is(this,e),t)}}),Le&&Us(i.prototype,"size",{get:function(){return Is(this,e)[js]}}),i},def:function(t,e,n){var r,i=Ys(t,e);return i?i.v=n:(t._l=i={i:r=Ns(e,!0),k:e,v:n,p:e=t._l,n:void 0,r:!1},t._f||(t._f=i),e&&(e.n=i),t[js]++,"F"!==r&&(t._i[r]=i)),t},getEntry:Ys,setStrong:function(t,e,n){Ln(t,e,function(t,n){this._t=Is(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?"keys"==t?On(0,e.k):"values"==t?On(0,e.v):On(0,[e.k,e.v]):(this._t=void 0,On(1))},n?"entries":"values",!n,!0),vs(e)}},Hs=(_n("species"),Be.f),Ws=function(t,e){return function(t,e,n){var r=Object($t(t)),i=re(r);e=Ee(e,n,3),n=le(i.length);var o=0;t=void 0;for(var a;n>o;o++)o in i&&(a=i[o],e(a,o,r));return t}}();!function(t,e,n,r,i,o){var a=pe[t],s=a,u=s&&s.prototype,l={};Le&&"function"==typeof s&&u.forEach&&!Ce(function(){(new s).entries().next()})?(s=e(function(e,n){Ua(e,s,t,"_c"),e._c=new a,void 0!=n&&Na(n,!0,e.set,e)}),Ws("add clear delete forEach get has set keys values entries toJSON".split(" "),function(t){var e="add"==t||"set"==t;t in u&&!0&&Ie(s.prototype,t,function(n,r){return Ua(this,s,t),n=this._c[t](0===n?0:n,r),e?this:n})}),Hs(s.prototype,"size",{get:function(){return this._c.size}})):(s=r.getConstructor(e,t,!0,"set"),ps(s.prototype,n),Yn.NEED=!0),Tn(s,t),l[t]=s,Ne(Ne.G+Ne.W+Ne.F,l),r.setStrong(s,t,!0)}("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){return(t=Vs.getEntry(Is(this,"Map"),t))&&t.v},set:function(t,e){return Vs.def(Is(this,"Map"),0===t?0:t,e)}},Vs),Ne(Ne.P+Ne.R,"Map",{toJSON:function(t){return function(){if("Map"!=ei(this))throw TypeError("Map#toJSON isn't generic");var t=[];return Na(this,!1,t.push,t,void 0),t}}()}),function(t){Ne(Ne.S,"Map",{of:function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return new this(e)}})}(),function(t){Ne(Ne.S,"Map",{from:function(t,e,n){var r;if(Ae(this),(r=void 0!==e)&&Ae(e),void 0==t)return new this;var i=[];if(r){var o=0,a=Ee(e,n,2);Na(t,!1,function(t){i.push(a(t,o++))})}else Na(t,!1,i.push,i);return new this(i)}})}();var qs=fe.Map,Zs=r(function(t){t.exports={default:qs,__esModule:!0}}),Xs=n(Zs),Gs=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.index=[],n=t.canvas=document.createElement("canvas"),n=t.ctx=n.getContext("2d"),n.textAlign="start",n.textBaseline="top",t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Hi(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform vec2 u_offset;uniform float devicePixelRatio;varying vec2 v_texture_coord;vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x-=size[0];y+=size[1];}else if(corner==2.0){x+=size[0];y+=size[1];}else if(corner==3.0){x+=size[0];y-=size[1];}else{x-=size[0];y-=size[1];}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-a_offset*2./MAPV_resolution*devicePixelRatio;gl_Position=vec4(current,1.0);}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:24},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Xi({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){var n=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){n.processCache(t,e)},0))}},{key:"processCache",value:function(t,e){var n=this;this.cachedData=[],this.iconHash=new Xs;for(var r=t.icon,i=t.width,o=t.height,a=t.offset,s=0;s<e.length;s++){var u=this.normizedPoint(e[s].geometry.coordinates),l=e[s].icon||r;"properties"in e[s]&&"icon"in e[s].properties&&(l=e[s].properties.icon);var h=e[s].width||i;"properties"in e[s]&&"width"in e[s].properties&&(h=e[s].properties.width);var c=e[s].height||o;"properties"in e[s]&&"height"in e[s].properties&&(c=e[s].properties.height);var f=e[s].offset||a;"properties"in e[s]&&"offset"in e[s].properties&&(f=e[s].properties.offset),u&&l&&(this.cachedData.push({point:u,icon:l,width:h,height:c,offset:f}),u=new Image,this.iconHash.get(l)||this.iconHash.set(l,u))}e=xi(this.iconHash.keys()).map(function(t){return new zs(function(e,r){n.url2canvas(t,function(r){n.iconHash.set(t,r),e()})})}),zs.all(e).then(function(e){n.buildSprite(t),n.webglLayer.render()})}},{key:"buildSprite",value:function(t){var e=t.padding,n=this.canvas,r=this.ctx,i=[],o=new Xs,a=!0,s=!1,u=void 0;try{for(var l,h=li(this.iconHash);!(a=(l=h.next()).done);a=!0){var c=ci(l.value,2),f=c[1],p=f.width,v=f.height;i.push({w:p+e[0],h:v+e[0],width:p,height:v,key:c[0],icon:f})}}catch(t){s=!0,u=t}finally{try{!a&&h.return&&h.return()}finally{if(s)throw u}}for(s=Ut(i),a=0;a<i.length;a++)u=i[a],o.get(u.key)||o.set(u.key,u);for(a=d(s.w),s=d(s.h),n.width=a,n.height=s,r.save(),n=0;n<i.length;n++)u=i[n],r.drawImage(u.icon,u.x+e[0],u.y+e[1],u.width,u.height);r.restore(),this.loadTexture(),this.buildVertex(t,o,a,s)}},{key:"buildVertex",value:function(t,e,n,r){t=t.enablePicked;for(var i=[],o=[],a=[],s=[],u=0;u<this.cachedData.length;u++){var l=this.cachedData[u],h=l.point,c=l.width,f=l.height,p=l.offset;l=e.get(l.icon),c=c||l.icon.width,f=f||l.icon.height,p=p||[0,-f/2];var d=ci(h,3);h=d[0];var v=d[1];d=d[2];for(var g=0;4>g;g++)i.push(h,v,d),i.push(g),i.push(c,f),i.push.apply(i,wi(p));c=l.x/n,f=(l.x+l.w)/n,p=(l.y+l.h)/r,l=l.y/r,o.push(c,p,c,l,f,l,f,p),l=4*u,a.push(l,l+2,l+1,l,l+3,l+2),t&&(l=this.indexToRgb(u),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255))}this.index=a,this.vertexBuffer.updateData(new Float32Array(i)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(a)),t&&this.pickBuffer.updateData(new Float32Array(s))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,n=t.matrix,r=this.program;r.use(e),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),r.setUniforms(Ke(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:n,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)),e.useProgram(null)}}},{key:"url2canvas",value:function(t,e){if("object"===(void 0===t?"undefined":Fr(t)))e(t);else{var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var t=n.width,r=n.height,i=document.createElement("canvas");i.width=t,i.height=r,i.getContext("2d").drawImage(n,0,0,t,r),e(i)},n.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?C(this.gl,this.canvas,function(e){t.texture=e}):this.texture=null}}]),e}(no),Js=function(t){function e(t){an(this,e);var n=Br(this,(e.__proto__||rn(e)).call(this,t));return t=n.getOptions(),n.shapeLayer=new Fo({enablePicked:t.enablePicked}),n.lineLayer=new $o,n.children=[n.shapeLayer,n.lineLayer],n}return $r(e,t),fn(e,[{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,height:0,autoSelect:t.autoSelect,color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1}),this.lineLayer.setOptions({color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin})}},{key:"onDataChanged",value:function(t){var e=t.map(function(t){return{geometry:{type:"LineString",coordinates:t.geometry.coordinates[0].map(function(t){return 3===t.length?t:[t[0],t[1],.1]})}}});this.shapeLayer.setData(t),this.lineLayer.setData(e)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]),e}(Bo),Ks=Ks||{},$s=0,Qs=null,tu=Ks.Scene=function(t,e){this.name=void 0!==e.name?e.name:null,this.nodes=Array(e.nodes.length);for(var n=0,r=e.nodes.length;n<r;n++)this.nodes[n]=t.nodes[e.nodes[n]];this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=null},eu=Ks.BoundingBox=function(t,e,n){t=t||go.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e=e||go.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),void 0===n||!0===n?(this.min=go.clone(t),this.max=go.clone(e)):(this.min=t,this.max=e),this.transform=xo.create()};eu.prototype.updateBoundingBox=function(t){go.min(this.min,this.min,t.min),go.max(this.max,this.max,t.max)},eu.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},eu.getAABBFromOBB=function(){var t=go.create(),e=go.create(),n=go.create(),r=go.create(),i=go.create();return function(o,a){go.set(t,a[0],a[1],a[2]),go.set(e,a[4],a[5],a[6]),go.set(n,a[8],a[9],a[10]),a=go.fromValues(a[12],a[13],a[14]);var s=go.clone(a);return go.scale(r,t,o.min[0]),go.scale(i,t,o.max[0]),go.min(t,r,i),go.add(a,a,t),go.max(t,r,i),go.add(s,s,t),go.scale(r,e,o.min[1]),go.scale(i,e,o.max[1]),go.min(e,r,i),go.add(a,a,e),go.max(e,r,i),go.add(s,s,e),go.scale(r,n,o.min[2]),go.scale(i,n,o.max[2]),go.min(n,r,i),go.add(a,a,n),go.max(n,r,i),go.add(s,s,n),o=new eu(a,s,!1),o.calculateTransform(),o}}();var nu=Ks.Accessor=function(t,e){this.bufferView=e,this.componentType=t.componentType,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=e.byteStride,this.normalized=void 0!==t.normalized&&t.normalized,this.count=t.count,this.type=t.type,this.size=Eu[this.type],this.min=t.min,this.max=t.max,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null};nu.prototype.prepareVertexAttrib=function(t,e){e.vertexAttribPointer(t,this.size,this.componentType,this.normalized,this.byteStride,this.byteOffset),e.enableVertexAttribArray(t)};var ru=Ks.BufferView=function(t,e){this.byteLength=t.byteLength,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=void 0!==t.byteStride?t.byteStride:0,this.target=void 0!==t.target?t.target:null,this.data=e.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.buffer=null};ru.prototype.createBuffer=function(t){this.buffer=t.createBuffer()},ru.prototype.bindData=function(t){return!!this.target&&(t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,this.data,t.STATIC_DRAW),t.bindBuffer(this.target,null),!0)};var iu=Ks.Camera=function(t){this.name=void 0!==t.name?t.name:null,this.type=t.type,this.othographic=void 0===t.othographic?null:t.othographic,this.perspective=void 0===t.perspective?null:{yfov:t.perspective.yfov,znear:t.perspective.znear,zfar:void 0!==t.perspective.zfar?t.perspective.zfar:null,aspectRatio:void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:null},this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},ou=Ks.Node=function(t,e){if(this.name=void 0!==t.name?t.name:null,this.nodeID=e,this.camera=void 0!==t.camera?t.camera:null,this.matrix=xo.create(),t.hasOwnProperty("matrix")){for(e=0;16>e;++e)this.matrix[e]=t.matrix[e];this.translation=go.create(),xo.getTranslation(this.translation,this.matrix),this.rotation=bo.create(),xo.getRotation(this.rotation,this.matrix),this.scale=go.create(),xo.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(t.translation,t.rotation,t.scale);this.children=t.children||[],this.mesh=void 0!==t.mesh?Qs.glTF.meshes[t.mesh]:null,this.skin=void 0!==t.skin?t.skin:null,void 0!==t.extensions&&void 0!==t.extensions.gl_avatar&&!0===Qs.enableGLAvatar&&(this.skin=new mu(Qs.glTF,Qs.skeletonGltf.skins[Qs.skeletonGltf.json.extensions.gl_avatar.skins[t.extensions.gl_avatar.skin.name]],t.extensions.gl_avatar.skin.inverseBindMatrices)),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.aabb=null,this.bvh=new eu};ou.prototype.traverse=function(t,e){e(this,t),t=0;for(var n=this.children.length;t<n;t++)this.children[t].traverse(this,e)},ou.prototype.traversePostOrder=function(t,e){for(var n=0,r=this.children.length;n<r;n++)this.children[n].traversePostOrder(this,e);e(this,t)},ou.prototype.traverseTwoExecFun=function(t,e,n){e(this,t);for(var r=0,i=this.children.length;r<i;r++)this.children[r].traverseTwoExecFun(this,e,n);n(this,t)};var au=xo.create();ou.prototype.getTransformMatrixFromTRS=function(t,e,n){this.translation=void 0!==t?go.fromValues(t[0],t[1],t[2]):go.fromValues(0,0,0),this.rotation=void 0!==e?vo.fromValues(e[0],e[1],e[2],e[3]):vo.fromValues(0,0,0,1),this.scale=void 0!==n?go.fromValues(n[0],n[1],n[2]):go.fromValues(1,1,1),this.updateMatrixFromTRS()},ou.prototype.updateMatrixFromTRS=function(){xo.fromRotationTranslation(au,this.rotation,this.translation),xo.scale(this.matrix,au,this.scale)};var su=Ks.Mesh=function(t,e){this.meshID=e,this.name=void 0!==t.name?t.name:null,this.primitives=[],this.boundingBox=null,e=0;for(var n=t.primitives.length;e<n;++e){var r=t.primitives[e];r=new uu(Qs.glTF,r),this.primitives.push(r),r.boundingBox&&(this.boundingBox||(this.boundingBox=new eu),this.boundingBox.updateBoundingBox(r.boundingBox))}this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},uu=Ks.Primitive=function(t,e){this.attributes=e.attributes,this.indices=void 0!==e.indices?e.indices:null;var n;if(void 0!==e.extensions&&void 0!==e.extensions.gl_avatar&&!0===Qs.enableGLAvatar&&e.extensions.gl_avatar.attributes)for(n in e.extensions.gl_avatar.attributes)this.attributes[n]=e.extensions.gl_avatar.attributes[n];null!==this.indices?(this.indicesComponentType=t.json.accessors[this.indices].componentType,this.indicesLength=t.json.accessors[this.indices].count,this.indicesOffset=t.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=t.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=t.json.accessors[this.attributes.POSITION].byteOffset||0);for(n in this.attributes)this.attributes[n]=t.accessors[this.attributes[n]];this.material=void 0!==e.material?t.materials[e.material]:null,this.mode=void 0!==e.mode?e.mode:4,this.targets=e.targets,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=this.shader=this.indexBuffer=this.vertexBuffer=this.vertexArray=null,void 0!==this.attributes.POSITION&&(t=this.attributes.POSITION,t.max&&"VEC3"===t.type&&(this.boundingBox=new eu(go.fromValues(t.min[0],t.min[1],t.min[2]),go.fromValues(t.max[0],t.max[1],t.max[2]),!1),this.boundingBox.calculateTransform()))},lu=Ks.Texture=function(t){this.name=void 0!==t.name?t.name:null,this.sampler=void 0!==t.sampler?Qs.glTF.samplers[t.sampler]:null,this.source=void 0!==t.source?Qs.glTF.images[t.source]:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.texture=null};lu.prototype.createTexture=function(t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)};var hu=Ks.Sampler=function(t){this.name=void 0!==t.name?t.name:null,this.magFilter=void 0!==t.magFilter?t.magFilter:null,this.minFilter=void 0!==t.minFilter?t.minFilter:null,this.wrapS=void 0!==t.wrapS?t.wrapS:10497,this.wrapT=void 0!==t.wrapT?t.wrapT:10497,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.sampler=null};hu.prototype.createSampler=function(t){this.sampler=t.createSampler(),this.minFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,this.minFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR),this.magFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,this.magFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_S,this.wrapS),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_T,this.wrapT)};var cu=Ks.TextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},fu=Ks.PbrMetallicRoughness=function(t){this.baseColorFactor=void 0!==t.baseColorFactor?t.baseColorFactor:[1,1,1,1],this.baseColorTexture=void 0!==t.baseColorTexture?new cu(t.baseColorTexture):null,this.metallicFactor=void 0!==t.metallicFactor?t.metallicFactor:1,this.roughnessFactor=void 0!==t.roughnessFactor?t.roughnessFactor:1,this.metallicRoughnessTexture=void 0!==t.metallicRoughnessTexture?new cu(t.metallicRoughnessTexture):null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},pu=Ks.NormalTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.scale=void 0!==t.scale?t.scale:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},du=Ks.OcclusionTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.strength=void 0!==t.strength?t.strength:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},vu=Ks.Material=function(t){this.name=void 0!==t.name?t.name:null,this.pbrMetallicRoughness=new fu(void 0!==t.pbrMetallicRoughness?t.pbrMetallicRoughness:{baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=void 0!==t.normalTexture?new pu(t.normalTexture):null,this.occlusionTexture=void 0!==t.occlusionTexture?new du(t.occlusionTexture):null,this.emissiveTexture=void 0!==t.emissiveTexture?new cu(t.emissiveTexture):null,this.emissiveFactor=void 0!==t.emissiveFactor?t.emissiveFactor:[0,0,0],this.alphaMode=void 0!==t.alphaMode?t.alphaMode:"OPAQUE",this.alphaCutoff=void 0!==t.alphaCutoff?t.alphaCutoff:.5,this.doubleSided=t.doubleSided||!1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},gu=Ks.Skin=function(t,e,n){this.name=void 0!==e.name?e.name:null,this.skinID=n,this.joints=Array(e.joints.length);var r;for(n=0,r=this.joints.length;n<r;n++)this.joints[n]=t.nodes[e.joints[n]];if(this.skeleton=void 0!==e.skeleton?t.nodes[e.skeleton]:null,this.inverseBindMatrices=void 0!==e.inverseBindMatrices?t.accessors[e.inverseBindMatrices]:null,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.uniformBlockID=$s++,this.inverseBindMatrices)for(this.inverseBindMatricesData=Ht(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),n=0,r=this.inverseBindMatricesData.length;n<r;n+=16)this.inverseBindMatrix.push(xo.fromValues(this.inverseBindMatricesData[n],this.inverseBindMatricesData[n+1],this.inverseBindMatricesData[n+2],this.inverseBindMatricesData[n+3],this.inverseBindMatricesData[n+4],this.inverseBindMatricesData[n+5],this.inverseBindMatricesData[n+6],this.inverseBindMatricesData[n+7],this.inverseBindMatricesData[n+8],this.inverseBindMatricesData[n+9],this.inverseBindMatricesData[n+10],this.inverseBindMatricesData[n+11],this.inverseBindMatricesData[n+12],this.inverseBindMatricesData[n+13],this.inverseBindMatricesData[n+14],this.inverseBindMatricesData[n+15]))},mu=Ks.SkinLink=function(t,e,n){if(this.isLink=!0,t.skins||(t.skins=[]),t.skins.push(this),this.name=e.name,this.skinID=t.skins.length-1,this.joints=e.joints,this.skeleton=e.skeleton,this.inverseBindMatrices=void 0!==n?t.accessors[n]:null,this.uniformBlockID=$s++,this.inverseBindMatrices)for(this.inverseBindMatricesData=Ht(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),t=0,e=this.inverseBindMatricesData.length;t<e;t+=16)this.inverseBindMatrix.push(xo.fromValues(this.inverseBindMatricesData[t],this.inverseBindMatricesData[t+1],this.inverseBindMatricesData[t+2],this.inverseBindMatricesData[t+3],this.inverseBindMatricesData[t+4],this.inverseBindMatricesData[t+5],this.inverseBindMatricesData[t+6],this.inverseBindMatricesData[t+7],this.inverseBindMatricesData[t+8],this.inverseBindMatricesData[t+9],this.inverseBindMatricesData[t+10],this.inverseBindMatricesData[t+11],this.inverseBindMatricesData[t+12],this.inverseBindMatricesData[t+13],this.inverseBindMatricesData[t+14],this.inverseBindMatricesData[t+15]))},yu=Ks.Target=function(t){this.nodeID=void 0!==t.node?t.node:null,this.path=t.path,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},bu=Ks.Channel=function(t,e){this.sampler=e.samplers[t.sampler],this.target=new yu(t.target),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},xu=Ks.AnimationSampler=function(t,e){this.input=t.accessors[e.input],this.output=t.accessors[e.output],this.inputTypedArray=Ht(this.input),this.outputTypedArray=Ht(this.output),this.interpolation=void 0!==e.interpolation?e.interpolation:"LINEAR",this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.curIdx=0,this.curValue=vo.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]},_u=vo.create(),wu=vo.create();xu.prototype.getValue=function(t){t>this.endT&&(t-=this.inputMax*Math.ceil((t-this.endT)/this.inputMax),this.curIdx=0);for(var e=this.inputTypedArray.length;this.curIdx<=e-2&&t>=this.inputTypedArray[this.curIdx+1];)this.curIdx++;this.curIdx>=e-1&&(t-=this.inputMax,this.curIdx=0),e=Eu[this.output.type];var n=4===e?bo.slerp:vo.lerp,r=this.curIdx,i=r*e,o=i+e;for(t=Math.max(0,t-this.inputTypedArray[r])/(this.inputTypedArray[r+1]-this.inputTypedArray[r]),r=0;r<e;r++)_u[r]=this.outputTypedArray[i+r],wu[r]=this.outputTypedArray[o+r];switch(this.interpolation){case"LINEAR":n(this.curValue,_u,wu,t)}};var Mu=Ks.Animation=function(t,e){this.name=void 0!==e.name?e.name:null;var n;this.samplers=[];var r=0;for(n=e.samplers.length;r<n;r++)this.samplers[r]=new xu(t,e.samplers[r]);for(this.channels=[],r=0,n=e.channels.length;r<n;r++)this.channels[r]=new bu(e.channels[r],this);this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null},Tu=Ks.glTFModel=function(t){this.json=t,this.defaultScene=void 0!==t.scene?t.scene:0,this.version=Number(t.asset.version),t.accessors&&(this.accessors=Array(t.accessors.length)),t.bufferViews&&(this.bufferViews=Array(t.bufferViews.length)),t.scenes&&(this.scenes=Array(t.scenes.length)),t.nodes&&(this.nodes=Array(t.nodes.length)),t.meshes&&(this.meshes=Array(t.meshes.length)),t.materials&&(this.materials=Array(t.materials.length)),t.textures&&(this.textures=Array(t.textures.length)),t.samplers&&(this.samplers=Array(t.samplers.length)),t.images&&(this.images=Array(t.images.length)),t.skins&&(this.skins=Array(t.skins.length)),t.animations&&(this.animations=Array(t.animations.length)),t.cameras&&(this.cameras=Array(t.cameras.length)),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Au=Ks.glTFLoader=function(t){this._init(),this.glTF=null,this.enableGLAvatar=!1,this.linkSkeletonGltf=null};Au.prototype._init=function(){this._loadDone=!1,this._bufferLoaded=this._bufferRequested=0,this._buffers=[],this._bufferTasks={},this._finishedPendingTasks=this._pendingTasks=this._imageLoaded=this._imageRequested=this._shaderLoaded=this._shaderRequested=0,this.onload=null,Qs=this},Au.prototype._checkComplete=function(){this._bufferRequested==this._bufferLoaded&&this._imageRequested==this._imageLoaded&&(this._loadDone=!0),this._loadDone&&this._pendingTasks==this._finishedPendingTasks&&(this._postprocess(),this.onload(this.glTF))},Au.prototype.loadGLTF_GL_Avatar_Skin=function(t,e,n){this.enableGLAvatar=!0,this.skeletonGltf=e,this.loadGLTF(t,n)},Au.prototype.loadGLTF=function(t,e){this._init(),this.onload=e||function(t){},this.baseUri=Wt(t);var n=this;qt(t,function(t){t=JSON.parse(t),n.glTF=new Tu(t);var e,r=function(t){if(n._buffers[e]=t,n._bufferLoaded++,n._bufferTasks[e]){var r,i=0;for(r=n._bufferTasks[e].length;i<r;++i)n._bufferTasks[e][i](t)}n._checkComplete()};if(t.buffers)for(e in t.buffers){n._bufferRequested++;var i=t.buffers[e].uri;-1===i.indexOf("base64")&&(i=n.baseUri+i),Zt(i,r)}r=function(t,e){n._imageLoaded++,n.glTF.images[e]=t,n._checkComplete()};var o;if(t.images)for(o in t.images)n._imageRequested++,Xt(n.baseUri+t.images[o].uri,o,r);n._checkComplete()})},Au.prototype._postprocess=function(){function t(t,e){var n=u[t.nodeID];null!==e?xo.mul(n,u[e.nodeID],t.matrix):xo.copy(n,t.matrix)}function e(t,e){var n=u[t.nodeID];e=null!==e?e.bvh:l.boundingBox,t.mesh&&(i=t.mesh,i.boundingBox&&(t.aabb=eu.getAABBFromOBB(i.boundingBox,n),0===t.children.length&&(go.copy(t.bvh.min,t.aabb.min),go.copy(t.bvh.max,t.aabb.max)))),go.min(e.min,e.min,t.bvh.min),go.max(e.max,e.max,t.bvh.max)}Qs=this;var n,r,i;if(this.glTF.cameras){var o=0;for(n=this.glTF.cameras.length;o<n;o++)this.glTF.cameras[o]=new iu(this.glTF.json.cameras[o])}if(this.glTF.bufferViews)for(o=0,n=this.glTF.bufferViews.length;o<n;o++)this.glTF.bufferViews[o]=new ru(this.glTF.json.bufferViews[o],this._buffers[this.glTF.json.bufferViews[o].buffer]);if(this.glTF.accessors)for(o=0,n=this.glTF.accessors.length;o<n;o++)this.glTF.accessors[o]=new nu(this.glTF.json.accessors[o],this.glTF.bufferViews[this.glTF.json.accessors[o].bufferView]);if(this.glTF.materials)for(o=0,n=this.glTF.materials.length;o<n;o++)this.glTF.materials[o]=new vu(this.glTF.json.materials[o]);if(this.glTF.samplers)for(o=0,n=this.glTF.samplers.length;o<n;o++)this.glTF.samplers[o]=new hu(this.glTF.json.samplers[o]);if(this.glTF.textures)for(o=0,n=this.glTF.textures.length;o<n;o++)this.glTF.textures[o]=new lu(this.glTF.json.textures[o]);for(o=0,n=this.glTF.meshes.length;o<n;o++)this.glTF.meshes[o]=new su(this.glTF.json.meshes[o],o);for(o=0,n=this.glTF.nodes.length;o<n;o++)this.glTF.nodes[o]=new ou(this.glTF.json.nodes[o],o);for(o=0,n=this.glTF.nodes.length;o<n;o++){var a=this.glTF.nodes[o],s=0;for(r=a.children.length;s<r;s++)a.children[s]=this.glTF.nodes[a.children[s]]}var u=Array(this.glTF.nodes.length);for(o=0,n=u.length;o<n;o++)u[o]=xo.create();for(o=0,n=this.glTF.scenes.length;o<n;o++){var l=this.glTF.scenes[o]=new tu(this.glTF,this.glTF.json.scenes[o]);for(l.boundingBox=new eu,s=0,r=l.nodes.length;s<r;s++)a=l.nodes[s],a.traverseTwoExecFun(null,t,e);l.boundingBox.calculateTransform()}for(s=0,r=this.glTF.nodes.length;s<r;s++)a=this.glTF.nodes[s],null!==a.bvh&&a.bvh.calculateTransform();if(this.glTF.animations)for(o=0,n=this.glTF.animations.length;o<n;o++)this.glTF.animations[o]=new Mu(this.glTF,this.glTF.json.animations[o]);if(this.glTF.json.skins)for(o=0,n=this.glTF.skins.length;o<n;o++)for(this.glTF.skins[o]=new gu(this.glTF,this.glTF.json.skins[o],o),a=this.glTF.skins[o].joints,s=0,r=a.length;s<r;s++)a[s].jointID=s;for(o=0,n=this.glTF.nodes.length;o<n;o++)a=this.glTF.nodes[o],null!==a.skin&&"number"==typeof a.skin&&(a.skin=this.glTF.skins[a.skin])};var Eu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pu=function(t){function e(t,n){return an(this,e),Br(this,(e.__proto__||rn(e)).call(this,t,n))}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{scale:1}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var n=this.getOptions();this.gltfObj=Gt({gl:t,options:n}),(new Au).loadGLTF(n.url,function(t){e.gltfObj.setupScene(t),e.webglLayer.render()})}},{key:"onChanged",value:function(t,e){}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var n=this.getData(),r=this.getOptions(),i=r.scale,o=[i,i,i];for("px"===r.unit&&this.map&&(o=this.map.getZoomUnits(),o=[i*o,i*o,i*o]),i=0;i<n.length;i++){var a=n[i].geometry.coordinates;r=xo.create();var s=xo.create();a=this.normizedPoint(a),xo.identity(r),xo.translate(r,r,[a[0],a[1],0]),xo.rotateX(r,r,Math.PI/2),xo.rotateY(r,r,(n[i].angle||0)*Math.PI/180),xo.scale(r,r,o),xo.mul(s,t,r),this.gltfObj.render({gl:e,matrix:s})}}}]),e}(no),Su=Su||{};!function(){function t(t,e,n){return n=t.createShader(n),t.shaderSource(n,e),t.compileShader(n),n}Su.getShaderSource=function(t){return document.getElementById(t).textContent.replace(/^\s+|\s+$/g,"")},Su.createProgram=function(e,n,r){var i=e.createProgram();return n=t(e,n,e.VERTEX_SHADER),r=t(e,r,e.FRAGMENT_SHADER),e.attachShader(i,n),e.deleteShader(n),e.attachShader(i,r),e.deleteShader(r),e.linkProgram(i),e.getProgramInfoLog(i),e.getShaderInfoLog(n),e.getShaderInfoLog(r),i};var e=Su.loadImage=function(t,e){var n=new Image;return n.crossOrigin="Anonymous",n.src=t,n.onload=e,n};Su.loadImages=function(t,n){function r(){0>=--o&&n(i)}for(var i=[],o=t.length,a=0;a<o;++a)i.push(e(t[a],r))}}();var Cu=function(t){function e(t){an(this,e);var n=Br(this,(e.__proto__||rn(e)).call(this,t));return t=n.getOptions(),n.gltfLayer=new Pu({url:t.url||"https://mapv-website.bj.bcebos.com/gl/examples/model/car.gltf",scale:t.scale}),n.children=[n.gltfLayer],n.autoUpdate=!0,n.index=[],n.newData=[],n.isStarted=!1!==t.autoPlay,n}return $r(e,t),fn(e,[{key:"onOptionsChanged",value:function(t){this.gltfLayer.setOptions({})}},{key:"onDataChanged",value:function(t){this.index=[],this.newData=[];for(var e=0;e<t.length;e++)this.index.push(0),this.newData.push(this._addPath(t[e].geometry.coordinates));this.updatePoints()}},{key:"lnglatToMercator",value:function(t,e){return e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]}},{key:"getDeg",value:function(t,e){-180<t[0]&&180>t[0]&&(t=this.lnglatToMercator(t[0],t[1]),e=this.lnglatToMercator(e[0],e[1]));var n=180*Math.atan((e[1]-t[1])/(e[0]-t[0]))/Math.PI;return e[0]>t[0]&&(n-=180),n}},{key:"getPoint",value:function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}},{key:"updatePoints",value:function(){for(var t=this.newData,e=[],n=0;n<t.length;n++){for(var r=t[n],i=Math.floor(this.index[n]),o=i+1;r[o][0]===r[i][0]&&r[o][1]===r[i][1];)o++;o>=r.length-1&&(o=--i),o=this.getDeg(r[i],r[o]),e.push({geometry:{type:"Point",coordinates:this.getPoint(r[i],r[i+1],this.index[n]%1)},angle:o-90})}this.pointData=e,this.gltfLayer.setData(e,{autoRender:!1})}},{key:"getCurrentPoint",value:function(){return this.pointData}},{key:"getDefaultOptions",value:function(){return{step:1}}},{key:"getDistance",value:function(t,e){var n=t[1]*Math.PI/180,r=e[1]*Math.PI/180;return t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((n-r)/2),2)+Math.cos(n)*Math.cos(r)*Math.pow(Math.sin((t[0]*Math.PI/180-e[0]*Math.PI/180)/2),2))),t=Math.round(6378137e4*t)/1e4}},{key:"_addPath",value:function(t){for(var e=t.length,n=0,r=[],i=[],o=1;o<e;o++){var a=this.getDistance(t[o-1],t[o]);r.push(a),n+=a}for(a=[0],o=1;o<e;o++){var s=(r[o-1]/n).toFixed(2);a[o]=a[o-1]+parseFloat(s,10),i=i.concat(this._getPath(t[o-1],t[o],1e3*s))}return this._pathPercents=a,i}},{key:"_getPath",value:function(t,e,n){if(0===n)return[t];for(var r=[],i=0;i<=n;i++)r.push([(e[0]-t[0])/n*i+t[0],(e[1]-t[1])/n*i+t[1]]);return r}},{key:"start",value:function(){this.isStarted=!0}},{key:"stop",value:function(){this.isStarted=!1}},{key:"render",value:function(t){if(Vr(e.prototype.__proto__||rn(e.prototype),"render",this).call(this,t),t=this.getOptions(),this.isStarted)for(var n=this.newData,r=0;r<this.index.length;r++)this.index[r]+=t.step,this.index[r]>n[r].length-2&&(this.index[r]=0);this.updatePoints()}}]),e}(Bo);Jt.prototype.parseColors=function(t){this.arrFeatureStyles=[[2,t[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]},Jt.prototype.setColors=function(t){this.parseColors(t)},Jt.prototype.initialize=function(t){this._initialize||(this._initialize=!0)},Jt.prototype.clearCache=function(t){this.cache={}},Jt.prototype.setMap=function(t){t?(this.map=t,this._initialize?this.canvaslayer.show():this.initialize(t)):this.canvaslayer.hide()},Jt.prototype.draw=function(t){t=t||{},t.clearCache&&this.clearCache(),this.canvaslayer.draw()},Jt.prototype.clear=function(){},Jt.prototype.update=function(){var t=this.map,e=this.getDataZoom(),n=Math.pow(2,18-e),r=256*n,i=t.getCenter(),o=Math.ceil(i.lng/r),a=Math.ceil(i.lat/r),s=this.tileSize,u=e-Math.round(t.getZoom());for(0<u&&(s/=Math.pow(2,u)),r=[o,a,(i.lng-o*r)/r*s,(i.lat-a*r)/r*s],o=t.getBounds(),i=o.getNorthEast(),o=o.getSouthWest(),t.getSize(),t.getSize(),t=(i.lng-o.lng)/n,n=(i.lat-o.lat)/n,i=r[1]-Math.ceil((n/2-r[3])/s),o=r[0]+Math.ceil((t/2+r[2])/s),a=r[1]+Math.ceil((n/2+r[3])/s),n=[],s=r[0]-Math.ceil((t/2-r[2])/s);s<o;s++)for(r=i;r<a;r++)n.push([s,r,e]);for(this.tilesOrder=n,this._loadCount={},s=0;s<n.length;s++)r=n[s][0],t=n[s][1],this._loadCount[r+"_"+t+"_"+n[s][2]]=!1;for(s=0;s<n.length;s++)r=n[s][0],t=n[s][1],this.showTile(r,t,e)},Jt.prototype.showTile=function(t,e,n){this._parseDataAndDraw(t,e,n)},Jt.prototype.drawCurrentData=function(){this.clear();for(var t=[],e=0;e<this.tilesOrder.length;e++){var n=this.tilesOrder[e][0],r=this.tilesOrder[e][1],i=this.tilesOrder[e][2],o=this.cache[this.getCacheKey(n,r,i)];if(o)for(n=this._drawFeatures(o,n,r,i),r=0;r<n.length;r++)t.push(n[r])}this.lineLayer.setData(t)},Jt.prototype.isAllLoaded=function(){var t,e=!0;for(t in this._loadCount)if(!this._loadCount[t]){e=!1;break}return e},Jt.prototype.getCacheKey=function(t,e,n){return t+"_"+e+"_"+n},Jt.prototype.getDataZoom=function(){var t=Math.round(this.map.getZoom());return 19<t&&(t=19),t},Jt.prototype._parseDataAndDraw=function(t,e,n){var r=this,i=r.map,o=i.getCenter(),a=Math.round(i.getZoom()),s=this.getCacheKey(t,e,n),u="_cbk"+(1e5*Math.random()).toFixed(0),l=this.getTileUrl(t,e,n,"BMapGL."+u);BMapGL[u]=function(l){r._loadCount[t+"_"+e+"_"+n]=!0;var h=i.getCenter(),c=Math.round(i.getZoom());h.equals(o)&&c===a?(h=l.content&&l.content.tf,l.data&&(h=l.data),r.cache[s]=h?{traffic:h,precision:l.precision}:null,r.drawTogether&&r.isAllLoaded()&&r.drawCurrentData()):c!==a&&r.clear(),delete BMapGL[u]},void 0!==r.cache[s]?(r._loadCount[t+"_"+e+"_"+n]=!0,r.drawTogether&&r.isAllLoaded()&&r.drawCurrentData()):this.request(l)},Jt.prototype.getTileUrl=function(t,e,n,r){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+t+"&y="+e+"&z="+n+"&fn="+r+"&t="+(new Date).getTime()},Jt.prototype._drawFeatures=function(t,e,n,r){var i=10;r=Math.pow(2,18-r),this.map.getCenter();var o=this.tileSize;if(e=[e*o*r,(n+1)*o*r],n=[],t&&t.traffic){i*=t.precision,t=t.traffic,o=0;for(var a=t.length;o<a;o++){var s=t[o],u=s[1];s=this.arrFeatureStyles[s[3]];var l=u[0]/i,h=-u[1]/i,c=[];c.push([e[0]+l*r,e[1]+h*r]);for(var f=2,p=u.length;f<p;f+=2)l+=u[f]/i,h-=u[f+1]/i,c.push([e[0]+l*r,e[1]+h*r,1]);n.push({color:s[1],geometry:{type:"LineString",coordinates:c}})}}return n},Jt.prototype.request=function(t,e){if(e){var n=(1e5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+n]=function(t){e&&e(t),delete BMapGL._rd["_cbk"+n]},t+="&callback=BMapGL._rd._cbk"+n}var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.src=t,r.addEventListener?r.addEventListener("load",function(t){t=t.target,t.parentNode.removeChild(t)},!1):r.attachEvent&&r.attachEvent("onreadystatechange",function(t){!(t=window.event.srcElement)||"loaded"!==t.readyState&&"complete"!==t.readyState||t.parentNode.removeChild(t)}),setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(r),r=null},1)},Jt.prototype.getRGBA=function(t){return"rgba("+((t>>>=0)>>24&255)+","+(t>>16&255)+","+(t>>8&255)+","+(255&t)/256+")"},Jt.prototype.getLineCap=function(t){return["butt","square","round"][t]},Jt.prototype.getLineJoin=function(t){return["miter","bevel","round"][t]};var Lu=function(t){function e(t){an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t)),t.autoUpdate=!0,t.getOptions();var n=new za({color:"rgba(257, 254, 47, 0.9)",zoom:18,duration:.8,interval:.2,trailLength:.4}),r=new na({height:5,color:"rgba(257, 254, 47, 0.9)",trailLength:2,step:.02,startTime:0,endTime:4});return t.lineLayer=n,t.wallTripLayer=r,t.children=[n,r],t}return $r(e,t),fn(e,[{key:"initialize",value:function(t){Vr(e.prototype.__proto__||rn(e.prototype),"initialize",this).call(this,t),t=this.map.map;var n=new Jt({});n.lineLayer=this.lineLayer,n.wallTripLayer=this.wallTripLayer,this.trafficTileManager=n,n.setMap(t),n.update(),t.addEventListener("moveend",function(){n.update()}),t.addEventListener("zoomend",function(){n.update()}),t.addEventListener("ondraw",function(){})}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"getDefaultOptions",value:function(){return{}}}]),e}(Bo),Ru=function(t){function e(t,n){return an(this,e),t=Br(this,(e.__proto__||rn(e)).call(this,t,n)),t.bufferData=[],t}return $r(e,t),fn(e,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var n=this.getOptions();this.inverseMatrix=xo.create(Float64Array),this.frameBuffer=new Gi(t),this.webglLayer.map.onResize(function(){e.frameBuffer=new Gi(t)}),this.circle=Kt(64),this.circleTexture=S(t,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.intensity=new w({gradient:n.gradient}),this.paletteTexture=S(t,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.offlineProgram=new Hi(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this),this.offlineBuffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineIndexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineVertexArray=new Xi({gl:t,program:this.offlineProgram,attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]}),this.indexBuffer=new qi({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.program=new Hi(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}vec4 color=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));gl_FragColor=vec4(color.rgb,grayAlpha);}"},this),this.buffer=new qi({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Xi({gl:t,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,size:2,type:"FLOAT",offset:0}]}),n=[];for(var r=[],i=Math.floor(t.canvas.width/4),o=Math.floor(t.canvas.height/4),a=i+1,s=0;s<=o;s++)for(var u=0;u<=i;u++)if(n.push(2*u/i-1,2*s/o-1),u<i&&s<o){var l=a*s+u,h=a*(s+1)+u;r.push(l,l+1,h+1),r.push(l,h+1,h)}this.bufferData=n,this.buffer.updateData(new Float32Array(n)),this.indexData=r,this.indexBuffer.updateData(new Uint32Array(r))}},{key:"onOptionsChanged",value:function(t,e){var n=this.gl;n&&t.gradient!==e.gradient&&(this.intensity=new w({gradient:t.gradient}),this.paletteTexture=S(n,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(t){if(this.gl){var e=[],n=[];this.getOptions();for(var r=0;r<t.length;r++){var i=t[r],o=this.normizedPoint(t[r].geometry.coordinates),a=void 0===i.count?1:i.count;"properties"in i&&"count"in i.properties&&(a=i.properties.count),e.push(o[0],o[1],o[2]),e.push(-1,-1),e.push(a),e.push(o[0],o[1],o[2]),e.push(-1,1),e.push(a),e.push(o[0],o[1],o[2]),e.push(1,1),e.push(a),e.push(o[0],o[1],o[2]),e.push(1,-1),e.push(a),i=4*r,n.push(i+0,i+2,i+1),n.push(i+0,i+3,i+2)}this.offlineBufferData=e,this.offlineIndexData=n,this.offlineBuffer.updateData(new Float32Array(e)),this.offlineIndexBuffer.updateData(new Uint32Array(n))}}},{key:"render",value:function(t){var e=t.gl,n=t.matrix,r=t.pointToPixelMatrix,i=t.pixelToViewMatrix;if(t=t.projectionMatrix,this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var o=this.getOptions();e.enable(e.BLEND),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this.offlineProgram.use(e),this.offlineProgram.setUniforms({u_matrix:n,uCircle:this.circleTexture,pointToPixelMatrix:r,pixelToViewMatrix:i,projectionMatrix:t,unit:"px"===o.unit?1:0,size:o.size,max:o.max,min:o.min}),this.offlineVertexArray.bind(),this.offlineIndexBuffer.bind(),e.drawElements(e.TRIANGLES,this.offlineIndexData.length,e.UNSIGNED_INT,0),e.bindFramebuffer(e.FRAMEBUFFER,null),this.program.use(e),this.vertexArray.bind(),n=this.inverseMatrix,xo.identity(n),xo.multiply(n,t,i),xo.invert(n,n),e.enable(e.DEPTH_TEST),e.disable(e.BLEND),this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:o.height,pixelToViewMatrix:i,inverseMatrix:n,projectionMatrix:t}),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,this.indexData.length,e.UNSIGNED_INT,0)}}}]),e}(no),Ou=function(){function t(e){an(this,t),this.layers=[],this.options=e,this.webglLayer=e.webglLayer}return fn(t,[{key:"addLayer",value:function(t){for(var e=!1,n=0;n<this.layers.length;n++)if(this.layers[n]===t){e=!0;break}e||(t.map=this.webglLayer.map,"threeLayer"===t.layerType?(t.setWebglLayer(this.webglLayer),e=t.getThreeLayer(),this.addLayer(e),t.initialize&&t.initialize(e)):(t.setWebglLayer(this.webglLayer),t.commonInitialize&&t.commonInitialize(this.webglLayer.gl),t.initialize&&t.initialize(this.webglLayer.gl),t.onOptionsChanged(t.getOptions(),{}),t.onDataChanged(t.getData()),t.onChanged(t.getOptions(),t.getData())),this.layers.push(t)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&(t.destroy&&t.destroy(),this.layers.splice(e,1));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];e.destroy&&e.destroy(),this.layers.splice(t,1)}this.webglLayer.render()}},{key:"getAllLayers",value:function(){return this.layers}},{key:"getAllThreeLayers",value:function(){for(var t=[],e=0;e<this.layers.length;e++){var n=this.layers[e];"ThreeLayer"===n.layerType&&t.push(n)}return t}},{key:"isRequestAnimation",value:function(){for(var t=!1,e=0;e<this.layers.length;e++)if(this.layers[e].isRequestAnimation()){t=!0;break}return t}},{key:"beforeRender",value:function(t){t.gl&&this.webglLayer.stateManager.save()}},{key:"afterRender",value:function(t){t.gl&&this.webglLayer.stateManager.restore()}},{key:"renderGLLayers",value:function(t){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setDefaultState();for(var e=0;e<this.layers.length;e++){var n=this.layers[e];"threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType&&(this.beforeRender(t),t.gl.enable(t.gl.DEPTH_TEST),t.gl.depthFunc(t.gl.LEQUAL),t.gl.enable(t.gl.POLYGON_OFFSET_FILL),t.gl.polygonOffset(1,1),n.render(t),this.afterRender(t))}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",value:function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];"ThreeLayer"===n.layerType&&n.render(t)}}},{key:"renderThreeLayers",value:function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];"threeLayer"===n.layerType&&(this.beforeRender(t),n.render(t),this.afterRender(t))}}},{key:"onClick",value:function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];if("threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType&&n.options.enablePicked&&n.options.onClick&&n.pick){var r=n.pick(t.x,t.y);n.options.onClick(r,t)}}}},{key:"onDblClick",value:function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];if("threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType&&n.options.enablePicked&&n.options.onDblClick&&n.pick){var r=n.pick(t.x,t.y);n.options.onDblClick(r,t)}}}},{key:"onRightClick",value:function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];if("threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType&&n.options.enablePicked&&n.options.onRightClick&&n.pick){var r=n.pick(t.x,t.y);n.options.onRightClick(r,t)}}}},{key:"onMousemove",value:function(t){for(var e=!1,n=0;n<this.layers.length;n++){var r=this.layers[n];if("threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType&&r.options.enablePicked&&r.pick){var i=r.pick(t.x,t.y);this.webglLayer.map.map.platform.style.cursor=-1===i.dataIndex?"default":"pointer",r.options.onMousemove&&r.options.onMousemove(i,t),r.options.autoSelect&&(e=!0)}}e&&(this.webglLayer.isAnimation||this.webglLayer.render())}}]),t}(),ku=function(){function t(e){var n=this;an(this,t),this.options={autoUpdate:!0},Ke(this.options,e);var r=e.pointOffset;this.webglLayer=e.webglLayer||new Aa(e.map,this.options),this.layerManager=new Ou({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new eo(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender(function(t){n._render(t)}),this.webglLayer.onClick=function(t){n.layerManager.onClick(t)},this.webglLayer.onDblClick=function(t){n.layerManager.onDblClick(t)},this.webglLayer.onRightClick=function(t){n.layerManager.onRightClick(t)},this.webglLayer.onMousemove=function(t){n.layerManager.onMousemove(t)},r||"cesium"===this.webglLayer.options.mapType||(r=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[r.lng,r.lat]),this.webglLayer.map.onResize(function(){n.effectManager.onResize()}),(this.postProcessing=e.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),e=this.postProcessing.getThreeLayer(),this.addLayer(e),this.postProcessing.initialize(e),e.postProcessing=this.postProcessing)}return fn(t,[{key:"renderCanvas",value:function(t){var e=this;this.postProcessing?(this.postProcessing.addRender(function(){e.renderGLLayers(t)}),this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t)):(this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t),this.layerManager.renderGLLayers(t))}},{key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(t){var e=this,n=this.options.effects;n&&0<n.length?(this.webglRender.render=function(){e.renderCanvas(t)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(t),this.webglLayer.restoreFramebuffer())}},{key:"onRender",value:function(t){this.webglLayer.onRender(t)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.removeAllLayers(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"addLayer",value:function(t){this.layerManager.addLayer(t)}},{key:"removeLayer",value:function(t){this.layerManager.removeLayer(t)}},{key:"getAllLayers",value:function(){return this.layerManager.getAllLayers()}},{key:"getAllThreeLayers",value:function(){return this.layerManager.getAllThreeLayers()}}]),t}();window._hmt=window._hmt||[],function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),e.View=ku,e.GridLayer=Do,e.HeatGridLayer=zo,e.ShapeLayer=Fo,e.SimpleLineLayer=Io,e.LineLayer=$o,e.ELineLayer=ta,e.WallSpriteLayer=na,e.LinePointLayer=sa,e.WallLayer=la,e.WallTripLayer=ca,e.HeatLineLayer=fa,e.HoneycombLayer=ya,e.WebglLayer=Aa,e.PointLayer=Pa,e.GroundRippleLayer=Sa,e.RippleLayer=Ca,e.SparkLayer=La,e.ClusterLayer=Ra,e.HeatPointLayer=Oa,e.ShapeLineLayer=ka,e.PointTripLayer=Da,e.LineTripLayer=Ba,e.LineFlowLayer=za,e.TileLayer=Ia,e.IconLayer=Gs,e.PolygonLayer=Js,e.CarLineLayer=Cu,e.Layer=no,e.TextLayer=ga,e.TrafficLayer=Lu,e.GltfLayer=Pu,e.HeatmapLayer=Ru,e.BlurEffect=Ki,e.BloomEffect=$i,e.BrightEffect=Qi,e.DepthEffect=to,e.EffectManager=eo,e.getContext=P,e.createTexture=S,e.loadTextureImage=C,e.FrameBufferObject=Gi,e.Program=Hi,e.StateManager=Wi,e.Buffer=qi,e.VertexArray=Xi,e.CommonLayer=Vi,e.MercatorProjection=m,e.Canvas=_,e.Intensity=w,e.BezierCurve=M,e.GeodesicCurve=A,e.OdCurve=Yi,e.toRadian=f,e.toAngle=p,e.ceilPowerOfTwo=d,e.floorPowerOfTwo=v,e.approximatelyEqual=g,e.__moduleExports=po,e.vec4=vo,e.vec3=go,e.vec2=mo,e.quat2=yo,e.quat=bo,e.mat4=xo,e.mat3=_o,e.mat2d=wo,e.mat2=Mo,e.glMatrix=To,Object.defineProperty(e,"__esModule",{value:!0})})}).call(e,n(45))},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);Object.defineProperty(e,"Map",{enumerable:!0,get:function(){return r(i).default}});var o=n(6);Object.defineProperty(e,"Marker",{enumerable:!0,get:function(){return r(o).default}});var a=n(7);Object.defineProperty(e,"MarkerOrderTip",{enumerable:!0,get:function(){return r(a).default}});var s=n(24);Object.defineProperty(e,"InfoWindow",{enumerable:!0,get:function(){return r(s).default}});var u=n(25);Object.defineProperty(e,"NavigationControl",{enumerable:!0,get:function(){return r(u).default}});var l=n(26);Object.defineProperty(e,"OverviewMapControl",{enumerable:!0,get:function(){return r(l).default}});var h=n(27);Object.defineProperty(e,"ScaleControl",{enumerable:!0,get:function(){return r(h).default}});var c=n(28);Object.defineProperty(e,"MapTypeControl",{enumerable:!0,get:function(){return r(c).default}});var f=n(29);Object.defineProperty(e,"PanoramaControl",{enumerable:!0,get:function(){return r(f).default}});var p=n(30);Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return r(p).default}});var d=n(31);Object.defineProperty(e,"Polyline",{enumerable:!0,get:function(){return r(d).default}});var v=n(32);Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return r(v).default}});var g=n(33);Object.defineProperty(e,"Road",{enumerable:!0,get:function(){return r(g).default}});var m=n(37);Object.defineProperty(e,"Boundary",{enumerable:!0,get:function(){return r(m).default}});var y=n(38);Object.defineProperty(e,"MarkerList",{enumerable:!0,get:function(){return r(y).default}});var b=n(40);Object.defineProperty(e,"MapvMarkerList",{enumerable:!0,get:function(){return r(b).default}});var x=n(41);Object.defineProperty(e,"TrafficLayer",{enumerable:!0,get:function(){return r(x).default}});var _=n(42);Object.defineProperty(e,"Merge",{enumerable:!0,get:function(){return r(_).default}});var w=n(43);Object.defineProperty(e,"MapvLayer",{enumerable:!0,get:function(){return r(w).default}});var M=n(44);Object.defineProperty(e,"MapvglLayer",{enumerable:!0,get:function(){return r(M).default}});var T=n(46);Object.defineProperty(e,"MapvglView",{enumerable:!0,get:function(){return r(T).default}});var A=n(47);Object.defineProperty(e,"DrivingRoute",{enumerable:!0,get:function(){return r(A).default}});var E=n(48);Object.defineProperty(e,"PointLabel",{enumerable:!0,get:function(){return r(E).default}});var P=n(51);Object.defineProperty(e,"Arc",{enumerable:!0,get:function(){return r(P).default}});var S=n(52);Object.defineProperty(e,"ThickRay",{enumerable:!0,get:function(){return r(S).default}});var C=n(53);Object.defineProperty(e,"MapListener",{enumerable:!0,get:function(){return r(C).default}});var L=n(54);Object.defineProperty(e,"Autocomplete",{enumerable:!0,get:function(){return r(L).default}})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=r(u),h=n(0),c=r(h),f=n(12),p=function(t){function e(t){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return a(e,t),s(e,[{key:"componentDidMount",value:function(){this.initMap(),this.forceUpdate()}},{key:"componentDidUpdate",value:function(t){var e=t.center,n=this.props.center;if((0,f.isString)(n))e!=n&&this.map.centerAndZoom(n);else{var r=e&&n&&(e.lng!=n.lng||e.lat!=n.lat||this.props.forceUpdate),i=t.zoom!==this.props.zoom&&(this.props.zoom||this.props.forceUpdate),n=new BMap.Point(n.lng,n.lat);r&&i?this.map.centerAndZoom(n,this.props.zoom):r?this.map.setCenter(n):i&&this.map.zoomTo(this.props.zoom)}}},{key:"initMap",value:function(){var t=this,e=this.options;e=this.getOptions(e),!0!==this.props.enableMapClick&&(e.enableMapClick=!1);var n=new BMap.Map(this.refs.map,e);this.map=n;var r=this.props.zoom;if(this.bindEvent(n,this.events),(0,f.isString)(this.props.center))n.centerAndZoom(this.props.center);else{var i=new BMap.Point(this.props.center.lng,this.props.center.lat);n.centerAndZoom(i,r)}this.props.mapStyleV2?n.setMapStyleV2(this.props.mapStyleV2):this.props.mapStyle&&n.setMapStyle(this.props.mapStyle),this.bindToggleMeghods(n,this.toggleMethods);var o=r;n.addEventListener("zoomend",function(){var e=n.getZoom();t.props.zoom_changed&&t.props.zoom_changed(e,o),o=e})}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map)return l.default.Children.map(e,function(e){if(e)return"string"==typeof e.type?e:l.default.cloneElement(e,{map:t.map})})}},{key:"onRender",value:function(){if(this.props.render&&this.map)return this.props.render(this.map)}},{key:"render",value:function(){var t={height:"100%",position:"relative"};for(var e in this.props.style)t[e]=this.props.style[e];return l.default.createElement("div",{style:t,key:this.props.keys},l.default.createElement("div",{ref:"map",className:this.props.className,style:{height:"100%"}},"加载地图中..."),this.renderChildren(),this.onRender())}},{key:"events",get:function(){return["click","dblclick","rightclick","rightdblclick","maptypechange","mousemove","mouseover","mouseout","movestart","moving","moveend","zoomstart","zoomend","addoverlay","addcontrol","removecontrol","removeoverlay","clearoverlays","dragstart","dragging","dragend","addtilelayer","removetilelayer","load","resize","hotspotclick","hotspotover","hotspotout","tilesloaded","touchstart","touchmove","touchend","longpress"]}},{key:"toggleMethods",get:function(){return{enableScrollWheelZoom:["enableScrollWheelZoom","disableScrollWheelZoom"],enableDragging:["enableDragging","disableDragging"],enableDoubleClickZoom:["enableDoubleClickZoom","disableDoubleClickZoom"],enableKeyboard:["enableKeyboard","disableKeyboard"],enableInertialDragging:["enableInertialDragging","disableInertialDragging"],enableContinuousZoom:["enableContinuousZoom","disableContinuousZoom"],enablePinchToZoom:["enablePinchToZoom","disablePinchToZoom"],enableAutoResize:["enableAutoResize","disableAutoResize"]}}},{key:"options",get:function(){return["minZoom","maxZoom","mapType","enableMapClick"]}}],[{key:"defaultProps",get:function(){return{style:{height:"350px"}}}}]),e}(c.default);e.default=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14);Object.defineProperty(e,"obj",{enumerable:!0,get:function(){return r(i).default}});var o=n(18);Object.defineProperty(e,"bmap",{enumerable:!0,get:function(){return r(o).default}});var a=n(20);Object.defineProperty(e,"http",{enumerable:!0,get:function(){return r(a).default}})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(15),o=r(i),a=n(16),s=r(a),u=n(17),l=r(u),h={deepClone:o.default,merge:s.default,diff:l.default};e.default=h},function(t,e,n){"use strict";function r(t){return("object"===(void 0===t?"undefined":o(t))||"function"==typeof t)&&null!==t}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap,n=void 0,o=t.constructor;switch(o){case RegExp:n=new o(t);break;case Date:n=new o(t.getTime());break;default:if(e.has(t))return e.get(t);n=new o,e.set(t,n)}for(var a in t)n[a]=r(t[a])?i(t[a],e):t[a];return n}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,e){var n=JSON.parse(JSON.stringify(t));return function t(e,n){for(var i in n)"[object Object]"==Object.prototype.toString.call(n[i])?("object"!==r(e[i])&&(e[i]={}),t(e[i],n[i])):e[i]=n[i]}(n,e),n};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){var n={};return function t(e,n,r){var i={};e&&Object.keys(e).map(function(t){i[t]=!0}),n&&Object.keys(n).map(function(t){i[t]=!0});for(var o in i)if(e[o]&&"[object Object]"==Object.prototype.toString.call(e[o])&&n[o]&&"[object Object]"==Object.prototype.toString.call(n[o]))if(JSON.stringify(e[o])!==JSON.stringify(n[o])){r[o]||(r[o]={});var a=r[o];t(e[o],n[o],a)}else r[o]=n[o];else r[o]=n[o]}(t,e,n),0==Object.keys(n).length&&(n=null),n};e.default=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(19),s=r(a),u={createPoint:o.default,getPoints:s.default};e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(t){return t&&t.__esModule?t:{default:t}}(r),o=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];return t.split("|").forEach(function(t){for(var r=t?t.split(","):[],o=[],a=0;a<r.length-1;){var s={lng:parseFloat(r[a]),lat:parseFloat(r[a+1])};if(e)o.push(s);else{var u=(0,i.default)(s);o.push(u)}a+=2}n.push(o)}),1==n.length&&(n=n[0]),n};e.default=o},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(21),o=r(i),a=n(22),s=r(a);o.default.download=s.default,e.default=o.default},function(t,e,n){"use strict";function r(t){var e=null;if(/^http(s{0,1}):\/\//.test(t.url)){var n=location.href.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/),r=t.url.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/);e=2===n.length&&2===r.length&&r[1]===n[1]?this.ajax(t):this.jsonp(t)}else e=this.ajax(t);return e}function i(t){var e=this,n=new XMLHttpRequest,r=t.method||"GET",i=!1;if(n.open(r,t.url),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.withCredentials=!0,"GET"===r)n.send();else{n.withCredentials=!0,n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var o=Object.keys(t.data).map(function(e){return e+"="+t.data[e]});n.send(o.join("&"))}var a=setTimeout(function(){n.abort(),t.fail&&t.fail("timeout")},1e4);return n.onload=function(){this.status>=200&&this.status<300?t.success&&t.success(JSON.parse(this.response)):t.fail&&t.fail(this.statusText),t.complete&&t.complete(JSON.parse(this.response)),clearTimeout(a)},n.onerror=function(){t.fail&&t.fail(e.statusText),clearTimeout(a)},{abort:function(){i||(i=!0,n.abort())},params:t}}function o(t){var e="jsonp_"+ +new Date+"_"+parseInt(1e7*Math.random(),10),n=document.createElement("script"),r=!1;t.url+="-1"===t.url.indexOf("?")?"?":"&",t.url+="callback="+e,n.src=t.url,document.head.appendChild(n);var i=setTimeout(function(){null!==window[e]&&(window[e]=null,n.parentElement.removeChild(n),t.fail&&t.fail({error:null,msg:"timeout"}),t.complete&&t.complete(JSON.parse()))},1e4);return n.addEventListener("error",function(o){window[e]=null,n.parentElement.removeChild(n),clearTimeout(i),r||(t.fail&&t.fail({error:o,msg:"loaderror"}),t.complete&&t.complete())}),window[e]=function(o){clearTimeout(i),r||(t.success(o),t.complete&&t.complete()),window[e]=null,n.parentElement.removeChild(n)},{abort:function(){clearTimeout(i),r=!0},params:t}}Object.defineProperty(e,"__esModule",{value:!0});var a={fetch:r,ajax:i,jsonp:o};e.default=a},function(t,e,n){"use strict";function r(t,e){var n=document.createElement("a");n.style.display="none";var r=new Blob([t]);n.href=URL.createObjectURL(r),n.href=t,e&&(n.download=e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r},function(t,e,n){"use strict";function r(t,e,n){this.options=n||{},this._point=t,this.content=e}Object.defineProperty(e,"__esModule",{value:!0}),r.prototype=new BMap.Overlay,r.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.setAttribute("tag","customoverlay"),e.style.position="absolute";var n=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat);e.style.zIndex=n,e.addEventListener("touchstart",function(t){t.stopPropagation(),console.log("touchstart")}),e.addEventListener("touchend",function(t){t.stopPropagation(),console.log("touchend")}),"[object String]"==Object.prototype.toString.call(this.content)?e.innerHTML=this.content:e.appendChild(this.content);var r=this.options.pane||"labelPane";return t.getPanes()[r].appendChild(e),e},r.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point),n=this.options.offset||new BMap.Size(0,0);this._div.style.left=e.x+n.width+"px",this._div.style.top=e.y+n.height+"px"},e.default=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(4),u=n(0),l=function(t){return t&&t.__esModule?t:{default:t}}(u),h=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.closeInfoWindow(),this.infoWindow=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy();if(this.infoWindow=new BMap.InfoWindow(this.props.text||"",this.getOptions(this.options)),this.bindEvent(this.infoWindow,this.events),t.openInfoWindow(this.infoWindow,new BMap.Point(this.props.position.lng,this.props.position.lat)),"children"in this.props){var e=document.createElement("div");(0,s.render)(this.props.children,e),this.infoWindow.setContent(e)}}}},{key:"options",get:function(){return["width","height","maxWidth","offset","title","enableAutoPan","enableCloseOnClick","enableMessage","message"]}},{key:"events",get:function(){return["close","open","maximize","restore","clickclose"]}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getControl",value:function(){return new BMap.NavigationControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","showZoomInfo","enableGeolocation"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getControl",value:function(){return new BMap.OverviewMapControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","size","isOpen"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getControl",value:function(){return new BMap.ScaleControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getControl",value:function(){return new BMap.MapTypeControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","mapTypes"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getControl",value:function(){return new BMap.PanoramaControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(5),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getOverlay",value:function(){var t=this.props.center,e=this.props.radius;return new BMap.Circle(t,e,this.getOptions(this.options))}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(5),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map(function(t){return new BMap.Point(t.lng,t.lat)}),new BMap.Polyline(t,this.getOptions(this.options))}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(5),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return o(e,t),a(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map(function(t){return new BMap.Point(t.lng,t.lat)}),new BMap.Polygon(t,this.getOptions(this.options))}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(0),l=r(u),h=n(2),c=n(35),f=r(c),p=n(36),d=r(p),v=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"getRoadPoints",value:function(t){for(var e=this.props.map.getMapType().getProjection(),n=[],r=0;r<t.length;r++)for(var i=t[r].split(","),o=0;o<i.length;o+=2)"bd09mc"===this.props.coordType?n.push(e.pointToLngLat(new BMap.Pixel(i[o],i[o+1]))):n.push(new BMap.Point(i[o],i[o+1]));return n}},{key:"updateViewport",value:function(){var t=this,e=(this.props.roadPath,[]);this.props.roadPaths?this.props.roadPaths.forEach(function(n){e=e.concat(t.getRoadPoints(n))}):this.props.roadPath&&(e=e.concat(this.getRoadPoints(this.props.roadPath))),e.length>0&&!1!==this.props.autoViewport&&this.props.map.setViewport(e,this.props.viewportOptions)}},{key:"getRoadGroup",value:function(t,e,n){var t=t,e=e,n=n,r={},i=[];if(e)for(var o=0;o<e.length;o++)r[e[o]]||(r[e[o]]={roadPath:[],color:n[e[o]]}),i.push(t[o]),r[e[o]].roadPath.push(t[o]);else r[0]={roadPath:t,color:this.props.color||"#1495ff"};return{group:r,allPath:d.default.mergeRoadPath(t)}}},{key:"isClick",value:function(t,e,n){var r=this.canvasLayer.canvas.getContext("2d"),i=this.getRoadGroup(n);r.beginPath();var o=this.props.lineWidth||10;return f.default.drawRoads(t,r,i.allPath,{color:this.props.bgColor||"#fff",lineWidth:o+4,lineCap:"butt",arrow:!1,line:!1}),r.lineWidth=o+6,r.isPointInStroke(e.x*window.devicePixelRatio,e.y*window.devicePixelRatio)}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){var n=this.canvasLayerUpdate.bind(this);this.canvasLayer?this.canvasLayer.draw():(this.canvasLayer=new h.baiduMapCanvasLayer({zIndex:this.props.zIndex,map:e,update:function(){n(this)}}),this.props.onClick&&e.addEventListener("click",function(n){var r=!1;if(t.props.roadPaths)for(var i=0;i<t.props.roadPaths.length;i++){var o=t.props.roadPaths[i];r=t.isClick(e,n.pixel,o),r&&t.props.onClick(i)}else t.props.roadPath&&(r=t.isClick(e,n.pixel,t.props.roadPath))&&t.props.onClick()})),this.updateViewport()}}},{key:"canvasLayerUpdate",value:function(t){var e=this,n=t.canvas.getContext("2d");if(!n)return!1;n.clearRect(0,0,n.canvas.width,n.canvas.height);var r=this.props.roadPath,i=this.props.roadPaths,o=this.props.lineWidth||10;i?i.forEach(function(t,r){e.props.lineWidths&&(o=e.props.lineWidths[r]),e.drawRoad(n,t,e.props.category,e.props.splitList,o)}):r&&this.drawRoad(n,this.props.roadPath,this.props.category,this.props.splitList,o)}},{key:"drawRoad",value:function(t,e,n,r,i){var o=this.getRoadGroup(e,n,r),a=o.group;f.default.drawRoads(this.props.map,t,o.allPath,{color:this.props.bgColor||"#fff",coordType:this.props.coordType,lineWidth:i+4,lineCap:"butt",arrow:!1,line:!0});for(var s in a){var u=a[s],e=d.default.mergeRoadPath(u.roadPath);f.default.drawRoads(this.props.map,t,e,{color:u.color,coordType:this.props.coordType,line:!0,lineWidth:i,lineCap:"butt",arrow:!1})}f.default.drawRoads(this.props.map,t,o.allPath,{color:u.color,coordType:this.props.coordType,lineWidth:i,border:{},lineCap:"butt",arrow:!1!==this.props.isShowArrow&&{width:5,height:3,color:this.props.arrowColor}})}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.canvasLayer.hide()}}]),e}(l.default);e.default=v},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function o(t){if(c===clearTimeout)return clearTimeout(t);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(t);try{return c(t)}catch(e){try{return c.call(null,t)}catch(e){return c.call(this,t)}}}function a(){v&&p&&(v=!1,p.length?d=p.concat(d):g=-1,d.length&&s())}function s(){if(!v){var t=i(a);v=!0;for(var e=d.length;e;){for(p=d,d=[];++g<e;)p&&p[g].run();g=-1,e=d.length}p=null,v=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var h,c,f=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(t){c=r}}();var p,d=[],v=!1,g=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new u(t,e)),1!==d.length||v||i(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={0:"#fff",1:"#00dc35",2:"#f3e032",3:"#ff6c6c",4:"#900000"},i={drawRoads:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=t.getZoom(),a=i.lineWidth||5,s=void 0===i.level?1:i.level,u=null,l=0,h=0,c=[],f=[],p=[],d=0,v=0;e.beginPath();var g,m=Math.pow(2,18-t.getZoom()),y=t.getMapType().getProjection(),b=y.lngLatToPoint(t.getCenter()),x=new BMap.Pixel(b.x-t.getSize().width/2*m,b.y+t.getSize().height/2*m);return n.forEach(function(n,r){var o=null;u=null;for(var a=n.split(","),s=0;s<a.length;s+=2){var y=new BMap.Point(a[s],a[s+1]);f.push(y),g="bd09mc"===i.coordType?{x:(y.lng-x.x)/m,y:(x.y-y.lat)/m}:t.pointToPixel(y);var b=void 0;if(u){var _=g.x-u.x,w=g.y-u.y;l=Math.sqrt(_*_+w*w),h+=l,i.arrow&&(d+=l,v+=l,b={start:u,end:g,offset:50-(d-l),depth:l,totalDepth:v},c.push(b),d>=50&&(p.push(b),d%=50))}u=g,0===s?(o=o||g,e.moveTo(g.x,g.y)):(h>15||s>=a.length-2)&&(h=0,e.lineTo(g.x,g.y))}if(i.arrow&&r===n.length-1&&v<100){var M=c[Math.ceil(c.length/2)];for(var T in c)if(c[T].totalDepth>=v/2){M=c[T+1]?c[T+1]:c[T];break}var A=c[c.length-1];M.end=A.end,p=[],p.push(M)}}),i.line&&(e.lineCap=i.lineCap||"round",e.lineJoin="round",i.border&&(e.strokeStyle=i.border.color||"white",e.lineWidth=(o<=13?a-2:a)+(2*i.border.lineWidth||4),e.stroke()),e.strokeStyle=i.color||r[s]||"#fc2c2b",e.lineWidth=o<=13?a-2:a,e.stroke()),i.arrow&&this.drawArrow(e,p,i),f},drawArrow:function(t,e,n){t.beginPath(),e.forEach(function(r){var i=r.start.x,o=r.start.y,a=r.end.x,s=r.end.y,u=a-i,l=s-o,h=[0,-1],c=[r.end.x-r.start.x,r.end.y-r.start.y],f=h[0]*c[0]+h[1]*c[1],p=Math.sqrt(h[0]*h[0]+h[1]*h[1]),d=Math.sqrt(c[0]*c[0]+c[1]*c[1]),v=Math.acos(f/(p*d));c[0]<0&&(v=2*Math.PI-v);for(var g=n.arrow.width/2||2,m=n.arrow.height||g,y=0;r.offset+50*y<=r.depth;){var b=r.offset+50*y,x=b/r.depth;t.save(),t.translate(i+u*x,o+l*x),t.rotate(v),t.moveTo(1.618*-g,m),t.lineTo(0,0),t.lineTo(1.618*g,m),t.restore(),y+=1}1===e.length&&r.offset>r.depth&&(t.save(),t.translate(i,o),t.rotate(v),t.moveTo(1.618*-g,m),t.lineTo(0,0),t.lineTo(1.618*g,m),t.restore())}),t.strokeStyle=n.arrow.color||"#fff",t.lineWidth=3,t.stroke()}};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={mergeRoadPath:function(t,e){for(var n=[],r=0;r<t.length;r++)if(0==n.length)n.push(t[r]);else{var i=t[r].split(","),o=n[n.length-1].split(",");if(i[0]===o[o.length-2]&&i[1]===o[o.length-1]){var a=i.slice(2);n[n.length-1]+=","+a.join(",")}else n.push(t[r])}return n},uniqueRoadPath:function(t){for(var e=0;e<t.length-1;e++)if(t[e])for(var n=t[e].split(","),r=e+1;r<t.length;r++)if(t[r]){for(var i=t[r].split(","),o=!0,a=0;a<i.length;a+=2){var s=this.isPointOnPolyline({lng:i[a],lat:i[a+1]},n);0==s&&(o=!1)}o&&delete t[r]}return t},isPointOnPolyline:function(t,e){for(var n=e,r=0;r<n.length-2;r++){var i={lng:n[r],lat:n[r+1]},o={lng:n[r+2],lat:n[r+3]};if(t.lng>=Math.min(i.lng,o.lng)&&t.lng<=Math.max(i.lng,o.lng)&&t.lat>=Math.min(i.lat,o.lat)&&t.lat<=Math.max(i.lat,o.lat)){var a=(i.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(i.lat-t.lat),s=2e-10;if(s=2e-9,a<s&&a>-s)return!0}}return!1}};e.default=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=n(2),h=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this._allRequest={},this._backData={},this.initialize()}},{key:"componentWillUnmount",value:function(){this.mapvLayer&&(this.mapvLayer.destroy(),this.mapvLayer=null)}},{key:"getPointArrayByDataSetData",value:function(t){for(var e=[],n=0;n<t.length;n++){t[n].geometry.coordinates[0].forEach(function(t){e.push(new BMap.Point(t[0],t[1]))})}return e}},{key:"getBoundaryData",value:function(){function t(){var t=!0;for(var e in r._request)r._request[e]||(t=!1);if(t){r.dataSet.set(o);var i=r.getPointArrayByDataSetData(o);i.length>0&&!1!==r.props.autoViewport&&n.setViewport(i,r.props.viewportOptions)}}var e=this.props.data,n=this.props.map;if(e){this._request={};var r=this,i=new BMap.Boundary,o=[];e.forEach(function(t,e){r._request[t.name]=!1,r._backData[t.name]&&(o=o.concat(r._backData[t.name]),r._request[t.name]=!0)}),t(),e.forEach(function(e,n){r._request[e.name]||r._allRequest[e.name]||(r._allRequest[e.name]=!0,i.get(e.name,function(n){for(var i=[],a=0;a<n.boundaries.length;a++){for(var s=[],u=n.boundaries[a].split(";"),l=0;l<u.length;l++)s.push(u[l].split(","));i.push({geometry:{type:"Polygon",coordinates:[s]},count:e.count})}r._backData[e.name]=i,o=o.concat(i),r._request[e.name]=!0,t()}))})}}},{key:"initialize",value:function(){var t=this.props.map;if(t){if(!this.mapvLayer){this.dataSet=new l.DataSet([]);var e=this.props.layerOptions||{gradient:{0:"yellow",1:"red"},max:100,globalAlpha:.8,draw:"intensity"};this.mapvLayer=new l.baiduMapLayer(t,this.dataSet,e)}this.getBoundaryData()}}}]),e}(u.default);e.default=h},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(0),l=r(u),h=n(2),c=n(39),f=r(c),p=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)==JSON.stringify(this.props.data)&&this.map?this.setViewport():this.initialize()}},{key:"componentDidMount",value:function(){this.markers=[],this.initialize()}},{key:"componentWillUnmount",value:function(){this.clearMarkers(),this.textLayer&&(this.textLayer.destroy(),this.textLayer=null),this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"clearMarkers",value:function(){for(var t=0;t<this.markers.length;t++)this.map.removeOverlay(this.markers[t]),this.markers[t]=null;this.markers.length=0}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this.clearMarkers(),!this.textLayer){this.dataSet=new h.DataSet([]);var n=this.props.textOptions||{fillStyle:"#666666",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 0.1)",globalAlpha:"0.9",textAlign:"left",offset:{x:this.props.mini?10:15,y:0},coordType:this.props.coordType,avoid:!0,size:12,textKey:"text",draw:"text"};!1!==this.props.isShowText&&(this.textLayer=new h.baiduMapLayer(e,this.dataSet,n))}if(!this.animationLayer&&!0===this.props.animation){var r=this.props.splitList||{};r.other=this.props.fillStyle||"rgba(50, 50, 255, 0.5)";var i={styleType:"stroke",strokeStyle:this.props.fillStyle||"rgba(20, 249, 255, 0.5)",coordType:this.props.coordType,splitList:r,globalAlpha:.4,size:this.props.multiple||this.props.mini?20:26,minSize:this.props.multiple||this.props.mini?10:13,draw:"category"};this.animationLayer=new h.baiduMapAnimationLayer(e,this.dataSet,i)}for(var o=e.getMapType().getProjection(),a=this.props.data,s=[],u=0;u<a.length;u++)if((void 0===this.props.showIndex||this.props.showIndex==u)&&a[u].location){var l=a[u].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var c=o.pointToLngLat(new BMap.Pixel(l[0],l[1]));else var c=new BMap.Point(l[0],l[1]);var p=a[u].color||this.props.fillStyle||"#1495ff";this.props.splitList&&(p=this.props.splitList[a[u].count]?this.props.splitList[a[u].count]:this.props.splitList.other);var n={point:c,fillStyle:p,isShowNumber:this.props.isShowNumber,size:26,zIndex:a.length-u,number:u+1};(this.props.multiple||this.props.mini)&&(n.size=20,n.lineWidth=0,(u>=10||this.props.mini)&&(n.isShowNumber=!1,n.size=10,n.strokeStyle=p,n.lineWidth=3,n.strokeOpacity=.4));var d=new f.default(n);d.addEventListener("click",function(e,n){t.props.onClick&&t.props.onClick(n-1)}),d.addEventListener("mouseover",function(e,n){t.props.onMouseOver&&t.props.onMouseOver(n-1)}),d.addEventListener("mouseout",function(e,n){t.props.onMouseOut&&t.props.onMouseOut(n-1)}),d.index=u,this.markers.push(d),s.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:a[u].count,text:a[u].text})}for(var v=this.markers.length;v--;)e.addOverlay(this.markers[v]);this.props.mini?this.dataSet.set(s):this.dataSet.set(s.splice(0,10)),this.setViewport()}}},{key:"setViewport",value:function(){var t=this.props.map;if(t){for(var e=this.props.data,n=t.getMapType().getProjection(),r=[],i=0;i<e.length;i++)if(e[i].location){var o=e[i].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var a=n.pointToLngLat(new BMap.Pixel(o[0],o[1]));else var a=new BMap.Point(o[0],o[1]);r.push(a)}r.length>0&&!1!==this.props.autoViewport&&t.setViewport(r,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(l.default);e.default=p},function(t,e,n){"use strict";function r(t){this.options=t||{},this._point=t.point,this._fillColor=t.fillStyle||"#1495ff",this._size=t.size||30,this._lineWidth=void 0===t.lineWidth?2:t.lineWidth,this._strokeStyle=t.strokeStyle||"#ffffff",t.strokeOpacity&&(this._strokeStyle=i(this._strokeStyle,.4))}function i(t,e){var n=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,r=t.toLowerCase();if(r&&n.test(r)){if(4===r.length){for(var i="#",o=1;o<4;o+=1)i+=r.slice(o,o+1).concat(r.slice(o,o+1));r=i}for(var a=[],o=1;o<7;o+=2)a.push(parseInt("0x"+r.slice(o,o+2)));return e?(a.push(e),"rgba("+a.join(",")+")"):"rgb("+a.join(",")+")"}return r}Object.defineProperty(e,"__esModule",{value:!0}),r.prototype=new BMap.Overlay,r.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div"),n=e.style;n.position="absolute",n.backgroundClip="padding-box",n.zIndex=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat),n.backgroundColor=this._fillColor,!1!==this.options.isShowShadow&&(n.boxShadow="0 0 5px rgba(0, 0, 0, 0.5)"),n.border=this._lineWidth+"px solid "+this._strokeStyle,n.color="white",n.textShadow="0px 0px 5px #fff",n.width=this._size+"px",n.boxSizing="content-box",n.borderRadius="30px",n.height=this._size+"px",n.lineHeight=this._size+"px",n.fontSize="12px",n.cursor="pointer",n.textAlign="center",n.MozUserSelect="none",this.options.number&&!1!==this.options.isShowNumber&&(e.innerHTML=this.options.number);var r=this;return e.addEventListener("mouseover",function(){r.dispatchEvent("mouseover",r.options.number),n.backgroundColor="#1495ff"}),e.addEventListener("mouseout",function(){r.dispatchEvent("mouseout",r.options.number),n.backgroundColor=r._fillColor}),e.addEventListener("click",function(){r.dispatchEvent("click",r.options.number)}),e.addEventListener("touchstart",function(t){t.stopPropagation()}),e.addEventListener("touchmove",function(t){t.stopPropagation()}),e.addEventListener("touchend",function(t){t.stopPropagation()}),t.getPanes().markerPane.appendChild(e),e},r.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x-(this._size+this._lineWidth)/2-1+"px",this._div.style.top=e.y-(this._size+this._lineWidth)/2-2+"px"},e.default=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=n(2),h=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)==JSON.stringify(this.props.data)&&this.map||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.map=t,this._createLayer||this.createLayers(),this.showDatasets(this.props.data))}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.shadowSet=null,this.circleSet=null,this.textSet=null,this.numSet=null,this.otherSet=null,this.otherShadowSet=null;for(var t=0;t<this.layers.length;t++)this.layers[t].destroy(),this.layers[t]=null}},{key:"showDatasets",value:function(t){var e=this,n=[],r=[],i=[],o=[],a=[],s=[];t.length>0&&(t.forEach(function(t,u){var l=t.location.split(","),h=e.project.pointToLngLat(new BMap.Pixel(l[0],l[1]));s.push(h),u<10?(n.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count)}),r.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t.count),text:parseInt(u)+1}),i.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count),text:t.text})):(o.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t.count)}),a.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count)}))}),this.shadowSet.set(n),this.circleSet.set(r),this.textSet.set(i),this.numSet.set(r),this.otherSet.set(o),this.otherShadowSet.set(a),s.length>0&&!1!==this.props.autoViewport&&map.setViewport(s,self.props.viewportOptions))}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.project=t.getMapType().getProjection();var e=this,n=this.shadowSet=new l.DataSet([]),r=this.circleSet=new l.DataSet([]),i=this.textSet=new l.DataSet([]),o=this.numSet=new l.DataSet([]),a=this.otherSet=new l.DataSet([]),s=this.otherShadowSet=new l.DataSet([]);this.layers=[];var u={coordType:"bd09mc",splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",other:"#80db69"},shadowBlur:10,size:5,max:30,methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){a.update(function(t){t.fillStyle=null}),t?(e.isSmallPath=!0,e.props.map.setDefaultCursor("pointer"),a.update(function(t){t.fillStyle="#1495ff"},{id:t.id})):(e.isSmallPath=!1,e.isSmallPath||e.isBigPath||e.props.map.setDefaultCursor("auto"))}},draw:"category"},h={splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"fill",globalAlpha:.4,coordType:"bd09mc",size:8,minSize:5,draw:"category"};if(this.layers.push(new l.baiduMapLayer(t,s,h)),this.layers.push(new l.baiduMapLayer(t,a,u)),!0===this.props.animation){var c={splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"stroke",globalAlpha:.4,coordType:"bd09mc",size:20,minSize:10,draw:"category"};this.layers.push(new l.baiduMapAnimationLayer(t,n,c))}var f={splitList:{1:"#80db69",4:"#d53938",3:"#fe6261",2:"#ffb02d"},fillStyle:"red",coordType:"bd09mc",size:10,draw:"category",methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){r.update(function(t){t.fillStyle=null}),t?(e.isBigPath=!0,e.map.setDefaultCursor("pointer"),r.update(function(t){t.fillStyle="#1495ff"},{id:t.id})):(e.isBigPath=!1,e.isBigPath||e.isSmallPath||e.map.setDefaultCursor("auto"))}}};this.layers.push(new l.baiduMapLayer(t,r,f));var p={coordType:"bd09mc",draw:"text",font:"13px Arial",fillStyle:"#ffffff",shadowColor:"#ffffff",shadowBlur:10};this.layers.push(new l.baiduMapLayer(t,o,p));var d={coordType:"bd09mc",font:"13px Arial",fillStyle:"#666",shadowColor:"#ffffff",shadowBlur:10,draw:"text",avoid:!0,textAlign:"left",offset:{x:10,y:0}};this.layers.push(new l.baiduMapLayer(t,i,d))}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(u.default);e.default=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){var t=this.props.map;t&&t.removeTileLayer&&t.removeTileLayer instanceof Function&&this.tileLayer&&(t.removeTileLayer(this.tileLayer),this.tileLayer=null)}},{key:"initialize",value:function(){var t=this.props.map,e=this.props.tilesUrl?this.props.tilesUrl:"http://its.map.baidu.com:8002/traffic/TrafficTileService";if(t){if(!this.tileLayer){this.tileLayer=new BMap.TileLayer({isTransparentPng:!0});var n=Math.round(window.devicePixelRatio||1);n=Math.min(2,n),n=Math.max(1,n),this.tileLayer.getTilesUrl=function(t,r){var i=t.x,o=t.y,a=(new Date).getTime();return e+"?level="+r+"&x="+i+"&y="+o+"&time="+a+"&v=081&scaler="+n}}t.addTileLayer(this.tileLayer)}}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t){this.polyline=t;for(var e=t[0],n=t[0],r=t[1],i=t[1],o=2;o<t.length;o+=2)e=Math.min(e,t[o]),n=Math.max(n,t[o]),r=Math.min(r,t[o+1]),i=Math.max(i,t[o+1]);this.minX=e,this.maxX=n,this.minY=r,this.maxY=i}Object.defineProperty(e,"__esModule",{value:!0});var i={mergeRoadPath:function(t,e){if(t){for(var n=[],r=0;r<t.length;r++)if(0==n.length)n.push(t[r]);else{for(var i=t[r].split(","),o=!1,a=0;a<n.length;a++){var s=n[a].split(",");if(i[0]===s[s.length-2]&&i[1]===s[s.length-1]){var u=i.slice(2);n[a]+=","+u.join(","),o=!0}if(i[i.length-2]===s[0]&&i[i.length-1]===s[1]){var u=i.slice(0,i.length-2);n[a]=u.join(",")+","+n[a],o=!0}}!1===o&&n.push(t[r])}return n=this.uniqueRoadPath(n)}},uniqueRoadPath:function(t){for(var e=t.map(function(t){return new r(t.split(","))}),n=0;n<e.length-1;n++)if(e[n])for(var i=e[n],o=n+1;o<e.length;o++)if(e[o]){var a=e[o];a.isInclude(i)&&delete e[o]}var s=[];return e.map(function(t){t&&s.push(t.getPoints().join(","))}),s}};r.prototype.getPoints=function(){return this.polyline},r.prototype.isInBound=function(t){return t.lng>this.minX&&t.lat>this.minY&&t.lng<this.maxX&&t.lat<this.maxY},r.prototype.isInclude=function(t){if(!(t.minX>this.minX&&t.minY>this.minY&&t.maxX<this.maxX&&t.maxY<this.maxY))return!1;for(var e=this.getPoints(),n=!0,r=0;r<e.length;r+=2){0==this.isPointOnPolyline({lng:e[r],lat:e[r+1]},t)&&(n=!1)}return n},r.prototype.isPointOnPolyline=function(t,e){var n=e.getPoints();if(!e.isInBound(t))return!1;for(var r=0;r<n.length-2;r++){var i={lng:n[r],lat:n[r+1]},o={lng:n[r+2],lat:n[r+3]};if(t.lng>=Math.min(i.lng,o.lng)&&t.lng<=Math.max(i.lng,o.lng)&&t.lat>=Math.min(i.lat,o.lat)&&t.lat<=Math.max(i.lat,o.lat)){var a=(i.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(i.lat-t.lat),s=2e-10;if(s=2e-9,a<s&&a>-s)return!0}}return!1},e.default=i},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=n(2),h=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),n=JSON.stringify(this.props.data),r=JSON.stringify(t.options),i=JSON.stringify(this.props.options);e==n&&this.map&&r==i||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var n=function(e){return"bd09mc"===t.props.options.coordType?r.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},r=e.getMapType().getProjection(),i=[];this.props.data.map(function(t){"Point"===t.geometry.type?i.push(n(t.geometry.coordinates)):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map(function(t){i.push(n(t))})}),i.length>0&&e.setViewport(i,this.props.options.viewportOptions)}this.dataSet.set(this.props.data),this.layer.update({options:this.props.options})}}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer.destroy(),this.layer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map,e=this.dataSet=new l.DataSet([]);this.layer=new l.baiduMapLayer(t,e,{enableMassClear:!1})}}],[{key:"defaultProps",get:function(){return{}}}]),e}(u.default);e.default=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=n(9),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(l),c=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer&&(this.props.view.removeLayer(this.layer),this.layer.destroy(),this.layer=null)}},{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),n=JSON.stringify(this.props.data),r=JSON.stringify(t.options),i=JSON.stringify(this.props.options);this.map&&e===n&&r===i||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var n=e.getMapType().getProjection(),r=function(e){return"bd09mc"===t.props.options.coordType?n.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},i=[];this.props.data.map(function(t){"Point"===t.geometry.type?i.push(r(t.geometry.coordinates)):"LineString"===t.geometry.type?t.geometry.coordinates.map(function(t){i.push(r(t))}):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map(function(t){i.push(r(t))})}),i.length>0&&e.setViewport(i,this.props.options.viewportOptions)}this.layer.setData(this.props.data),this.layer.setOptions(this.props.options)}}},{key:"createLayers",value:function(){h[this.props.type]?(this._createLayer=!0,this.layer=new h[this.props.type](this.props.options),this.props.view.addLayer(this.layer)):console.error("mapvgl doesn't have layer "+this.props.type+"!")}}],[{key:"defaultProps",get:function(){return{}}}]),e}(u.default);e.default=c},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=r(u),h=n(0),c=r(h),f=n(9),p=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"componentDidMount",value:function(){this.initialize(),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.mapvglView&&(this.mapvglView.destroy(),this.mapvglView=null)}},{key:"componentDidUpdate",value:function(t){this.map&&this.mapvglView||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;if(t&&(this.map=t,!this.mapvglView)){var e=[],n=this.props.effects;n&&n.length&&n.forEach(function(t){"bloom"===t?e.push(new f.BloomEffect):"bright"===t?e.push(new f.BrightEffect):"blur"===t&&e.push(new f.BlurEffect)}),this.mapvglView=new f.View({mapType:"bmap",effects:e,map:t})}}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map&&this.mapvglView)return l.default.Children.map(e,function(e){if(e)return"string"==typeof e.type?e:l.default.cloneElement(e,{map:t.map,view:t.mapvglView})})}},{key:"render",value:function(){return l.default.createElement("div",{title:"mapvgl view"},this.renderChildren())}}]),e}(c.default);e.default=p},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return o(e,t),a(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.driving&&this.driving.clearResults(),this.driving=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.driving||(this.driving=new BMap.DrivingRoute(t,{renderOptions:{map:t,policy:this.props.policy||BMAP_DRIVING_POLICY_LEAST_TIME,autoViewport:void 0===this.props.autoViewport||this.props.autoViewport,viewportOptions:{zoomFactor:-1}}}));var e=this.props.start,n=this.props.end;e.lng&&e.lat&&(e=new BMap.Point(e.lng,e.lat)),n.lng&&n.lat&&(n=new BMap.Point(n.lng,n.lat)),this.driving.search(e,n)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(u.default);e.default=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=(r(u),n(4),n(0)),h=r(l),c=n(49),f=r(c),p=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n.tips=[],n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.tips.forEach(function(t){t.hide()}),this.tips=[]}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e&&(this.destroy(),this.props.data)){var n=[];this.props.data.forEach(function(r,i){var o=new f.default({isShowTipArrow:!0,changePosition:function(e){t.props.changePosition&&t.props.changePosition(e,i)},map:e,numberDirection:r.numberDirection,isShowNumber:r.isShowNumber,point:r.point,name:r.name,index:void 0!==r.index?r.index:i+1,color:r.color,change:function(){}});n.push(r.point),o.show(),t.tips.push(o)}),this.props.autoViewport&&e.setViewport(n,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(h.default);e.default=p},function(t,e,n){"use strict";function r(t){this.options=t;var e=t.map,n=t.point;this.point=n;t.name;this.map=e;var r=this.tip=new o.default(t),i=new BMap.Icon("//huiyan.baidu.com/github/tools/gis-drawing/static/images/drag.png",new BMap.Size(25,25),{imageSize:new BMap.Size(25,25)}),a=this.marker=new BMap.Marker(this.point);a.setIcon(i),a.setShadow(i);var s=this;a.addEventListener("dragging",function(){s.point=a.point,r.setPosition(a.point),t.change&&t.change()}),a.addEventListener("dragend",function(){t.changePosition&&t.changePosition(s.point)}),a.enableDragging()}Object.defineProperty(e,"__esModule",{value:!0});var i=n(50),o=function(t){return t&&t.__esModule?t:{default:t}}(i);r.prototype.show=function(){this.map.addOverlay(this.marker),this.map.addOverlay(this.tip),!1===this.options.isShowTipArrow&&this.tip.hideArrow()},r.prototype.hide=function(){this.map.removeOverlay(this.marker),this.map.removeOverlay(this.tip)},r.prototype.setNumberLeft=function(){this.tip.setNumberLeft()},r.prototype.setNumberRight=function(){this.tip.setNumberRight()},r.prototype.hideNumber=function(){this.tip.hideNumber()},e.default=r},function(t,e,n){"use strict";function r(t){t=t||{},this._point=t.point,this._text=t.name,this._index=t.index,this._numberDirection=t.numberDirection||"left",this._isShowNumber=void 0===t.isShowNumber||t.isShowNumber,this.color=t.color||"#ee5d5b"}Object.defineProperty(e,"__esModule",{value:!0});var i={"#ee5d5b":"0 0","#ff9625":"0 -10px","#6caeca":"0 -20px"},o={"#ee5d5b":"#BC3B3A","#ff9625":"#c57f1d","#6caeca":"#5188a5"};r.prototype=new BMap.Overlay,r.prototype.changeColor=function(t){this._div&&(this._div.style.backgroundColor=t,this._div.style.borderColor=o[t],this._arrow.style.backgroundPosition=i[t])},r.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.style.position="absolute",e.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),e.style.backgroundColor=this.color,e.style.border="1px solid "+o[this.color],e.style.color="white",e.style.height="38px",e.style.boxSizing="border-box",e.style.padding="5px",e.style.whiteSpace="nowrap",e.style.MozUserSelect="none",e.style.fontSize="18px",e.style.border="1px solid #a67972",e.style.color="#494947",e.style.background="#fff",e.style.borderRadius="25px",e.style.paddingLeft="30px";var n=this._span=document.createElement("span");e.appendChild(n),n.appendChild(document.createTextNode(this._text));var r=this._arrow=document.createElement("div");r.style.backgroundPosition=i[this.color],r.style.position="absolute",r.style.width="11px",r.style.height="10px",r.style.top="26px",r.style.left="10px",r.style.overflow="hidden",e.appendChild(r);var a=this._number=document.createElement("div");return a.style.background=this.color||"#f15e5c",a.style.color="#fff",a.style.position="absolute",a.style.top="3px",a.style.position="absolute",a.style.textAlign="center",a.style.height="30px",a.style.width="30px",a.style.lineHeight="30px",a.style.borderRadius="30px",!1===this._isShowNumber&&(a.style.display="none"),this.renderDirection(),a.innerHTML=this._index,e.appendChild(a),t.getPanes().labelPane.appendChild(e),e},r.prototype.setNumberLeft=function(){this._numberDirection="left",this.renderDirection()},r.prototype.setNumberRight=function(){this._numberDirection="right",this.renderDirection()},r.prototype.renderDirection=function(){"left"==this._numberDirection?(this._isShowNumber?this._div.style.paddingLeft="38px":this._div.style.paddingLeft="8px",this._div.style.paddingRight="8px",this._number.style.left="5px",this._number.style.right="initial"):(this._div.style.paddingLeft="8px",this._isShowNumber?this._div.style.paddingRight="38px":this._div.style.paddingRight="8px",this._number.style.left="initial",this._number.style.right="5px")},r.prototype.hideNumber=function(){this._isShowNumber=!1,this._number.style.display="none",this.renderDirection()},r.prototype.setPosition=function(t){this._point=t,this.draw()},r.prototype.hideArrow=function(){this._arrow.style.display="none"},r.prototype.draw=function(){var t=this._map;this._span.innerHTML=this._text;var e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x+5+"px",this._div.style.top=e.y-20+"px"},e.default=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=(r(u),n(0)),h=r(l),c=n(2),f=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null,this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new c.DataSet([]),this.lineLayer=new c.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new c.DataSet([]),this.pointLayer=new c.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new c.baiduMapLayer(t,this.pointDataSet,{}),this.props.enableAnimation&&(this.animationLayer=new c.baiduMapAnimationLayer(t,this.lineDataSet,{}))}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var n=[],r=[];if(this.props.data){var i=[],o=e.getMapType().getProjection();this.props.data.forEach(function(a,s){var u=a.from.point||c.utilCityCenter.getCenterByCityName(a.from.city),l=a.to.point||c.utilCityCenter.getCenterByCityName(a.to.city),h=c.utilCurve.getPoints([u,l]);"bd09mc"===t.props.coordType?(i.push(o.pointToLngLat(new BMap.Pixel(u.lng,u.lat))),i.push(o.pointToLngLat(new BMap.Pixel(l.lng,l.lat)))):(i.push(u),i.push(l)),n.push({strokeStyle:a.color,geometry:{type:"LineString",coordinates:h}}),!1!==t.props.showToPoint&&r.push({fillStyle:a.color,text:a.to.name||a.to.city,geometry:{type:"Point",coordinates:[l.lng,l.lat]}}),!1!==t.props.showFromPoint&&r.push({fillStyle:a.color,text:a.from.name||a.from.city,geometry:{type:"Point",coordinates:[u.lng,u.lat]}}),i.length>0&&!1!==t.props.autoViewport&&e.setViewport(i,t.props.viewportOptions)})}this.lineDataSet.set(n),this.lineLayer.update({options:this.props.lineOptions||{draw:"simple",strokeStyle:"#5E87DB",lineWidth:3}}),this.pointDataSet.set(r),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}}),this.props.enableAnimation?this.animationLayer.update({options:this.props.animationOptions||{coordType:this.props.coordType,fillStyle:"rgba(255, 250, 250, 0.9)",lineWidth:0,size:4,animateTime:50,draw:"simple"}}):this.animationLayer&&this.animationLayer.hide()}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(h.default);e.default=f},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=(r(u),n(0)),h=r(l),c=n(2),f=function(t){function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={},n}return a(e,t),s(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new c.DataSet([]),this.lineLayer=new c.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new c.DataSet([]),this.pointLayer=new c.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new c.baiduMapLayer(t,this.pointDataSet,{})}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var n=[],r=[],i=Boolean("curve"===this.props.type);if(this.props.data){var o=[],a=e.getMapType().getProjection();this.props.data.forEach(function(s,u){var l=s.from.point||c.utilCityCenter.getCenterByCityName(s.from.city),h=s.to.point||c.utilCityCenter.getCenterByCityName(s.to.city),f=c.utilCurve.getPoints([l,h]);"bd09mc"===t.props.coordType?(o.push(a.pointToLngLat(new BMap.Pixel(l.lng,l.lat))),o.push(a.pointToLngLat(new BMap.Pixel(h.lng,h.lat)))):(o.push(l),o.push(h));var p=new c.utilDataRangeIntensity({maxSize:10,minSize:1,min:t.props.min||0,max:t.props.max||1e3}),d=p.getSize(s.count);n.push({strokeStyle:s.color,geometry:{type:"LineString",coordinates:i?f:[[l.lng,l.lat],[h.lng,h.lat]]},count:s.count,lineWidth:d}),!1!==t.props.showToPoint&&r.push({fillStyle:s.color,text:s.to.name||s.to.city,geometry:{type:"Point",coordinates:[h.lng,h.lat]}}),!1!==t.props.showFromPoint&&r.push({fillStyle:s.color,text:s.from.name||s.from.city,geometry:{type:"Point",coordinates:[l.lng,l.lat]}}),o.length>0&&!1!==t.props.autoViewport&&e.setViewport(o,t.props.viewportOptions)})}this.lineDataSet.set(n),this.lineLayer.update({options:this.props.lineOptions||{coordType:this.props.coordType,draw:"simple",strokeStyle:"#5E87DB",globalCompositeOperation:"lighter",shadowColor:"rgba(255, 255, 255, 0.5)",shadowBlur:60,lineWidth:2}}),this.pointDataSet.set(r),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5,shadowColor:"#5E87DB",shadowBlur:20}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}})}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(h.default);e.default=f},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){var n=null;return function(){var r=this,i=arguments;n&&clearTimeout(n),n=setTimeout(function(){t.apply(r,i)},e)}}function s(t,e){var n=void 0,r=arguments,i=void 0;return function o(){var a=this,s=Date.now();i||(i=s),n&&clearTimeout(n),s-i>=e?(t.apply(a,r),i=s):n=setTimeout(function(){o.apply(a,r)},50)}}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(1),h=function(t){return t&&t.__esModule?t:{default:t}}(l),c=function(t){function e(t){r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.map=n.props.map,n}return o(e,t),u(e,[{key:"componentDidMount",value:function(){this.props.onZoomend&&this._bindZoomendEvent(),this.props.onDragend&&this._bindDragendEvent()}},{key:"componentWillUnmount",value:function(){var t=this.map;this.props.onZoomend&&t.removeEventListener("zoomend",this.onZoomend),this.props.onDragend&&t.removeEventListener("dragend",this.onDragend)}},{key:"_bindZoomendEvent",value:function(){var t=this.map,e=this.props,n=e.onZoomend,r=e.eventType,i=e.delay;this.onZoomend="debounce"===r?a(n,i):"throttle"===r?s(n,i):n,t.addEventListener("zoomend",this.onZoomend)}},{key:"_bindDragendEvent",value:function(){var t=this.map,e=this.props,n=e.onDragend,r=e.eventType,i=e.delay;this.onDragend="debounce"===r?a(n,i):"throttle"===r?s(n,i):n,t.addEventListener("dragend",this.onDragend)}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{eventType:"debounce",delay:500}}}]),e}(h.default.Component);e.default=c},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),l=r(u),h=n(0),c=r(h),f=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"componentDidMount",value:function(){var t=this;new BMap.Autocomplete({input:"suggestId"}).addEventListener("onconfirm",function(e){t.props.onConfirm&&t.props.onConfirm(e)})}},{key:"render",value:function(){return l.default.createElement("div",null,l.default.createElement("input",{style:this.props.style,id:"suggestId"}))}}]),e}(c.default);e.default=f}])});